import './polyfills.server.mjs';
import{$ as Sc,A as Cn,Aa as ia,B as zn,Ba as _h,C as ge,Ca as $A,D as Z,Da as HA,E as pt,F as _c,G as fr,Ga as KA,H as Gn,I as Xr,J as Ti,K as LA,Ka as QA,L as Ly,La as vh,M as By,N as Vy,Na as Eh,O as BA,Oa as sa,P as Jr,Pa as YA,Q as Uy,Qa as oa,R as vc,S as pr,T as wn,U as Ve,V as qy,W as vt,X as zs,Y as Ec,Z as VA,_ as zy,a as ur,aa as UA,b as DA,ba as qA,c as ra,ca as zA,d as NA,da as ve,e as wi,ea as he,f as Us,fa as Zr,g as dr,ga as GA,h as hr,ha as bi,i as Be,ia as Gy,j as kA,ja as Te,k as gc,ka as Cc,l as yc,la as gh,m as dh,ma as mr,n as OA,na as Wy,o as hh,oa as yh,p as qs,q as xA,qa as WA,r as My,s as PA,t as fh,u as Yr,v as Fy,va as jy,w as MA,x as FA,xa as jA,y as ph,ya as $y,z as mh}from"./chunk-ADD4D4WV.mjs";import{A as sR,B as ee,C as Zt,D as mt,E as Yy,F as oR,G as bc,H as ue,I as ln,J as Ah,K as Xy,L as bn,M as Ai,N as Gs,O as Ic,P as Rh,Q as aR,R as Ws,S as Dh,T as et,U as gt,V as yV,W as Jy,a as L,b as aa,c as Sh,d as XA,e as JA,f as Ch,g as Et,h as wh,i as wc,j as Hy,k as ZA,l as gr,m as Ky,n as Th,o as eR,p as tR,q as bh,r as lt,s as nR,t as rR,u as Tn,v as Ii,w as Ih,x as Tc,y as Qy,z as iR}from"./chunk-JMPTLJPU.mjs";import{a as Ut,b as Sn,c as X,f as A,h as uh,i as Py,j as T}from"./chunk-H6KHSOBK.mjs";var _r=A((u_,NR)=>{"use strict";var Ph=X("buffer"),yr=Ph.Buffer;function DR(n,e){for(var t in n)e[t]=n[t]}yr.from&&yr.alloc&&yr.allocUnsafe&&yr.allocUnsafeSlow?NR.exports=Ph:(DR(Ph,u_),u_.Buffer=Ks);function Ks(n,e,t){return yr(n,e,t)}Ks.prototype=Object.create(yr.prototype);DR(yr,Ks);Ks.from=function(n,e,t){if(typeof n=="number")throw new TypeError("Argument must not be a number");return yr(n,e,t)};Ks.alloc=function(n,e,t){if(typeof n!="number")throw new TypeError("Argument must be a number");var r=yr(n);return e!==void 0?typeof t=="string"?r.fill(e,t):r.fill(e):r.fill(0),r};Ks.allocUnsafe=function(n){if(typeof n!="number")throw new TypeError("Argument must be a number");return yr(n)};Ks.allocUnsafeSlow=function(n){if(typeof n!="number")throw new TypeError("Argument must be a number");return Ph.SlowBuffer(n)}});var xR=A(d_=>{"use strict";var kR=X("stream").Stream,OR=X("util"),Qs=function(n){this.readable=this.writable=!0,this._paused=!1,this._driver=n};OR.inherits(Qs,kR);Qs.prototype.pause=function(){this._paused=!0,this._driver.messages._paused=!0};Qs.prototype.resume=function(){this._paused=!1,this.emit("drain");var n=this._driver.messages;n._paused=!1,n.emit("drain")};Qs.prototype.write=function(n){return this.writable?(this._driver.parse(n),!this._paused):!1};Qs.prototype.end=function(n){if(this.writable){n!==void 0&&this.write(n),this.writable=!1;var e=this._driver.messages;e.readable&&(e.readable=e.writable=!1,e.emit("end"))}};Qs.prototype.destroy=function(){this.end()};var Ys=function(n){this.readable=this.writable=!0,this._paused=!1,this._driver=n};OR.inherits(Ys,kR);Ys.prototype.pause=function(){this._driver.io._paused=!0};Ys.prototype.resume=function(){this._driver.io._paused=!1,this._driver.io.emit("drain")};Ys.prototype.write=function(n){return this.writable?(typeof n=="string"?this._driver.text(n):this._driver.binary(n),!this._paused):!1};Ys.prototype.end=function(n){n!==void 0&&this.write(n)};Ys.prototype.destroy=function(){};d_.IO=Qs;d_.Messages=Ys});var Mh=A((Wne,PR)=>{"use strict";var da=function(){this.clear()};da.prototype.ALLOWED_DUPLICATES=["set-cookie","set-cookie2","warning","www-authenticate"];da.prototype.clear=function(){this._sent={},this._lines=[]};da.prototype.set=function(n,e){if(e!==void 0){n=this._strip(n),e=this._strip(e);var t=n.toLowerCase();(!this._sent.hasOwnProperty(t)||this.ALLOWED_DUPLICATES.indexOf(t)>=0)&&(this._sent[t]=!0,this._lines.push(n+": "+e+`\r
`))}};da.prototype.toString=function(){return this._lines.join("")};da.prototype._strip=function(n){return n.toString().replace(/^ */,"").replace(/ *$/,"")};PR.exports=da});var FR=A((jne,MR)=>{"use strict";var Fh=_r().Buffer,Lh=function(){this._queue=[],this._queueSize=0,this._offset=0};Lh.prototype.put=function(n){!n||n.length===0||(Fh.isBuffer(n)||(n=Fh.from(n)),this._queue.push(n),this._queueSize+=n.length)};Lh.prototype.read=function(n){if(n>this._queueSize)return null;if(n===0)return Fh.alloc(0);this._queueSize-=n;var e=this._queue,t=n,r=e[0],i,s;if(r.length>=n)return r.length===n?e.shift():(s=r.slice(0,n),e[0]=r.slice(n),s);for(var o=0,a=e.length;o<a&&!(t<e[o].length);o++)t-=e[o].length;return i=e.splice(0,o),t>0&&e.length>0&&(i.push(e[0].slice(0,t)),e[0]=e[0].slice(t)),Fh.concat(i,n)};Lh.prototype.eachByte=function(n,e){for(var t,r,i;this._queue.length>0;){for(t=this._queue[0],r=t.length;this._offset<r;)i=this._offset,this._offset+=1,n.call(e,t[i]);this._offset=0,this._queue.shift()}};MR.exports=Lh});var Oi=A(($ne,zR)=>{"use strict";var LR=_r().Buffer,UR=X("events").EventEmitter,aU=X("util"),BR=xR(),qR=Mh(),lU=FR(),zt=function(n,e,t){UR.call(this),zt.validateOptions(t||{},["maxLength","masking","requireMasking","protocols"]),this._request=n,this._reader=new lU,this._options=t||{},this._maxLength=this._options.maxLength||this.MAX_LENGTH,this._headers=new qR,this.__queue=[],this.readyState=0,this.url=e,this.io=new BR.IO(this),this.messages=new BR.Messages(this),this._bindEventListeners()};aU.inherits(zt,UR);zt.isWebSocket=function(n){var e=n.headers.connection||"",t=n.headers.upgrade||"";return n.method==="GET"&&e.toLowerCase().split(/ *, */).indexOf("upgrade")>=0&&t.toLowerCase()==="websocket"};zt.validateOptions=function(n,e){for(var t in n)if(e.indexOf(t)<0)throw new Error("Unrecognized option: "+t)};var VR={MAX_LENGTH:67108863,STATES:["connecting","open","closing","closed"],_bindEventListeners:function(){var n=this;this.messages.on("error",function(){}),this.on("message",function(e){var t=n.messages;t.readable&&t.emit("data",e.data)}),this.on("error",function(e){var t=n.messages;t.readable&&t.emit("error",e)}),this.on("close",function(){var e=n.messages;e.readable&&(e.readable=e.writable=!1,e.emit("end"))})},getState:function(){return this.STATES[this.readyState]||null},addExtension:function(n){return!1},setHeader:function(n,e){return this.readyState>0?!1:(this._headers.set(n,e),!0)},start:function(){if(this.readyState!==0)return!1;if(!zt.isWebSocket(this._request))return this._failHandshake(new Error("Not a WebSocket request"));var n;try{n=this._handshakeResponse()}catch(e){return this._failHandshake(e)}return this._write(n),this._stage!==-1&&this._open(),!0},_failHandshake:function(n){var e=new qR;return e.set("Content-Type","text/plain"),e.set("Content-Length",LR.byteLength(n.message,"utf8")),e=["HTTP/1.1 400 Bad Request",e.toString(),n.message],this._write(LR.from(e.join(`\r
`),"utf8")),this._fail("protocol_error",n.message),!1},text:function(n){return this.frame(n)},binary:function(n){return!1},ping:function(){return!1},pong:function(){return!1},close:function(n,e){return this.readyState!==1?!1:(this.readyState=3,this.emit("close",new zt.CloseEvent(null,null)),!0)},_open:function(){this.readyState=1,this.__queue.forEach(function(n){this.frame.apply(this,n)},this),this.__queue=[],this.emit("open",new zt.OpenEvent)},_queue:function(n){return this.__queue.push(n),!0},_write:function(n){var e=this.io;e.readable&&e.emit("data",n)},_fail:function(n,e){this.readyState=2,this.emit("error",new Error(e)),this.close()}};for(h_ in VR)zt.prototype[h_]=VR[h_];var h_;zt.ConnectEvent=function(){};zt.OpenEvent=function(){};zt.CloseEvent=function(n,e){this.code=n,this.reason=e};zt.MessageEvent=function(n){this.data=n};zt.PingEvent=function(n){this.data=n};zt.PongEvent=function(n){this.data=n};zR.exports=zt});var HR=A(m_=>{"use strict";m_.HTTPParser=K;function K(n){if(n!==void 0&&n!==K.REQUEST&&n!==K.RESPONSE)throw new Error("type must be REQUEST or RESPONSE");n===void 0||this.initialize(n),this.maxHeaderSize=K.maxHeaderSize}K.prototype.initialize=function(n,e){if(n!==K.REQUEST&&n!==K.RESPONSE)throw new Error("type must be REQUEST or RESPONSE");this.type=n,this.state=n+"_LINE",this.info={headers:[],upgrade:!1},this.trailers=[],this.line="",this.isChunked=!1,this.connection="",this.headerSize=0,this.body_bytes=null,this.isUserCall=!1,this.hadError=!1};K.encoding="ascii";K.maxHeaderSize=80*1024;K.REQUEST="REQUEST";K.RESPONSE="RESPONSE";var GR=K.kOnHeaders=1,f_=K.kOnHeadersComplete=2,Bh=K.kOnBody=3,p_=K.kOnMessageComplete=4;K.prototype[GR]=K.prototype[f_]=K.prototype[Bh]=K.prototype[p_]=function(){};var WR=!0;Object.defineProperty(K,"kOnExecute",{get:function(){return WR=!1,99}});var jR=m_.methods=K.methods=["DELETE","GET","HEAD","POST","PUT","CONNECT","OPTIONS","TRACE","COPY","LOCK","MKCOL","MOVE","PROPFIND","PROPPATCH","SEARCH","UNLOCK","BIND","REBIND","UNBIND","ACL","REPORT","MKACTIVITY","CHECKOUT","MERGE","M-SEARCH","NOTIFY","SUBSCRIBE","UNSUBSCRIBE","PATCH","PURGE","MKCALENDAR","LINK","UNLINK","SOURCE"],$R=jR.indexOf("CONNECT");K.prototype.reinitialize=K;K.prototype.close=K.prototype.pause=K.prototype.resume=K.prototype.remove=K.prototype.free=function(){};K.prototype._compatMode0_11=!1;K.prototype.getAsyncId=function(){return 0};var cU={REQUEST_LINE:!0,RESPONSE_LINE:!0,HEADER:!0};K.prototype.execute=function(n,e,t){if(!(this instanceof K))throw new TypeError("not a HTTPParser");e=e||0,t=typeof t=="number"?t:n.length,this.chunk=n,this.offset=e;var r=this.end=e+t;try{for(;this.offset<r&&!this[this.state](););}catch(i){if(this.isUserCall)throw i;return this.hadError=!0,i}return this.chunk=null,t=this.offset-e,cU[this.state]&&(this.headerSize+=t,this.headerSize>(this.maxHeaderSize||K.maxHeaderSize))?new Error("max header size exceeded"):t};var uU={REQUEST_LINE:!0,RESPONSE_LINE:!0,BODY_RAW:!0};K.prototype.finish=function(){if(!this.hadError){if(!uU[this.state])return new Error("invalid state for EOF");this.state==="BODY_RAW"&&this.userCall()(this[p_]())}};K.prototype.consume=K.prototype.unconsume=K.prototype.getCurrentBuffer=function(){};K.prototype.userCall=function(){this.isUserCall=!0;var n=this;return function(e){return n.isUserCall=!1,e}};K.prototype.nextRequest=function(){this.userCall()(this[p_]()),this.reinitialize(this.type)};K.prototype.consumeLine=function(){for(var n=this.end,e=this.chunk,t=this.offset;t<n;t++)if(e[t]===10){var r=this.line+e.toString(K.encoding,this.offset,t);return r.charAt(r.length-1)==="\r"&&(r=r.substr(0,r.length-1)),this.line="",this.offset=t+1,r}this.line+=e.toString(K.encoding,this.offset,this.end),this.offset=this.end};var dU=/^([^: \t]+):[ \t]*((?:.*[^ \t])|)/,hU=/^[ \t]+(.*[^ \t])/;K.prototype.parseHeader=function(n,e){if(n.indexOf("\r")!==-1)throw Vh("HPE_LF_EXPECTED");var t=dU.exec(n),r=t&&t[1];if(r)e.push(r),e.push(t[2]);else{var i=hU.exec(n);i&&e.length&&(e[e.length-1]&&(e[e.length-1]+=" "),e[e.length-1]+=i[1])}};var fU=/^([A-Z-]+) ([^ ]+) HTTP\/(\d)\.(\d)$/;K.prototype.REQUEST_LINE=function(){var n=this.consumeLine();if(n){var e=fU.exec(n);if(e===null)throw Vh("HPE_INVALID_CONSTANT");if(this.info.method=this._compatMode0_11?e[1]:jR.indexOf(e[1]),this.info.method===-1)throw new Error("invalid request method");this.info.url=e[2],this.info.versionMajor=+e[3],this.info.versionMinor=+e[4],this.body_bytes=0,this.state="HEADER"}};var pU=/^HTTP\/(\d)\.(\d) (\d{3}) ?(.*)$/;K.prototype.RESPONSE_LINE=function(){var n=this.consumeLine();if(n){var e=pU.exec(n);if(e===null)throw Vh("HPE_INVALID_CONSTANT");this.info.versionMajor=+e[1],this.info.versionMinor=+e[2];var t=this.info.statusCode=+e[3];this.info.statusMessage=e[4],((t/100|0)===1||t===204||t===304)&&(this.body_bytes=0),this.state="HEADER"}};K.prototype.shouldKeepAlive=function(){if(this.info.versionMajor>0&&this.info.versionMinor>0){if(this.connection.indexOf("close")!==-1)return!1}else if(this.connection.indexOf("keep-alive")===-1)return!1;return!!(this.body_bytes!==null||this.isChunked)};K.prototype.HEADER=function(){var n=this.consumeLine();if(n!==void 0){var e=this.info;if(n)this.parseHeader(n,e.headers);else{for(var t=e.headers,r=!1,i,s=!1,o=0;o<t.length;o+=2)switch(t[o].toLowerCase()){case"transfer-encoding":this.isChunked=t[o+1].toLowerCase()==="chunked";break;case"content-length":if(i=+t[o+1],r){if(i!==this.body_bytes)throw Vh("HPE_UNEXPECTED_CONTENT_LENGTH")}else r=!0,this.body_bytes=i;break;case"connection":this.connection+=t[o+1].toLowerCase();break;case"upgrade":s=!0;break}this.isChunked&&r&&(r=!1,this.body_bytes=null),s&&this.connection.indexOf("upgrade")!=-1?e.upgrade=this.type===K.REQUEST||e.statusCode===101:e.upgrade=e.method===$R,this.isChunked&&e.upgrade&&(this.isChunked=!1),e.shouldKeepAlive=this.shouldKeepAlive();var a;if(WR?a=this.userCall()(this[f_](e)):a=this.userCall()(this[f_](e.versionMajor,e.versionMinor,e.headers,e.method,e.url,e.statusCode,e.statusMessage,e.upgrade,e.shouldKeepAlive)),a===2)return this.nextRequest(),!0;if(this.isChunked&&!a)this.state="BODY_CHUNKHEAD";else{if(a||this.body_bytes===0)return this.nextRequest(),e.upgrade;this.body_bytes===null?this.state="BODY_RAW":this.state="BODY_SIZED"}}}};K.prototype.BODY_CHUNKHEAD=function(){var n=this.consumeLine();n!==void 0&&(this.body_bytes=parseInt(n,16),this.body_bytes?this.state="BODY_CHUNK":this.state="BODY_CHUNKTRAILERS")};K.prototype.BODY_CHUNK=function(){var n=Math.min(this.end-this.offset,this.body_bytes);this.userCall()(this[Bh](this.chunk.slice(this.offset,this.offset+n),0,n)),this.offset+=n,this.body_bytes-=n,this.body_bytes||(this.state="BODY_CHUNKEMPTYLINE")};K.prototype.BODY_CHUNKEMPTYLINE=function(){var n=this.consumeLine();if(n!==void 0){if(n!=="")throw new Error("Expected empty line");this.state="BODY_CHUNKHEAD"}};K.prototype.BODY_CHUNKTRAILERS=function(){var n=this.consumeLine();n!==void 0&&(n?this.parseHeader(n,this.trailers):(this.trailers.length&&this.userCall()(this[GR](this.trailers,"")),this.nextRequest()))};K.prototype.BODY_RAW=function(){this.userCall()(this[Bh](this.chunk.slice(this.offset,this.end),0,this.end-this.offset)),this.offset=this.end};K.prototype.BODY_SIZED=function(){var n=Math.min(this.end-this.offset,this.body_bytes);this.userCall()(this[Bh](this.chunk.slice(this.offset,this.offset+n),0,n)),this.offset+=n,this.body_bytes-=n,this.body_bytes||this.nextRequest()};["Headers","HeadersComplete","Body","MessageComplete"].forEach(function(n){var e=K["kOn"+n];Object.defineProperty(K.prototype,"on"+n,{get:function(){return this[e]},set:function(t){return this._compatMode0_11=!0,$R="CONNECT",this[e]=t}})});function Vh(n){var e=new Error("Parse Error");return e.code=n,e}});var qh=A((Kne,QR)=>{"use strict";var Uh=HR().HTTPParser,mU=_r().Buffer,gU={request:Uh.REQUEST||"request",response:Uh.RESPONSE||"response"},Gt=function(n){this._type=n,this._parser=new Uh(gU[n]),this._complete=!1,this.headers={};var e=null,t=this;this._parser.onHeaderField=function(r,i,s){e=r.toString("utf8",i,i+s).toLowerCase()},this._parser.onHeaderValue=function(r,i,s){var o=r.toString("utf8",i,i+s);t.headers.hasOwnProperty(e)?t.headers[e]+=", "+o:t.headers[e]=o},this._parser.onHeadersComplete=this._parser[Uh.kOnHeadersComplete]=function(r,i,s,o,a,l){var c=arguments[0];if(typeof c=="object"&&(o=c.method,a=c.url,l=c.statusCode,s=c.headers),t.method=typeof o=="number"?Gt.METHODS[o]:o,t.statusCode=l,t.url=a,!!s){for(var u=0,d=s.length,h,p;u<d;u+=2)h=s[u].toLowerCase(),p=s[u+1],t.headers.hasOwnProperty(h)?t.headers[h]+=", "+p:t.headers[h]=p;t._complete=!0}}};Gt.METHODS={0:"DELETE",1:"GET",2:"HEAD",3:"POST",4:"PUT",5:"CONNECT",6:"OPTIONS",7:"TRACE",8:"COPY",9:"LOCK",10:"MKCOL",11:"MOVE",12:"PROPFIND",13:"PROPPATCH",14:"SEARCH",15:"UNLOCK",16:"BIND",17:"REBIND",18:"UNBIND",19:"ACL",20:"REPORT",21:"MKACTIVITY",22:"CHECKOUT",23:"MERGE",24:"M-SEARCH",25:"NOTIFY",26:"SUBSCRIBE",27:"UNSUBSCRIBE",28:"PATCH",29:"PURGE",30:"MKCALENDAR",31:"LINK",32:"UNLINK"};var KR=process.version?process.version.match(/[0-9]+/g).map(function(n){return parseInt(n,10)}):[];KR[0]===0&&KR[1]===12&&(Gt.METHODS[16]="REPORT",Gt.METHODS[17]="MKACTIVITY",Gt.METHODS[18]="CHECKOUT",Gt.METHODS[19]="MERGE",Gt.METHODS[20]="M-SEARCH",Gt.METHODS[21]="NOTIFY",Gt.METHODS[22]="SUBSCRIBE",Gt.METHODS[23]="UNSUBSCRIBE",Gt.METHODS[24]="PATCH",Gt.METHODS[25]="PURGE");Gt.prototype.isComplete=function(){return this._complete};Gt.prototype.parse=function(n){var e=this._parser.execute(n,0,n.length);if(typeof e!="number"){this.error=e,this._complete=!0;return}this._complete&&(this.body=e<n.length?n.slice(e):mU.alloc(0))};QR.exports=Gt});var JR=A((Qne,XR)=>{"use strict";var g_=/([!#\$%&'\*\+\-\.\^_`\|~0-9A-Za-z]+)/,yU=/([^!#\$%&'\*\+\-\.\^_`\|~0-9A-Za-z])/g,_U=/"((?:\\[\x00-\x7f]|[^\x00-\x08\x0a-\x1f\x7f"\\])*)"/,y_=new RegExp(g_.source+"(?:=(?:"+g_.source+"|"+_U.source+"))?"),__=new RegExp(g_.source+"(?: *; *"+y_.source+")*","g"),vU=new RegExp("^"+__.source+"(?: *, *"+__.source+")*$"),EU=/^-?(0|[1-9][0-9]*)(\.[0-9]+)?$/,YR=Object.prototype.hasOwnProperty,SU={parseHeader:function(n){var e=new Fc;if(n===""||n===void 0)return e;if(!vU.test(n))throw new SyntaxError("Invalid Sec-WebSocket-Extensions header: "+n);var t=n.match(__);return t.forEach(function(r){var i=r.match(new RegExp(y_.source,"g")),s=i.shift(),o={};i.forEach(function(a){var l=a.match(y_),c=l[1],u;l[2]!==void 0?u=l[2]:l[3]!==void 0?u=l[3].replace(/\\/g,""):u=!0,EU.test(u)&&(u=parseFloat(u)),YR.call(o,c)?(o[c]=[].concat(o[c]),o[c].push(u)):o[c]=u},this),e.push(s,o)},this),e},serializeParams:function(n,e){var t=[],r=function(s,o){o instanceof Array?o.forEach(function(a){r(s,a)}):o===!0?t.push(s):typeof o=="number"?t.push(s+"="+o):yU.test(o)?t.push(s+'="'+o.replace(/"/g,'\\"')+'"'):t.push(s+"="+o)};for(var i in e)r(i,e[i]);return[n].concat(t).join("; ")}},Fc=function(){this._byName={},this._inOrder=[]};Fc.prototype.push=function(n,e){YR.call(this._byName,n)||(this._byName[n]=[]),this._byName[n].push(e),this._inOrder.push({name:n,params:e})};Fc.prototype.eachOffer=function(n,e){for(var t=this._inOrder,r=0,i=t.length;r<i;r++)n.call(e,t[r].name,t[r].params)};Fc.prototype.byName=function(n){return this._byName[n]||[]};Fc.prototype.toArray=function(){return this._inOrder.slice()};XR.exports=SU});var v_=A((Yne,ZR)=>{"use strict";var Lc=function(n){this._bufferSize=n,this.clear()};Lc.prototype.clear=function(){this._buffer=new Array(this._bufferSize),this._ringOffset=0,this._ringSize=this._bufferSize,this._head=0,this._tail=0,this.length=0};Lc.prototype.push=function(n){var e=!1,t=!1;this._ringSize<this._bufferSize?e=this._tail===0:this._ringOffset===this._ringSize&&(e=!0,t=this._tail===0),e&&(this._tail=this._bufferSize,this._buffer=this._buffer.concat(new Array(this._bufferSize)),this._bufferSize=this._buffer.length,t&&(this._ringSize=this._bufferSize)),this._buffer[this._tail]=n,this.length+=1,this._tail<this._ringSize&&(this._ringOffset+=1),this._tail=(this._tail+1)%this._bufferSize};Lc.prototype.peek=function(){if(this.length!==0)return this._buffer[this._head]};Lc.prototype.shift=function(){if(this.length!==0){var n=this._buffer[this._head];return this._buffer[this._head]=void 0,this.length-=1,this._ringOffset-=1,this._ringOffset===0&&this.length>0?(this._head=this._ringSize,this._ringOffset=this.length,this._ringSize=this._bufferSize):this._head=(this._head+1)%this._ringSize,n}};ZR.exports=Lc});var tD=A((Xne,eD)=>{"use strict";var CU=v_(),ha=function(n,e){this._session=n,this._method=e,this._queue=new CU(ha.QUEUE_SIZE),this._stopped=!1,this.pending=0};ha.QUEUE_SIZE=8;ha.prototype.call=function(n,e,t,r){if(!this._stopped){var i={error:n,message:e,callback:t,context:r,done:!1},s=!1,o=this;if(this._queue.push(i),i.error)return i.done=!0,this._stop(),this._flushQueue();var a=function(l,c){s^(s=!0)&&(l?(o._stop(),i.error=l,i.message=null):i.message=c,i.done=!0,o._flushQueue())};try{this._session[this._method](e,a)}catch(l){a(l)}}};ha.prototype._stop=function(){this.pending=this._queue.length,this._stopped=!0};ha.prototype._flushQueue=function(){for(var n=this._queue,e;n.length>0&&n.peek().done;)e=n.shift(),e.error?(this.pending=0,n.clear()):this.pending-=1,e.callback.call(e.context,e.error,e.message)};eD.exports=ha});var E_=A((Jne,nD)=>{"use strict";var wU=v_(),Xs=function(){this._complete=!1,this._callbacks=new wU(Xs.QUEUE_SIZE)};Xs.QUEUE_SIZE=4;Xs.all=function(n){var e=new Xs,t=n.length,r=t;for(t===0&&e.done();r--;)n[r].then(function(){t-=1,t===0&&e.done()});return e};Xs.prototype.then=function(n){this._complete?n():this._callbacks.push(n)};Xs.prototype.done=function(){this._complete=!0;for(var n=this._callbacks,e;e=n.shift();)e()};nD.exports=Xs});var sD=A((Zne,iD)=>{"use strict";var rD=tD(),TU=E_(),Js=function(n){this._ext=n[0],this._session=n[1],this._functors={incoming:new rD(this._session,"processIncomingMessage"),outgoing:new rD(this._session,"processOutgoingMessage")}};Js.prototype.pending=function(n){var e=this._functors[n];e._stopped||(e.pending+=1)};Js.prototype.incoming=function(n,e,t,r){this._exec("incoming",n,e,t,r)};Js.prototype.outgoing=function(n,e,t,r){this._exec("outgoing",n,e,t,r)};Js.prototype.close=function(){return this._closed=this._closed||new TU,this._doClose(),this._closed};Js.prototype._exec=function(n,e,t,r,i){this._functors[n].call(e,t,function(s,o){s&&(s.message=this._ext.name+": "+s.message),r.call(i,s,o),this._doClose()},this)};Js.prototype._doClose=function(){var n=this._functors.incoming,e=this._functors.outgoing;!this._closed||n.pending+e.pending!==0||(this._session&&this._session.close(),this._session=null,this._closed.done())};iD.exports=Js});var aD=A((ere,oD)=>{"use strict";var bU=sD(),IU=E_(),Bc=function(n){this._cells=n.map(function(e){return new bU(e)}),this._stopped={incoming:!1,outgoing:!1}};Bc.prototype.processIncomingMessage=function(n,e,t){this._stopped.incoming||this._loop("incoming",this._cells.length-1,-1,-1,n,e,t)};Bc.prototype.processOutgoingMessage=function(n,e,t){this._stopped.outgoing||this._loop("outgoing",0,this._cells.length,1,n,e,t)};Bc.prototype.close=function(n,e){this._stopped={incoming:!0,outgoing:!0};var t=this._cells.map(function(r){return r.close()});n&&IU.all(t).then(function(){n.call(e)})};Bc.prototype._loop=function(n,e,t,r,i,s,o){for(var a=this._cells,l=a.length,c=this;l--;)a[l].pending(n);var u=function(d,h,p){if(d===t)return s.call(o,h,p);a[d][n](h,p,function(E,w){E&&(c._stopped[n]=!0),u(d+r,E,w)})};u(e,null,i)};oD.exports=Bc});var dD=A((tre,uD)=>{"use strict";var Vc=JR(),lD=aD(),zh=function(){this._rsv1=this._rsv2=this._rsv3=null,this._byName={},this._inOrder=[],this._sessions=[],this._index={}};zh.MESSAGE_OPCODES=[1,2];var cD={add:function(n){if(typeof n.name!="string")throw new TypeError("extension.name must be a string");if(n.type!=="permessage")throw new TypeError('extension.type must be "permessage"');if(typeof n.rsv1!="boolean")throw new TypeError("extension.rsv1 must be true or false");if(typeof n.rsv2!="boolean")throw new TypeError("extension.rsv2 must be true or false");if(typeof n.rsv3!="boolean")throw new TypeError("extension.rsv3 must be true or false");if(this._byName.hasOwnProperty(n.name))throw new TypeError('An extension with name "'+n.name+'" is already registered');this._byName[n.name]=n,this._inOrder.push(n)},generateOffer:function(){var n=[],e=[],t={};return this._inOrder.forEach(function(r){var i=r.createClientSession();if(i){var s=[r,i];n.push(s),t[r.name]=s;var o=i.generateOffer();o=o?[].concat(o):[],o.forEach(function(a){e.push(Vc.serializeParams(r.name,a))},this)}},this),this._sessions=n,this._index=t,e.length>0?e.join(", "):null},activate:function(n){var e=Vc.parseHeader(n),t=[];e.eachOffer(function(r,i){var s=this._index[r];if(!s)throw new Error('Server sent an extension response for unknown extension "'+r+'"');var o=s[0],a=s[1],l=this._reserved(o);if(l)throw new Error("Server sent two extension responses that use the RSV"+l[0]+' bit: "'+l[1]+'" and "'+o.name+'"');if(a.activate(i)!==!0)throw new Error("Server sent unacceptable extension parameters: "+Vc.serializeParams(r,i));this._reserve(o),t.push(s)},this),this._sessions=t,this._pipeline=new lD(t)},generateResponse:function(n){var e=[],t=[],r=Vc.parseHeader(n);return this._inOrder.forEach(function(i){var s=r.byName(i.name);if(!(s.length===0||this._reserved(i))){var o=i.createServerSession(s);o&&(this._reserve(i),e.push([i,o]),t.push(Vc.serializeParams(i.name,o.generateResponse())))}},this),this._sessions=e,this._pipeline=new lD(e),t.length>0?t.join(", "):null},validFrameRsv:function(n){var e={rsv1:!1,rsv2:!1,rsv3:!1},t;if(zh.MESSAGE_OPCODES.indexOf(n.opcode)>=0)for(var r=0,i=this._sessions.length;r<i;r++)t=this._sessions[r][0],e.rsv1=e.rsv1||t.rsv1,e.rsv2=e.rsv2||t.rsv2,e.rsv3=e.rsv3||t.rsv3;return(e.rsv1||!n.rsv1)&&(e.rsv2||!n.rsv2)&&(e.rsv3||!n.rsv3)},processIncomingMessage:function(n,e,t){this._pipeline.processIncomingMessage(n,e,t)},processOutgoingMessage:function(n,e,t){this._pipeline.processOutgoingMessage(n,e,t)},close:function(n,e){if(!this._pipeline)return n.call(e);this._pipeline.close(n,e)},_reserve:function(n){this._rsv1=this._rsv1||n.rsv1&&n.name,this._rsv2=this._rsv2||n.rsv2&&n.name,this._rsv3=this._rsv3||n.rsv3&&n.name},_reserved:function(n){return this._rsv1&&n.rsv1?[1,this._rsv1]:this._rsv2&&n.rsv2?[2,this._rsv2]:this._rsv3&&n.rsv3?[3,this._rsv3]:!1}};for(S_ in cD)zh.prototype[S_]=cD[S_];var S_;uD.exports=zh});var mD=A((nre,pD)=>{"use strict";var fD=function(){},hD={final:!1,rsv1:!1,rsv2:!1,rsv3:!1,opcode:null,masked:!1,maskingKey:null,lengthBytes:1,length:0,payload:null};for(C_ in hD)fD.prototype[C_]=hD[C_];var C_;pD.exports=fD});var vD=A((rre,_D)=>{"use strict";var AU=_r().Buffer,yD=function(){this.rsv1=!1,this.rsv2=!1,this.rsv3=!1,this.opcode=null,this.length=0,this._chunks=[]},gD={read:function(){return this.data=this.data||AU.concat(this._chunks,this.length)},pushFrame:function(n){this.rsv1=this.rsv1||n.rsv1,this.rsv2=this.rsv2||n.rsv2,this.rsv3=this.rsv3||n.rsv3,this.opcode===null&&(this.opcode=n.opcode),this._chunks.push(n.payload),this.length+=n.length}};for(w_ in gD)yD.prototype[w_]=gD[w_];var w_;_D.exports=yD});var b_=A((ire,TD)=>{"use strict";var Uc=_r().Buffer,wD=X("crypto"),RU=X("util"),DU=dD(),Zs=Oi(),ED=mD(),SD=vD(),cn=function(n,e,t){if(Zs.apply(this,arguments),this._extensions=new DU,this._stage=0,this._masking=this._options.masking,this._protocols=this._options.protocols||[],this._requireMasking=this._options.requireMasking,this._pingCallbacks={},typeof this._protocols=="string"&&(this._protocols=this._protocols.split(/ *, */)),!!this._request){var r=this._request.headers["sec-websocket-protocol"],i=this._protocols;r!==void 0&&(typeof r=="string"&&(r=r.split(/ *, */)),this.protocol=r.filter(function(s){return i.indexOf(s)>=0})[0]),this.version="hybi-"+cn.VERSION}};RU.inherits(cn,Zs);cn.VERSION="13";cn.mask=function(n,e,t){if(!e||e.length===0)return n;t=t||0;for(var r=0,i=n.length-t;r<i;r++)n[t+r]=n[t+r]^e[r%4];return n};cn.generateAccept=function(n){var e=wD.createHash("sha1");return e.update(n+cn.GUID),e.digest("base64")};cn.GUID="258EAFA5-E914-47DA-95CA-C5AB0DC85B11";var CD={FIN:128,MASK:128,RSV1:64,RSV2:32,RSV3:16,OPCODE:15,LENGTH:127,OPCODES:{continuation:0,text:1,binary:2,close:8,ping:9,pong:10},OPCODE_CODES:[0,1,2,8,9,10],MESSAGE_OPCODES:[0,1,2],OPENING_OPCODES:[1,2],ERRORS:{normal_closure:1e3,going_away:1001,protocol_error:1002,unacceptable:1003,encoding_error:1007,policy_violation:1008,too_large:1009,extension_error:1010,unexpected_condition:1011},ERROR_CODES:[1e3,1001,1002,1003,1007,1008,1009,1010,1011],DEFAULT_ERROR_CODE:1e3,MIN_RESERVED_ERROR:3e3,MAX_RESERVED_ERROR:4999,UTF8_MATCH:/^([\x00-\x7F]|[\xC2-\xDF][\x80-\xBF]|\xE0[\xA0-\xBF][\x80-\xBF]|[\xE1-\xEC\xEE\xEF][\x80-\xBF]{2}|\xED[\x80-\x9F][\x80-\xBF]|\xF0[\x90-\xBF][\x80-\xBF]{2}|[\xF1-\xF3][\x80-\xBF]{3}|\xF4[\x80-\x8F][\x80-\xBF]{2})*$/,addExtension:function(n){return this._extensions.add(n),!0},parse:function(n){this._reader.put(n);for(var e=!0;e;)switch(this._stage){case 0:e=this._reader.read(1),e&&this._parseOpcode(e[0]);break;case 1:e=this._reader.read(1),e&&this._parseLength(e[0]);break;case 2:e=this._reader.read(this._frame.lengthBytes),e&&this._parseExtendedLength(e);break;case 3:e=this._reader.read(4),e&&(this._stage=4,this._frame.maskingKey=e);break;case 4:e=this._reader.read(this._frame.length),e&&(this._stage=0,this._emitFrame(e));break;default:e=null}},text:function(n){return this.readyState>1?!1:this.frame(n,"text")},binary:function(n){return this.readyState>1?!1:this.frame(n,"binary")},ping:function(n,e){return this.readyState>1?!1:(n=n||"",e&&(this._pingCallbacks[n]=e),this.frame(n,"ping"))},pong:function(n){return this.readyState>1?!1:(n=n||"",this.frame(n,"pong"))},close:function(n,e){return n=n||"",e=e||this.ERRORS.normal_closure,this.readyState<=0?(this.readyState=3,this.emit("close",new Zs.CloseEvent(e,n)),!0):this.readyState===1?(this.readyState=2,this._extensions.close(function(){this.frame(n,"close",e)},this),!0):!1},frame:function(n,e,t){if(this.readyState<=0)return this._queue([n,e,t]);if(this.readyState>2)return!1;n instanceof Array&&(n=Uc.from(n)),typeof n=="number"&&(n=n.toString());var r=new SD,i=typeof n=="string",s,o;r.rsv1=r.rsv2=r.rsv3=!1,r.opcode=this.OPCODES[e||(i?"text":"binary")],s=i?Uc.from(n,"utf8"):n,t&&(o=s,s=Uc.allocUnsafe(2+o.length),s.writeUInt16BE(t,0),o.copy(s,2)),r.data=s;var a=function(l){var c=new ED;c.final=!0,c.rsv1=l.rsv1,c.rsv2=l.rsv2,c.rsv3=l.rsv3,c.opcode=l.opcode,c.masked=!!this._masking,c.length=l.data.length,c.payload=l.data,c.masked&&(c.maskingKey=wD.randomBytes(4)),this._sendFrame(c)};return this.MESSAGE_OPCODES.indexOf(r.opcode)>=0?this._extensions.processOutgoingMessage(r,function(l,c){if(l)return this._fail("extension_error",l.message);a.call(this,c)},this):a.call(this,r),!0},_sendFrame:function(n){var e=n.length,t=e<=125?2:e<=65535?4:10,r=t+(n.masked?4:0),i=Uc.allocUnsafe(r+e),s=n.masked?this.MASK:0;i[0]=(n.final?this.FIN:0)|(n.rsv1?this.RSV1:0)|(n.rsv2?this.RSV2:0)|(n.rsv3?this.RSV3:0)|n.opcode,e<=125?i[1]=s|e:e<=65535?(i[1]=s|126,i.writeUInt16BE(e,2)):(i[1]=s|127,i.writeUInt32BE(Math.floor(e/4294967296),2),i.writeUInt32BE(e%4294967296,6)),n.payload.copy(i,r),n.masked&&(n.maskingKey.copy(i,t),cn.mask(i,n.maskingKey,r)),this._write(i)},_handshakeResponse:function(){var n=this._request.headers["sec-websocket-key"],e=this._request.headers["sec-websocket-version"];if(e!==cn.VERSION)throw new Error("Unsupported WebSocket version: "+e);if(typeof n!="string")throw new Error("Missing handshake request header: Sec-WebSocket-Key");this._headers.set("Upgrade","websocket"),this._headers.set("Connection","Upgrade"),this._headers.set("Sec-WebSocket-Accept",cn.generateAccept(n)),this.protocol&&this._headers.set("Sec-WebSocket-Protocol",this.protocol);var t=this._extensions.generateResponse(this._request.headers["sec-websocket-extensions"]);t&&this._headers.set("Sec-WebSocket-Extensions",t);var r="HTTP/1.1 101 Switching Protocols",i=[r,this._headers.toString(),""];return Uc.from(i.join(`\r
`),"utf8")},_shutdown:function(n,e,t){delete this._frame,delete this._message,this._stage=5;var r=this.readyState===1;this.readyState=2,this._extensions.close(function(){r&&this.frame(e,"close",n),this.readyState=3,t&&this.emit("error",new Error(e)),this.emit("close",new Zs.CloseEvent(n,e))},this)},_fail:function(n,e){this.readyState>1||this._shutdown(this.ERRORS[n],e,!0)},_parseOpcode:function(n){var e=[this.RSV1,this.RSV2,this.RSV3].map(function(r){return(n&r)===r}),t=this._frame=new ED;if(t.final=(n&this.FIN)===this.FIN,t.rsv1=e[0],t.rsv2=e[1],t.rsv3=e[2],t.opcode=n&this.OPCODE,this._stage=1,!this._extensions.validFrameRsv(t))return this._fail("protocol_error","One or more reserved bits are on: reserved1 = "+(t.rsv1?1:0)+", reserved2 = "+(t.rsv2?1:0)+", reserved3 = "+(t.rsv3?1:0));if(this.OPCODE_CODES.indexOf(t.opcode)<0)return this._fail("protocol_error","Unrecognized frame opcode: "+t.opcode);if(this.MESSAGE_OPCODES.indexOf(t.opcode)<0&&!t.final)return this._fail("protocol_error","Received fragmented control frame: opcode = "+t.opcode);if(this._message&&this.OPENING_OPCODES.indexOf(t.opcode)>=0)return this._fail("protocol_error","Received new data frame but previous continuous frame is unfinished")},_parseLength:function(n){var e=this._frame;if(e.masked=(n&this.MASK)===this.MASK,e.length=n&this.LENGTH,e.length>=0&&e.length<=125){if(this._stage=e.masked?3:4,!this._checkFrameLength())return}else this._stage=2,e.lengthBytes=e.length===126?2:8;if(this._requireMasking&&!e.masked)return this._fail("unacceptable","Received unmasked frame but masking is required")},_parseExtendedLength:function(n){var e=this._frame;if(e.length=this._readUInt(n),this._stage=e.masked?3:4,this.MESSAGE_OPCODES.indexOf(e.opcode)<0&&e.length>125)return this._fail("protocol_error","Received control frame having too long payload: "+e.length);this._checkFrameLength()},_checkFrameLength:function(){var n=this._message?this._message.length:0;return n+this._frame.length>this._maxLength?(this._fail("too_large","WebSocket frame length too large"),!1):!0},_emitFrame:function(n){var e=this._frame,t=e.payload=cn.mask(n,e.maskingKey),r=e.opcode,i,s,o,a,l;if(delete this._frame,r===this.OPCODES.continuation){if(!this._message)return this._fail("protocol_error","Received unexpected continuation frame");this._message.pushFrame(e)}if((r===this.OPCODES.text||r===this.OPCODES.binary)&&(this._message=new SD,this._message.pushFrame(e)),e.final&&this.MESSAGE_OPCODES.indexOf(r)>=0)return this._emitMessage(this._message);r===this.OPCODES.close&&(s=t.length>=2?t.readUInt16BE(0):null,o=t.length>2?this._encode(t.slice(2)):null,t.length!==0&&!(s!==null&&s>=this.MIN_RESERVED_ERROR&&s<=this.MAX_RESERVED_ERROR)&&this.ERROR_CODES.indexOf(s)<0&&(s=this.ERRORS.protocol_error),(t.length>125||t.length>2&&!o)&&(s=this.ERRORS.protocol_error),this._shutdown(s||this.DEFAULT_ERROR_CODE,o||"")),r===this.OPCODES.ping&&(this.frame(t,"pong"),this.emit("ping",new Zs.PingEvent(t.toString()))),r===this.OPCODES.pong&&(a=this._pingCallbacks,i=this._encode(t),l=a[i],delete a[i],l&&l(),this.emit("pong",new Zs.PongEvent(t.toString())))},_emitMessage:function(e){var e=this._message;e.read(),delete this._message,this._extensions.processIncomingMessage(e,function(t,r){if(t)return this._fail("extension_error",t.message);var i=r.data;if(r.opcode===this.OPCODES.text&&(i=this._encode(i)),i===null)return this._fail("encoding_error","Could not decode a text frame as UTF-8");this.emit("message",new Zs.MessageEvent(i))},this)},_encode:function(n){try{var e=n.toString("binary",0,n.length);if(!this.UTF8_MATCH.test(e))return null}catch{}return n.toString("utf8",0,n.length)},_readUInt:function(n){return n.length===2?n.readUInt16BE(0):n.readUInt32BE(0)*4294967296+n.readUInt32BE(4)}};for(T_ in CD)cn.prototype[T_]=CD[T_];var T_;TD.exports=cn});var DD=A((sre,RD)=>{"use strict";var AD=_r().Buffer,NU=X("stream").Stream,bD=X("url"),kU=X("util"),OU=Oi(),xU=Mh(),PU=qh(),MU={"ws:":80,"wss:":443},A_=function(n,e,t){this._client=n,this._http=new PU("response"),this._origin=typeof n.url=="object"?n.url:bD.parse(n.url),this._url=typeof e=="object"?e:bD.parse(e),this._options=t||{},this._state=0,this.readable=this.writable=!0,this._paused=!1,this._headers=new xU,this._headers.set("Host",this._origin.host),this._headers.set("Connection","keep-alive"),this._headers.set("Proxy-Connection","keep-alive");var r=this._url.auth&&AD.from(this._url.auth,"utf8").toString("base64");r&&this._headers.set("Proxy-Authorization","Basic "+r)};kU.inherits(A_,NU);var ID={setHeader:function(n,e){return this._state!==0?!1:(this._headers.set(n,e),!0)},start:function(){if(this._state!==0)return!1;this._state=1;var n=this._origin,e=n.port||MU[n.protocol],t="CONNECT "+n.hostname+":"+e+" HTTP/1.1",r=[t,this._headers.toString(),""];return this.emit("data",AD.from(r.join(`\r
`),"utf8")),!0},pause:function(){this._paused=!0},resume:function(){this._paused=!1,this.emit("drain")},write:function(n){if(!this.writable)return!1;if(this._http.parse(n),!this._http.isComplete())return!this._paused;if(this.statusCode=this._http.statusCode,this.headers=this._http.headers,this.statusCode===200)this.emit("connect",new OU.ConnectEvent);else{var e="Can't establish a connection to the server at "+this._origin.href;this.emit("error",new Error(e))}return this.end(),!this._paused},end:function(n){this.writable&&(n!==void 0&&this.write(n),this.readable=this.writable=!1,this.emit("close"),this.emit("end"))},destroy:function(){this.end()}};for(I_ in ID)A_.prototype[I_]=ID[I_];var I_;RD.exports=A_});var xD=A((ore,OD)=>{"use strict";var kD=_r().Buffer,FU=X("crypto"),LU=X("url"),BU=X("util"),VU=qh(),UU=Oi(),fa=b_(),qU=DD(),qc=function(n,e){this.version="hybi-"+fa.VERSION,fa.call(this,null,n,e),this.readyState=-1,this._key=qc.generateKey(),this._accept=fa.generateAccept(this._key),this._http=new VU("response");var t=LU.parse(this.url),r=t.auth&&kD.from(t.auth,"utf8").toString("base64");if(this.VALID_PROTOCOLS.indexOf(t.protocol)<0)throw new Error(this.url+" is not a valid WebSocket URL");this._pathname=(t.pathname||"/")+(t.search||""),this._headers.set("Host",t.host),this._headers.set("Upgrade","websocket"),this._headers.set("Connection","Upgrade"),this._headers.set("Sec-WebSocket-Key",this._key),this._headers.set("Sec-WebSocket-Version",fa.VERSION),this._protocols.length>0&&this._headers.set("Sec-WebSocket-Protocol",this._protocols.join(", ")),r&&this._headers.set("Authorization","Basic "+r)};BU.inherits(qc,fa);qc.generateKey=function(){return FU.randomBytes(16).toString("base64")};var ND={VALID_PROTOCOLS:["ws:","wss:"],proxy:function(n,e){return new qU(this,n,e)},start:function(){return this.readyState!==-1?!1:(this._write(this._handshakeRequest()),this.readyState=0,!0)},parse:function(n){if(this.readyState!==3){if(this.readyState>0)return fa.prototype.parse.call(this,n);this._http.parse(n),this._http.isComplete()&&(this._validateHandshake(),this.readyState!==3&&(this._open(),this.parse(this._http.body)))}},_handshakeRequest:function(){var n=this._extensions.generateOffer();n&&this._headers.set("Sec-WebSocket-Extensions",n);var e="GET "+this._pathname+" HTTP/1.1",t=[e,this._headers.toString(),""];return kD.from(t.join(`\r
`),"utf8")},_failHandshake:function(n){n="Error during WebSocket handshake: "+n,this.readyState=3,this.emit("error",new Error(n)),this.emit("close",new UU.CloseEvent(this.ERRORS.protocol_error,n))},_validateHandshake:function(){if(this.statusCode=this._http.statusCode,this.headers=this._http.headers,this._http.error)return this._failHandshake(this._http.error.message);if(this._http.statusCode!==101)return this._failHandshake("Unexpected response code: "+this._http.statusCode);var n=this._http.headers,e=n.upgrade||"",t=n.connection||"",r=n["sec-websocket-accept"]||"",i=n["sec-websocket-protocol"]||"";if(e==="")return this._failHandshake("'Upgrade' header is missing");if(e.toLowerCase()!=="websocket")return this._failHandshake("'Upgrade' header value is not 'WebSocket'");if(t==="")return this._failHandshake("'Connection' header is missing");if(t.toLowerCase()!=="upgrade")return this._failHandshake("'Connection' header value is not 'Upgrade'");if(r!==this._accept)return this._failHandshake("Sec-WebSocket-Accept mismatch");if(this.protocol=null,i!==""){if(this._protocols.indexOf(i)<0)return this._failHandshake("Sec-WebSocket-Protocol mismatch");this.protocol=i}try{this._extensions.activate(this.headers["sec-websocket-extensions"])}catch(s){return this._failHandshake(s.message)}}};for(R_ in ND)qc.prototype[R_]=ND[R_];var R_;OD.exports=qc});var k_=A((are,MD)=>{"use strict";var Gh=_r().Buffer,Wh=Oi(),zU=X("util"),N_=function(n,e,t){Wh.apply(this,arguments),this._stage=0,this.version="hixie-75",this._headers.set("Upgrade","WebSocket"),this._headers.set("Connection","Upgrade"),this._headers.set("WebSocket-Origin",this._request.headers.origin),this._headers.set("WebSocket-Location",this.url)};zU.inherits(N_,Wh);var PD={close:function(){return this.readyState===3?!1:(this.readyState=3,this.emit("close",new Wh.CloseEvent(null,null)),!0)},parse:function(n){this.readyState>1||(this._reader.put(n),this._reader.eachByte(function(e){var t;switch(this._stage){case-1:this._body.push(e),this._sendHandshakeBody();break;case 0:this._parseLeadingByte(e);break;case 1:if(this._length=(e&127)+128*this._length,this._closing&&this._length===0)return this.close();(e&128)!==128&&(this._length===0?this._stage=0:(this._skipped=0,this._stage=2));break;case 2:if(e===255)this._stage=0,t=Gh.from(this._buffer).toString("utf8",0,this._buffer.length),this.emit("message",new Wh.MessageEvent(t));else if(this._length)this._skipped+=1,this._skipped===this._length&&(this._stage=0);else if(this._buffer.push(e),this._buffer.length>this._maxLength)return this.close();break}},this))},frame:function(n){if(this.readyState===0)return this._queue([n]);if(this.readyState>1)return!1;typeof n!="string"&&(n=n.toString());var e=Gh.byteLength(n),t=Gh.allocUnsafe(e+2);return t[0]=0,t.write(n,1),t[t.length-1]=255,this._write(t),!0},_handshakeResponse:function(){var n="HTTP/1.1 101 Web Socket Protocol Handshake",e=[n,this._headers.toString(),""];return Gh.from(e.join(`\r
`),"utf8")},_parseLeadingByte:function(n){(n&128)===128?(this._length=0,this._stage=1):(delete this._length,delete this._skipped,this._buffer=[],this._stage=2)}};for(D_ in PD)N_.prototype[D_]=PD[D_];var D_;MD.exports=N_});var UD=A((lre,VD)=>{"use strict";var zc=_r().Buffer,GU=Oi(),jh=k_(),WU=X("crypto"),jU=X("util"),FD=function(n){return parseInt((n.match(/[0-9]/g)||[]).join(""),10)},LD=function(n){return(n.match(/ /g)||[]).length},x_=function(n,e,t){jh.apply(this,arguments),this._stage=-1,this._body=[],this.version="hixie-76",this._headers.clear(),this._headers.set("Upgrade","WebSocket"),this._headers.set("Connection","Upgrade"),this._headers.set("Sec-WebSocket-Origin",this._request.headers.origin),this._headers.set("Sec-WebSocket-Location",this.url)};jU.inherits(x_,jh);var BD={BODY_SIZE:8,start:function(){return jh.prototype.start.call(this)?(this._started=!0,this._sendHandshakeBody(),!0):!1},close:function(){return this.readyState===3?!1:(this.readyState===1&&this._write(zc.from([255,0])),this.readyState=3,this.emit("close",new GU.CloseEvent(null,null)),!0)},_handshakeResponse:function(){var a=this._request.headers,n=a["sec-websocket-key1"],e=a["sec-websocket-key2"];if(!n)throw new Error("Missing required header: Sec-WebSocket-Key1");if(!e)throw new Error("Missing required header: Sec-WebSocket-Key2");var t=FD(n),r=LD(n),i=FD(e),s=LD(e);if(t%r!==0||i%s!==0)throw new Error("Client sent invalid Sec-WebSocket-Key headers");this._keyValues=[t/r,i/s];var o="HTTP/1.1 101 WebSocket Protocol Handshake",a=[o,this._headers.toString(),""];return zc.from(a.join(`\r
`),"binary")},_handshakeSignature:function(){if(this._body.length<this.BODY_SIZE)return null;var n=WU.createHash("md5"),e=zc.allocUnsafe(8+this.BODY_SIZE);return e.writeUInt32BE(this._keyValues[0],0),e.writeUInt32BE(this._keyValues[1],4),zc.from(this._body).copy(e,8,0,this.BODY_SIZE),n.update(e),zc.from(n.digest("binary"),"binary")},_sendHandshakeBody:function(){if(this._started){var n=this._handshakeSignature();n&&(this._write(n),this._stage=0,this._open(),this._body.length>this.BODY_SIZE&&this.parse(this._body.slice(this.BODY_SIZE)))}},_parseLeadingByte:function(n){if(n!==255)return jh.prototype._parseLeadingByte.call(this,n);this._closing=!0,this._length=0,this._stage=1}};for(O_ in BD)x_.prototype[O_]=BD[O_];var O_;VD.exports=x_});var zD=A((cre,qD)=>{"use strict";var $U=X("util"),HU=qh(),F_=Oi(),KU=k_(),QU=UD(),YU=b_(),eo=function(n){F_.call(this,null,null,n),this._http=new HU("request")};$U.inherits(eo,F_);var M_={EVENTS:["open","message","error","close","ping","pong"],_bindEventListeners:function(){this.messages.on("error",function(){}),this.on("error",function(){})},parse:function(n){if(this._delegate)return this._delegate.parse(n);if(this._http.parse(n),!!this._http.isComplete()){this.method=this._http.method,this.url=this._http.url,this.headers=this._http.headers,this.body=this._http.body;var e=this;this._delegate=eo.http(this,this._options),this._delegate.messages=this.messages,this._delegate.io=this.io,this._open(),this.EVENTS.forEach(function(t){this._delegate.on(t,function(r){e.emit(t,r)})},this),this.protocol=this._delegate.protocol,this.version=this._delegate.version,this.parse(this._http.body),this.emit("connect",new F_.ConnectEvent)}},_open:function(){this.__queue.forEach(function(n){this._delegate[n[0]].apply(this._delegate,n[1])},this),this.__queue=[]}};["addExtension","setHeader","start","frame","text","binary","ping","close"].forEach(function(n){M_[n]=function(){return this._delegate?this._delegate[n].apply(this._delegate,arguments):(this.__queue.push([n,arguments]),!0)}});for(P_ in M_)eo.prototype[P_]=M_[P_];var P_;eo.isSecureRequest=function(n){if(n.connection&&n.connection.authorized!==void 0||n.socket&&n.socket.secure)return!0;var e=n.headers;return e?e.https==="on"||e["x-forwarded-ssl"]==="on"||e["x-forwarded-scheme"]==="https"||e["x-forwarded-proto"]==="https":!1};eo.determineUrl=function(n){var e=this.isSecureRequest(n)?"wss:":"ws:";return e+"//"+n.headers.host+n.url};eo.http=function(n,e){e=e||{},e.requireMasking===void 0&&(e.requireMasking=!0);var t=n.headers,r=t["sec-websocket-version"],i=t["sec-websocket-key"],s=t["sec-websocket-key1"],o=t["sec-websocket-key2"],a=this.determineUrl(n);return r||i?new YU(n,a,e):s||o?new QU(n,a,e):new KU(n,a,e)};qD.exports=eo});var Gc=A((ure,WD)=>{"use strict";var GD=Oi(),XU=xD(),$h=zD(),JU={client:function(n,e){return e=e||{},e.masking===void 0&&(e.masking=!0),new XU(n,e)},server:function(n){return n=n||{},n.requireMasking===void 0&&(n.requireMasking=!0),new $h(n)},http:function(){return $h.http.apply($h,arguments)},isSecureRequest:function(n){return $h.isSecureRequest(n)},isWebSocket:function(n){return GD.isWebSocket(n)},validateOptions:function(n,e){GD.validateOptions(n,e)}};WD.exports=JU});var Wc=A((dre,jD)=>{"use strict";var to=function(n,e){this.type=n;for(var t in e)this[t]=e[t]};to.prototype.initEvent=function(n,e,t){this.type=n,this.bubbles=e,this.cancelable=t};to.prototype.stopPropagation=function(){};to.prototype.preventDefault=function(){};to.CAPTURING_PHASE=1;to.AT_TARGET=2;to.BUBBLING_PHASE=3;jD.exports=to});var L_=A((hre,$D)=>{"use strict";var ZU=Wc(),eq={onopen:null,onmessage:null,onerror:null,onclose:null,addEventListener:function(n,e,t){this.on(n,e)},removeEventListener:function(n,e,t){this.removeListener(n,e)},dispatchEvent:function(n){n.target=n.currentTarget=this,n.eventPhase=ZU.AT_TARGET,this["on"+n.type]&&this["on"+n.type](n),this.emit(n.type,n)}};$D.exports=eq});var Kh=A((fre,QD)=>{"use strict";var tq=X("stream").Stream,nq=X("util"),rq=Gc(),HD=L_(),Hh=Wc(),Ue=function(n){n=n||{},rq.validateOptions(n,["headers","extensions","maxLength","ping","proxy","tls","ca"]),this.readable=this.writable=!0;var e=n.headers;if(e)for(var t in e)this._driver.setHeader(t,e[t]);var r=n.extensions;r&&[].concat(r).forEach(this._driver.addExtension,this._driver),this._ping=n.ping,this._pingId=0,this.readyState=Ue.CONNECTING,this.bufferedAmount=0,this.protocol="",this.url=this._driver.url,this.version=this._driver.version;var i=this;this._driver.on("open",function(s){i._open()}),this._driver.on("message",function(s){i._receiveMessage(s.data)}),this._driver.on("close",function(s){i._beginClose(s.reason,s.code)}),this._driver.on("error",function(s){i._emitError(s.message)}),this.on("error",function(){}),this._driver.messages.on("drain",function(){i.emit("drain")}),this._ping&&(this._pingTimer=setInterval(function(){i._pingId+=1,i.ping(i._pingId.toString())},this._ping*1e3)),this._configureStream(),this._proxy||(this._stream.pipe(this._driver.io),this._driver.io.pipe(this._stream))};nq.inherits(Ue,tq);Ue.CONNECTING=0;Ue.OPEN=1;Ue.CLOSING=2;Ue.CLOSED=3;Ue.CLOSE_TIMEOUT=3e4;var KD={write:function(n){return this.send(n)},end:function(n){n!==void 0&&this.send(n),this.close()},pause:function(){return this._driver.messages.pause()},resume:function(){return this._driver.messages.resume()},send:function(n){return this.readyState>Ue.OPEN?!1:(n instanceof Buffer||(n=String(n)),this._driver.messages.write(n))},ping:function(n,e){return this.readyState>Ue.OPEN?!1:this._driver.ping(n,e)},close:function(n,e){if(n===void 0&&(n=1e3),e===void 0&&(e=""),n!==1e3&&(n<3e3||n>4999))throw new Error("Failed to execute 'close' on WebSocket: The code must be either 1000, or between 3000 and 4999. "+n+" is neither.");if(this.readyState<Ue.CLOSING){var t=this;this._closeTimer=setTimeout(function(){t._beginClose("",1006)},Ue.CLOSE_TIMEOUT)}this.readyState!==Ue.CLOSED&&(this.readyState=Ue.CLOSING),this._driver.close(e,n)},_configureStream:function(){var n=this;this._stream.setTimeout(0),this._stream.setNoDelay(!0),["close","end"].forEach(function(e){this._stream.on(e,function(){n._finalizeClose()})},this),this._stream.on("error",function(e){n._emitError("Network error: "+n.url+": "+e.message),n._finalizeClose()})},_open:function(){if(this.readyState===Ue.CONNECTING){this.readyState=Ue.OPEN,this.protocol=this._driver.protocol||"";var n=new Hh("open");n.initEvent("open",!1,!1),this.dispatchEvent(n)}},_receiveMessage:function(n){if(this.readyState>Ue.OPEN)return!1;this.readable&&this.emit("data",n);var e=new Hh("message",{data:n});e.initEvent("message",!1,!1),this.dispatchEvent(e)},_emitError:function(n){if(!(this.readyState>=Ue.CLOSING)){var e=new Hh("error",{message:n});e.initEvent("error",!1,!1),this.dispatchEvent(e)}},_beginClose:function(n,e){this.readyState!==Ue.CLOSED&&(this.readyState=Ue.CLOSING,this._closeParams=[n,e],this._stream&&(this._stream.destroy(),this._stream.readable||this._finalizeClose()))},_finalizeClose:function(){if(this.readyState!==Ue.CLOSED){this.readyState=Ue.CLOSED,this._closeTimer&&clearTimeout(this._closeTimer),this._pingTimer&&clearInterval(this._pingTimer),this._stream&&this._stream.end(),this.readable&&this.emit("end"),this.readable=this.writable=!1;var n=this._closeParams?this._closeParams[0]:"",e=this._closeParams?this._closeParams[1]:1006,t=new Hh("close",{code:e,reason:n});t.initEvent("close",!1,!1),this.dispatchEvent(t)}}};for(B_ in KD)Ue.prototype[B_]=KD[B_];var B_;for(V_ in HD)Ue.prototype[V_]=HD[V_];var V_;QD.exports=Ue});var tN=A((mre,eN)=>{"use strict";var iq=X("util"),sq=X("net"),YD=X("tls"),XD=X("url"),oq=Gc(),JD=Kh(),pre=Wc(),aq={"http:":80,"https:":443,"ws:":80,"wss:":443},ZD=["https:","wss:"],Qh=function(n,e,t){t=t||{},this.url=n,this._driver=oq.client(this.url,{maxLength:t.maxLength,protocols:e}),["open","error"].forEach(function(h){this._driver.on(h,function(){d.headers=d._driver.headers,d.statusCode=d._driver.statusCode})},this);var r=t.proxy||{},i=XD.parse(r.origin||this.url),s=i.port||aq[i.protocol],o=ZD.indexOf(i.protocol)>=0,a=function(){d._onConnect()},l=t.net||{},c=t.tls||{},u=r.origin?r.tls||{}:c,d=this;l.host=u.host=i.hostname,l.port=u.port=s,c.ca=c.ca||t.ca,u.servername=u.servername||i.hostname,this._stream=o?YD.connect(u,a):sq.connect(l,a),r.origin&&this._configureProxy(r,c),JD.call(this,t)};iq.inherits(Qh,JD);Qh.prototype._onConnect=function(){var n=this._proxy||this._driver;n.start()};Qh.prototype._configureProxy=function(n,e){var t=XD.parse(this.url),r=ZD.indexOf(t.protocol)>=0,i=this,s;if(this._proxy=this._driver.proxy(n.origin),n.headers)for(s in n.headers)this._proxy.setHeader(s,n.headers[s]);this._proxy.pipe(this._stream,{end:!1}),this._stream.pipe(this._proxy),this._proxy.on("connect",function(){if(r){var o={socket:i._stream,servername:t.hostname};for(s in e)o[s]=e[s];i._stream=YD.connect(o),i._configureStream()}i._driver.io.pipe(i._stream),i._stream.pipe(i._driver.io),i._driver.start()}),this._proxy.on("error",function(o){i._driver.emit("error",o)})};eN.exports=Qh});var oN=A((gre,sN)=>{"use strict";var lq=X("stream").Stream,cq=X("util"),uq=Gc(),dq=Mh(),pa=Kh(),nN=L_(),rN=Wc(),jc=function(n,e,t){this.writable=!0,t=t||{},this._stream=e.socket,this._ping=t.ping||this.DEFAULT_PING,this._retry=t.retry||this.DEFAULT_RETRY;var r=uq.isSecureRequest(n)?"https:":"http:";this.url=r+"//"+n.headers.host+n.url,this.lastEventId=n.headers["last-event-id"]||"",this.readyState=pa.CONNECTING;var i=new dq,s=this;if(t.headers)for(var o in t.headers)i.set(o,t.headers[o]);if(!(!this._stream||!this._stream.writable)){process.nextTick(function(){s._open()}),this._stream.setTimeout(0),this._stream.setNoDelay(!0);var a=`HTTP/1.1 200 OK\r
Content-Type: text/event-stream\r
Cache-Control: no-cache, no-store\r
Connection: close\r
`+i.toString()+`\r
retry: `+Math.floor(this._retry*1e3)+`\r
\r
`;this._write(a),this._stream.on("drain",function(){s.emit("drain")}),this._ping&&(this._pingTimer=setInterval(function(){s.ping()},this._ping*1e3)),["error","end"].forEach(function(l){s._stream.on(l,function(){s.close()})})}};cq.inherits(jc,lq);jc.isEventSource=function(n){if(n.method!=="GET")return!1;var e=(n.headers.accept||"").split(/\s*,\s*/);return e.indexOf("text/event-stream")>=0};var iN={DEFAULT_PING:10,DEFAULT_RETRY:5,_write:function(n){if(!this.writable)return!1;try{return this._stream.write(n,"utf8")}catch{return!1}},_open:function(){if(this.readyState===pa.CONNECTING){this.readyState=pa.OPEN;var n=new rN("open");n.initEvent("open",!1,!1),this.dispatchEvent(n)}},write:function(n){return this.send(n)},end:function(n){n!==void 0&&this.write(n),this.close()},send:function(n,e){if(this.readyState>pa.OPEN)return!1;n=String(n).replace(/(\r\n|\r|\n)/g,"$1data: "),e=e||{};var t="";return e.event&&(t+="event: "+e.event+`\r
`),e.id&&(t+="id: "+e.id+`\r
`),t+="data: "+n+`\r
\r
`,this._write(t)},ping:function(){return this._write(`:\r
\r
`)},close:function(){if(this.readyState>pa.OPEN)return!1;this.readyState=pa.CLOSED,this.writable=!1,this._pingTimer&&clearInterval(this._pingTimer),this._stream&&this._stream.end();var n=new rN("close");return n.initEvent("close",!1,!1),this.dispatchEvent(n),!0}};for(U_ in iN)jc.prototype[U_]=iN[U_];var U_;for(q_ in nN)jc.prototype[q_]=nN[q_];var q_;sN.exports=jc});var cN=A((yre,lN)=>{"use strict";var hq=X("util"),z_=Gc(),aN=Kh(),xi=function(n,e,t,r,i){i=i||{},this._stream=e,this._driver=z_.http(n,{maxLength:i.maxLength,protocols:r});var s=this;if(!(!this._stream||!this._stream.writable)){if(!this._stream.readable)return this._stream.end();var o=function(){s._stream.removeListener("data",o)};this._stream.on("data",o),aN.call(this,i),process.nextTick(function(){s._driver.start(),s._driver.io.write(t)})}};hq.inherits(xi,aN);xi.isWebSocket=function(n){return z_.isWebSocket(n)};xi.validateOptions=function(n,e){z_.validateOptions(n,e)};xi.WebSocket=xi;xi.Client=tN();xi.EventSource=oN();lN.exports=xi});var we=A(Rn=>{"use strict";Object.defineProperty(Rn,"__esModule",{value:!0});Rn.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=Rn.DEFAULT_MAX_SEND_MESSAGE_LENGTH=Rn.Propagate=Rn.LogVerbosity=Rn.Status=void 0;var YO=function(n){return n[n.OK=0]="OK",n[n.CANCELLED=1]="CANCELLED",n[n.UNKNOWN=2]="UNKNOWN",n[n.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",n[n.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",n[n.NOT_FOUND=5]="NOT_FOUND",n[n.ALREADY_EXISTS=6]="ALREADY_EXISTS",n[n.PERMISSION_DENIED=7]="PERMISSION_DENIED",n[n.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",n[n.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",n[n.ABORTED=10]="ABORTED",n[n.OUT_OF_RANGE=11]="OUT_OF_RANGE",n[n.UNIMPLEMENTED=12]="UNIMPLEMENTED",n[n.INTERNAL=13]="INTERNAL",n[n.UNAVAILABLE=14]="UNAVAILABLE",n[n.DATA_LOSS=15]="DATA_LOSS",n[n.UNAUTHENTICATED=16]="UNAUTHENTICATED",n}(YO||(Rn.Status=YO={})),XO=function(n){return n[n.DEBUG=0]="DEBUG",n[n.INFO=1]="INFO",n[n.ERROR=2]="ERROR",n[n.NONE=3]="NONE",n}(XO||(Rn.LogVerbosity=XO={})),JO=function(n){return n[n.DEADLINE=1]="DEADLINE",n[n.CENSUS_STATS_CONTEXT=2]="CENSUS_STATS_CONTEXT",n[n.CENSUS_TRACING_CONTEXT=4]="CENSUS_TRACING_CONTEXT",n[n.CANCELLATION=8]="CANCELLATION",n[n.DEFAULTS=65535]="DEFAULTS",n}(JO||(Rn.Propagate=JO={}));Rn.DEFAULT_MAX_SEND_MESSAGE_LENGTH=-1;Rn.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=4*1024*1024});var fS=A((_se,iW)=>{iW.exports={name:"@grpc/grpc-js",version:"1.9.15",description:"gRPC Library for Node - pure JS implementation",homepage:"https://grpc.io/",repository:"https://github.com/grpc/grpc-node/tree/master/packages/grpc-js",main:"build/src/index.js",engines:{node:"^8.13.0 || >=10.10.0"},keywords:[],author:{name:"Google Inc."},types:"build/src/index.d.ts",license:"Apache-2.0",devDependencies:{"@types/gulp":"^4.0.6","@types/gulp-mocha":"0.0.32","@types/lodash":"^4.14.186","@types/mocha":"^5.2.6","@types/ncp":"^2.0.1","@types/pify":"^3.0.2","@types/semver":"^7.3.9","@typescript-eslint/eslint-plugin":"^5.59.11","@typescript-eslint/parser":"^5.59.11","@typescript-eslint/typescript-estree":"^5.59.11","clang-format":"^1.0.55",eslint:"^8.42.0","eslint-config-prettier":"^8.8.0","eslint-plugin-node":"^11.1.0","eslint-plugin-prettier":"^4.2.1",execa:"^2.0.3",gulp:"^4.0.2","gulp-mocha":"^6.0.0",lodash:"^4.17.4",madge:"^5.0.1","mocha-jenkins-reporter":"^0.4.1",ncp:"^2.0.0",pify:"^4.0.1",prettier:"^2.8.8",rimraf:"^3.0.2",semver:"^7.3.5","ts-node":"^10.9.1",typescript:"^5.1.3"},contributors:[{name:"Google Inc."}],scripts:{build:"npm run compile",clean:"rimraf ./build",compile:"tsc -p .",format:'clang-format -i -style="{Language: JavaScript, BasedOnStyle: Google, ColumnLimit: 80}" src/*.ts test/*.ts',lint:"eslint src/*.ts test/*.ts",prepare:"npm run generate-types && npm run compile",test:"gulp test",check:"npm run lint",fix:"eslint --fix src/*.ts test/*.ts",pretest:"npm run generate-types && npm run generate-test-types && npm run compile",posttest:"npm run check && madge -c ./build/src","generate-types":"proto-loader-gen-types --keepCase --longs String --enums String --defaults --oneofs --includeComments --includeDirs proto/ --include-dirs test/fixtures/ -O src/generated/ --grpcLib ../index channelz.proto","generate-test-types":"proto-loader-gen-types --keepCase --longs String --enums String --defaults --oneofs --includeComments --include-dirs test/fixtures/ -O test/generated/ --grpcLib ../../src/index test_service.proto"},dependencies:{"@grpc/proto-loader":"^0.7.8","@types/node":">=12.12.47"},files:["src/**/*.ts","build/src/**/*.{js,d.ts,js.map}","proto/*.proto","LICENSE","deps/envoy-api/envoy/api/v2/**/*.proto","deps/envoy-api/envoy/config/**/*.proto","deps/envoy-api/envoy/service/**/*.proto","deps/envoy-api/envoy/type/**/*.proto","deps/udpa/udpa/**/*.proto","deps/googleapis/google/api/*.proto","deps/googleapis/google/rpc/*.proto","deps/protoc-gen-validate/validate/**/*.proto"]}});var Xe=A(Ht=>{"use strict";var pS,mS,gS,yS;Object.defineProperty(Ht,"__esModule",{value:!0});Ht.isTracerEnabled=Ht.trace=Ht.log=Ht.setLoggerVerbosity=Ht.setLogger=Ht.getLogger=void 0;var Gi=we(),sW=X("process"),oW=fS().version,aW={error:(n,...e)=>{console.error("E "+n,...e)},info:(n,...e)=>{console.error("I "+n,...e)},debug:(n,...e)=>{console.error("D "+n,...e)}},po=aW,Ma=Gi.LogVerbosity.ERROR,lW=(mS=(pS=process.env.GRPC_NODE_VERBOSITY)!==null&&pS!==void 0?pS:process.env.GRPC_VERBOSITY)!==null&&mS!==void 0?mS:"";switch(lW.toUpperCase()){case"DEBUG":Ma=Gi.LogVerbosity.DEBUG;break;case"INFO":Ma=Gi.LogVerbosity.INFO;break;case"ERROR":Ma=Gi.LogVerbosity.ERROR;break;case"NONE":Ma=Gi.LogVerbosity.NONE;break;default:}var cW=()=>po;Ht.getLogger=cW;var uW=n=>{po=n};Ht.setLogger=uW;var dW=n=>{Ma=n};Ht.setLoggerVerbosity=dW;var hW=(n,...e)=>{let t;if(n>=Ma){switch(n){case Gi.LogVerbosity.DEBUG:t=po.debug;break;case Gi.LogVerbosity.INFO:t=po.info;break;case Gi.LogVerbosity.ERROR:t=po.error;break}t||(t=po.error),t&&t.bind(po)(...e)}};Ht.log=hW;var fW=(yS=(gS=process.env.GRPC_NODE_TRACE)!==null&&gS!==void 0?gS:process.env.GRPC_TRACE)!==null&&yS!==void 0?yS:"",_S=new Set,ZO=new Set;for(let n of fW.split(","))n.startsWith("-")?ZO.add(n.substring(1)):_S.add(n);var pW=_S.has("all");function mW(n,e,t){e1(e)&&(0,Ht.log)(n,new Date().toISOString()+" | v"+oW+" "+sW.pid+" | "+e+" | "+t)}Ht.trace=mW;function e1(n){return!ZO.has(n)&&(pW||_S.has(n))}Ht.isTracerEnabled=e1});var ip=A(Fa=>{"use strict";Object.defineProperty(Fa,"__esModule",{value:!0});Fa.getErrorCode=Fa.getErrorMessage=void 0;function gW(n){return n instanceof Error?n.message:String(n)}Fa.getErrorMessage=gW;function yW(n){return typeof n=="object"&&n!==null&&"code"in n&&typeof n.code=="number"?n.code:null}Fa.getErrorCode=yW});var tn=A(op=>{"use strict";Object.defineProperty(op,"__esModule",{value:!0});op.Metadata=void 0;var _W=Xe(),vW=we(),EW=ip(),SW=/^[0-9a-z_.-]+$/,CW=/^[ -~]*$/;function wW(n){return SW.test(n)}function TW(n){return CW.test(n)}function n1(n){return n.endsWith("-bin")}function bW(n){return!n.startsWith("grpc-")}function sp(n){return n.toLowerCase()}function t1(n,e){if(!wW(n))throw new Error('Metadata key "'+n+'" contains illegal characters');if(e!=null)if(n1(n)){if(!Buffer.isBuffer(e))throw new Error("keys that end with '-bin' must have Buffer values")}else{if(Buffer.isBuffer(e))throw new Error("keys that don't end with '-bin' must have String values");if(!TW(e))throw new Error('Metadata string value "'+e+'" contains illegal characters')}}var vS=class n{constructor(e={}){this.internalRepr=new Map,this.options=e}set(e,t){e=sp(e),t1(e,t),this.internalRepr.set(e,[t])}add(e,t){e=sp(e),t1(e,t);let r=this.internalRepr.get(e);r===void 0?this.internalRepr.set(e,[t]):r.push(t)}remove(e){e=sp(e),this.internalRepr.delete(e)}get(e){return e=sp(e),this.internalRepr.get(e)||[]}getMap(){let e={};for(let[t,r]of this.internalRepr)if(r.length>0){let i=r[0];e[t]=Buffer.isBuffer(i)?Buffer.from(i):i}return e}clone(){let e=new n(this.options),t=e.internalRepr;for(let[r,i]of this.internalRepr){let s=i.map(o=>Buffer.isBuffer(o)?Buffer.from(o):o);t.set(r,s)}return e}merge(e){for(let[t,r]of e.internalRepr){let i=(this.internalRepr.get(t)||[]).concat(r);this.internalRepr.set(t,i)}}setOptions(e){this.options=e}getOptions(){return this.options}toHttp2Headers(){let e={};for(let[t,r]of this.internalRepr)e[t]=r.map(IW);return e}toJSON(){let e={};for(let[t,r]of this.internalRepr)e[t]=r;return e}static fromHttp2Headers(e){let t=new n;for(let r of Object.keys(e)){if(r.charAt(0)===":")continue;let i=e[r];try{n1(r)?Array.isArray(i)?i.forEach(s=>{t.add(r,Buffer.from(s,"base64"))}):i!==void 0&&(bW(r)?i.split(",").forEach(s=>{t.add(r,Buffer.from(s.trim(),"base64"))}):t.add(r,Buffer.from(i,"base64"))):Array.isArray(i)?i.forEach(s=>{t.add(r,s)}):i!==void 0&&t.add(r,i)}catch(s){let o=`Failed to add metadata entry ${r}: ${i}. ${(0,EW.getErrorMessage)(s)}. For more information see https://github.com/grpc/grpc-node/issues/1173`;(0,_W.log)(vW.LogVerbosity.ERROR,o)}}return t}};op.Metadata=vS;var IW=n=>Buffer.isBuffer(n)?n.toString("base64"):n});var TS=A(ap=>{"use strict";Object.defineProperty(ap,"__esModule",{value:!0});ap.CallCredentials=void 0;var wS=tn();function AW(n){return"getRequestHeaders"in n&&typeof n.getRequestHeaders=="function"}var La=class n{static createFromMetadataGenerator(e){return new SS(e)}static createFromGoogleCredential(e){return n.createFromMetadataGenerator((t,r)=>{let i;AW(e)?i=e.getRequestHeaders(t.service_url):i=new Promise((s,o)=>{e.getRequestMetadata(t.service_url,(a,l)=>{if(a){o(a);return}if(!l){o(new Error("Headers not set by metadata plugin"));return}s(l)})}),i.then(s=>{let o=new wS.Metadata;for(let a of Object.keys(s))o.add(a,s[a]);r(null,o)},s=>{r(s)})})}static createEmpty(){return new CS}};ap.CallCredentials=La;var ES=class n extends La{constructor(e){super(),this.creds=e}generateMetadata(e){return T(this,null,function*(){let t=new wS.Metadata,r=yield Promise.all(this.creds.map(i=>i.generateMetadata(e)));for(let i of r)t.merge(i);return t})}compose(e){return new n(this.creds.concat([e]))}_equals(e){return this===e?!0:e instanceof n?this.creds.every((t,r)=>t._equals(e.creds[r])):!1}},SS=class n extends La{constructor(e){super(),this.metadataGenerator=e}generateMetadata(e){return new Promise((t,r)=>{this.metadataGenerator(e,(i,s)=>{s!==void 0?t(s):r(i)})})}compose(e){return new ES([this,e])}_equals(e){return this===e?!0:e instanceof n?this.metadataGenerator===e.metadataGenerator:!1}},CS=class n extends La{generateMetadata(e){return Promise.resolve(new wS.Metadata)}compose(e){return e}_equals(e){return e instanceof n}}});var IS=A(Ba=>{"use strict";Object.defineProperty(Ba,"__esModule",{value:!0});Ba.getDefaultRootsData=Ba.CIPHER_SUITES=void 0;var RW=X("fs");Ba.CIPHER_SUITES=process.env.GRPC_SSL_CIPHER_SUITES;var r1=process.env.GRPC_DEFAULT_SSL_ROOTS_FILE_PATH,bS=null;function DW(){return r1?(bS===null&&(bS=RW.readFileSync(r1)),bS):null}Ba.getDefaultRootsData=DW});var up=A(cp=>{"use strict";Object.defineProperty(cp,"__esModule",{value:!0});cp.ChannelCredentials=void 0;var NW=X("tls"),kW=TS(),i1=IS();function AS(n,e){if(n&&!(n instanceof Buffer))throw new TypeError(`${e}, if provided, must be a Buffer.`)}var Va=class{constructor(e){this.callCredentials=e||kW.CallCredentials.createEmpty()}_getCallCredentials(){return this.callCredentials}static createSsl(e,t,r,i){var s;if(AS(e,"Root certificate"),AS(t,"Private key"),AS(r,"Certificate chain"),t&&!r)throw new Error("Private key must be given with accompanying certificate chain");if(!t&&r)throw new Error("Certificate chain must be given with accompanying private key");let o=(0,NW.createSecureContext)({ca:(s=e??(0,i1.getDefaultRootsData)())!==null&&s!==void 0?s:void 0,key:t??void 0,cert:r??void 0,ciphers:i1.CIPHER_SUITES});return new lp(o,i??{})}static createFromSecureContext(e,t){return new lp(e,t??{})}static createInsecure(){return new RS}};cp.ChannelCredentials=Va;var RS=class n extends Va{constructor(e){super(e)}compose(e){throw new Error("Cannot compose insecure credentials")}_getConnectionOptions(){return null}_isSecure(){return!1}_equals(e){return e instanceof n}},lp=class n extends Va{constructor(e,t){super(),this.secureContext=e,this.verifyOptions=t,this.connectionOptions={secureContext:e},t?.checkServerIdentity&&(this.connectionOptions.checkServerIdentity=t.checkServerIdentity)}compose(e){let t=this.callCredentials.compose(e);return new DS(this,t)}_getConnectionOptions(){return Object.assign({},this.connectionOptions)}_isSecure(){return!0}_equals(e){return this===e?!0:e instanceof n?this.secureContext===e.secureContext&&this.verifyOptions.checkServerIdentity===e.verifyOptions.checkServerIdentity:!1}},DS=class n extends Va{constructor(e,t){super(t),this.channelCredentials=e}compose(e){let t=this.callCredentials.compose(e);return new n(this.channelCredentials,t)}_getConnectionOptions(){return this.channelCredentials._getConnectionOptions()}_isSecure(){return!0}_equals(e){return this===e?!0:e instanceof n?this.channelCredentials._equals(e.channelCredentials)&&this.callCredentials._equals(e.callCredentials):!1}}});var ji=A(xt=>{"use strict";Object.defineProperty(xt,"__esModule",{value:!0});xt.validateLoadBalancingConfig=xt.getFirstUsableConfig=xt.isLoadBalancerNameRegistered=xt.createLoadBalancer=xt.registerDefaultLoadBalancerType=xt.registerLoadBalancerType=xt.createChildChannelControlHelper=void 0;function OW(n,e){var t,r,i,s,o,a,l,c,u,d;return{createSubchannel:(r=(t=e.createSubchannel)===null||t===void 0?void 0:t.bind(e))!==null&&r!==void 0?r:n.createSubchannel.bind(n),updateState:(s=(i=e.updateState)===null||i===void 0?void 0:i.bind(e))!==null&&s!==void 0?s:n.updateState.bind(n),requestReresolution:(a=(o=e.requestReresolution)===null||o===void 0?void 0:o.bind(e))!==null&&a!==void 0?a:n.requestReresolution.bind(n),addChannelzChild:(c=(l=e.addChannelzChild)===null||l===void 0?void 0:l.bind(e))!==null&&c!==void 0?c:n.addChannelzChild.bind(n),removeChannelzChild:(d=(u=e.removeChannelzChild)===null||u===void 0?void 0:u.bind(e))!==null&&d!==void 0?d:n.removeChannelzChild.bind(n)}}xt.createChildChannelControlHelper=OW;var Wi={},NS=null;function xW(n,e,t){Wi[n]={LoadBalancer:e,LoadBalancingConfig:t}}xt.registerLoadBalancerType=xW;function PW(n){NS=n}xt.registerDefaultLoadBalancerType=PW;function MW(n,e){let t=n.getLoadBalancerName();return t in Wi?new Wi[t].LoadBalancer(e):null}xt.createLoadBalancer=MW;function FW(n){return n in Wi}xt.isLoadBalancerNameRegistered=FW;function LW(n,e=!1){for(let t of n)if(t.getLoadBalancerName()in Wi)return t;return e&&NS?new Wi[NS].LoadBalancingConfig:null}xt.getFirstUsableConfig=LW;function BW(n){if(!(n!==null&&typeof n=="object"))throw new Error("Load balancing config must be an object");let e=Object.keys(n);if(e.length!==1)throw new Error("Provided load balancing config has multiple conflicting entries");let t=e[0];if(t in Wi)return Wi[t].LoadBalancingConfig.createFromJson(n[t]);throw new Error(`Unrecognized load balancing config name ${t}`)}xt.validateLoadBalancingConfig=BW});var kS=A($i=>{"use strict";Object.defineProperty($i,"__esModule",{value:!0});$i.extractAndSelectServiceConfig=$i.validateServiceConfig=$i.validateRetryThrottling=void 0;var VW=X("os"),dp=we(),UW=ji(),hp=/^\d+(\.\d{1,9})?s$/,qW="node";function zW(n){if("service"in n&&n.service!==""){if(typeof n.service!="string")throw new Error(`Invalid method config name: invalid service: expected type string, got ${typeof n.service}`);if("method"in n&&n.method!==""){if(typeof n.method!="string")throw new Error(`Invalid method config name: invalid method: expected type string, got ${typeof n.service}`);return{service:n.service,method:n.method}}else return{service:n.service}}else{if("method"in n&&n.method!==void 0)throw new Error("Invalid method config name: method set with empty or unset service");return{}}}function GW(n){if(!("maxAttempts"in n)||!Number.isInteger(n.maxAttempts)||n.maxAttempts<2)throw new Error("Invalid method config retry policy: maxAttempts must be an integer at least 2");if(!("initialBackoff"in n)||typeof n.initialBackoff!="string"||!hp.test(n.initialBackoff))throw new Error("Invalid method config retry policy: initialBackoff must be a string consisting of a positive integer followed by s");if(!("maxBackoff"in n)||typeof n.maxBackoff!="string"||!hp.test(n.maxBackoff))throw new Error("Invalid method config retry policy: maxBackoff must be a string consisting of a positive integer followed by s");if(!("backoffMultiplier"in n)||typeof n.backoffMultiplier!="number"||n.backoffMultiplier<=0)throw new Error("Invalid method config retry policy: backoffMultiplier must be a number greater than 0");if(!("retryableStatusCodes"in n&&Array.isArray(n.retryableStatusCodes)))throw new Error("Invalid method config retry policy: retryableStatusCodes is required");if(n.retryableStatusCodes.length===0)throw new Error("Invalid method config retry policy: retryableStatusCodes must be non-empty");for(let e of n.retryableStatusCodes)if(typeof e=="number"){if(!Object.values(dp.Status).includes(e))throw new Error("Invalid method config retry policy: retryableStatusCodes value not in status code range")}else if(typeof e=="string"){if(!Object.values(dp.Status).includes(e.toUpperCase()))throw new Error("Invalid method config retry policy: retryableStatusCodes value not a status code name")}else throw new Error("Invalid method config retry policy: retryableStatusCodes value must be a string or number");return{maxAttempts:n.maxAttempts,initialBackoff:n.initialBackoff,maxBackoff:n.maxBackoff,backoffMultiplier:n.backoffMultiplier,retryableStatusCodes:n.retryableStatusCodes}}function WW(n){if(!("maxAttempts"in n)||!Number.isInteger(n.maxAttempts)||n.maxAttempts<2)throw new Error("Invalid method config hedging policy: maxAttempts must be an integer at least 2");if("hedgingDelay"in n&&(typeof n.hedgingDelay!="string"||!hp.test(n.hedgingDelay)))throw new Error("Invalid method config hedging policy: hedgingDelay must be a string consisting of a positive integer followed by s");if("nonFatalStatusCodes"in n&&Array.isArray(n.nonFatalStatusCodes))for(let t of n.nonFatalStatusCodes)if(typeof t=="number"){if(!Object.values(dp.Status).includes(t))throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value not in status code range")}else if(typeof t=="string"){if(!Object.values(dp.Status).includes(t.toUpperCase()))throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value not a status code name")}else throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value must be a string or number");let e={maxAttempts:n.maxAttempts};return n.hedgingDelay&&(e.hedgingDelay=n.hedgingDelay),n.nonFatalStatusCodes&&(e.nonFatalStatusCodes=n.nonFatalStatusCodes),e}function jW(n){var e;let t={name:[]};if(!("name"in n)||!Array.isArray(n.name))throw new Error("Invalid method config: invalid name array");for(let r of n.name)t.name.push(zW(r));if("waitForReady"in n){if(typeof n.waitForReady!="boolean")throw new Error("Invalid method config: invalid waitForReady");t.waitForReady=n.waitForReady}if("timeout"in n)if(typeof n.timeout=="object"){if(!("seconds"in n.timeout)||typeof n.timeout.seconds!="number")throw new Error("Invalid method config: invalid timeout.seconds");if(!("nanos"in n.timeout)||typeof n.timeout.nanos!="number")throw new Error("Invalid method config: invalid timeout.nanos");t.timeout=n.timeout}else if(typeof n.timeout=="string"&&hp.test(n.timeout)){let r=n.timeout.substring(0,n.timeout.length-1).split(".");t.timeout={seconds:r[0]|0,nanos:((e=r[1])!==null&&e!==void 0?e:0)|0}}else throw new Error("Invalid method config: invalid timeout");if("maxRequestBytes"in n){if(typeof n.maxRequestBytes!="number")throw new Error("Invalid method config: invalid maxRequestBytes");t.maxRequestBytes=n.maxRequestBytes}if("maxResponseBytes"in n){if(typeof n.maxResponseBytes!="number")throw new Error("Invalid method config: invalid maxRequestBytes");t.maxResponseBytes=n.maxResponseBytes}if("retryPolicy"in n){if("hedgingPolicy"in n)throw new Error("Invalid method config: retryPolicy and hedgingPolicy cannot both be specified");t.retryPolicy=GW(n.retryPolicy)}else"hedgingPolicy"in n&&(t.hedgingPolicy=WW(n.hedgingPolicy));return t}function s1(n){if(!("maxTokens"in n)||typeof n.maxTokens!="number"||n.maxTokens<=0||n.maxTokens>1e3)throw new Error("Invalid retryThrottling: maxTokens must be a number in (0, 1000]");if(!("tokenRatio"in n)||typeof n.tokenRatio!="number"||n.tokenRatio<=0)throw new Error("Invalid retryThrottling: tokenRatio must be a number greater than 0");return{maxTokens:+n.maxTokens.toFixed(3),tokenRatio:+n.tokenRatio.toFixed(3)}}$i.validateRetryThrottling=s1;function o1(n){let e={loadBalancingConfig:[],methodConfig:[]};if("loadBalancingPolicy"in n)if(typeof n.loadBalancingPolicy=="string")e.loadBalancingPolicy=n.loadBalancingPolicy;else throw new Error("Invalid service config: invalid loadBalancingPolicy");if("loadBalancingConfig"in n)if(Array.isArray(n.loadBalancingConfig))for(let r of n.loadBalancingConfig)e.loadBalancingConfig.push((0,UW.validateLoadBalancingConfig)(r));else throw new Error("Invalid service config: invalid loadBalancingConfig");if("methodConfig"in n&&Array.isArray(n.methodConfig))for(let r of n.methodConfig)e.methodConfig.push(jW(r));"retryThrottling"in n&&(e.retryThrottling=s1(n.retryThrottling));let t=[];for(let r of e.methodConfig)for(let i of r.name){for(let s of t)if(i.service===s.service&&i.method===s.method)throw new Error(`Invalid service config: duplicate name ${i.service}/${i.method}`);t.push(i)}return e}$i.validateServiceConfig=o1;function $W(n){if(!("serviceConfig"in n))throw new Error("Invalid service config choice: missing service config");let e={serviceConfig:o1(n.serviceConfig)};if("clientLanguage"in n)if(Array.isArray(n.clientLanguage)){e.clientLanguage=[];for(let r of n.clientLanguage)if(typeof r=="string")e.clientLanguage.push(r);else throw new Error("Invalid service config choice: invalid clientLanguage")}else throw new Error("Invalid service config choice: invalid clientLanguage");if("clientHostname"in n)if(Array.isArray(n.clientHostname)){e.clientHostname=[];for(let r of n.clientHostname)if(typeof r=="string")e.clientHostname.push(r);else throw new Error("Invalid service config choice: invalid clientHostname")}else throw new Error("Invalid service config choice: invalid clientHostname");if("percentage"in n)if(typeof n.percentage=="number"&&0<=n.percentage&&n.percentage<=100)e.percentage=n.percentage;else throw new Error("Invalid service config choice: invalid percentage");let t=["clientLanguage","percentage","clientHostname","serviceConfig"];for(let r in n)if(!t.includes(r))throw new Error(`Invalid service config choice: unexpected field ${r}`);return e}function HW(n,e){if(!Array.isArray(n))throw new Error("Invalid service config list");for(let t of n){let r=$W(t);if(!(typeof r.percentage=="number"&&e>r.percentage)){if(Array.isArray(r.clientHostname)){let i=!1;for(let s of r.clientHostname)s===VW.hostname()&&(i=!0);if(!i)continue}if(Array.isArray(r.clientLanguage)){let i=!1;for(let s of r.clientLanguage)s===qW&&(i=!0);if(!i)continue}return r.serviceConfig}}throw new Error("No matching service config found")}function KW(n,e){for(let t of n)if(t.length>0&&t[0].startsWith("grpc_config=")){let r=t.join("").substring(12),i=JSON.parse(r);return HW(i,e)}return null}$i.extractAndSelectServiceConfig=KW});var Dn=A(fp=>{"use strict";Object.defineProperty(fp,"__esModule",{value:!0});fp.ConnectivityState=void 0;var a1=function(n){return n[n.IDLE=0]="IDLE",n[n.CONNECTING=1]="CONNECTING",n[n.READY=2]="READY",n[n.TRANSIENT_FAILURE=3]="TRANSIENT_FAILURE",n[n.SHUTDOWN=4]="SHUTDOWN",n}(a1||(fp.ConnectivityState=a1={}))});var mn=A(Hi=>{"use strict";Object.defineProperty(Hi,"__esModule",{value:!0});Hi.uriToString=Hi.splitHostPort=Hi.parseUri=void 0;var QW=/^(?:([A-Za-z0-9+.-]+):)?(?:\/\/([^/]*)\/)?(.+)$/;function YW(n){let e=QW.exec(n);return e===null?null:{scheme:e[1],authority:e[2],path:e[3]}}Hi.parseUri=YW;var l1=/^\d+$/;function XW(n){if(n.startsWith("[")){let e=n.indexOf("]");if(e===-1)return null;let t=n.substring(1,e);if(t.indexOf(":")===-1)return null;if(n.length>e+1)if(n[e+1]===":"){let r=n.substring(e+2);return l1.test(r)?{host:t,port:+r}:null}else return null;else return{host:t}}else{let e=n.split(":");return e.length===2?l1.test(e[1])?{host:e[0],port:+e[1]}:null:{host:n}}}Hi.splitHostPort=XW;function JW(n){let e="";return n.scheme!==void 0&&(e+=n.scheme+":"),n.authority!==void 0&&(e+="//"+n.authority+"/"),e+=n.path,e}Hi.uriToString=JW});var Tr=A(Nn=>{"use strict";Object.defineProperty(Nn,"__esModule",{value:!0});Nn.mapUriDefaultScheme=Nn.getDefaultAuthority=Nn.createResolver=Nn.registerDefaultScheme=Nn.registerResolver=void 0;var xS=mn(),Ua={},OS=null;function ZW(n,e){Ua[n]=e}Nn.registerResolver=ZW;function e6(n){OS=n}Nn.registerDefaultScheme=e6;function t6(n,e,t){if(n.scheme!==void 0&&n.scheme in Ua)return new Ua[n.scheme](n,e,t);throw new Error(`No resolver could be created for target ${(0,xS.uriToString)(n)}`)}Nn.createResolver=t6;function n6(n){if(n.scheme!==void 0&&n.scheme in Ua)return Ua[n.scheme].getDefaultAuthority(n);throw new Error(`Invalid target ${(0,xS.uriToString)(n)}`)}Nn.getDefaultAuthority=n6;function r6(n){return n.scheme===void 0||!(n.scheme in Ua)?OS!==null?{scheme:OS,authority:void 0,path:(0,xS.uriToString)(n)}:null:n}Nn.mapUriDefaultScheme=r6});var Qi=A(Ki=>{"use strict";Object.defineProperty(Ki,"__esModule",{value:!0});Ki.QueuePicker=Ki.UnavailablePicker=Ki.PickResultType=void 0;var i6=tn(),s6=we(),pp=function(n){return n[n.COMPLETE=0]="COMPLETE",n[n.QUEUE=1]="QUEUE",n[n.TRANSIENT_FAILURE=2]="TRANSIENT_FAILURE",n[n.DROP=3]="DROP",n}(pp||(Ki.PickResultType=pp={})),PS=class{constructor(e){this.status=Object.assign({code:s6.Status.UNAVAILABLE,details:"No connection established",metadata:new i6.Metadata},e)}pick(e){return{pickResultType:pp.TRANSIENT_FAILURE,subchannel:null,status:this.status,onCallStarted:null,onCallEnded:null}}};Ki.UnavailablePicker=PS;var MS=class{constructor(e){this.loadBalancer=e,this.calledExitIdle=!1}pick(e){return this.calledExitIdle||(process.nextTick(()=>{this.loadBalancer.exitIdle()}),this.calledExitIdle=!0),{pickResultType:pp.QUEUE,subchannel:null,status:null,onCallStarted:null,onCallEnded:null}}};Ki.QueuePicker=MS});var Ou=A(mp=>{"use strict";Object.defineProperty(mp,"__esModule",{value:!0});mp.BackoffTimeout=void 0;var o6=1e3,a6=1.6,l6=12e4,c6=.2;function u6(n,e){return Math.random()*(e-n)+n}var FS=class{constructor(e,t){this.callback=e,this.initialDelay=o6,this.multiplier=a6,this.maxDelay=l6,this.jitter=c6,this.running=!1,this.hasRef=!0,this.startTime=new Date,this.endTime=new Date,t&&(t.initialDelay&&(this.initialDelay=t.initialDelay),t.multiplier&&(this.multiplier=t.multiplier),t.jitter&&(this.jitter=t.jitter),t.maxDelay&&(this.maxDelay=t.maxDelay)),this.nextDelay=this.initialDelay,this.timerId=setTimeout(()=>{},0),clearTimeout(this.timerId)}runTimer(e){var t,r;this.endTime=this.startTime,this.endTime.setMilliseconds(this.endTime.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),this.timerId=setTimeout(()=>{this.callback(),this.running=!1},e),this.hasRef||(r=(t=this.timerId).unref)===null||r===void 0||r.call(t)}runOnce(){this.running=!0,this.startTime=new Date,this.runTimer(this.nextDelay);let e=Math.min(this.nextDelay*this.multiplier,this.maxDelay),t=e*this.jitter;this.nextDelay=e+u6(-t,t)}stop(){clearTimeout(this.timerId),this.running=!1}reset(){if(this.nextDelay=this.initialDelay,this.running){let e=new Date,t=this.startTime;t.setMilliseconds(t.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),e<t?this.runTimer(t.getTime()-e.getTime()):this.running=!1}}isRunning(){return this.running}ref(){var e,t;this.hasRef=!0,(t=(e=this.timerId).ref)===null||t===void 0||t.call(e)}unref(){var e,t;this.hasRef=!1,(t=(e=this.timerId).unref)===null||t===void 0||t.call(e)}getEndTime(){return this.endTime}};mp.BackoffTimeout=FS});var yp=A(gp=>{"use strict";Object.defineProperty(gp,"__esModule",{value:!0});gp.ChildLoadBalancerHandler=void 0;var d6=ji(),h6=Dn(),f6="child_load_balancer_helper",LS=class{constructor(e){this.channelControlHelper=e,this.currentChild=null,this.pendingChild=null,this.latestConfig=null,this.ChildPolicyHelper=class{constructor(t){this.parent=t,this.child=null}createSubchannel(t,r){return this.parent.channelControlHelper.createSubchannel(t,r)}updateState(t,r){var i;if(this.calledByPendingChild()){if(t===h6.ConnectivityState.CONNECTING)return;(i=this.parent.currentChild)===null||i===void 0||i.destroy(),this.parent.currentChild=this.parent.pendingChild,this.parent.pendingChild=null}else if(!this.calledByCurrentChild())return;this.parent.channelControlHelper.updateState(t,r)}requestReresolution(){var t;let r=(t=this.parent.pendingChild)!==null&&t!==void 0?t:this.parent.currentChild;this.child===r&&this.parent.channelControlHelper.requestReresolution()}setChild(t){this.child=t}addChannelzChild(t){this.parent.channelControlHelper.addChannelzChild(t)}removeChannelzChild(t){this.parent.channelControlHelper.removeChannelzChild(t)}calledByPendingChild(){return this.child===this.parent.pendingChild}calledByCurrentChild(){return this.child===this.parent.currentChild}}}configUpdateRequiresNewPolicyInstance(e,t){return e.getLoadBalancerName()!==t.getLoadBalancerName()}updateAddressList(e,t,r){let i;if(this.currentChild===null||this.latestConfig===null||this.configUpdateRequiresNewPolicyInstance(this.latestConfig,t)){let s=new this.ChildPolicyHelper(this),o=(0,d6.createLoadBalancer)(t,s);s.setChild(o),this.currentChild===null?(this.currentChild=o,i=this.currentChild):(this.pendingChild&&this.pendingChild.destroy(),this.pendingChild=o,i=this.pendingChild)}else this.pendingChild===null?i=this.currentChild:i=this.pendingChild;this.latestConfig=t,i.updateAddressList(e,t,r)}exitIdle(){this.currentChild&&(this.currentChild.exitIdle(),this.pendingChild&&this.pendingChild.exitIdle())}resetBackoff(){this.currentChild&&(this.currentChild.resetBackoff(),this.pendingChild&&this.pendingChild.resetBackoff())}destroy(){this.currentChild&&(this.currentChild.destroy(),this.currentChild=null),this.pendingChild&&(this.pendingChild.destroy(),this.pendingChild=null)}getTypeName(){return f6}};gp.ChildLoadBalancerHandler=LS});var u1=A(_p=>{"use strict";Object.defineProperty(_p,"__esModule",{value:!0});_p.ResolvingLoadBalancer=void 0;var p6=ji(),m6=kS(),nn=Dn(),g6=Tr(),qa=Qi(),y6=Ou(),BS=we(),_6=tn(),v6=Xe(),E6=we(),S6=mn(),C6=yp(),w6="resolving_load_balancer";function c1(n){v6.trace(E6.LogVerbosity.DEBUG,w6,n)}var T6=["SERVICE_AND_METHOD","SERVICE","EMPTY"];function b6(n,e,t,r){for(let i of t.name)switch(r){case"EMPTY":if(!i.service&&!i.method)return!0;break;case"SERVICE":if(i.service===n&&!i.method)return!0;break;case"SERVICE_AND_METHOD":if(i.service===n&&i.method===e)return!0}return!1}function I6(n,e,t,r){for(let i of t)if(b6(n,e,i,r))return i;return null}function A6(n){return function(t,r){var i,s;let o=t.split("/").filter(c=>c.length>0),a=(i=o[0])!==null&&i!==void 0?i:"",l=(s=o[1])!==null&&s!==void 0?s:"";if(n&&n.methodConfig)for(let c of T6){let u=I6(a,l,n.methodConfig,c);if(u)return{methodConfig:u,pickInformation:{},status:BS.Status.OK,dynamicFilterFactories:[]}}return{methodConfig:{name:[]},pickInformation:{},status:BS.Status.OK,dynamicFilterFactories:[]}}}var VS=class{constructor(e,t,r,i,s){this.target=e,this.channelControlHelper=t,this.onSuccessfulResolution=i,this.onFailedResolution=s,this.latestChildState=nn.ConnectivityState.IDLE,this.latestChildPicker=new qa.QueuePicker(this),this.currentState=nn.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1,r["grpc.service_config"]?this.defaultServiceConfig=(0,m6.validateServiceConfig)(JSON.parse(r["grpc.service_config"])):this.defaultServiceConfig={loadBalancingConfig:[],methodConfig:[]},this.updateState(nn.ConnectivityState.IDLE,new qa.QueuePicker(this)),this.childLoadBalancer=new C6.ChildLoadBalancerHandler({createSubchannel:t.createSubchannel.bind(t),requestReresolution:()=>{this.backoffTimeout.isRunning()?(c1("requestReresolution delayed by backoff timer until "+this.backoffTimeout.getEndTime().toISOString()),this.continueResolving=!0):this.updateResolution()},updateState:(a,l)=>{this.latestChildState=a,this.latestChildPicker=l,this.updateState(a,l)},addChannelzChild:t.addChannelzChild.bind(t),removeChannelzChild:t.removeChannelzChild.bind(t)}),this.innerResolver=(0,g6.createResolver)(e,{onSuccessfulResolution:(a,l,c,u,d)=>{var h;this.backoffTimeout.stop(),this.backoffTimeout.reset();let p=null;l===null?c===null?(this.previousServiceConfig=null,p=this.defaultServiceConfig):this.previousServiceConfig===null?this.handleResolutionFailure(c):p=this.previousServiceConfig:(p=l,this.previousServiceConfig=l);let E=(h=p?.loadBalancingConfig)!==null&&h!==void 0?h:[],w=(0,p6.getFirstUsableConfig)(E,!0);if(w===null){this.handleResolutionFailure({code:BS.Status.UNAVAILABLE,details:"All load balancer options in service config are not compatible",metadata:new _6.Metadata});return}this.childLoadBalancer.updateAddressList(a,w,d);let b=p??this.defaultServiceConfig;this.onSuccessfulResolution(b,u??A6(b))},onError:a=>{this.handleResolutionFailure(a)}},r);let o={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new y6.BackoffTimeout(()=>{this.continueResolving?(this.updateResolution(),this.continueResolving=!1):this.updateState(this.latestChildState,this.latestChildPicker)},o),this.backoffTimeout.unref()}updateResolution(){this.innerResolver.updateResolution(),this.currentState===nn.ConnectivityState.IDLE&&this.updateState(nn.ConnectivityState.CONNECTING,new qa.QueuePicker(this)),this.backoffTimeout.runOnce()}updateState(e,t){c1((0,S6.uriToString)(this.target)+" "+nn.ConnectivityState[this.currentState]+" -> "+nn.ConnectivityState[e]),e===nn.ConnectivityState.IDLE&&(t=new qa.QueuePicker(this)),this.currentState=e,this.channelControlHelper.updateState(e,t)}handleResolutionFailure(e){this.latestChildState===nn.ConnectivityState.IDLE&&(this.updateState(nn.ConnectivityState.TRANSIENT_FAILURE,new qa.UnavailablePicker(e)),this.onFailedResolution(e))}exitIdle(){(this.currentState===nn.ConnectivityState.IDLE||this.currentState===nn.ConnectivityState.TRANSIENT_FAILURE)&&(this.backoffTimeout.isRunning()?this.continueResolving=!0:this.updateResolution()),this.childLoadBalancer.exitIdle()}updateAddressList(e,t){throw new Error("updateAddressList not supported on ResolvingLoadBalancer")}resetBackoff(){this.backoffTimeout.reset(),this.childLoadBalancer.resetBackoff()}destroy(){this.childLoadBalancer.destroy(),this.innerResolver.destroy(),this.backoffTimeout.reset(),this.backoffTimeout.stop(),this.latestChildState=nn.ConnectivityState.IDLE,this.latestChildPicker=new qa.QueuePicker(this),this.currentState=nn.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1}getTypeName(){return"resolving_load_balancer"}};_p.ResolvingLoadBalancer=VS});var d1=A(za=>{"use strict";Object.defineProperty(za,"__esModule",{value:!0});za.channelOptionsEqual=za.recognizedOptions=void 0;za.recognizedOptions={"grpc.ssl_target_name_override":!0,"grpc.primary_user_agent":!0,"grpc.secondary_user_agent":!0,"grpc.default_authority":!0,"grpc.keepalive_time_ms":!0,"grpc.keepalive_timeout_ms":!0,"grpc.keepalive_permit_without_calls":!0,"grpc.service_config":!0,"grpc.max_concurrent_streams":!0,"grpc.initial_reconnect_backoff_ms":!0,"grpc.max_reconnect_backoff_ms":!0,"grpc.use_local_subchannel_pool":!0,"grpc.max_send_message_length":!0,"grpc.max_receive_message_length":!0,"grpc.enable_http_proxy":!0,"grpc.enable_channelz":!0,"grpc.dns_min_time_between_resolutions_ms":!0,"grpc.enable_retries":!0,"grpc.per_rpc_retry_buffer_size":!0,"grpc.retry_buffer_size":!0,"grpc.max_connection_age_ms":!0,"grpc.max_connection_age_grace_ms":!0,"grpc-node.max_session_memory":!0,"grpc.service_config_disable_resolution":!0,"grpc.client_idle_timeout_ms":!0,"grpc-node.tls_enable_trace":!0};function R6(n,e){let t=Object.keys(n).sort(),r=Object.keys(e).sort();if(t.length!==r.length)return!1;for(let i=0;i<t.length;i+=1)if(t[i]!==r[i]||n[t[i]]!==e[r[i]])return!1;return!0}za.channelOptionsEqual=R6});var Ir=A(br=>{"use strict";Object.defineProperty(br,"__esModule",{value:!0});br.stringToSubchannelAddress=br.subchannelAddressToString=br.subchannelAddressEqual=br.isTcpSubchannelAddress=void 0;var D6=X("net");function xu(n){return"port"in n}br.isTcpSubchannelAddress=xu;function N6(n,e){return!n&&!e?!0:!n||!e?!1:xu(n)?xu(e)&&n.host===e.host&&n.port===e.port:!xu(e)&&n.path===e.path}br.subchannelAddressEqual=N6;function k6(n){return xu(n)?n.host+":"+n.port:n.path}br.subchannelAddressToString=k6;var O6=443;function x6(n,e){return(0,D6.isIP)(n)?{host:n,port:e??O6}:{path:n}}br.stringToSubchannelAddress=x6});var vp=A(Ga=>{"use strict";Object.defineProperty(Ga,"__esModule",{value:!0});Ga.addAdminServicesToServer=Ga.registerAdminService=void 0;var h1=[];function P6(n,e){h1.push({getServiceDefinition:n,getHandlers:e})}Ga.registerAdminService=P6;function M6(n){for(let{getServiceDefinition:e,getHandlers:t}of h1)n.addService(e(),t())}Ga.addAdminServicesToServer=M6});var f1=A(kn=>{"use strict";Object.defineProperty(kn,"__esModule",{value:!0});kn.ClientDuplexStreamImpl=kn.ClientWritableStreamImpl=kn.ClientReadableStreamImpl=kn.ClientUnaryCallImpl=kn.callErrorFromStatus=void 0;var F6=X("events"),WS=X("stream"),Pu=we();function L6(n,e){let t=`${n.code} ${Pu.Status[n.code]}: ${n.details}`,i=`${new Error(t).stack}
for call at
${e}`;return Object.assign(new Error(t),n,{stack:i})}kn.callErrorFromStatus=L6;var US=class extends F6.EventEmitter{constructor(){super()}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(Pu.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}};kn.ClientUnaryCallImpl=US;var qS=class extends WS.Readable{constructor(e){super({objectMode:!0}),this.deserialize=e}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(Pu.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_read(e){var t;(t=this.call)===null||t===void 0||t.startRead()}};kn.ClientReadableStreamImpl=qS;var zS=class extends WS.Writable{constructor(e){super({objectMode:!0}),this.serialize=e}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(Pu.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_write(e,t,r){var i;let s={callback:r},o=Number(t);Number.isNaN(o)||(s.flags=o),(i=this.call)===null||i===void 0||i.sendMessageWithContext(s,e)}_final(e){var t;(t=this.call)===null||t===void 0||t.halfClose(),e()}};kn.ClientWritableStreamImpl=zS;var GS=class extends WS.Duplex{constructor(e,t){super({objectMode:!0}),this.serialize=e,this.deserialize=t}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(Pu.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_read(e){var t;(t=this.call)===null||t===void 0||t.startRead()}_write(e,t,r){var i;let s={callback:r},o=Number(t);Number.isNaN(o)||(s.flags=o),(i=this.call)===null||i===void 0||i.sendMessageWithContext(s,e)}_final(e){var t;(t=this.call)===null||t===void 0||t.halfClose(),e()}};kn.ClientDuplexStreamImpl=GS});var p1=A(Wa=>{"use strict";Object.defineProperty(Wa,"__esModule",{value:!0});Wa.InterceptingListenerImpl=Wa.isInterceptingListener=void 0;function B6(n){return n.onReceiveMetadata!==void 0&&n.onReceiveMetadata.length===1}Wa.isInterceptingListener=B6;var jS=class{constructor(e,t){this.listener=e,this.nextListener=t,this.processingMetadata=!1,this.hasPendingMessage=!1,this.processingMessage=!1,this.pendingStatus=null}processPendingMessage(){this.hasPendingMessage&&(this.nextListener.onReceiveMessage(this.pendingMessage),this.pendingMessage=null,this.hasPendingMessage=!1)}processPendingStatus(){this.pendingStatus&&this.nextListener.onReceiveStatus(this.pendingStatus)}onReceiveMetadata(e){this.processingMetadata=!0,this.listener.onReceiveMetadata(e,t=>{this.processingMetadata=!1,this.nextListener.onReceiveMetadata(t),this.processPendingMessage(),this.processPendingStatus()})}onReceiveMessage(e){this.processingMessage=!0,this.listener.onReceiveMessage(e,t=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessage=t,this.hasPendingMessage=!0):(this.nextListener.onReceiveMessage(t),this.processPendingStatus())})}onReceiveStatus(e){this.listener.onReceiveStatus(e,t=>{this.processingMetadata||this.processingMessage?this.pendingStatus=t:this.nextListener.onReceiveStatus(t)})}};Wa.InterceptingListenerImpl=jS});var JS=A(On=>{"use strict";Object.defineProperty(On,"__esModule",{value:!0});On.getInterceptingCall=On.InterceptingCall=On.RequesterBuilder=On.ListenerBuilder=On.InterceptorConfigurationError=void 0;var V6=tn(),m1=p1(),g1=we(),y1=ip(),Fu=class n extends Error{constructor(e){super(e),this.name="InterceptorConfigurationError",Error.captureStackTrace(this,n)}};On.InterceptorConfigurationError=Fu;var HS=class{constructor(){this.metadata=void 0,this.message=void 0,this.status=void 0}withOnReceiveMetadata(e){return this.metadata=e,this}withOnReceiveMessage(e){return this.message=e,this}withOnReceiveStatus(e){return this.status=e,this}build(){return{onReceiveMetadata:this.metadata,onReceiveMessage:this.message,onReceiveStatus:this.status}}};On.ListenerBuilder=HS;var KS=class{constructor(){this.start=void 0,this.message=void 0,this.halfClose=void 0,this.cancel=void 0}withStart(e){return this.start=e,this}withSendMessage(e){return this.message=e,this}withHalfClose(e){return this.halfClose=e,this}withCancel(e){return this.cancel=e,this}build(){return{start:this.start,sendMessage:this.message,halfClose:this.halfClose,cancel:this.cancel}}};On.RequesterBuilder=KS;var $S={onReceiveMetadata:(n,e)=>{e(n)},onReceiveMessage:(n,e)=>{e(n)},onReceiveStatus:(n,e)=>{e(n)}},Mu={start:(n,e,t)=>{t(n,e)},sendMessage:(n,e)=>{e(n)},halfClose:n=>{n()},cancel:n=>{n()}},QS=class{constructor(e,t){var r,i,s,o;this.nextCall=e,this.processingMetadata=!1,this.pendingMessageContext=null,this.processingMessage=!1,this.pendingHalfClose=!1,t?this.requester={start:(r=t.start)!==null&&r!==void 0?r:Mu.start,sendMessage:(i=t.sendMessage)!==null&&i!==void 0?i:Mu.sendMessage,halfClose:(s=t.halfClose)!==null&&s!==void 0?s:Mu.halfClose,cancel:(o=t.cancel)!==null&&o!==void 0?o:Mu.cancel}:this.requester=Mu}cancelWithStatus(e,t){this.requester.cancel(()=>{this.nextCall.cancelWithStatus(e,t)})}getPeer(){return this.nextCall.getPeer()}processPendingMessage(){this.pendingMessageContext&&(this.nextCall.sendMessageWithContext(this.pendingMessageContext,this.pendingMessage),this.pendingMessageContext=null,this.pendingMessage=null)}processPendingHalfClose(){this.pendingHalfClose&&this.nextCall.halfClose()}start(e,t){var r,i,s,o,a,l;let c={onReceiveMetadata:(i=(r=t?.onReceiveMetadata)===null||r===void 0?void 0:r.bind(t))!==null&&i!==void 0?i:u=>{},onReceiveMessage:(o=(s=t?.onReceiveMessage)===null||s===void 0?void 0:s.bind(t))!==null&&o!==void 0?o:u=>{},onReceiveStatus:(l=(a=t?.onReceiveStatus)===null||a===void 0?void 0:a.bind(t))!==null&&l!==void 0?l:u=>{}};this.processingMetadata=!0,this.requester.start(e,c,(u,d)=>{var h,p,E;this.processingMetadata=!1;let w;if((0,m1.isInterceptingListener)(d))w=d;else{let b={onReceiveMetadata:(h=d.onReceiveMetadata)!==null&&h!==void 0?h:$S.onReceiveMetadata,onReceiveMessage:(p=d.onReceiveMessage)!==null&&p!==void 0?p:$S.onReceiveMessage,onReceiveStatus:(E=d.onReceiveStatus)!==null&&E!==void 0?E:$S.onReceiveStatus};w=new m1.InterceptingListenerImpl(b,c)}this.nextCall.start(u,w),this.processPendingMessage(),this.processPendingHalfClose()})}sendMessageWithContext(e,t){this.processingMessage=!0,this.requester.sendMessage(t,r=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessageContext=e,this.pendingMessage=t):(this.nextCall.sendMessageWithContext(e,r),this.processPendingHalfClose())})}sendMessage(e){this.sendMessageWithContext({},e)}startRead(){this.nextCall.startRead()}halfClose(){this.requester.halfClose(()=>{this.processingMetadata||this.processingMessage?this.pendingHalfClose=!0:this.nextCall.halfClose()})}};On.InterceptingCall=QS;function U6(n,e,t){var r,i;let s=(r=t.deadline)!==null&&r!==void 0?r:1/0,o=t.host,a=(i=t.parent)!==null&&i!==void 0?i:null,l=t.propagate_flags,c=t.credentials,u=n.createCall(e,s,o,a,l);return c&&u.setCredentials(c),u}var Ep=class{constructor(e,t){this.call=e,this.methodDefinition=t}cancelWithStatus(e,t){this.call.cancelWithStatus(e,t)}getPeer(){return this.call.getPeer()}sendMessageWithContext(e,t){let r;try{r=this.methodDefinition.requestSerialize(t)}catch(i){this.call.cancelWithStatus(g1.Status.INTERNAL,`Request message serialization failure: ${(0,y1.getErrorMessage)(i)}`);return}this.call.sendMessageWithContext(e,r)}sendMessage(e){this.sendMessageWithContext({},e)}start(e,t){let r=null;this.call.start(e,{onReceiveMetadata:i=>{var s;(s=t?.onReceiveMetadata)===null||s===void 0||s.call(t,i)},onReceiveMessage:i=>{var s;let o;try{o=this.methodDefinition.responseDeserialize(i)}catch(a){r={code:g1.Status.INTERNAL,details:`Response message parsing error: ${(0,y1.getErrorMessage)(a)}`,metadata:new V6.Metadata},this.call.cancelWithStatus(r.code,r.details);return}(s=t?.onReceiveMessage)===null||s===void 0||s.call(t,o)},onReceiveStatus:i=>{var s,o;r?(s=t?.onReceiveStatus)===null||s===void 0||s.call(t,r):(o=t?.onReceiveStatus)===null||o===void 0||o.call(t,i)}})}startRead(){this.call.startRead()}halfClose(){this.call.halfClose()}},YS=class extends Ep{constructor(e,t){super(e,t)}start(e,t){var r,i;let s=!1,o={onReceiveMetadata:(i=(r=t?.onReceiveMetadata)===null||r===void 0?void 0:r.bind(t))!==null&&i!==void 0?i:a=>{},onReceiveMessage:a=>{var l;s=!0,(l=t?.onReceiveMessage)===null||l===void 0||l.call(t,a)},onReceiveStatus:a=>{var l,c;s||(l=t?.onReceiveMessage)===null||l===void 0||l.call(t,null),(c=t?.onReceiveStatus)===null||c===void 0||c.call(t,a)}};super.start(e,o),this.call.startRead()}},XS=class extends Ep{};function q6(n,e,t){let r=U6(n,t.path,e);return t.responseStream?new XS(r,t):new YS(r,t)}function z6(n,e,t,r){if(n.clientInterceptors.length>0&&n.clientInterceptorProviders.length>0)throw new Fu("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(n.callInterceptors.length>0&&n.callInterceptorProviders.length>0)throw new Fu("Both interceptors and interceptor_providers were passed as call options. Only one of these is allowed.");let i=[];n.callInterceptors.length>0||n.callInterceptorProviders.length>0?i=[].concat(n.callInterceptors,n.callInterceptorProviders.map(a=>a(e))).filter(a=>a):i=[].concat(n.clientInterceptors,n.clientInterceptorProviders.map(a=>a(e))).filter(a=>a);let s=Object.assign({},t,{method_definition:e});return i.reduceRight((a,l)=>c=>l(c,a),a=>q6(r,a,e))(s)}On.getInterceptingCall=z6});var tC=A(Cp=>{"use strict";Object.defineProperty(Cp,"__esModule",{value:!0});Cp.Client=void 0;var Ar=f1(),G6=nC(),W6=Dn(),Yi=we(),ja=tn(),Sp=JS(),Qn=Symbol(),$a=Symbol(),Ha=Symbol(),si=Symbol();function ZS(n){return typeof n=="function"}function Ka(n){return n.stack.split(`
`).slice(1).join(`
`)}var eC=class{constructor(e,t,r={}){var i,s;if(r=Object.assign({},r),this[$a]=(i=r.interceptors)!==null&&i!==void 0?i:[],delete r.interceptors,this[Ha]=(s=r.interceptor_providers)!==null&&s!==void 0?s:[],delete r.interceptor_providers,this[$a].length>0&&this[Ha].length>0)throw new Error("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(this[si]=r.callInvocationTransformer,delete r.callInvocationTransformer,r.channelOverride)this[Qn]=r.channelOverride;else if(r.channelFactoryOverride){let o=r.channelFactoryOverride;delete r.channelFactoryOverride,this[Qn]=o(e,t,r)}else this[Qn]=new G6.ChannelImplementation(e,t,r)}close(){this[Qn].close()}getChannel(){return this[Qn]}waitForReady(e,t){let r=i=>{if(i){t(new Error("Failed to connect before the deadline"));return}let s;try{s=this[Qn].getConnectivityState(!0)}catch{t(new Error("The channel has been closed"));return}if(s===W6.ConnectivityState.READY)t();else try{this[Qn].watchConnectivityState(s,e,r)}catch{t(new Error("The channel has been closed"))}};setImmediate(r)}checkOptionalUnaryResponseArguments(e,t,r){if(ZS(e))return{metadata:new ja.Metadata,options:{},callback:e};if(ZS(t))return e instanceof ja.Metadata?{metadata:e,options:{},callback:t}:{metadata:new ja.Metadata,options:e,callback:t};if(!(e instanceof ja.Metadata&&t instanceof Object&&ZS(r)))throw new Error("Incorrect arguments passed");return{metadata:e,options:t,callback:r}}makeUnaryRequest(e,t,r,i,s,o,a){var l,c;let u=this.checkOptionalUnaryResponseArguments(s,o,a),d={path:e,requestStream:!1,responseStream:!1,requestSerialize:t,responseDeserialize:r},h={argument:i,metadata:u.metadata,call:new Ar.ClientUnaryCallImpl,channel:this[Qn],methodDefinition:d,callOptions:u.options,callback:u.callback};this[si]&&(h=this[si](h));let p=h.call,E={clientInterceptors:this[$a],clientInterceptorProviders:this[Ha],callInterceptors:(l=h.callOptions.interceptors)!==null&&l!==void 0?l:[],callInterceptorProviders:(c=h.callOptions.interceptor_providers)!==null&&c!==void 0?c:[]},w=(0,Sp.getInterceptingCall)(E,h.methodDefinition,h.callOptions,h.channel);p.call=w;let b=null,N=!1,D=new Error;return w.start(h.metadata,{onReceiveMetadata:O=>{p.emit("metadata",O)},onReceiveMessage(O){b!==null&&w.cancelWithStatus(Yi.Status.INTERNAL,"Too many responses received"),b=O},onReceiveStatus(O){if(!N){if(N=!0,O.code===Yi.Status.OK)if(b===null){let F=Ka(D);h.callback((0,Ar.callErrorFromStatus)({code:Yi.Status.INTERNAL,details:"No message received",metadata:O.metadata},F))}else h.callback(null,b);else{let F=Ka(D);h.callback((0,Ar.callErrorFromStatus)(O,F))}D=null,p.emit("status",O)}}}),w.sendMessage(i),w.halfClose(),p}makeClientStreamRequest(e,t,r,i,s,o){var a,l;let c=this.checkOptionalUnaryResponseArguments(i,s,o),u={path:e,requestStream:!0,responseStream:!1,requestSerialize:t,responseDeserialize:r},d={metadata:c.metadata,call:new Ar.ClientWritableStreamImpl(t),channel:this[Qn],methodDefinition:u,callOptions:c.options,callback:c.callback};this[si]&&(d=this[si](d));let h=d.call,p={clientInterceptors:this[$a],clientInterceptorProviders:this[Ha],callInterceptors:(a=d.callOptions.interceptors)!==null&&a!==void 0?a:[],callInterceptorProviders:(l=d.callOptions.interceptor_providers)!==null&&l!==void 0?l:[]},E=(0,Sp.getInterceptingCall)(p,d.methodDefinition,d.callOptions,d.channel);h.call=E;let w=null,b=!1,N=new Error;return E.start(d.metadata,{onReceiveMetadata:D=>{h.emit("metadata",D)},onReceiveMessage(D){w!==null&&E.cancelWithStatus(Yi.Status.INTERNAL,"Too many responses received"),w=D},onReceiveStatus(D){if(!b){if(b=!0,D.code===Yi.Status.OK)if(w===null){let O=Ka(N);d.callback((0,Ar.callErrorFromStatus)({code:Yi.Status.INTERNAL,details:"No message received",metadata:D.metadata},O))}else d.callback(null,w);else{let O=Ka(N);d.callback((0,Ar.callErrorFromStatus)(D,O))}N=null,h.emit("status",D)}}}),h}checkMetadataAndOptions(e,t){let r,i;return e instanceof ja.Metadata?(r=e,t?i=t:i={}):(e?i=e:i={},r=new ja.Metadata),{metadata:r,options:i}}makeServerStreamRequest(e,t,r,i,s,o){var a,l;let c=this.checkMetadataAndOptions(s,o),u={path:e,requestStream:!1,responseStream:!0,requestSerialize:t,responseDeserialize:r},d={argument:i,metadata:c.metadata,call:new Ar.ClientReadableStreamImpl(r),channel:this[Qn],methodDefinition:u,callOptions:c.options};this[si]&&(d=this[si](d));let h=d.call,p={clientInterceptors:this[$a],clientInterceptorProviders:this[Ha],callInterceptors:(a=d.callOptions.interceptors)!==null&&a!==void 0?a:[],callInterceptorProviders:(l=d.callOptions.interceptor_providers)!==null&&l!==void 0?l:[]},E=(0,Sp.getInterceptingCall)(p,d.methodDefinition,d.callOptions,d.channel);h.call=E;let w=!1,b=new Error;return E.start(d.metadata,{onReceiveMetadata(N){h.emit("metadata",N)},onReceiveMessage(N){h.push(N)},onReceiveStatus(N){if(!w){if(w=!0,h.push(null),N.code!==Yi.Status.OK){let D=Ka(b);h.emit("error",(0,Ar.callErrorFromStatus)(N,D))}b=null,h.emit("status",N)}}}),E.sendMessage(i),E.halfClose(),h}makeBidiStreamRequest(e,t,r,i,s){var o,a;let l=this.checkMetadataAndOptions(i,s),c={path:e,requestStream:!0,responseStream:!0,requestSerialize:t,responseDeserialize:r},u={metadata:l.metadata,call:new Ar.ClientDuplexStreamImpl(t,r),channel:this[Qn],methodDefinition:c,callOptions:l.options};this[si]&&(u=this[si](u));let d=u.call,h={clientInterceptors:this[$a],clientInterceptorProviders:this[Ha],callInterceptors:(o=u.callOptions.interceptors)!==null&&o!==void 0?o:[],callInterceptorProviders:(a=u.callOptions.interceptor_providers)!==null&&a!==void 0?a:[]},p=(0,Sp.getInterceptingCall)(h,u.methodDefinition,u.callOptions,u.channel);d.call=p;let E=!1,w=new Error;return p.start(u.metadata,{onReceiveMetadata(b){d.emit("metadata",b)},onReceiveMessage(b){d.push(b)},onReceiveStatus(b){if(!E){if(E=!0,d.push(null),b.code!==Yi.Status.OK){let N=Ka(w);d.emit("error",(0,Ar.callErrorFromStatus)(b,N))}w=null,d.emit("status",b)}}}),d}};Cp.Client=eC});var iC=A(Qa=>{"use strict";Object.defineProperty(Qa,"__esModule",{value:!0});Qa.loadPackageDefinition=Qa.makeClientConstructor=void 0;var Lu=tC(),j6={unary:Lu.Client.prototype.makeUnaryRequest,server_stream:Lu.Client.prototype.makeServerStreamRequest,client_stream:Lu.Client.prototype.makeClientStreamRequest,bidi:Lu.Client.prototype.makeBidiStreamRequest};function rC(n){return["__proto__","prototype","constructor"].includes(n)}function _1(n,e,t){t||(t={});class r extends Lu.Client{}return Object.keys(n).forEach(i=>{if(rC(i))return;let s=n[i],o;if(typeof i=="string"&&i.charAt(0)==="$")throw new Error("Method names cannot start with $");s.requestStream?s.responseStream?o="bidi":o="client_stream":s.responseStream?o="server_stream":o="unary";let a=s.requestSerialize,l=s.responseDeserialize,c=$6(j6[o],s.path,a,l);r.prototype[i]=c,Object.assign(r.prototype[i],s),s.originalName&&!rC(s.originalName)&&(r.prototype[s.originalName]=r.prototype[i])}),r.service=n,r.serviceName=e,r}Qa.makeClientConstructor=_1;function $6(n,e,t,r){return function(...i){return n.call(this,e,t,r,...i)}}function H6(n){return"format"in n}function K6(n){let e={};for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t)){let r=n[t],i=t.split(".");if(i.some(a=>rC(a)))continue;let s=i[i.length-1],o=e;for(let a of i.slice(0,-1))o[a]||(o[a]={}),o=o[a];H6(r)?o[s]=r:o[s]=_1(r,s,{})}return e}Qa.loadPackageDefinition=K6});var G1=A((Wse,z1)=>{"use strict";var Q6=1/0,Y6="[object Symbol]",X6=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,J6=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Tp="\\ud800-\\udfff",I1="\\u0300-\\u036f\\ufe20-\\ufe23",A1="\\u20d0-\\u20f0",R1="\\u2700-\\u27bf",D1="a-z\\xdf-\\xf6\\xf8-\\xff",Z6="\\xac\\xb1\\xd7\\xf7",ej="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",tj="\\u2000-\\u206f",nj=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",N1="A-Z\\xc0-\\xd6\\xd8-\\xde",k1="\\ufe0e\\ufe0f",O1=Z6+ej+tj+nj,oC="['\u2019]",rj="["+Tp+"]",v1="["+O1+"]",wp="["+I1+A1+"]",x1="\\d+",ij="["+R1+"]",P1="["+D1+"]",M1="[^"+Tp+O1+x1+R1+D1+N1+"]",sC="\\ud83c[\\udffb-\\udfff]",sj="(?:"+wp+"|"+sC+")",F1="[^"+Tp+"]",aC="(?:\\ud83c[\\udde6-\\uddff]){2}",lC="[\\ud800-\\udbff][\\udc00-\\udfff]",Ya="["+N1+"]",L1="\\u200d",E1="(?:"+P1+"|"+M1+")",oj="(?:"+Ya+"|"+M1+")",S1="(?:"+oC+"(?:d|ll|m|re|s|t|ve))?",C1="(?:"+oC+"(?:D|LL|M|RE|S|T|VE))?",B1=sj+"?",V1="["+k1+"]?",aj="(?:"+L1+"(?:"+[F1,aC,lC].join("|")+")"+V1+B1+")*",U1=V1+B1+aj,lj="(?:"+[ij,aC,lC].join("|")+")"+U1,cj="(?:"+[F1+wp+"?",wp,aC,lC,rj].join("|")+")",uj=RegExp(oC,"g"),dj=RegExp(wp,"g"),hj=RegExp(sC+"(?="+sC+")|"+cj+U1,"g"),fj=RegExp([Ya+"?"+P1+"+"+S1+"(?="+[v1,Ya,"$"].join("|")+")",oj+"+"+C1+"(?="+[v1,Ya+E1,"$"].join("|")+")",Ya+"?"+E1+"+"+S1,Ya+"+"+C1,x1,lj].join("|"),"g"),pj=RegExp("["+L1+Tp+I1+A1+k1+"]"),mj=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,gj={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"ss"},yj=typeof global=="object"&&global&&global.Object===Object&&global,_j=typeof self=="object"&&self&&self.Object===Object&&self,vj=yj||_j||Function("return this")();function Ej(n,e,t,r){var i=-1,s=n?n.length:0;for(r&&s&&(t=n[++i]);++i<s;)t=e(t,n[i],i,n);return t}function Sj(n){return n.split("")}function Cj(n){return n.match(X6)||[]}function wj(n){return function(e){return n?.[e]}}var Tj=wj(gj);function q1(n){return pj.test(n)}function bj(n){return mj.test(n)}function Ij(n){return q1(n)?Aj(n):Sj(n)}function Aj(n){return n.match(hj)||[]}function Rj(n){return n.match(fj)||[]}var Dj=Object.prototype,Nj=Dj.toString,w1=vj.Symbol,T1=w1?w1.prototype:void 0,b1=T1?T1.toString:void 0;function kj(n,e,t){var r=-1,i=n.length;e<0&&(e=-e>i?0:i+e),t=t>i?i:t,t<0&&(t+=i),i=e>t?0:t-e>>>0,e>>>=0;for(var s=Array(i);++r<i;)s[r]=n[r+e];return s}function Oj(n){if(typeof n=="string")return n;if(Lj(n))return b1?b1.call(n):"";var e=n+"";return e=="0"&&1/n==-Q6?"-0":e}function xj(n,e,t){var r=n.length;return t=t===void 0?r:t,!e&&t>=r?n:kj(n,e,t)}function Pj(n){return function(e){e=bp(e);var t=q1(e)?Ij(e):void 0,r=t?t[0]:e.charAt(0),i=t?xj(t,1).join(""):e.slice(1);return r[n]()+i}}function Mj(n){return function(e){return Ej(zj(Uj(e).replace(uj,"")),n,"")}}function Fj(n){return!!n&&typeof n=="object"}function Lj(n){return typeof n=="symbol"||Fj(n)&&Nj.call(n)==Y6}function bp(n){return n==null?"":Oj(n)}var Bj=Mj(function(n,e,t){return e=e.toLowerCase(),n+(t?Vj(e):e)});function Vj(n){return qj(bp(n).toLowerCase())}function Uj(n){return n=bp(n),n&&n.replace(J6,Tj).replace(dj,"")}var qj=Pj("toUpperCase");function zj(n,e,t){return n=bp(n),e=t?void 0:e,e===void 0?bj(n)?Rj(n):Cj(n):n.match(e)||[]}z1.exports=Bj});var cC=A((jse,W1)=>{"use strict";W1.exports=Gj;function Gj(n,e){for(var t=new Array(arguments.length-1),r=0,i=2,s=!0;i<arguments.length;)t[r++]=arguments[i++];return new Promise(function(a,l){t[r]=function(u){if(s)if(s=!1,u)l(u);else{for(var d=new Array(arguments.length-1),h=0;h<d.length;)d[h++]=arguments[h];a.apply(null,d)}};try{n.apply(e||null,t)}catch(c){s&&(s=!1,l(c))}})}});var K1=A(H1=>{"use strict";var Ip=H1;Ip.length=function(e){var t=e.length;if(!t)return 0;for(var r=0;--t%4>1&&e.charAt(t)==="=";)++r;return Math.ceil(e.length*3)/4-r};var Xa=new Array(64),$1=new Array(123);for(Yn=0;Yn<64;)$1[Xa[Yn]=Yn<26?Yn+65:Yn<52?Yn+71:Yn<62?Yn-4:Yn-59|43]=Yn++;var Yn;Ip.encode=function(e,t,r){for(var i=null,s=[],o=0,a=0,l;t<r;){var c=e[t++];switch(a){case 0:s[o++]=Xa[c>>2],l=(c&3)<<4,a=1;break;case 1:s[o++]=Xa[l|c>>4],l=(c&15)<<2,a=2;break;case 2:s[o++]=Xa[l|c>>6],s[o++]=Xa[c&63],a=0;break}o>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,s)),o=0)}return a&&(s[o++]=Xa[l],s[o++]=61,a===1&&(s[o++]=61)),i?(o&&i.push(String.fromCharCode.apply(String,s.slice(0,o))),i.join("")):String.fromCharCode.apply(String,s.slice(0,o))};var j1="invalid encoding";Ip.decode=function(e,t,r){for(var i=r,s=0,o,a=0;a<e.length;){var l=e.charCodeAt(a++);if(l===61&&s>1)break;if((l=$1[l])===void 0)throw Error(j1);switch(s){case 0:o=l,s=1;break;case 1:t[r++]=o<<2|(l&48)>>4,o=l,s=2;break;case 2:t[r++]=(o&15)<<4|(l&60)>>2,o=l,s=3;break;case 3:t[r++]=(o&3)<<6|l,s=0;break}}if(s===1)throw Error(j1);return r-i};Ip.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}});var Y1=A((Hse,Q1)=>{"use strict";Q1.exports=Ap;function Ap(){this._listeners={}}Ap.prototype.on=function(e,t,r){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:r||this}),this};Ap.prototype.off=function(e,t){if(e===void 0)this._listeners={};else if(t===void 0)this._listeners[e]=[];else for(var r=this._listeners[e],i=0;i<r.length;)r[i].fn===t?r.splice(i,1):++i;return this};Ap.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var r=[],i=1;i<arguments.length;)r.push(arguments[i++]);for(i=0;i<t.length;)t[i].fn.apply(t[i++].ctx,r)}return this}});var rx=A((Kse,nx)=>{"use strict";nx.exports=X1(X1);function X1(n){return typeof Float32Array<"u"?function(){var e=new Float32Array([-0]),t=new Uint8Array(e.buffer),r=t[3]===128;function i(l,c,u){e[0]=l,c[u]=t[0],c[u+1]=t[1],c[u+2]=t[2],c[u+3]=t[3]}function s(l,c,u){e[0]=l,c[u]=t[3],c[u+1]=t[2],c[u+2]=t[1],c[u+3]=t[0]}n.writeFloatLE=r?i:s,n.writeFloatBE=r?s:i;function o(l,c){return t[0]=l[c],t[1]=l[c+1],t[2]=l[c+2],t[3]=l[c+3],e[0]}function a(l,c){return t[3]=l[c],t[2]=l[c+1],t[1]=l[c+2],t[0]=l[c+3],e[0]}n.readFloatLE=r?o:a,n.readFloatBE=r?a:o}():function(){function e(r,i,s,o){var a=i<0?1:0;if(a&&(i=-i),i===0)r(1/i>0?0:2147483648,s,o);else if(isNaN(i))r(2143289344,s,o);else if(i>34028234663852886e22)r((a<<31|2139095040)>>>0,s,o);else if(i<11754943508222875e-54)r((a<<31|Math.round(i/1401298464324817e-60))>>>0,s,o);else{var l=Math.floor(Math.log(i)/Math.LN2),c=Math.round(i*Math.pow(2,-l)*8388608)&8388607;r((a<<31|l+127<<23|c)>>>0,s,o)}}n.writeFloatLE=e.bind(null,J1),n.writeFloatBE=e.bind(null,Z1);function t(r,i,s){var o=r(i,s),a=(o>>31)*2+1,l=o>>>23&255,c=o&8388607;return l===255?c?NaN:a*(1/0):l===0?a*1401298464324817e-60*c:a*Math.pow(2,l-150)*(c+8388608)}n.readFloatLE=t.bind(null,ex),n.readFloatBE=t.bind(null,tx)}(),typeof Float64Array<"u"?function(){var e=new Float64Array([-0]),t=new Uint8Array(e.buffer),r=t[7]===128;function i(l,c,u){e[0]=l,c[u]=t[0],c[u+1]=t[1],c[u+2]=t[2],c[u+3]=t[3],c[u+4]=t[4],c[u+5]=t[5],c[u+6]=t[6],c[u+7]=t[7]}function s(l,c,u){e[0]=l,c[u]=t[7],c[u+1]=t[6],c[u+2]=t[5],c[u+3]=t[4],c[u+4]=t[3],c[u+5]=t[2],c[u+6]=t[1],c[u+7]=t[0]}n.writeDoubleLE=r?i:s,n.writeDoubleBE=r?s:i;function o(l,c){return t[0]=l[c],t[1]=l[c+1],t[2]=l[c+2],t[3]=l[c+3],t[4]=l[c+4],t[5]=l[c+5],t[6]=l[c+6],t[7]=l[c+7],e[0]}function a(l,c){return t[7]=l[c],t[6]=l[c+1],t[5]=l[c+2],t[4]=l[c+3],t[3]=l[c+4],t[2]=l[c+5],t[1]=l[c+6],t[0]=l[c+7],e[0]}n.readDoubleLE=r?o:a,n.readDoubleBE=r?a:o}():function(){function e(r,i,s,o,a,l){var c=o<0?1:0;if(c&&(o=-o),o===0)r(0,a,l+i),r(1/o>0?0:2147483648,a,l+s);else if(isNaN(o))r(0,a,l+i),r(2146959360,a,l+s);else if(o>17976931348623157e292)r(0,a,l+i),r((c<<31|2146435072)>>>0,a,l+s);else{var u;if(o<22250738585072014e-324)u=o/5e-324,r(u>>>0,a,l+i),r((c<<31|u/4294967296)>>>0,a,l+s);else{var d=Math.floor(Math.log(o)/Math.LN2);d===1024&&(d=1023),u=o*Math.pow(2,-d),r(u*4503599627370496>>>0,a,l+i),r((c<<31|d+1023<<20|u*1048576&1048575)>>>0,a,l+s)}}}n.writeDoubleLE=e.bind(null,J1,0,4),n.writeDoubleBE=e.bind(null,Z1,4,0);function t(r,i,s,o,a){var l=r(o,a+i),c=r(o,a+s),u=(c>>31)*2+1,d=c>>>20&2047,h=4294967296*(c&1048575)+l;return d===2047?h?NaN:u*(1/0):d===0?u*5e-324*h:u*Math.pow(2,d-1075)*(h+4503599627370496)}n.readDoubleLE=t.bind(null,ex,0,4),n.readDoubleBE=t.bind(null,tx,4,0)}(),n}function J1(n,e,t){e[t]=n&255,e[t+1]=n>>>8&255,e[t+2]=n>>>16&255,e[t+3]=n>>>24}function Z1(n,e,t){e[t]=n>>>24,e[t+1]=n>>>16&255,e[t+2]=n>>>8&255,e[t+3]=n&255}function ex(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16|n[e+3]<<24)>>>0}function tx(n,e){return(n[e]<<24|n[e+1]<<16|n[e+2]<<8|n[e+3])>>>0}});var uC=A((exports,module)=>{"use strict";module.exports=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(n){}return null}});var sx=A(ix=>{"use strict";var dC=ix;dC.length=function(e){for(var t=0,r=0,i=0;i<e.length;++i)r=e.charCodeAt(i),r<128?t+=1:r<2048?t+=2:(r&64512)===55296&&(e.charCodeAt(i+1)&64512)===56320?(++i,t+=4):t+=3;return t};dC.read=function(e,t,r){var i=r-t;if(i<1)return"";for(var s=null,o=[],a=0,l;t<r;)l=e[t++],l<128?o[a++]=l:l>191&&l<224?o[a++]=(l&31)<<6|e[t++]&63:l>239&&l<365?(l=((l&7)<<18|(e[t++]&63)<<12|(e[t++]&63)<<6|e[t++]&63)-65536,o[a++]=55296+(l>>10),o[a++]=56320+(l&1023)):o[a++]=(l&15)<<12|(e[t++]&63)<<6|e[t++]&63,a>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,o)),a=0);return s?(a&&s.push(String.fromCharCode.apply(String,o.slice(0,a))),s.join("")):String.fromCharCode.apply(String,o.slice(0,a))};dC.write=function(e,t,r){for(var i=r,s,o,a=0;a<e.length;++a)s=e.charCodeAt(a),s<128?t[r++]=s:s<2048?(t[r++]=s>>6|192,t[r++]=s&63|128):(s&64512)===55296&&((o=e.charCodeAt(a+1))&64512)===56320?(s=65536+((s&1023)<<10)+(o&1023),++a,t[r++]=s>>18|240,t[r++]=s>>12&63|128,t[r++]=s>>6&63|128,t[r++]=s&63|128):(t[r++]=s>>12|224,t[r++]=s>>6&63|128,t[r++]=s&63|128);return r-i}});var ax=A((Yse,ox)=>{"use strict";ox.exports=Wj;function Wj(n,e,t){var r=t||8192,i=r>>>1,s=null,o=r;return function(l){if(l<1||l>i)return n(l);o+l>r&&(s=n(r),o=0);var c=e.call(s,o,o+=l);return o&7&&(o=(o|7)+1),c}}});var cx=A((Xse,lx)=>{"use strict";lx.exports=Tt;var Bu=Rr();function Tt(n,e){this.lo=n>>>0,this.hi=e>>>0}var mo=Tt.zero=new Tt(0,0);mo.toNumber=function(){return 0};mo.zzEncode=mo.zzDecode=function(){return this};mo.length=function(){return 1};var jj=Tt.zeroHash="\0\0\0\0\0\0\0\0";Tt.fromNumber=function(e){if(e===0)return mo;var t=e<0;t&&(e=-e);var r=e>>>0,i=(e-r)/4294967296>>>0;return t&&(i=~i>>>0,r=~r>>>0,++r>4294967295&&(r=0,++i>4294967295&&(i=0))),new Tt(r,i)};Tt.from=function(e){if(typeof e=="number")return Tt.fromNumber(e);if(Bu.isString(e))if(Bu.Long)e=Bu.Long.fromString(e);else return Tt.fromNumber(parseInt(e,10));return e.low||e.high?new Tt(e.low>>>0,e.high>>>0):mo};Tt.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=~this.lo+1>>>0,r=~this.hi>>>0;return t||(r=r+1>>>0),-(t+r*4294967296)}return this.lo+this.hi*4294967296};Tt.prototype.toLong=function(e){return Bu.Long?new Bu.Long(this.lo|0,this.hi|0,!!e):{low:this.lo|0,high:this.hi|0,unsigned:!!e}};var Xi=String.prototype.charCodeAt;Tt.fromHash=function(e){return e===jj?mo:new Tt((Xi.call(e,0)|Xi.call(e,1)<<8|Xi.call(e,2)<<16|Xi.call(e,3)<<24)>>>0,(Xi.call(e,4)|Xi.call(e,5)<<8|Xi.call(e,6)<<16|Xi.call(e,7)<<24)>>>0)};Tt.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)};Tt.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this};Tt.prototype.zzDecode=function(){var e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this};Tt.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return r===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10}});var Rr=A(hC=>{"use strict";var H=hC;H.asPromise=cC();H.base64=K1();H.EventEmitter=Y1();H.float=rx();H.inquire=uC();H.utf8=sx();H.pool=ax();H.LongBits=cx();H.isNode=!!(typeof global<"u"&&global&&global.process&&global.process.versions&&global.process.versions.node);H.global=H.isNode&&global||typeof window<"u"&&window||typeof self<"u"&&self||hC;H.emptyArray=Object.freeze?Object.freeze([]):[];H.emptyObject=Object.freeze?Object.freeze({}):{};H.isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e};H.isString=function(e){return typeof e=="string"||e instanceof String};H.isObject=function(e){return e&&typeof e=="object"};H.isset=H.isSet=function(e,t){var r=e[t];return r!=null&&e.hasOwnProperty(t)?typeof r!="object"||(Array.isArray(r)?r.length:Object.keys(r).length)>0:!1};H.Buffer=function(){try{var n=H.inquire("buffer").Buffer;return n.prototype.utf8Write?n:null}catch{return null}}();H._Buffer_from=null;H._Buffer_allocUnsafe=null;H.newBuffer=function(e){return typeof e=="number"?H.Buffer?H._Buffer_allocUnsafe(e):new H.Array(e):H.Buffer?H._Buffer_from(e):typeof Uint8Array>"u"?e:new Uint8Array(e)};H.Array=typeof Uint8Array<"u"?Uint8Array:Array;H.Long=H.global.dcodeIO&&H.global.dcodeIO.Long||H.global.Long||H.inquire("long");H.key2Re=/^true|false|0|1$/;H.key32Re=/^-?(?:0|[1-9][0-9]*)$/;H.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/;H.longToHash=function(e){return e?H.LongBits.from(e).toHash():H.LongBits.zeroHash};H.longFromHash=function(e,t){var r=H.LongBits.fromHash(e);return H.Long?H.Long.fromBits(r.lo,r.hi,t):r.toNumber(!!t)};function ux(n,e,t){for(var r=Object.keys(e),i=0;i<r.length;++i)(n[r[i]]===void 0||!t)&&(n[r[i]]=e[r[i]]);return n}H.merge=ux;H.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)};function dx(n){function e(t,r){if(!(this instanceof e))return new e(t,r);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:new Error().stack||""}),r&&ux(this,r)}return e.prototype=Object.create(Error.prototype,{constructor:{value:e,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return n},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),e}H.newError=dx;H.ProtocolError=dx("ProtocolError");H.oneOfGetter=function(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=1;return function(){for(var i=Object.keys(this),s=i.length-1;s>-1;--s)if(t[i[s]]===1&&this[i[s]]!==void 0&&this[i[s]]!==null)return i[s]}};H.oneOfSetter=function(e){return function(t){for(var r=0;r<e.length;++r)e[r]!==t&&delete this[e[r]]}};H.toJSONOptions={longs:String,enums:String,bytes:String,json:!0};H._configure=function(){var n=H.Buffer;if(!n){H._Buffer_from=H._Buffer_allocUnsafe=null;return}H._Buffer_from=n.from!==Uint8Array.from&&n.from||function(t,r){return new n(t,r)},H._Buffer_allocUnsafe=n.allocUnsafe||function(t){return new n(t)}}});var Dp=A((Zse,mx)=>{"use strict";mx.exports=ye;var xn=Rr(),fC,Rp=xn.LongBits,hx=xn.base64,fx=xn.utf8;function Vu(n,e,t){this.fn=n,this.len=e,this.next=void 0,this.val=t}function mC(){}function $j(n){this.head=n.head,this.tail=n.tail,this.len=n.len,this.next=n.states}function ye(){this.len=0,this.head=new Vu(mC,0,0),this.tail=this.head,this.states=null}var px=function(){return xn.Buffer?function(){return(ye.create=function(){return new fC})()}:function(){return new ye}};ye.create=px();ye.alloc=function(e){return new xn.Array(e)};xn.Array!==Array&&(ye.alloc=xn.pool(ye.alloc,xn.Array.prototype.subarray));ye.prototype._push=function(e,t,r){return this.tail=this.tail.next=new Vu(e,t,r),this.len+=t,this};function gC(n,e,t){e[t]=n&255}function Hj(n,e,t){for(;n>127;)e[t++]=n&127|128,n>>>=7;e[t]=n}function yC(n,e){this.len=n,this.next=void 0,this.val=e}yC.prototype=Object.create(Vu.prototype);yC.prototype.fn=Hj;ye.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new yC((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this};ye.prototype.int32=function(e){return e<0?this._push(_C,10,Rp.fromNumber(e)):this.uint32(e)};ye.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)};function _C(n,e,t){for(;n.hi;)e[t++]=n.lo&127|128,n.lo=(n.lo>>>7|n.hi<<25)>>>0,n.hi>>>=7;for(;n.lo>127;)e[t++]=n.lo&127|128,n.lo=n.lo>>>7;e[t++]=n.lo}ye.prototype.uint64=function(e){var t=Rp.from(e);return this._push(_C,t.length(),t)};ye.prototype.int64=ye.prototype.uint64;ye.prototype.sint64=function(e){var t=Rp.from(e).zzEncode();return this._push(_C,t.length(),t)};ye.prototype.bool=function(e){return this._push(gC,1,e?1:0)};function pC(n,e,t){e[t]=n&255,e[t+1]=n>>>8&255,e[t+2]=n>>>16&255,e[t+3]=n>>>24}ye.prototype.fixed32=function(e){return this._push(pC,4,e>>>0)};ye.prototype.sfixed32=ye.prototype.fixed32;ye.prototype.fixed64=function(e){var t=Rp.from(e);return this._push(pC,4,t.lo)._push(pC,4,t.hi)};ye.prototype.sfixed64=ye.prototype.fixed64;ye.prototype.float=function(e){return this._push(xn.float.writeFloatLE,4,e)};ye.prototype.double=function(e){return this._push(xn.float.writeDoubleLE,8,e)};var Kj=xn.Array.prototype.set?function(e,t,r){t.set(e,r)}:function(e,t,r){for(var i=0;i<e.length;++i)t[r+i]=e[i]};ye.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(gC,1,0);if(xn.isString(e)){var r=ye.alloc(t=hx.length(e));hx.decode(e,r,0),e=r}return this.uint32(t)._push(Kj,t,e)};ye.prototype.string=function(e){var t=fx.length(e);return t?this.uint32(t)._push(fx.write,t,e):this._push(gC,1,0)};ye.prototype.fork=function(){return this.states=new $j(this),this.head=this.tail=new Vu(mC,0,0),this.len=0,this};ye.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Vu(mC,0,0),this.len=0),this};ye.prototype.ldelim=function(){var e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this};ye.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t};ye._configure=function(n){fC=n,ye.create=px(),fC._configure()}});var _x=A((eoe,yx)=>{"use strict";yx.exports=Dr;var gx=Dp();(Dr.prototype=Object.create(gx.prototype)).constructor=Dr;var Ji=Rr();function Dr(){gx.call(this)}Dr._configure=function(){Dr.alloc=Ji._Buffer_allocUnsafe,Dr.writeBytesBuffer=Ji.Buffer&&Ji.Buffer.prototype instanceof Uint8Array&&Ji.Buffer.prototype.set.name==="set"?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var i=0;i<e.length;)t[r++]=e[i++]}};Dr.prototype.bytes=function(e){Ji.isString(e)&&(e=Ji._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(Dr.writeBytesBuffer,t,e),this};function Qj(n,e,t){n.length<40?Ji.utf8.write(n,e,t):e.utf8Write?e.utf8Write(n,t):e.write(n,t)}Dr.prototype.string=function(e){var t=Ji.Buffer.byteLength(e);return this.uint32(t),t&&this._push(Qj,t,e),this};Dr._configure()});var kp=A((toe,wx)=>{"use strict";wx.exports=tt;var Xn=Rr(),EC,Sx=Xn.LongBits,Yj=Xn.utf8;function Jn(n,e){return RangeError("index out of range: "+n.pos+" + "+(e||1)+" > "+n.len)}function tt(n){this.buf=n,this.pos=0,this.len=n.length}var vx=typeof Uint8Array<"u"?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new tt(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new tt(e);throw Error("illegal buffer")},Cx=function(){return Xn.Buffer?function(t){return(tt.create=function(i){return Xn.Buffer.isBuffer(i)?new EC(i):vx(i)})(t)}:vx};tt.create=Cx();tt.prototype._slice=Xn.Array.prototype.subarray||Xn.Array.prototype.slice;tt.prototype.uint32=function(){var e=4294967295;return function(){if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,Jn(this,10);return e}}();tt.prototype.int32=function(){return this.uint32()|0};tt.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(e&1)|0};function vC(){var n=new Sx(0,0),e=0;if(this.len-this.pos>4){for(;e<4;++e)if(n.lo=(n.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return n;if(n.lo=(n.lo|(this.buf[this.pos]&127)<<28)>>>0,n.hi=(n.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return n;e=0}else{for(;e<3;++e){if(this.pos>=this.len)throw Jn(this);if(n.lo=(n.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return n}return n.lo=(n.lo|(this.buf[this.pos++]&127)<<e*7)>>>0,n}if(this.len-this.pos>4){for(;e<5;++e)if(n.hi=(n.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return n}else for(;e<5;++e){if(this.pos>=this.len)throw Jn(this);if(n.hi=(n.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return n}throw Error("invalid varint encoding")}tt.prototype.bool=function(){return this.uint32()!==0};function Np(n,e){return(n[e-4]|n[e-3]<<8|n[e-2]<<16|n[e-1]<<24)>>>0}tt.prototype.fixed32=function(){if(this.pos+4>this.len)throw Jn(this,4);return Np(this.buf,this.pos+=4)};tt.prototype.sfixed32=function(){if(this.pos+4>this.len)throw Jn(this,4);return Np(this.buf,this.pos+=4)|0};function Ex(){if(this.pos+8>this.len)throw Jn(this,8);return new Sx(Np(this.buf,this.pos+=4),Np(this.buf,this.pos+=4))}tt.prototype.float=function(){if(this.pos+4>this.len)throw Jn(this,4);var e=Xn.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e};tt.prototype.double=function(){if(this.pos+8>this.len)throw Jn(this,4);var e=Xn.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e};tt.prototype.bytes=function(){var e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw Jn(this,e);if(this.pos+=e,Array.isArray(this.buf))return this.buf.slice(t,r);if(t===r){var i=Xn.Buffer;return i?i.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,t,r)};tt.prototype.string=function(){var e=this.bytes();return Yj.read(e,0,e.length)};tt.prototype.skip=function(e){if(typeof e=="number"){if(this.pos+e>this.len)throw Jn(this,e);this.pos+=e}else do if(this.pos>=this.len)throw Jn(this);while(this.buf[this.pos++]&128);return this};tt.prototype.skipType=function(n){switch(n){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(n=this.uint32()&7)!==4;)this.skipType(n);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+n+" at offset "+this.pos)}return this};tt._configure=function(n){EC=n,tt.create=Cx(),EC._configure();var e=Xn.Long?"toLong":"toNumber";Xn.merge(tt.prototype,{int64:function(){return vC.call(this)[e](!1)},uint64:function(){return vC.call(this)[e](!0)},sint64:function(){return vC.call(this).zzDecode()[e](!1)},fixed64:function(){return Ex.call(this)[e](!0)},sfixed64:function(){return Ex.call(this)[e](!1)}})}});var Ax=A((noe,Ix)=>{"use strict";Ix.exports=go;var bx=kp();(go.prototype=Object.create(bx.prototype)).constructor=go;var Tx=Rr();function go(n){bx.call(this,n)}go._configure=function(){Tx.Buffer&&(go.prototype._slice=Tx.Buffer.prototype.slice)};go.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))};go._configure()});var Dx=A((roe,Rx)=>{"use strict";Rx.exports=Uu;var SC=Rr();(Uu.prototype=Object.create(SC.EventEmitter.prototype)).constructor=Uu;function Uu(n,e,t){if(typeof n!="function")throw TypeError("rpcImpl must be a function");SC.EventEmitter.call(this),this.rpcImpl=n,this.requestDelimited=!!e,this.responseDelimited=!!t}Uu.prototype.rpcCall=function n(e,t,r,i,s){if(!i)throw TypeError("request must be specified");var o=this;if(!s)return SC.asPromise(n,o,e,t,r,i);if(!o.rpcImpl){setTimeout(function(){s(Error("already ended"))},0);return}try{return o.rpcImpl(e,t[o.requestDelimited?"encodeDelimited":"encode"](i).finish(),function(l,c){if(l)return o.emit("error",l,e),s(l);if(c===null){o.end(!0);return}if(!(c instanceof r))try{c=r[o.responseDelimited?"decodeDelimited":"decode"](c)}catch(u){return o.emit("error",u,e),s(u)}return o.emit("data",c,e),s(null,c)})}catch(a){o.emit("error",a,e),setTimeout(function(){s(a)},0);return}};Uu.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}});var CC=A(Nx=>{"use strict";var Xj=Nx;Xj.Service=Dx()});var wC=A((soe,kx)=>{"use strict";kx.exports={}});var Px=A(xx=>{"use strict";var rn=xx;rn.build="minimal";rn.Writer=Dp();rn.BufferWriter=_x();rn.Reader=kp();rn.BufferReader=Ax();rn.util=Rr();rn.rpc=CC();rn.roots=wC();rn.configure=Ox;function Ox(){rn.util._configure(),rn.Writer._configure(rn.BufferWriter),rn.Reader._configure(rn.BufferReader)}Ox()});var Fx=A((aoe,Mx)=>{"use strict";Mx.exports=TC;function TC(n,e){typeof n=="string"&&(e=n,n=void 0);var t=[];function r(s){if(typeof s!="string"){var o=i();if(TC.verbose&&console.log("codegen: "+o),o="return "+o,s){for(var a=Object.keys(s),l=new Array(a.length+1),c=new Array(a.length),u=0;u<a.length;)l[u]=a[u],c[u]=s[a[u++]];return l[u]=o,Function.apply(null,l).apply(null,c)}return Function(o)()}for(var d=new Array(arguments.length-1),h=0;h<d.length;)d[h]=arguments[++h];if(h=0,s=s.replace(/%([%dfijs])/g,function(E,w){var b=d[h++];switch(w){case"d":case"f":return String(Number(b));case"i":return String(Math.floor(b));case"j":return JSON.stringify(b);case"s":return String(b)}return"%"}),h!==d.length)throw Error("parameter count mismatch");return t.push(s),r}function i(s){return"function "+(s||e||"")+"("+(n&&n.join(",")||"")+`){
  `+t.join(`
  `)+`
}`}return r.toString=i,r}TC.verbose=!1});var Bx=A((loe,Lx)=>{"use strict";Lx.exports=qu;var Jj=cC(),Zj=uC(),bC=Zj("fs");function qu(n,e,t){return typeof e=="function"?(t=e,e={}):e||(e={}),t?!e.xhr&&bC&&bC.readFile?bC.readFile(n,function(i,s){return i&&typeof XMLHttpRequest<"u"?qu.xhr(n,e,t):i?t(i):t(null,e.binary?s:s.toString("utf8"))}):qu.xhr(n,e,t):Jj(qu,this,n,e)}qu.xhr=function(e,t,r){var i=new XMLHttpRequest;i.onreadystatechange=function(){if(i.readyState===4){if(i.status!==0&&i.status!==200)return r(Error("status "+i.status));if(t.binary){var o=i.response;if(!o){o=[];for(var a=0;a<i.responseText.length;++a)o.push(i.responseText.charCodeAt(a)&255)}return r(null,typeof Uint8Array<"u"?new Uint8Array(o):o)}return r(null,i.responseText)}},t.binary&&("overrideMimeType"in i&&i.overrideMimeType("text/plain; charset=x-user-defined"),i.responseType="arraybuffer"),i.open("GET",e),i.send()}});var qx=A(Ux=>{"use strict";var AC=Ux,Vx=AC.isAbsolute=function(e){return/^(?:\/|\w+:)/.test(e)},IC=AC.normalize=function(e){e=e.replace(/\\/g,"/").replace(/\/{2,}/g,"/");var t=e.split("/"),r=Vx(e),i="";r&&(i=t.shift()+"/");for(var s=0;s<t.length;)t[s]===".."?s>0&&t[s-1]!==".."?t.splice(--s,2):r?t.splice(s,1):++s:t[s]==="."?t.splice(s,1):++s;return i+t.join("/")};AC.resolve=function(e,t,r){return r||(t=IC(t)),Vx(t)?t:(r||(e=IC(e)),(e=e.replace(/(?:\/|^)[^/]+$/,"")).length?IC(e+"/"+t):t)}});var yo=A(zx=>{"use strict";var zu=zx,e$=bt(),t$=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function Gu(n,e){var t=0,r={};for(e|=0;t<n.length;)r[t$[t+e]]=n[t++];return r}zu.basic=Gu([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]);zu.defaults=Gu([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",e$.emptyArray,null]);zu.long=Gu([0,0,0,1,1],7);zu.mapKey=Gu([0,0,0,5,5,0,0,0,1,1,0,2],2);zu.packed=Gu([1,5,0,0,0,5,5,0,0,0,1,1,0])});var Zi=A((doe,jx)=>{"use strict";jx.exports=Pn;var Op=_o();((Pn.prototype=Object.create(Op.prototype)).constructor=Pn).className="Field";var Gx=Zn(),Wx=yo(),ct=bt(),RC,n$=/^required|optional|repeated$/;Pn.fromJSON=function(e,t){return new Pn(e,t.id,t.type,t.rule,t.extend,t.options,t.comment)};function Pn(n,e,t,r,i,s,o){if(ct.isObject(r)?(o=i,s=r,r=i=void 0):ct.isObject(i)&&(o=s,s=i,i=void 0),Op.call(this,n,s),!ct.isInteger(e)||e<0)throw TypeError("id must be a non-negative integer");if(!ct.isString(t))throw TypeError("type must be a string");if(r!==void 0&&!n$.test(r=r.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(i!==void 0&&!ct.isString(i))throw TypeError("extend must be a string");r==="proto3_optional"&&(r="optional"),this.rule=r&&r!=="optional"?r:void 0,this.type=t,this.id=e,this.extend=i||void 0,this.required=r==="required",this.optional=!this.required,this.repeated=r==="repeated",this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=ct.Long?Wx.long[t]!==void 0:!1,this.bytes=t==="bytes",this.resolvedType=null,this.extensionField=null,this.declaringField=null,this._packed=null,this.comment=o}Object.defineProperty(Pn.prototype,"packed",{get:function(){return this._packed===null&&(this._packed=this.getOption("packed")!==!1),this._packed}});Pn.prototype.setOption=function(e,t,r){return e==="packed"&&(this._packed=null),Op.prototype.setOption.call(this,e,t,r)};Pn.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return ct.toObject(["rule",this.rule!=="optional"&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])};Pn.prototype.resolve=function(){if(this.resolved)return this;if((this.typeDefault=Wx.defaults[this.type])===void 0?(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof RC?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]):this.options&&this.options.proto3_optional&&(this.typeDefault=null),this.options&&this.options.default!=null&&(this.typeDefault=this.options.default,this.resolvedType instanceof Gx&&typeof this.typeDefault=="string"&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&((this.options.packed===!0||this.options.packed!==void 0&&this.resolvedType&&!(this.resolvedType instanceof Gx))&&delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=ct.Long.fromNumber(this.typeDefault,this.type.charAt(0)==="u"),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&typeof this.typeDefault=="string"){var e;ct.base64.test(this.typeDefault)?ct.base64.decode(this.typeDefault,e=ct.newBuffer(ct.base64.length(this.typeDefault)),0):ct.utf8.write(this.typeDefault,e=ct.newBuffer(ct.utf8.length(this.typeDefault)),0),this.typeDefault=e}return this.map?this.defaultValue=ct.emptyObject:this.repeated?this.defaultValue=ct.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof RC&&(this.parent.ctor.prototype[this.name]=this.defaultValue),Op.prototype.resolve.call(this)};Pn.d=function(e,t,r,i){return typeof t=="function"?t=ct.decorateType(t).name:t&&typeof t=="object"&&(t=ct.decorateEnum(t).name),function(o,a){ct.decorateType(o.constructor).add(new Pn(a,e,t,r,{default:i}))}};Pn._configure=function(e){RC=e}});var Ja=A((hoe,Kx)=>{"use strict";Kx.exports=Mn;var Pp=_o();((Mn.prototype=Object.create(Pp.prototype)).constructor=Mn).className="OneOf";var $x=Zi(),xp=bt();function Mn(n,e,t,r){if(Array.isArray(e)||(t=e,e=void 0),Pp.call(this,n,t),!(e===void 0||Array.isArray(e)))throw TypeError("fieldNames must be an Array");this.oneof=e||[],this.fieldsArray=[],this.comment=r}Mn.fromJSON=function(e,t){return new Mn(e,t.oneof,t.options,t.comment)};Mn.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return xp.toObject(["options",this.options,"oneof",this.oneof,"comment",t?this.comment:void 0])};function Hx(n){if(n.parent)for(var e=0;e<n.fieldsArray.length;++e)n.fieldsArray[e].parent||n.parent.add(n.fieldsArray[e])}Mn.prototype.add=function(e){if(!(e instanceof $x))throw TypeError("field must be a Field");return e.parent&&e.parent!==this.parent&&e.parent.remove(e),this.oneof.push(e.name),this.fieldsArray.push(e),e.partOf=this,Hx(this),this};Mn.prototype.remove=function(e){if(!(e instanceof $x))throw TypeError("field must be a Field");var t=this.fieldsArray.indexOf(e);if(t<0)throw Error(e+" is not a member of "+this);return this.fieldsArray.splice(t,1),t=this.oneof.indexOf(e.name),t>-1&&this.oneof.splice(t,1),e.partOf=null,this};Mn.prototype.onAdd=function(e){Pp.prototype.onAdd.call(this,e);for(var t=this,r=0;r<this.oneof.length;++r){var i=e.get(this.oneof[r]);i&&!i.partOf&&(i.partOf=t,t.fieldsArray.push(i))}Hx(this)};Mn.prototype.onRemove=function(e){for(var t=0,r;t<this.fieldsArray.length;++t)(r=this.fieldsArray[t]).parent&&r.parent.remove(r);Pp.prototype.onRemove.call(this,e)};Mn.d=function(){for(var e=new Array(arguments.length),t=0;t<arguments.length;)e[t]=arguments[t++];return function(i,s){xp.decorateType(i.constructor).add(new Mn(s,e)),Object.defineProperty(i,s,{get:xp.oneOfGetter(e),set:xp.oneOfSetter(e)})}}});var tl=A((foe,Jx)=>{"use strict";Jx.exports=Ce;var DC=_o();((Ce.prototype=Object.create(DC.prototype)).constructor=Ce).className="Namespace";var Qx=Zi(),Mp=bt(),r$=Ja(),Za,Wu,el;Ce.fromJSON=function(e,t){return new Ce(e,t.options).addJSON(t.nested)};function Yx(n,e){if(n&&n.length){for(var t={},r=0;r<n.length;++r)t[n[r].name]=n[r].toJSON(e);return t}}Ce.arrayToJSON=Yx;Ce.isReservedId=function(e,t){if(e){for(var r=0;r<e.length;++r)if(typeof e[r]!="string"&&e[r][0]<=t&&e[r][1]>t)return!0}return!1};Ce.isReservedName=function(e,t){if(e){for(var r=0;r<e.length;++r)if(e[r]===t)return!0}return!1};function Ce(n,e){DC.call(this,n,e),this.nested=void 0,this._nestedArray=null}function Xx(n){return n._nestedArray=null,n}Object.defineProperty(Ce.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=Mp.toArray(this.nested))}});Ce.prototype.toJSON=function(e){return Mp.toObject(["options",this.options,"nested",Yx(this.nestedArray,e)])};Ce.prototype.addJSON=function(e){var t=this;if(e)for(var r=Object.keys(e),i=0,s;i<r.length;++i)s=e[r[i]],t.add((s.fields!==void 0?Za.fromJSON:s.values!==void 0?el.fromJSON:s.methods!==void 0?Wu.fromJSON:s.id!==void 0?Qx.fromJSON:Ce.fromJSON)(r[i],s));return this};Ce.prototype.get=function(e){return this.nested&&this.nested[e]||null};Ce.prototype.getEnum=function(e){if(this.nested&&this.nested[e]instanceof el)return this.nested[e].values;throw Error("no such enum: "+e)};Ce.prototype.add=function(e){if(!(e instanceof Qx&&e.extend!==void 0||e instanceof Za||e instanceof r$||e instanceof el||e instanceof Wu||e instanceof Ce))throw TypeError("object must be a valid nested object");if(!this.nested)this.nested={};else{var t=this.get(e.name);if(t)if(t instanceof Ce&&e instanceof Ce&&!(t instanceof Za||t instanceof Wu)){for(var r=t.nestedArray,i=0;i<r.length;++i)e.add(r[i]);this.remove(t),this.nested||(this.nested={}),e.setOptions(t.options,!0)}else throw Error("duplicate name '"+e.name+"' in "+this)}return this.nested[e.name]=e,e.onAdd(this),Xx(this)};Ce.prototype.remove=function(e){if(!(e instanceof DC))throw TypeError("object must be a ReflectionObject");if(e.parent!==this)throw Error(e+" is not a member of "+this);return delete this.nested[e.name],Object.keys(this.nested).length||(this.nested=void 0),e.onRemove(this),Xx(this)};Ce.prototype.define=function(e,t){if(Mp.isString(e))e=e.split(".");else if(!Array.isArray(e))throw TypeError("illegal path");if(e&&e.length&&e[0]==="")throw Error("path must be relative");for(var r=this;e.length>0;){var i=e.shift();if(r.nested&&r.nested[i]){if(r=r.nested[i],!(r instanceof Ce))throw Error("path conflicts with non-namespace objects")}else r.add(r=new Ce(i))}return t&&r.addJSON(t),r};Ce.prototype.resolveAll=function(){for(var e=this.nestedArray,t=0;t<e.length;)e[t]instanceof Ce?e[t++].resolveAll():e[t++].resolve();return this.resolve()};Ce.prototype.lookup=function(e,t,r){if(typeof t=="boolean"?(r=t,t=void 0):t&&!Array.isArray(t)&&(t=[t]),Mp.isString(e)&&e.length){if(e===".")return this.root;e=e.split(".")}else if(!e.length)return this;if(e[0]==="")return this.root.lookup(e.slice(1),t);var i=this.get(e[0]);if(i){if(e.length===1){if(!t||t.indexOf(i.constructor)>-1)return i}else if(i instanceof Ce&&(i=i.lookup(e.slice(1),t,!0)))return i}else for(var s=0;s<this.nestedArray.length;++s)if(this._nestedArray[s]instanceof Ce&&(i=this._nestedArray[s].lookup(e,t,!0)))return i;return this.parent===null||r?null:this.parent.lookup(e,t)};Ce.prototype.lookupType=function(e){var t=this.lookup(e,[Za]);if(!t)throw Error("no such type: "+e);return t};Ce.prototype.lookupEnum=function(e){var t=this.lookup(e,[el]);if(!t)throw Error("no such Enum '"+e+"' in "+this);return t};Ce.prototype.lookupTypeOrEnum=function(e){var t=this.lookup(e,[Za,el]);if(!t)throw Error("no such Type or Enum '"+e+"' in "+this);return t};Ce.prototype.lookupService=function(e){var t=this.lookup(e,[Wu]);if(!t)throw Error("no such Service '"+e+"' in "+this);return t};Ce._configure=function(n,e,t){Za=n,Wu=e,el=t}});var Fp=A((poe,Zx)=>{"use strict";Zx.exports=oi;var NC=Zi();((oi.prototype=Object.create(NC.prototype)).constructor=oi).className="MapField";var i$=yo(),ju=bt();function oi(n,e,t,r,i,s){if(NC.call(this,n,e,r,void 0,void 0,i,s),!ju.isString(t))throw TypeError("keyType must be a string");this.keyType=t,this.resolvedKeyType=null,this.map=!0}oi.fromJSON=function(e,t){return new oi(e,t.id,t.keyType,t.type,t.options,t.comment)};oi.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return ju.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])};oi.prototype.resolve=function(){if(this.resolved)return this;if(i$.mapKey[this.keyType]===void 0)throw Error("invalid key type: "+this.keyType);return NC.prototype.resolve.call(this)};oi.d=function(e,t,r){return typeof r=="function"?r=ju.decorateType(r).name:r&&typeof r=="object"&&(r=ju.decorateEnum(r).name),function(s,o){ju.decorateType(s.constructor).add(new oi(o,e,t,r))}}});var Lp=A((moe,eP)=>{"use strict";eP.exports=vo;var kC=_o();((vo.prototype=Object.create(kC.prototype)).constructor=vo).className="Method";var nl=bt();function vo(n,e,t,r,i,s,o,a,l){if(nl.isObject(i)?(o=i,i=s=void 0):nl.isObject(s)&&(o=s,s=void 0),!(e===void 0||nl.isString(e)))throw TypeError("type must be a string");if(!nl.isString(t))throw TypeError("requestType must be a string");if(!nl.isString(r))throw TypeError("responseType must be a string");kC.call(this,n,o),this.type=e||"rpc",this.requestType=t,this.requestStream=i?!0:void 0,this.responseType=r,this.responseStream=s?!0:void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=a,this.parsedOptions=l}vo.fromJSON=function(e,t){return new vo(e,t.type,t.requestType,t.responseType,t.requestStream,t.responseStream,t.options,t.comment,t.parsedOptions)};vo.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return nl.toObject(["type",this.type!=="rpc"&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",t?this.comment:void 0,"parsedOptions",this.parsedOptions])};vo.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),kC.prototype.resolve.call(this))}});var Bp=A((goe,nP)=>{"use strict";nP.exports=Fn;var es=tl();((Fn.prototype=Object.create(es.prototype)).constructor=Fn).className="Service";var OC=Lp(),$u=bt(),s$=CC();function Fn(n,e){es.call(this,n,e),this.methods={},this._methodsArray=null}Fn.fromJSON=function(e,t){var r=new Fn(e,t.options);if(t.methods)for(var i=Object.keys(t.methods),s=0;s<i.length;++s)r.add(OC.fromJSON(i[s],t.methods[i[s]]));return t.nested&&r.addJSON(t.nested),r.comment=t.comment,r};Fn.prototype.toJSON=function(e){var t=es.prototype.toJSON.call(this,e),r=e?!!e.keepComments:!1;return $u.toObject(["options",t&&t.options||void 0,"methods",es.arrayToJSON(this.methodsArray,e)||{},"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])};Object.defineProperty(Fn.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=$u.toArray(this.methods))}});function tP(n){return n._methodsArray=null,n}Fn.prototype.get=function(e){return this.methods[e]||es.prototype.get.call(this,e)};Fn.prototype.resolveAll=function(){for(var e=this.methodsArray,t=0;t<e.length;++t)e[t].resolve();return es.prototype.resolve.call(this)};Fn.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);return e instanceof OC?(this.methods[e.name]=e,e.parent=this,tP(this)):es.prototype.add.call(this,e)};Fn.prototype.remove=function(e){if(e instanceof OC){if(this.methods[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.methods[e.name],e.parent=null,tP(this)}return es.prototype.remove.call(this,e)};Fn.prototype.create=function(e,t,r){for(var i=new s$.Service(e,t,r),s=0,o;s<this.methodsArray.length;++s){var a=$u.lcFirst((o=this._methodsArray[s]).resolve().name).replace(/[^$\w_]/g,"");i[a]=$u.codegen(["r","c"],$u.isReserved(a)?a+"_":a)("return this.rpcCall(m,q,s,r,c)")({m:o,q:o.resolvedRequestType.ctor,s:o.resolvedResponseType.ctor})}return i}});var Vp=A((yoe,rP)=>{"use strict";rP.exports=Nr;var o$=Rr();function Nr(n){if(n)for(var e=Object.keys(n),t=0;t<e.length;++t)this[e[t]]=n[e[t]]}Nr.create=function(e){return this.$type.create(e)};Nr.encode=function(e,t){return this.$type.encode(e,t)};Nr.encodeDelimited=function(e,t){return this.$type.encodeDelimited(e,t)};Nr.decode=function(e){return this.$type.decode(e)};Nr.decodeDelimited=function(e){return this.$type.decodeDelimited(e)};Nr.verify=function(e){return this.$type.verify(e)};Nr.fromObject=function(e){return this.$type.fromObject(e)};Nr.toObject=function(e,t){return this.$type.toObject(e,t)};Nr.prototype.toJSON=function(){return this.$type.toObject(this,o$.toJSONOptions)}});var xC=A((_oe,sP)=>{"use strict";sP.exports=c$;var a$=Zn(),ai=yo(),iP=bt();function l$(n){return"missing required '"+n.name+"'"}function c$(n){var e=iP.codegen(["r","l"],n.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(n.fieldsArray.filter(function(a){return a.map}).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()");n.group&&e("if((t&7)===4)")("break"),e("switch(t>>>3){");for(var t=0;t<n.fieldsArray.length;++t){var r=n._fieldsArray[t].resolve(),i=r.resolvedType instanceof a$?"int32":r.type,s="m"+iP.safeProp(r.name);e("case %i: {",r.id),r.map?(e("if(%s===util.emptyObject)",s)("%s={}",s)("var c2 = r.uint32()+r.pos"),ai.defaults[r.keyType]!==void 0?e("k=%j",ai.defaults[r.keyType]):e("k=null"),ai.defaults[i]!==void 0?e("value=%j",ai.defaults[i]):e("value=null"),e("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",r.keyType)("case 2:"),ai.basic[i]===void 0?e("value=types[%i].decode(r,r.uint32())",t):e("value=r.%s()",i),e("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),ai.long[r.keyType]!==void 0?e('%s[typeof k==="object"?util.longToHash(k):k]=value',s):e("%s[k]=value",s)):r.repeated?(e("if(!(%s&&%s.length))",s,s)("%s=[]",s),ai.packed[i]!==void 0&&e("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,i)("}else"),ai.basic[i]===void 0?e(r.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,t):e("%s.push(r.%s())",s,i)):ai.basic[i]===void 0?e(r.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,t):e("%s=r.%s()",s,i),e("break")("}")}for(e("default:")("r.skipType(t&7)")("break")("}")("}"),t=0;t<n._fieldsArray.length;++t){var o=n._fieldsArray[t];o.required&&e("if(!m.hasOwnProperty(%j))",o.name)("throw util.ProtocolError(%j,{instance:m})",l$(o))}return e("return m")}});var FC=A((voe,oP)=>{"use strict";oP.exports=h$;var u$=Zn(),PC=bt();function Ln(n,e){return n.name+": "+e+(n.repeated&&e!=="array"?"[]":n.map&&e!=="object"?"{k:"+n.keyType+"}":"")+" expected"}function MC(n,e,t,r){if(e.resolvedType)if(e.resolvedType instanceof u$){n("switch(%s){",r)("default:")("return%j",Ln(e,"enum value"));for(var i=Object.keys(e.resolvedType.values),s=0;s<i.length;++s)n("case %i:",e.resolvedType.values[i[s]]);n("break")("}")}else n("{")("var e=types[%i].verify(%s);",t,r)("if(e)")("return%j+e",e.name+".")("}");else switch(e.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":n("if(!util.isInteger(%s))",r)("return%j",Ln(e,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":n("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",r,r,r,r)("return%j",Ln(e,"integer|Long"));break;case"float":case"double":n('if(typeof %s!=="number")',r)("return%j",Ln(e,"number"));break;case"bool":n('if(typeof %s!=="boolean")',r)("return%j",Ln(e,"boolean"));break;case"string":n("if(!util.isString(%s))",r)("return%j",Ln(e,"string"));break;case"bytes":n('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',r,r,r)("return%j",Ln(e,"buffer"));break}return n}function d$(n,e,t){switch(e.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":n("if(!util.key32Re.test(%s))",t)("return%j",Ln(e,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":n("if(!util.key64Re.test(%s))",t)("return%j",Ln(e,"integer|Long key"));break;case"bool":n("if(!util.key2Re.test(%s))",t)("return%j",Ln(e,"boolean key"));break}return n}function h$(n){var e=PC.codegen(["m"],n.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),t=n.oneofsArray,r={};t.length&&e("var p={}");for(var i=0;i<n.fieldsArray.length;++i){var s=n._fieldsArray[i].resolve(),o="m"+PC.safeProp(s.name);if(s.optional&&e("if(%s!=null&&m.hasOwnProperty(%j)){",o,s.name),s.map)e("if(!util.isObject(%s))",o)("return%j",Ln(s,"object"))("var k=Object.keys(%s)",o)("for(var i=0;i<k.length;++i){"),d$(e,s,"k[i]"),MC(e,s,i,o+"[k[i]]")("}");else if(s.repeated)e("if(!Array.isArray(%s))",o)("return%j",Ln(s,"array"))("for(var i=0;i<%s.length;++i){",o),MC(e,s,i,o+"[i]")("}");else{if(s.partOf){var a=PC.safeProp(s.partOf.name);r[s.partOf.name]===1&&e("if(p%s===1)",a)("return%j",s.partOf.name+": multiple values"),r[s.partOf.name]=1,e("p%s=1",a)}MC(e,s,i,o)}s.optional&&e("}")}return e("return null")}});var VC=A(lP=>{"use strict";var aP=lP,Hu=Zn(),kr=bt();function LC(n,e,t,r){var i=!1;if(e.resolvedType)if(e.resolvedType instanceof Hu){n("switch(d%s){",r);for(var s=e.resolvedType.values,o=Object.keys(s),a=0;a<o.length;++a)s[o[a]]===e.typeDefault&&!i&&(n("default:")('if(typeof(d%s)==="number"){m%s=d%s;break}',r,r,r),e.repeated||n("break"),i=!0),n("case%j:",o[a])("case %i:",s[o[a]])("m%s=%j",r,s[o[a]])("break");n("}")}else n('if(typeof d%s!=="object")',r)("throw TypeError(%j)",e.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",r,t,r);else{var l=!1;switch(e.type){case"double":case"float":n("m%s=Number(d%s)",r,r);break;case"uint32":case"fixed32":n("m%s=d%s>>>0",r,r);break;case"int32":case"sint32":case"sfixed32":n("m%s=d%s|0",r,r);break;case"uint64":l=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":n("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",r,r,l)('else if(typeof d%s==="string")',r)("m%s=parseInt(d%s,10)",r,r)('else if(typeof d%s==="number")',r)("m%s=d%s",r,r)('else if(typeof d%s==="object")',r)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",r,r,r,l?"true":"");break;case"bytes":n('if(typeof d%s==="string")',r)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",r,r,r)("else if(d%s.length >= 0)",r)("m%s=d%s",r,r);break;case"string":n("m%s=String(d%s)",r,r);break;case"bool":n("m%s=Boolean(d%s)",r,r);break}}return n}aP.fromObject=function(e){var t=e.fieldsArray,r=kr.codegen(["d"],e.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!t.length)return r("return new this.ctor");r("var m=new this.ctor");for(var i=0;i<t.length;++i){var s=t[i].resolve(),o=kr.safeProp(s.name);s.map?(r("if(d%s){",o)('if(typeof d%s!=="object")',o)("throw TypeError(%j)",s.fullName+": object expected")("m%s={}",o)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",o),LC(r,s,i,o+"[ks[i]]")("}")("}")):s.repeated?(r("if(d%s){",o)("if(!Array.isArray(d%s))",o)("throw TypeError(%j)",s.fullName+": array expected")("m%s=[]",o)("for(var i=0;i<d%s.length;++i){",o),LC(r,s,i,o+"[i]")("}")("}")):(s.resolvedType instanceof Hu||r("if(d%s!=null){",o),LC(r,s,i,o),s.resolvedType instanceof Hu||r("}"))}return r("return m")};function BC(n,e,t,r){if(e.resolvedType)e.resolvedType instanceof Hu?n("d%s=o.enums===String?(types[%i].values[m%s]===undefined?m%s:types[%i].values[m%s]):m%s",r,t,r,r,t,r,r):n("d%s=types[%i].toObject(m%s,o)",r,t,r);else{var i=!1;switch(e.type){case"double":case"float":n("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",r,r,r,r);break;case"uint64":i=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":n('if(typeof m%s==="number")',r)("d%s=o.longs===String?String(m%s):m%s",r,r,r)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",r,r,r,r,i?"true":"",r);break;case"bytes":n("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",r,r,r,r,r);break;default:n("d%s=m%s",r,r);break}}return n}aP.toObject=function(e){var t=e.fieldsArray.slice().sort(kr.compareFieldsById);if(!t.length)return kr.codegen()("return {}");for(var r=kr.codegen(["m","o"],e.name+"$toObject")("if(!o)")("o={}")("var d={}"),i=[],s=[],o=[],a=0;a<t.length;++a)t[a].partOf||(t[a].resolve().repeated?i:t[a].map?s:o).push(t[a]);if(i.length){for(r("if(o.arrays||o.defaults){"),a=0;a<i.length;++a)r("d%s=[]",kr.safeProp(i[a].name));r("}")}if(s.length){for(r("if(o.objects||o.defaults){"),a=0;a<s.length;++a)r("d%s={}",kr.safeProp(s[a].name));r("}")}if(o.length){for(r("if(o.defaults){"),a=0;a<o.length;++a){var l=o[a],c=kr.safeProp(l.name);if(l.resolvedType instanceof Hu)r("d%s=o.enums===String?%j:%j",c,l.resolvedType.valuesById[l.typeDefault],l.typeDefault);else if(l.long)r("if(util.Long){")("var n=new util.Long(%i,%i,%j)",l.typeDefault.low,l.typeDefault.high,l.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",c)("}else")("d%s=o.longs===String?%j:%i",c,l.typeDefault.toString(),l.typeDefault.toNumber());else if(l.bytes){var u="["+Array.prototype.slice.call(l.typeDefault).join(",")+"]";r("if(o.bytes===String)d%s=%j",c,String.fromCharCode.apply(String,l.typeDefault))("else{")("d%s=%s",c,u)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",c,c)("}")}else r("d%s=%j",c,l.typeDefault)}r("}")}var d=!1;for(a=0;a<t.length;++a){var l=t[a],h=e._fieldsArray.indexOf(l),c=kr.safeProp(l.name);l.map?(d||(d=!0,r("var ks2")),r("if(m%s&&(ks2=Object.keys(m%s)).length){",c,c)("d%s={}",c)("for(var j=0;j<ks2.length;++j){"),BC(r,l,h,c+"[ks2[j]]")("}")):l.repeated?(r("if(m%s&&m%s.length){",c,c)("d%s=[]",c)("for(var j=0;j<m%s.length;++j){",c),BC(r,l,h,c+"[j]")("}")):(r("if(m%s!=null&&m.hasOwnProperty(%j)){",c,l.name),BC(r,l,h,c),l.partOf&&r("if(o.oneofs)")("d%s=%j",kr.safeProp(l.partOf.name),l.name)),r("}")}return r("return d")}});var UC=A(cP=>{"use strict";var f$=cP,p$=Vp();f$[".google.protobuf.Any"]={fromObject:function(n){if(n&&n["@type"]){var e=n["@type"].substring(n["@type"].lastIndexOf("/")+1),t=this.lookup(e);if(t){var r=n["@type"].charAt(0)==="."?n["@type"].slice(1):n["@type"];return r.indexOf("/")===-1&&(r="/"+r),this.create({type_url:r,value:t.encode(t.fromObject(n)).finish()})}}return this.fromObject(n)},toObject:function(n,e){var t="type.googleapis.com/",r="",i="";if(e&&e.json&&n.type_url&&n.value){i=n.type_url.substring(n.type_url.lastIndexOf("/")+1),r=n.type_url.substring(0,n.type_url.lastIndexOf("/")+1);var s=this.lookup(i);s&&(n=s.decode(n.value))}if(!(n instanceof this.ctor)&&n instanceof p$){var o=n.$type.toObject(n,e),a=n.$type.fullName[0]==="."?n.$type.fullName.slice(1):n.$type.fullName;return r===""&&(r=t),i=r+a,o["@type"]=i,o}return this.toObject(n,e)}}});var zp=A((Coe,dP)=>{"use strict";dP.exports=Oe;var er=tl();((Oe.prototype=Object.create(er.prototype)).constructor=Oe).className="Type";var m$=Zn(),GC=Ja(),Up=Zi(),g$=Fp(),y$=Bp(),qC=Vp(),zC=kp(),_$=Dp(),Pt=bt(),v$=WC(),E$=xC(),S$=FC(),uP=VC(),C$=UC();function Oe(n,e){er.call(this,n,e),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}Object.defineProperties(Oe.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var n=Object.keys(this.fields),e=0;e<n.length;++e){var t=this.fields[n[e]],r=t.id;if(this._fieldsById[r])throw Error("duplicate id "+r+" in "+this);this._fieldsById[r]=t}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=Pt.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=Pt.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=Oe.generateConstructor(this)())},set:function(n){var e=n.prototype;e instanceof qC||((n.prototype=new qC).constructor=n,Pt.merge(n.prototype,e)),n.$type=n.prototype.$type=this,Pt.merge(n,qC,!0),this._ctor=n;for(var t=0;t<this.fieldsArray.length;++t)this._fieldsArray[t].resolve();var r={};for(t=0;t<this.oneofsArray.length;++t)r[this._oneofsArray[t].resolve().name]={get:Pt.oneOfGetter(this._oneofsArray[t].oneof),set:Pt.oneOfSetter(this._oneofsArray[t].oneof)};t&&Object.defineProperties(n.prototype,r)}}});Oe.generateConstructor=function(e){for(var t=Pt.codegen(["p"],e.name),r=0,i;r<e.fieldsArray.length;++r)(i=e._fieldsArray[r]).map?t("this%s={}",Pt.safeProp(i.name)):i.repeated&&t("this%s=[]",Pt.safeProp(i.name));return t("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")};function qp(n){return n._fieldsById=n._fieldsArray=n._oneofsArray=null,delete n.encode,delete n.decode,delete n.verify,n}Oe.fromJSON=function(e,t){var r=new Oe(e,t.options);r.extensions=t.extensions,r.reserved=t.reserved;for(var i=Object.keys(t.fields),s=0;s<i.length;++s)r.add((typeof t.fields[i[s]].keyType<"u"?g$.fromJSON:Up.fromJSON)(i[s],t.fields[i[s]]));if(t.oneofs)for(i=Object.keys(t.oneofs),s=0;s<i.length;++s)r.add(GC.fromJSON(i[s],t.oneofs[i[s]]));if(t.nested)for(i=Object.keys(t.nested),s=0;s<i.length;++s){var o=t.nested[i[s]];r.add((o.id!==void 0?Up.fromJSON:o.fields!==void 0?Oe.fromJSON:o.values!==void 0?m$.fromJSON:o.methods!==void 0?y$.fromJSON:er.fromJSON)(i[s],o))}return t.extensions&&t.extensions.length&&(r.extensions=t.extensions),t.reserved&&t.reserved.length&&(r.reserved=t.reserved),t.group&&(r.group=!0),t.comment&&(r.comment=t.comment),r};Oe.prototype.toJSON=function(e){var t=er.prototype.toJSON.call(this,e),r=e?!!e.keepComments:!1;return Pt.toObject(["options",t&&t.options||void 0,"oneofs",er.arrayToJSON(this.oneofsArray,e),"fields",er.arrayToJSON(this.fieldsArray.filter(function(i){return!i.declaringField}),e)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])};Oe.prototype.resolveAll=function(){for(var e=this.fieldsArray,t=0;t<e.length;)e[t++].resolve();var r=this.oneofsArray;for(t=0;t<r.length;)r[t++].resolve();return er.prototype.resolveAll.call(this)};Oe.prototype.get=function(e){return this.fields[e]||this.oneofs&&this.oneofs[e]||this.nested&&this.nested[e]||null};Oe.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);if(e instanceof Up&&e.extend===void 0){if(this._fieldsById?this._fieldsById[e.id]:this.fieldsById[e.id])throw Error("duplicate id "+e.id+" in "+this);if(this.isReservedId(e.id))throw Error("id "+e.id+" is reserved in "+this);if(this.isReservedName(e.name))throw Error("name '"+e.name+"' is reserved in "+this);return e.parent&&e.parent.remove(e),this.fields[e.name]=e,e.message=this,e.onAdd(this),qp(this)}return e instanceof GC?(this.oneofs||(this.oneofs={}),this.oneofs[e.name]=e,e.onAdd(this),qp(this)):er.prototype.add.call(this,e)};Oe.prototype.remove=function(e){if(e instanceof Up&&e.extend===void 0){if(!this.fields||this.fields[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.fields[e.name],e.parent=null,e.onRemove(this),qp(this)}if(e instanceof GC){if(!this.oneofs||this.oneofs[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.oneofs[e.name],e.parent=null,e.onRemove(this),qp(this)}return er.prototype.remove.call(this,e)};Oe.prototype.isReservedId=function(e){return er.isReservedId(this.reserved,e)};Oe.prototype.isReservedName=function(e){return er.isReservedName(this.reserved,e)};Oe.prototype.create=function(e){return new this.ctor(e)};Oe.prototype.setup=function(){for(var e=this.fullName,t=[],r=0;r<this.fieldsArray.length;++r)t.push(this._fieldsArray[r].resolve().resolvedType);this.encode=v$(this)({Writer:_$,types:t,util:Pt}),this.decode=E$(this)({Reader:zC,types:t,util:Pt}),this.verify=S$(this)({types:t,util:Pt}),this.fromObject=uP.fromObject(this)({types:t,util:Pt}),this.toObject=uP.toObject(this)({types:t,util:Pt});var i=C$[e];if(i){var s=Object.create(this);s.fromObject=this.fromObject,this.fromObject=i.fromObject.bind(s),s.toObject=this.toObject,this.toObject=i.toObject.bind(s)}return this};Oe.prototype.encode=function(e,t){return this.setup().encode(e,t)};Oe.prototype.encodeDelimited=function(e,t){return this.encode(e,t&&t.len?t.fork():t).ldelim()};Oe.prototype.decode=function(e,t){return this.setup().decode(e,t)};Oe.prototype.decodeDelimited=function(e){return e instanceof zC||(e=zC.create(e)),this.decode(e,e.uint32())};Oe.prototype.verify=function(e){return this.setup().verify(e)};Oe.prototype.fromObject=function(e){return this.setup().fromObject(e)};Oe.prototype.toObject=function(e,t){return this.setup().toObject(e,t)};Oe.d=function(e){return function(r){Pt.decorateType(r,e)}}});var jp=A((woe,gP)=>{"use strict";gP.exports=gn;var Wp=tl();((gn.prototype=Object.create(Wp.prototype)).constructor=gn).className="Root";var $C=Zi(),fP=Zn(),w$=Ja(),ts=bt(),pP,jC,Ku;function gn(n){Wp.call(this,"",n),this.deferred=[],this.files=[]}gn.fromJSON=function(e,t){return t||(t=new gn),e.options&&t.setOptions(e.options),t.addJSON(e.nested)};gn.prototype.resolvePath=ts.path.resolve;gn.prototype.fetch=ts.fetch;function mP(){}gn.prototype.load=function n(e,t,r){typeof t=="function"&&(r=t,t=void 0);var i=this;if(!r)return ts.asPromise(n,i,e,t);var s=r===mP;function o(p,E){if(r){if(s)throw p;var w=r;r=null,w(p,E)}}function a(p){var E=p.lastIndexOf("google/protobuf/");if(E>-1){var w=p.substring(E);if(w in Ku)return w}return null}function l(p,E){try{if(ts.isString(E)&&E.charAt(0)==="{"&&(E=JSON.parse(E)),!ts.isString(E))i.setOptions(E.options).addJSON(E.nested);else{jC.filename=p;var w=jC(E,i,t),b,N=0;if(w.imports)for(;N<w.imports.length;++N)(b=a(w.imports[N])||i.resolvePath(p,w.imports[N]))&&c(b);if(w.weakImports)for(N=0;N<w.weakImports.length;++N)(b=a(w.weakImports[N])||i.resolvePath(p,w.weakImports[N]))&&c(b,!0)}}catch(D){o(D)}!s&&!u&&o(null,i)}function c(p,E){if(p=a(p)||p,!(i.files.indexOf(p)>-1)){if(i.files.push(p),p in Ku){s?l(p,Ku[p]):(++u,setTimeout(function(){--u,l(p,Ku[p])}));return}if(s){var w;try{w=ts.fs.readFileSync(p).toString("utf8")}catch(b){E||o(b);return}l(p,w)}else++u,i.fetch(p,function(b,N){if(--u,!!r){if(b){E?u||o(null,i):o(b);return}l(p,N)}})}}var u=0;ts.isString(e)&&(e=[e]);for(var d=0,h;d<e.length;++d)(h=i.resolvePath("",e[d]))&&c(h);if(s)return i;u||o(null,i)};gn.prototype.loadSync=function(e,t){if(!ts.isNode)throw Error("not supported");return this.load(e,t,mP)};gn.prototype.resolveAll=function(){if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(e){return"'extend "+e.extend+"' in "+e.parent.fullName}).join(", "));return Wp.prototype.resolveAll.call(this)};var Gp=/^[A-Z]/;function hP(n,e){var t=e.parent.lookup(e.extend);if(t){var r=new $C(e.fullName,e.id,e.type,e.rule,void 0,e.options);return t.get(r.name)||(r.declaringField=e,e.extensionField=r,t.add(r)),!0}return!1}gn.prototype._handleAdd=function(e){if(e instanceof $C)e.extend!==void 0&&!e.extensionField&&(hP(this,e)||this.deferred.push(e));else if(e instanceof fP)Gp.test(e.name)&&(e.parent[e.name]=e.values);else if(!(e instanceof w$)){if(e instanceof pP)for(var t=0;t<this.deferred.length;)hP(this,this.deferred[t])?this.deferred.splice(t,1):++t;for(var r=0;r<e.nestedArray.length;++r)this._handleAdd(e._nestedArray[r]);Gp.test(e.name)&&(e.parent[e.name]=e)}};gn.prototype._handleRemove=function(e){if(e instanceof $C){if(e.extend!==void 0)if(e.extensionField)e.extensionField.parent.remove(e.extensionField),e.extensionField=null;else{var t=this.deferred.indexOf(e);t>-1&&this.deferred.splice(t,1)}}else if(e instanceof fP)Gp.test(e.name)&&delete e.parent[e.name];else if(e instanceof Wp){for(var r=0;r<e.nestedArray.length;++r)this._handleRemove(e._nestedArray[r]);Gp.test(e.name)&&delete e.parent[e.name]}};gn._configure=function(n,e,t){pP=n,jC=e,Ku=t}});var bt=A((Toe,_P)=>{"use strict";var nt=_P.exports=Rr(),yP=wC(),HC,KC;nt.codegen=Fx();nt.fetch=Bx();nt.path=qx();nt.fs=nt.inquire("fs");nt.toArray=function(e){if(e){for(var t=Object.keys(e),r=new Array(t.length),i=0;i<t.length;)r[i]=e[t[i++]];return r}return[]};nt.toObject=function(e){for(var t={},r=0;r<e.length;){var i=e[r++],s=e[r++];s!==void 0&&(t[i]=s)}return t};var T$=/\\/g,b$=/"/g;nt.isReserved=function(e){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(e)};nt.safeProp=function(e){return!/^[$\w_]+$/.test(e)||nt.isReserved(e)?'["'+e.replace(T$,"\\\\").replace(b$,'\\"')+'"]':"."+e};nt.ucFirst=function(e){return e.charAt(0).toUpperCase()+e.substring(1)};var I$=/_([a-z])/g;nt.camelCase=function(e){return e.substring(0,1)+e.substring(1).replace(I$,function(t,r){return r.toUpperCase()})};nt.compareFieldsById=function(e,t){return e.id-t.id};nt.decorateType=function(e,t){if(e.$type)return t&&e.$type.name!==t&&(nt.decorateRoot.remove(e.$type),e.$type.name=t,nt.decorateRoot.add(e.$type)),e.$type;HC||(HC=zp());var r=new HC(t||e.name);return nt.decorateRoot.add(r),r.ctor=e,Object.defineProperty(e,"$type",{value:r,enumerable:!1}),Object.defineProperty(e.prototype,"$type",{value:r,enumerable:!1}),r};var A$=0;nt.decorateEnum=function(e){if(e.$type)return e.$type;KC||(KC=Zn());var t=new KC("Enum"+A$++,e);return nt.decorateRoot.add(t),Object.defineProperty(e,"$type",{value:t,enumerable:!1}),t};nt.setProperty=function(e,t,r){function i(s,o,a){var l=o.shift();if(l==="__proto__"||l==="prototype")return s;if(o.length>0)s[l]=i(s[l]||{},o,a);else{var c=s[l];c&&(a=[].concat(c).concat(a)),s[l]=a}return s}if(typeof e!="object")throw TypeError("dst must be an object");if(!t)throw TypeError("path must be specified");return t=t.split("."),i(e,t,r)};Object.defineProperty(nt,"decorateRoot",{get:function(){return yP.decorated||(yP.decorated=new(jp()))}})});var _o=A((boe,vP)=>{"use strict";vP.exports=yn;yn.className="ReflectionObject";var $p=bt(),Hp;function yn(n,e){if(!$p.isString(n))throw TypeError("name must be a string");if(e&&!$p.isObject(e))throw TypeError("options must be an object");this.options=e,this.parsedOptions=null,this.name=n,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(yn.prototype,{root:{get:function(){for(var n=this;n.parent!==null;)n=n.parent;return n}},fullName:{get:function(){for(var n=[this.name],e=this.parent;e;)n.unshift(e.name),e=e.parent;return n.join(".")}}});yn.prototype.toJSON=function(){throw Error()};yn.prototype.onAdd=function(e){this.parent&&this.parent!==e&&this.parent.remove(this),this.parent=e,this.resolved=!1;var t=e.root;t instanceof Hp&&t._handleAdd(this)};yn.prototype.onRemove=function(e){var t=e.root;t instanceof Hp&&t._handleRemove(this),this.parent=null,this.resolved=!1};yn.prototype.resolve=function(){return this.resolved?this:(this.root instanceof Hp&&(this.resolved=!0),this)};yn.prototype.getOption=function(e){if(this.options)return this.options[e]};yn.prototype.setOption=function(e,t,r){return(!r||!this.options||this.options[e]===void 0)&&((this.options||(this.options={}))[e]=t),this};yn.prototype.setParsedOption=function(e,t,r){this.parsedOptions||(this.parsedOptions=[]);var i=this.parsedOptions;if(r){var s=i.find(function(l){return Object.prototype.hasOwnProperty.call(l,e)});if(s){var o=s[e];$p.setProperty(o,r,t)}else s={},s[e]=$p.setProperty({},r,t),i.push(s)}else{var a={};a[e]=t,i.push(a)}return this};yn.prototype.setOptions=function(e,t){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)this.setOption(r[i],e[r[i]],t);return this};yn.prototype.toString=function(){var e=this.constructor.className,t=this.fullName;return t.length?e+" "+t:e};yn._configure=function(n){Hp=n}});var Zn=A((Ioe,CP)=>{"use strict";CP.exports=Or;var EP=_o();((Or.prototype=Object.create(EP.prototype)).constructor=Or).className="Enum";var SP=tl(),Kp=bt();function Or(n,e,t,r,i,s){if(EP.call(this,n,t),e&&typeof e!="object")throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=r,this.comments=i||{},this.valuesOptions=s,this.reserved=void 0,e)for(var o=Object.keys(e),a=0;a<o.length;++a)typeof e[o[a]]=="number"&&(this.valuesById[this.values[o[a]]=e[o[a]]]=o[a])}Or.fromJSON=function(e,t){var r=new Or(e,t.values,t.options,t.comment,t.comments);return r.reserved=t.reserved,r};Or.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return Kp.toObject(["options",this.options,"valuesOptions",this.valuesOptions,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",t?this.comment:void 0,"comments",t?this.comments:void 0])};Or.prototype.add=function(e,t,r,i){if(!Kp.isString(e))throw TypeError("name must be a string");if(!Kp.isInteger(t))throw TypeError("id must be an integer");if(this.values[e]!==void 0)throw Error("duplicate name '"+e+"' in "+this);if(this.isReservedId(t))throw Error("id "+t+" is reserved in "+this);if(this.isReservedName(e))throw Error("name '"+e+"' is reserved in "+this);if(this.valuesById[t]!==void 0){if(!(this.options&&this.options.allow_alias))throw Error("duplicate id "+t+" in "+this);this.values[e]=t}else this.valuesById[this.values[e]=t]=e;return i&&(this.valuesOptions===void 0&&(this.valuesOptions={}),this.valuesOptions[e]=i||null),this.comments[e]=r||null,this};Or.prototype.remove=function(e){if(!Kp.isString(e))throw TypeError("name must be a string");var t=this.values[e];if(t==null)throw Error("name '"+e+"' does not exist in "+this);return delete this.valuesById[t],delete this.values[e],delete this.comments[e],this.valuesOptions&&delete this.valuesOptions[e],this};Or.prototype.isReservedId=function(e){return SP.isReservedId(this.reserved,e)};Or.prototype.isReservedName=function(e){return SP.isReservedName(this.reserved,e)}});var WC=A((Aoe,TP)=>{"use strict";TP.exports=D$;var R$=Zn(),QC=yo(),YC=bt();function wP(n,e,t,r){return e.resolvedType.group?n("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",t,r,(e.id<<3|3)>>>0,(e.id<<3|4)>>>0):n("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",t,r,(e.id<<3|2)>>>0)}function D$(n){for(var e=YC.codegen(["m","w"],n.name+"$encode")("if(!w)")("w=Writer.create()"),t,r,i=n.fieldsArray.slice().sort(YC.compareFieldsById),t=0;t<i.length;++t){var s=i[t].resolve(),o=n._fieldsArray.indexOf(s),a=s.resolvedType instanceof R$?"int32":s.type,l=QC.basic[a];r="m"+YC.safeProp(s.name),s.map?(e("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",r,s.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",r)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(s.id<<3|2)>>>0,8|QC.mapKey[s.keyType],s.keyType),l===void 0?e("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",o,r):e(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|l,a,r),e("}")("}")):s.repeated?(e("if(%s!=null&&%s.length){",r,r),s.packed&&QC.packed[a]!==void 0?e("w.uint32(%i).fork()",(s.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",r)("w.%s(%s[i])",a,r)("w.ldelim()"):(e("for(var i=0;i<%s.length;++i)",r),l===void 0?wP(e,s,o,r+"[i]"):e("w.uint32(%i).%s(%s[i])",(s.id<<3|l)>>>0,a,r)),e("}")):(s.optional&&e("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",r,s.name),l===void 0?wP(e,s,o,r):e("w.uint32(%i).%s(%s)",(s.id<<3|l)>>>0,a,r))}return e("return w")}});var IP=A((Roe,bP)=>{"use strict";var fe=bP.exports=Px();fe.build="light";function N$(n,e,t){return typeof e=="function"?(t=e,e=new fe.Root):e||(e=new fe.Root),e.load(n,t)}fe.load=N$;function k$(n,e){return e||(e=new fe.Root),e.loadSync(n)}fe.loadSync=k$;fe.encoder=WC();fe.decoder=xC();fe.verifier=FC();fe.converter=VC();fe.ReflectionObject=_o();fe.Namespace=tl();fe.Root=jp();fe.Enum=Zn();fe.Type=zp();fe.Field=Zi();fe.OneOf=Ja();fe.MapField=Fp();fe.Service=Bp();fe.Method=Lp();fe.Message=Vp();fe.wrappers=UC();fe.types=yo();fe.util=bt();fe.ReflectionObject._configure(fe.Root);fe.Namespace._configure(fe.Type,fe.Service,fe.Enum);fe.Root._configure(fe.Type);fe.Field._configure(fe.Type)});var JC=A((Doe,DP)=>{"use strict";DP.exports=RP;var XC=/[\s{}=;:[\],'"()<>]/g,O$=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,x$=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,P$=/^ *[*/]+ */,M$=/^\s*\*?\/*/,F$=/\n/g,L$=/\s/,B$=/\\(.?)/g,V$={0:"\0",r:"\r",n:`
`,t:"	"};function AP(n){return n.replace(B$,function(e,t){switch(t){case"\\":case"":return t;default:return V$[t]||""}})}RP.unescape=AP;function RP(n,e){n=n.toString();var t=0,r=n.length,i=1,s=0,o={},a=[],l=null;function c(F){return Error("illegal "+F+" (line "+i+")")}function u(){var F=l==="'"?x$:O$;F.lastIndex=t-1;var G=F.exec(n);if(!G)throw c("string");return t=F.lastIndex,b(l),l=null,AP(G[1])}function d(F){return n.charAt(F)}function h(F,G,J){var S={type:n.charAt(F++),lineEmpty:!1,leading:J},y;e?y=2:y=3;var _=F-y,v;do if(--_<0||(v=n.charAt(_))===`
`){S.lineEmpty=!0;break}while(v===" "||v==="	");for(var m=n.substring(F,G).split(F$),C=0;C<m.length;++C)m[C]=m[C].replace(e?M$:P$,"").trim();S.text=m.join(`
`).trim(),o[i]=S,s=i}function p(F){var G=E(F),J=n.substring(F,G),S=/^\s*\/\//.test(J);return S}function E(F){for(var G=F;G<r&&d(G)!==`
`;)G++;return G}function w(){if(a.length>0)return a.shift();if(l)return u();var F,G,J,S,y,_=t===0;do{if(t===r)return null;for(F=!1;L$.test(J=d(t));)if(J===`
`&&(_=!0,++i),++t===r)return null;if(d(t)==="/"){if(++t===r)throw c("comment");if(d(t)==="/")if(e){if(S=t,y=!1,p(t-1)){y=!0;do if(t=E(t),t===r||(t++,!_))break;while(p(t))}else t=Math.min(r,E(t)+1);y&&(h(S,t,_),_=!0),i++,F=!0}else{for(y=d(S=t+1)==="/";d(++t)!==`
`;)if(t===r)return null;++t,y&&(h(S,t-1,_),_=!0),++i,F=!0}else if((J=d(t))==="*"){S=t+1,y=e||d(S)==="*";do{if(J===`
`&&++i,++t===r)throw c("comment");G=J,J=d(t)}while(G!=="*"||J!=="/");++t,y&&(h(S,t-2,_),_=!0),F=!0}else return"/"}}while(F);var v=t;XC.lastIndex=0;var m=XC.test(d(v++));if(!m)for(;v<r&&!XC.test(d(v));)++v;var C=n.substring(t,t=v);return(C==='"'||C==="'")&&(l=C),C}function b(F){a.push(F)}function N(){if(!a.length){var F=w();if(F===null)return null;b(F)}return a[0]}function D(F,G){var J=N(),S=J===F;if(S)return w(),!0;if(!G)throw c("token '"+J+"', '"+F+"' expected");return!1}function O(F){var G=null,J;return F===void 0?(J=o[i-1],delete o[i-1],J&&(e||J.type==="*"||J.lineEmpty)&&(G=J.leading?J.text:null)):(s<F&&N(),J=o[F],delete o[F],J&&!J.lineEmpty&&(e||J.type==="/")&&(G=J.leading?null:J.text)),G}return Object.defineProperty({next:w,peek:N,push:b,skip:D,cmnt:O},"line",{get:function(){return i}})}});var MP=A((Noe,PP)=>{"use strict";PP.exports=li;li.filename=null;li.defaults={keepCase:!1};var U$=JC(),NP=jp(),kP=zp(),OP=Zi(),q$=Fp(),xP=Ja(),z$=Zn(),G$=Bp(),W$=Lp(),ZC=yo(),ew=bt(),j$=/^[1-9][0-9]*$/,$$=/^-?[1-9][0-9]*$/,H$=/^0[x][0-9a-fA-F]+$/,K$=/^-?0[x][0-9a-fA-F]+$/,Q$=/^0[0-7]+$/,Y$=/^-?0[0-7]+$/,X$=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,xr=/^[a-zA-Z_][a-zA-Z_0-9]*$/,Pr=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/,J$=/^(?:\.[a-zA-Z_][a-zA-Z_0-9]*)+$/;function li(n,e,t){e instanceof NP||(t=e,e=new NP),t||(t=li.defaults);var r=t.preferTrailingComment||!1,i=U$(n,t.alternateCommentMode||!1),s=i.next,o=i.push,a=i.peek,l=i.skip,c=i.cmnt,u=!0,d,h,p,E,w=!1,b=e,N=t.keepCase?function(x){return x}:ew.camelCase;function D(x,P,B){var Y=li.filename;return B||(li.filename=null),Error("illegal "+(P||"token")+" '"+x+"' ("+(Y?Y+", ":"")+"line "+i.line+")")}function O(){var x=[],P;do{if((P=s())!=='"'&&P!=="'")throw D(P);x.push(s()),l(P),P=a()}while(P==='"'||P==="'");return x.join("")}function F(x){var P=s();switch(P){case"'":case'"':return o(P),O();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return J(P,!0)}catch{if(x&&Pr.test(P))return P;throw D(P,"value")}}function G(x,P){var B,Y;do P&&((B=a())==='"'||B==="'")?x.push(O()):x.push([Y=S(s()),l("to",!0)?S(s()):Y]);while(l(",",!0));var $={options:void 0};$.setOption=function(se,We){this.options===void 0&&(this.options={}),this.options[se]=We},C($,function(We){if(We==="option")Ne($,We),l(";");else throw D(We)},function(){Rt($)})}function J(x,P){var B=1;switch(x.charAt(0)==="-"&&(B=-1,x=x.substring(1)),x){case"inf":case"INF":case"Inf":return B*(1/0);case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if(j$.test(x))return B*parseInt(x,10);if(H$.test(x))return B*parseInt(x,16);if(Q$.test(x))return B*parseInt(x,8);if(X$.test(x))return B*parseFloat(x);throw D(x,"number",P)}function S(x,P){switch(x){case"max":case"MAX":case"Max":return 536870911;case"0":return 0}if(!P&&x.charAt(0)==="-")throw D(x,"id");if($$.test(x))return parseInt(x,10);if(K$.test(x))return parseInt(x,16);if(Y$.test(x))return parseInt(x,8);throw D(x,"id")}function y(){if(d!==void 0)throw D("package");if(d=s(),!Pr.test(d))throw D(d,"name");b=b.define(d),l(";")}function _(){var x=a(),P;switch(x){case"weak":P=p||(p=[]),s();break;case"public":s();default:P=h||(h=[]);break}x=O(),l(";"),P.push(x)}function v(){if(l("="),E=O(),w=E==="proto3",!w&&E!=="proto2")throw D(E,"syntax");e.setOption("syntax",E),l(";")}function m(x,P){switch(P){case"option":return Ne(x,P),l(";"),!0;case"message":return f(x,P),!0;case"enum":return Ae(x,P),!0;case"service":return at(x,P),!0;case"extend":return na(x,P),!0}return!1}function C(x,P,B){var Y=i.line;if(x&&(typeof x.comment!="string"&&(x.comment=c()),x.filename=li.filename),l("{",!0)){for(var $;($=s())!=="}";)P($);l(";",!0)}else B&&B(),l(";"),x&&(typeof x.comment!="string"||r)&&(x.comment=c(Y)||x.comment)}function f(x,P){if(!xr.test(P=s()))throw D(P,"type name");var B=new kP(P);C(B,function($){if(!m(B,$))switch($){case"map":me(B,$);break;case"required":case"repeated":g(B,$);break;case"optional":w?g(B,"proto3_optional"):g(B,"optional");break;case"oneof":Le(B,$);break;case"extensions":G(B.extensions||(B.extensions=[]));break;case"reserved":G(B.reserved||(B.reserved=[]),!0);break;default:if(!w||!Pr.test($))throw D($);o($),g(B,"optional");break}}),x.add(B)}function g(x,P,B){var Y=s();if(Y==="group"){q(x,P);return}for(;Y.endsWith(".")||a().startsWith(".");)Y+=s();if(!Pr.test(Y))throw D(Y,"type");var $=s();if(!xr.test($))throw D($,"name");$=N($),l("=");var se=new OP($,S(s()),Y,P,B);if(C(se,function(an){if(an==="option")Ne(se,an),l(";");else throw D(an)},function(){Rt(se)}),P==="proto3_optional"){var We=new xP("_"+$);se.setOption("proto3_optional",!0),We.add(se),x.add(We)}else x.add(se);!w&&se.repeated&&(ZC.packed[Y]!==void 0||ZC.basic[Y]===void 0)&&se.setOption("packed",!1,!0)}function q(x,P){var B=s();if(!xr.test(B))throw D(B,"name");var Y=ew.lcFirst(B);B===Y&&(B=ew.ucFirst(B)),l("=");var $=S(s()),se=new kP(B);se.group=!0;var We=new OP(Y,$,B,P);We.filename=li.filename,C(se,function(an){switch(an){case"option":Ne(se,an),l(";");break;case"required":case"repeated":g(se,an);break;case"optional":w?g(se,"proto3_optional"):g(se,"optional");break;case"message":f(se,an);break;case"enum":Ae(se,an);break;default:throw D(an)}}),x.add(se).add(We)}function me(x){l("<");var P=s();if(ZC.mapKey[P]===void 0)throw D(P,"type");l(",");var B=s();if(!Pr.test(B))throw D(B,"type");l(">");var Y=s();if(!xr.test(Y))throw D(Y,"name");l("=");var $=new q$(N(Y),S(s()),P,B);C($,function(We){if(We==="option")Ne($,We),l(";");else throw D(We)},function(){Rt($)}),x.add($)}function Le(x,P){if(!xr.test(P=s()))throw D(P,"name");var B=new xP(N(P));C(B,function($){$==="option"?(Ne(B,$),l(";")):(o($),g(B,"optional"))}),x.add(B)}function Ae(x,P){if(!xr.test(P=s()))throw D(P,"name");var B=new z$(P);C(B,function($){switch($){case"option":Ne(B,$),l(";");break;case"reserved":G(B.reserved||(B.reserved=[]),!0);break;default:Ze(B,$)}}),x.add(B)}function Ze(x,P){if(!xr.test(P))throw D(P,"name");l("=");var B=S(s(),!0),Y={options:void 0};Y.setOption=function($,se){this.options===void 0&&(this.options={}),this.options[$]=se},C(Y,function(se){if(se==="option")Ne(Y,se),l(";");else throw D(se)},function(){Rt(Y)}),x.add(P,B,Y.comment,Y.options)}function Ne(x,P){var B=l("(",!0);if(!Pr.test(P=s()))throw D(P,"name");var Y=P,$=Y,se;B&&(l(")"),Y="("+Y+")",$=Y,P=a(),J$.test(P)&&(se=P.slice(1),Y+=P,s())),l("=");var We=Bt(x,Y);Qe(x,$,We,se)}function Bt(x,P){if(l("{",!0)){for(var B={};!l("}",!0);){if(!xr.test(kt=s()))throw D(kt,"name");if(kt===null)throw D(kt,"end of input");var Y,$=kt;if(l(":",!0),a()==="{")Y=Bt(x,P+"."+kt);else if(a()==="["){Y=[];var se;if(l("[",!0)){do se=F(!0),Y.push(se);while(l(",",!0));l("]"),typeof se<"u"&&ot(x,P+"."+kt,se)}}else Y=F(!0),ot(x,P+"."+kt,Y);var We=B[$];We&&(Y=[].concat(We).concat(Y)),B[$]=Y,l(",",!0),l(";",!0)}return B}var Ci=F(!0);return ot(x,P,Ci),Ci}function ot(x,P,B){x.setOption&&x.setOption(P,B)}function Qe(x,P,B,Y){x.setParsedOption&&x.setParsedOption(P,B,Y)}function Rt(x){if(l("[",!0)){do Ne(x,"option");while(l(",",!0));l("]")}return x}function at(x,P){if(!xr.test(P=s()))throw D(P,"service name");var B=new G$(P);C(B,function($){if(!m(B,$))if($==="rpc")Vt(B,$);else throw D($)}),x.add(B)}function Vt(x,P){var B=c(),Y=P;if(!xr.test(P=s()))throw D(P,"name");var $=P,se,We,Ci,an;if(l("("),l("stream",!0)&&(We=!0),!Pr.test(P=s())||(se=P,l(")"),l("returns"),l("("),l("stream",!0)&&(an=!0),!Pr.test(P=s())))throw D(P);Ci=P,l(")");var ch=new W$($,Y,se,Ci,We,an);ch.comment=B,C(ch,function(xy){if(xy==="option")Ne(ch,xy),l(";");else throw D(xy)}),x.add(ch)}function na(x,P){if(!Pr.test(P=s()))throw D(P,"reference");var B=P;C(null,function($){switch($){case"required":case"repeated":g(x,$,B);break;case"optional":w?g(x,"proto3_optional",B):g(x,"optional",B);break;default:if(!w||!Pr.test($))throw D($);o($),g(x,"optional",B);break}})}for(var kt;(kt=s())!==null;)switch(kt){case"package":if(!u)throw D(kt);y();break;case"import":if(!u)throw D(kt);_();break;case"syntax":if(!u)throw D(kt);v();break;case"option":Ne(b,kt),l(";");break;default:if(m(b,kt)){u=!1;continue}throw D(kt)}return li.filename=null,{package:d,imports:h,weakImports:p,syntax:E,root:e}}});var BP=A((koe,LP)=>{"use strict";LP.exports=tr;var Z$=/\/|\./;function tr(n,e){Z$.test(n)||(n="google/protobuf/"+n+".proto",e={nested:{google:{nested:{protobuf:{nested:e}}}}}),tr[n]=e}tr("any",{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}}});var FP;tr("duration",{Duration:FP={fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}});tr("timestamp",{Timestamp:FP});tr("empty",{Empty:{fields:{}}});tr("struct",{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}}});tr("wrappers",{DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}}});tr("field_mask",{FieldMask:{fields:{paths:{rule:"repeated",type:"string",id:1}}}});tr.get=function(e){return tr[e]||null}});var UP=A((Ooe,VP)=>{"use strict";var ns=VP.exports=IP();ns.build="full";ns.tokenize=JC();ns.parse=MP();ns.common=BP();ns.Root._configure(ns.Type,ns.parse,ns.common)});var Qp=A((xoe,qP)=>{"use strict";qP.exports=UP()});var tw=A((Poe,eH)=>{eH.exports={nested:{google:{nested:{protobuf:{nested:{FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}}}}}}}}});var $P=A((ce,jP)=>{"use strict";var Kt=Qp();jP.exports=ce=Kt.descriptor=Kt.Root.fromJSON(tw()).lookup(".google.protobuf");var zP=Kt.Namespace,Qu=Kt.Root,ci=Kt.Enum,rs=Kt.Type,is=Kt.Field,tH=Kt.MapField,Yp=Kt.OneOf,Yu=Kt.Service,Xp=Kt.Method;Qu.fromDescriptor=function(e){typeof e.length=="number"&&(e=ce.FileDescriptorSet.decode(e));var t=new Qu;if(e.file)for(var r,i,s=0,o;s<e.file.length;++s){if(i=t,(r=e.file[s]).package&&r.package.length&&(i=t.define(r.package)),r.name&&r.name.length&&t.files.push(i.filename=r.name),r.messageType)for(o=0;o<r.messageType.length;++o)i.add(rs.fromDescriptor(r.messageType[o],r.syntax));if(r.enumType)for(o=0;o<r.enumType.length;++o)i.add(ci.fromDescriptor(r.enumType[o]));if(r.extension)for(o=0;o<r.extension.length;++o)i.add(is.fromDescriptor(r.extension[o]));if(r.service)for(o=0;o<r.service.length;++o)i.add(Yu.fromDescriptor(r.service[o]));var a=rl(r.options,ce.FileOptions);if(a){var l=Object.keys(a);for(o=0;o<l.length;++o)i.setOption(l[o],a[l[o]])}}return t};Qu.prototype.toDescriptor=function(e){var t=ce.FileDescriptorSet.create();return GP(this,t.file,e),t};function GP(n,e,t){var r=ce.FileDescriptorProto.create({name:n.filename||(n.fullName.substring(1).replace(/\./g,"_")||"root")+".proto"});t&&(r.syntax=t),n instanceof Qu||(r.package=n.fullName.substring(1));for(var i=0,s;i<n.nestedArray.length;++i)(s=n._nestedArray[i])instanceof rs?r.messageType.push(s.toDescriptor(t)):s instanceof ci?r.enumType.push(s.toDescriptor()):s instanceof is?r.extension.push(s.toDescriptor(t)):s instanceof Yu?r.service.push(s.toDescriptor()):s instanceof zP&&GP(s,e,t);r.options=il(n.options,ce.FileOptions),r.messageType.length+r.enumType.length+r.extension.length+r.service.length&&e.push(r)}var nH=0;rs.fromDescriptor=function(e,t){typeof e.length=="number"&&(e=ce.DescriptorProto.decode(e));var r=new rs(e.name.length?e.name:"Type"+nH++,rl(e.options,ce.MessageOptions)),i;if(e.oneofDecl)for(i=0;i<e.oneofDecl.length;++i)r.add(Yp.fromDescriptor(e.oneofDecl[i]));if(e.field)for(i=0;i<e.field.length;++i){var s=is.fromDescriptor(e.field[i],t);r.add(s),e.field[i].hasOwnProperty("oneofIndex")&&r.oneofsArray[e.field[i].oneofIndex].add(s)}if(e.extension)for(i=0;i<e.extension.length;++i)r.add(is.fromDescriptor(e.extension[i],t));if(e.nestedType)for(i=0;i<e.nestedType.length;++i)r.add(rs.fromDescriptor(e.nestedType[i],t)),e.nestedType[i].options&&e.nestedType[i].options.mapEntry&&r.setOption("map_entry",!0);if(e.enumType)for(i=0;i<e.enumType.length;++i)r.add(ci.fromDescriptor(e.enumType[i]));if(e.extensionRange&&e.extensionRange.length)for(r.extensions=[],i=0;i<e.extensionRange.length;++i)r.extensions.push([e.extensionRange[i].start,e.extensionRange[i].end]);if(e.reservedRange&&e.reservedRange.length||e.reservedName&&e.reservedName.length){if(r.reserved=[],e.reservedRange)for(i=0;i<e.reservedRange.length;++i)r.reserved.push([e.reservedRange[i].start,e.reservedRange[i].end]);if(e.reservedName)for(i=0;i<e.reservedName.length;++i)r.reserved.push(e.reservedName[i])}return r};rs.prototype.toDescriptor=function(e){var t=ce.DescriptorProto.create({name:this.name}),r;for(r=0;r<this.fieldsArray.length;++r){var i;if(t.field.push(i=this._fieldsArray[r].toDescriptor(e)),this._fieldsArray[r]instanceof tH){var s=nw(this._fieldsArray[r].keyType,this._fieldsArray[r].resolvedKeyType),o=nw(this._fieldsArray[r].type,this._fieldsArray[r].resolvedType),a=o===11||o===14?this._fieldsArray[r].resolvedType&&WP(this.parent,this._fieldsArray[r].resolvedType)||this._fieldsArray[r].type:void 0;t.nestedType.push(ce.DescriptorProto.create({name:i.typeName,field:[ce.FieldDescriptorProto.create({name:"key",number:1,label:1,type:s}),ce.FieldDescriptorProto.create({name:"value",number:2,label:1,type:o,typeName:a})],options:ce.MessageOptions.create({mapEntry:!0})}))}}for(r=0;r<this.oneofsArray.length;++r)t.oneofDecl.push(this._oneofsArray[r].toDescriptor());for(r=0;r<this.nestedArray.length;++r)this._nestedArray[r]instanceof is?t.field.push(this._nestedArray[r].toDescriptor(e)):this._nestedArray[r]instanceof rs?t.nestedType.push(this._nestedArray[r].toDescriptor(e)):this._nestedArray[r]instanceof ci&&t.enumType.push(this._nestedArray[r].toDescriptor());if(this.extensions)for(r=0;r<this.extensions.length;++r)t.extensionRange.push(ce.DescriptorProto.ExtensionRange.create({start:this.extensions[r][0],end:this.extensions[r][1]}));if(this.reserved)for(r=0;r<this.reserved.length;++r)typeof this.reserved[r]=="string"?t.reservedName.push(this.reserved[r]):t.reservedRange.push(ce.DescriptorProto.ReservedRange.create({start:this.reserved[r][0],end:this.reserved[r][1]}));return t.options=il(this.options,ce.MessageOptions),t};var rH=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/;is.fromDescriptor=function(e,t){if(typeof e.length=="number"&&(e=ce.DescriptorProto.decode(e)),typeof e.number!="number")throw Error("missing field id");var r;e.typeName&&e.typeName.length?r=e.typeName:r=lH(e.type);var i;switch(e.label){case 1:i=void 0;break;case 2:i="required";break;case 3:i="repeated";break;default:throw Error("illegal label: "+e.label)}var s=e.extendee;e.extendee!==void 0&&(s=s.length?s:void 0);var o=new is(e.name.length?e.name:"field"+e.number,e.number,r,i,s);if(o.options=rl(e.options,ce.FieldOptions),e.defaultValue&&e.defaultValue.length){var a=e.defaultValue;switch(a){case"true":case"TRUE":a=!0;break;case"false":case"FALSE":a=!1;break;default:var l=rH.exec(a);l&&(a=parseInt(a));break}o.setOption("default",a)}return cH(e.type)&&(t==="proto3"?e.options&&!e.options.packed&&o.setOption("packed",!1):e.options&&e.options.packed||o.setOption("packed",!1)),o};is.prototype.toDescriptor=function(e){var t=ce.FieldDescriptorProto.create({name:this.name,number:this.id});if(this.map)t.type=11,t.typeName=Kt.util.ucFirst(this.name),t.label=3;else{switch(t.type=nw(this.type,this.resolve().resolvedType)){case 10:case 11:case 14:t.typeName=this.resolvedType?WP(this.parent,this.resolvedType):this.type;break}switch(this.rule){case"repeated":t.label=3;break;case"required":t.label=2;break;default:t.label=1;break}}if(t.extendee=this.extensionField?this.extensionField.parent.fullName:this.extend,this.partOf&&(t.oneofIndex=this.parent.oneofsArray.indexOf(this.partOf))<0)throw Error("missing oneof");return this.options&&(t.options=il(this.options,ce.FieldOptions),this.options.default!=null&&(t.defaultValue=String(this.options.default))),e==="proto3"?this.packed||((t.options||(t.options=ce.FieldOptions.create())).packed=!1):this.packed&&((t.options||(t.options=ce.FieldOptions.create())).packed=!0),t};var iH=0;ci.fromDescriptor=function(e){typeof e.length=="number"&&(e=ce.EnumDescriptorProto.decode(e));var t={};if(e.value)for(var r=0;r<e.value.length;++r){var i=e.value[r].name,s=e.value[r].number||0;t[i&&i.length?i:"NAME"+s]=s}return new ci(e.name&&e.name.length?e.name:"Enum"+iH++,t,rl(e.options,ce.EnumOptions))};ci.prototype.toDescriptor=function(){for(var e=[],t=0,r=Object.keys(this.values);t<r.length;++t)e.push(ce.EnumValueDescriptorProto.create({name:r[t],number:this.values[r[t]]}));return ce.EnumDescriptorProto.create({name:this.name,value:e,options:il(this.options,ce.EnumOptions)})};var sH=0;Yp.fromDescriptor=function(e){return typeof e.length=="number"&&(e=ce.OneofDescriptorProto.decode(e)),new Yp(e.name&&e.name.length?e.name:"oneof"+sH++)};Yp.prototype.toDescriptor=function(){return ce.OneofDescriptorProto.create({name:this.name})};var oH=0;Yu.fromDescriptor=function(e){typeof e.length=="number"&&(e=ce.ServiceDescriptorProto.decode(e));var t=new Yu(e.name&&e.name.length?e.name:"Service"+oH++,rl(e.options,ce.ServiceOptions));if(e.method)for(var r=0;r<e.method.length;++r)t.add(Xp.fromDescriptor(e.method[r]));return t};Yu.prototype.toDescriptor=function(){for(var e=[],t=0;t<this.methodsArray.length;++t)e.push(this._methodsArray[t].toDescriptor());return ce.ServiceDescriptorProto.create({name:this.name,method:e,options:il(this.options,ce.ServiceOptions)})};var aH=0;Xp.fromDescriptor=function(e){return typeof e.length=="number"&&(e=ce.MethodDescriptorProto.decode(e)),new Xp(e.name&&e.name.length?e.name:"Method"+aH++,"rpc",e.inputType,e.outputType,!!e.clientStreaming,!!e.serverStreaming,rl(e.options,ce.MethodOptions))};Xp.prototype.toDescriptor=function(){return ce.MethodDescriptorProto.create({name:this.name,inputType:this.resolvedRequestType?this.resolvedRequestType.fullName:this.requestType,outputType:this.resolvedResponseType?this.resolvedResponseType.fullName:this.responseType,clientStreaming:this.requestStream,serverStreaming:this.responseStream,options:il(this.options,ce.MethodOptions)})};function lH(n){switch(n){case 1:return"double";case 2:return"float";case 3:return"int64";case 4:return"uint64";case 5:return"int32";case 6:return"fixed64";case 7:return"fixed32";case 8:return"bool";case 9:return"string";case 12:return"bytes";case 13:return"uint32";case 15:return"sfixed32";case 16:return"sfixed64";case 17:return"sint32";case 18:return"sint64"}throw Error("illegal type: "+n)}function cH(n){switch(n){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 13:case 14:case 15:case 16:case 17:case 18:return!0}return!1}function nw(n,e){switch(n){case"double":return 1;case"float":return 2;case"int64":return 3;case"uint64":return 4;case"int32":return 5;case"fixed64":return 6;case"fixed32":return 7;case"bool":return 8;case"string":return 9;case"bytes":return 12;case"uint32":return 13;case"sfixed32":return 15;case"sfixed64":return 16;case"sint32":return 17;case"sint64":return 18}if(e instanceof ci)return 14;if(e instanceof rs)return e.group?10:11;throw Error("illegal type: "+n)}function rl(n,e){if(n){for(var t=[],r=0,i,s,o;r<e.fieldsArray.length;++r)(s=(i=e._fieldsArray[r]).name)!=="uninterpretedOption"&&n.hasOwnProperty(s)&&(o=n[s],i.resolvedType instanceof ci&&typeof o=="number"&&i.resolvedType.valuesById[o]!==void 0&&(o=i.resolvedType.valuesById[o]),t.push(uH(s),o));return t.length?Kt.util.toObject(t):void 0}}function il(n,e){if(n){for(var t=[],r=0,i=Object.keys(n),s,o;r<i.length;++r)if(o=n[s=i[r]],s!=="default"){var a=e.fields[s];!a&&!(a=e.fields[s=Kt.util.camelCase(s)])||t.push(s,o)}return t.length?e.fromObject(Kt.util.toObject(t)):void 0}}function WP(n,e){var t=n.fullName.split("."),r=e.fullName.split("."),i=0,s=0,o=r.length-1;if(!(n instanceof Qu)&&e instanceof zP)for(;i<t.length&&s<o&&t[i]===r[s];){var a=e.lookup(t[i++],!0);if(a!==null&&a!==e)break;++s}else for(;i<t.length&&s<o&&t[i]===r[s];++i,++s);return r.slice(s).join(".")}function uH(n){return n.substring(0,1)+n.substring(1).replace(/([A-Z])(?=[a-z]|$)/g,function(e,t){return"_"+t.toLowerCase()})}});var HP=A((Moe,dH)=>{dH.exports={nested:{google:{nested:{protobuf:{nested:{Api:{fields:{name:{type:"string",id:1},methods:{rule:"repeated",type:"Method",id:2},options:{rule:"repeated",type:"Option",id:3},version:{type:"string",id:4},sourceContext:{type:"SourceContext",id:5},mixins:{rule:"repeated",type:"Mixin",id:6},syntax:{type:"Syntax",id:7}}},Method:{fields:{name:{type:"string",id:1},requestTypeUrl:{type:"string",id:2},requestStreaming:{type:"bool",id:3},responseTypeUrl:{type:"string",id:4},responseStreaming:{type:"bool",id:5},options:{rule:"repeated",type:"Option",id:6},syntax:{type:"Syntax",id:7}}},Mixin:{fields:{name:{type:"string",id:1},root:{type:"string",id:2}}},SourceContext:{fields:{fileName:{type:"string",id:1}}},Option:{fields:{name:{type:"string",id:1},value:{type:"Any",id:2}}},Syntax:{values:{SYNTAX_PROTO2:0,SYNTAX_PROTO3:1}}}}}}}}});var KP=A((Foe,hH)=>{hH.exports={nested:{google:{nested:{protobuf:{nested:{SourceContext:{fields:{fileName:{type:"string",id:1}}}}}}}}}});var QP=A((Loe,fH)=>{fH.exports={nested:{google:{nested:{protobuf:{nested:{Type:{fields:{name:{type:"string",id:1},fields:{rule:"repeated",type:"Field",id:2},oneofs:{rule:"repeated",type:"string",id:3},options:{rule:"repeated",type:"Option",id:4},sourceContext:{type:"SourceContext",id:5},syntax:{type:"Syntax",id:6}}},Field:{fields:{kind:{type:"Kind",id:1},cardinality:{type:"Cardinality",id:2},number:{type:"int32",id:3},name:{type:"string",id:4},typeUrl:{type:"string",id:6},oneofIndex:{type:"int32",id:7},packed:{type:"bool",id:8},options:{rule:"repeated",type:"Option",id:9},jsonName:{type:"string",id:10},defaultValue:{type:"string",id:11}},nested:{Kind:{values:{TYPE_UNKNOWN:0,TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Cardinality:{values:{CARDINALITY_UNKNOWN:0,CARDINALITY_OPTIONAL:1,CARDINALITY_REQUIRED:2,CARDINALITY_REPEATED:3}}}},Enum:{fields:{name:{type:"string",id:1},enumvalue:{rule:"repeated",type:"EnumValue",id:2},options:{rule:"repeated",type:"Option",id:3},sourceContext:{type:"SourceContext",id:4},syntax:{type:"Syntax",id:5}}},EnumValue:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{rule:"repeated",type:"Option",id:3}}},Option:{fields:{name:{type:"string",id:1},value:{type:"Any",id:2}}},Syntax:{values:{SYNTAX_PROTO2:0,SYNTAX_PROTO3:1}},Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}},SourceContext:{fields:{fileName:{type:"string",id:1}}}}}}}}}});var ZP=A(ss=>{"use strict";Object.defineProperty(ss,"__esModule",{value:!0});ss.addCommonProtos=ss.loadProtosWithOptionsSync=ss.loadProtosWithOptions=void 0;var YP=X("fs"),XP=X("path"),sl=Qp();function JP(n,e){let t=n.resolvePath;n.resolvePath=(r,i)=>{if(XP.isAbsolute(i))return i;for(let s of e){let o=XP.join(s,i);try{return YP.accessSync(o,YP.constants.R_OK),o}catch{continue}}return process.emitWarning(`${i} not found in any of the include paths ${e}`),t(r,i)}}function pH(n,e){return T(this,null,function*(){let t=new sl.Root;if(e=e||{},e.includeDirs){if(!Array.isArray(e.includeDirs))return Promise.reject(new Error("The includeDirs option must be an array"));JP(t,e.includeDirs)}let r=yield t.load(n,e);return r.resolveAll(),r})}ss.loadProtosWithOptions=pH;function mH(n,e){let t=new sl.Root;if(e=e||{},e.includeDirs){if(!Array.isArray(e.includeDirs))throw new Error("The includeDirs option must be an array");JP(t,e.includeDirs)}let r=t.loadSync(n,e);return r.resolveAll(),r}ss.loadProtosWithOptionsSync=mH;function gH(){let n=HP(),e=tw(),t=KP(),r=QP();sl.common("api",n.nested.google.nested.protobuf.nested),sl.common("descriptor",e.nested.google.nested.protobuf.nested),sl.common("source_context",t.nested.google.nested.protobuf.nested),sl.common("type",r.nested.google.nested.protobuf.nested)}ss.addCommonProtos=gH});var nM=A((tM,rw)=>{"use strict";var eM=function(n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var e=null;try{e=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function t(f,g,q){this.low=f|0,this.high=g|0,this.unsigned=!!q}t.prototype.__isLong__,Object.defineProperty(t.prototype,"__isLong__",{value:!0});function r(f){return(f&&f.__isLong__)===!0}function i(f){var g=Math.clz32(f&-f);return f?31-g:g}t.isLong=r;var s={},o={};function a(f,g){var q,me,Le;return g?(f>>>=0,(Le=0<=f&&f<256)&&(me=o[f],me)?me:(q=c(f,0,!0),Le&&(o[f]=q),q)):(f|=0,(Le=-128<=f&&f<128)&&(me=s[f],me)?me:(q=c(f,f<0?-1:0,!1),Le&&(s[f]=q),q))}t.fromInt=a;function l(f,g){if(isNaN(f))return g?F:O;if(g){if(f<0)return F;if(f>=b)return _}else{if(f<=-N)return v;if(f+1>=N)return y}return f<0?l(-f,g).neg():c(f%w|0,f/w|0,g)}t.fromNumber=l;function c(f,g,q){return new t(f,g,q)}t.fromBits=c;var u=Math.pow;function d(f,g,q){if(f.length===0)throw Error("empty string");if(typeof g=="number"?(q=g,g=!1):g=!!g,f==="NaN"||f==="Infinity"||f==="+Infinity"||f==="-Infinity")return g?F:O;if(q=q||10,q<2||36<q)throw RangeError("radix");var me;if((me=f.indexOf("-"))>0)throw Error("interior hyphen");if(me===0)return d(f.substring(1),g,q).neg();for(var Le=l(u(q,8)),Ae=O,Ze=0;Ze<f.length;Ze+=8){var Ne=Math.min(8,f.length-Ze),Bt=parseInt(f.substring(Ze,Ze+Ne),q);if(Ne<8){var ot=l(u(q,Ne));Ae=Ae.mul(ot).add(l(Bt))}else Ae=Ae.mul(Le),Ae=Ae.add(l(Bt))}return Ae.unsigned=g,Ae}t.fromString=d;function h(f,g){return typeof f=="number"?l(f,g):typeof f=="string"?d(f,g):c(f.low,f.high,typeof g=="boolean"?g:f.unsigned)}t.fromValue=h;var p=65536,E=1<<24,w=p*p,b=w*w,N=b/2,D=a(E),O=a(0);t.ZERO=O;var F=a(0,!0);t.UZERO=F;var G=a(1);t.ONE=G;var J=a(1,!0);t.UONE=J;var S=a(-1);t.NEG_ONE=S;var y=c(-1,2147483647,!1);t.MAX_VALUE=y;var _=c(-1,-1,!0);t.MAX_UNSIGNED_VALUE=_;var v=c(0,-2147483648,!1);t.MIN_VALUE=v;var m=t.prototype;m.toInt=function(){return this.unsigned?this.low>>>0:this.low},m.toNumber=function(){return this.unsigned?(this.high>>>0)*w+(this.low>>>0):this.high*w+(this.low>>>0)},m.toString=function(g){if(g=g||10,g<2||36<g)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(v)){var q=l(g),me=this.div(q),Le=me.mul(q).sub(this);return me.toString(g)+Le.toInt().toString(g)}else return"-"+this.neg().toString(g);for(var Ae=l(u(g,6),this.unsigned),Ze=this,Ne="";;){var Bt=Ze.div(Ae),ot=Ze.sub(Bt.mul(Ae)).toInt()>>>0,Qe=ot.toString(g);if(Ze=Bt,Ze.isZero())return Qe+Ne;for(;Qe.length<6;)Qe="0"+Qe;Ne=""+Qe+Ne}},m.getHighBits=function(){return this.high},m.getHighBitsUnsigned=function(){return this.high>>>0},m.getLowBits=function(){return this.low},m.getLowBitsUnsigned=function(){return this.low>>>0},m.getNumBitsAbs=function(){if(this.isNegative())return this.eq(v)?64:this.neg().getNumBitsAbs();for(var g=this.high!=0?this.high:this.low,q=31;q>0&&!(g&1<<q);q--);return this.high!=0?q+33:q+1},m.isZero=function(){return this.high===0&&this.low===0},m.eqz=m.isZero,m.isNegative=function(){return!this.unsigned&&this.high<0},m.isPositive=function(){return this.unsigned||this.high>=0},m.isOdd=function(){return(this.low&1)===1},m.isEven=function(){return(this.low&1)===0},m.equals=function(g){return r(g)||(g=h(g)),this.unsigned!==g.unsigned&&this.high>>>31===1&&g.high>>>31===1?!1:this.high===g.high&&this.low===g.low},m.eq=m.equals,m.notEquals=function(g){return!this.eq(g)},m.neq=m.notEquals,m.ne=m.notEquals,m.lessThan=function(g){return this.comp(g)<0},m.lt=m.lessThan,m.lessThanOrEqual=function(g){return this.comp(g)<=0},m.lte=m.lessThanOrEqual,m.le=m.lessThanOrEqual,m.greaterThan=function(g){return this.comp(g)>0},m.gt=m.greaterThan,m.greaterThanOrEqual=function(g){return this.comp(g)>=0},m.gte=m.greaterThanOrEqual,m.ge=m.greaterThanOrEqual,m.compare=function(g){if(r(g)||(g=h(g)),this.eq(g))return 0;var q=this.isNegative(),me=g.isNegative();return q&&!me?-1:!q&&me?1:this.unsigned?g.high>>>0>this.high>>>0||g.high===this.high&&g.low>>>0>this.low>>>0?-1:1:this.sub(g).isNegative()?-1:1},m.comp=m.compare,m.negate=function(){return!this.unsigned&&this.eq(v)?v:this.not().add(G)},m.neg=m.negate,m.add=function(g){r(g)||(g=h(g));var q=this.high>>>16,me=this.high&65535,Le=this.low>>>16,Ae=this.low&65535,Ze=g.high>>>16,Ne=g.high&65535,Bt=g.low>>>16,ot=g.low&65535,Qe=0,Rt=0,at=0,Vt=0;return Vt+=Ae+ot,at+=Vt>>>16,Vt&=65535,at+=Le+Bt,Rt+=at>>>16,at&=65535,Rt+=me+Ne,Qe+=Rt>>>16,Rt&=65535,Qe+=q+Ze,Qe&=65535,c(at<<16|Vt,Qe<<16|Rt,this.unsigned)},m.subtract=function(g){return r(g)||(g=h(g)),this.add(g.neg())},m.sub=m.subtract,m.multiply=function(g){if(this.isZero())return this;if(r(g)||(g=h(g)),e){var q=e.mul(this.low,this.high,g.low,g.high);return c(q,e.get_high(),this.unsigned)}if(g.isZero())return this.unsigned?F:O;if(this.eq(v))return g.isOdd()?v:O;if(g.eq(v))return this.isOdd()?v:O;if(this.isNegative())return g.isNegative()?this.neg().mul(g.neg()):this.neg().mul(g).neg();if(g.isNegative())return this.mul(g.neg()).neg();if(this.lt(D)&&g.lt(D))return l(this.toNumber()*g.toNumber(),this.unsigned);var me=this.high>>>16,Le=this.high&65535,Ae=this.low>>>16,Ze=this.low&65535,Ne=g.high>>>16,Bt=g.high&65535,ot=g.low>>>16,Qe=g.low&65535,Rt=0,at=0,Vt=0,na=0;return na+=Ze*Qe,Vt+=na>>>16,na&=65535,Vt+=Ae*Qe,at+=Vt>>>16,Vt&=65535,Vt+=Ze*ot,at+=Vt>>>16,Vt&=65535,at+=Le*Qe,Rt+=at>>>16,at&=65535,at+=Ae*ot,Rt+=at>>>16,at&=65535,at+=Ze*Bt,Rt+=at>>>16,at&=65535,Rt+=me*Qe+Le*ot+Ae*Bt+Ze*Ne,Rt&=65535,c(Vt<<16|na,Rt<<16|at,this.unsigned)},m.mul=m.multiply,m.divide=function(g){if(r(g)||(g=h(g)),g.isZero())throw Error("division by zero");if(e){if(!this.unsigned&&this.high===-2147483648&&g.low===-1&&g.high===-1)return this;var q=(this.unsigned?e.div_u:e.div_s)(this.low,this.high,g.low,g.high);return c(q,e.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?F:O;var me,Le,Ae;if(this.unsigned){if(g.unsigned||(g=g.toUnsigned()),g.gt(this))return F;if(g.gt(this.shru(1)))return J;Ae=F}else{if(this.eq(v)){if(g.eq(G)||g.eq(S))return v;if(g.eq(v))return G;var Ze=this.shr(1);return me=Ze.div(g).shl(1),me.eq(O)?g.isNegative()?G:S:(Le=this.sub(g.mul(me)),Ae=me.add(Le.div(g)),Ae)}else if(g.eq(v))return this.unsigned?F:O;if(this.isNegative())return g.isNegative()?this.neg().div(g.neg()):this.neg().div(g).neg();if(g.isNegative())return this.div(g.neg()).neg();Ae=O}for(Le=this;Le.gte(g);){me=Math.max(1,Math.floor(Le.toNumber()/g.toNumber()));for(var Ne=Math.ceil(Math.log(me)/Math.LN2),Bt=Ne<=48?1:u(2,Ne-48),ot=l(me),Qe=ot.mul(g);Qe.isNegative()||Qe.gt(Le);)me-=Bt,ot=l(me,this.unsigned),Qe=ot.mul(g);ot.isZero()&&(ot=G),Ae=Ae.add(ot),Le=Le.sub(Qe)}return Ae},m.div=m.divide,m.modulo=function(g){if(r(g)||(g=h(g)),e){var q=(this.unsigned?e.rem_u:e.rem_s)(this.low,this.high,g.low,g.high);return c(q,e.get_high(),this.unsigned)}return this.sub(this.div(g).mul(g))},m.mod=m.modulo,m.rem=m.modulo,m.not=function(){return c(~this.low,~this.high,this.unsigned)},m.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},m.clz=m.countLeadingZeros,m.countTrailingZeros=function(){return this.low?i(this.low):i(this.high)+32},m.ctz=m.countTrailingZeros,m.and=function(g){return r(g)||(g=h(g)),c(this.low&g.low,this.high&g.high,this.unsigned)},m.or=function(g){return r(g)||(g=h(g)),c(this.low|g.low,this.high|g.high,this.unsigned)},m.xor=function(g){return r(g)||(g=h(g)),c(this.low^g.low,this.high^g.high,this.unsigned)},m.shiftLeft=function(g){return r(g)&&(g=g.toInt()),(g&=63)===0?this:g<32?c(this.low<<g,this.high<<g|this.low>>>32-g,this.unsigned):c(0,this.low<<g-32,this.unsigned)},m.shl=m.shiftLeft,m.shiftRight=function(g){return r(g)&&(g=g.toInt()),(g&=63)===0?this:g<32?c(this.low>>>g|this.high<<32-g,this.high>>g,this.unsigned):c(this.high>>g-32,this.high>=0?0:-1,this.unsigned)},m.shr=m.shiftRight,m.shiftRightUnsigned=function(g){return r(g)&&(g=g.toInt()),(g&=63)===0?this:g<32?c(this.low>>>g|this.high<<32-g,this.high>>>g,this.unsigned):g===32?c(this.high,0,this.unsigned):c(this.high>>>g-32,0,this.unsigned)},m.shru=m.shiftRightUnsigned,m.shr_u=m.shiftRightUnsigned,m.rotateLeft=function(g){var q;return r(g)&&(g=g.toInt()),(g&=63)===0?this:g===32?c(this.high,this.low,this.unsigned):g<32?(q=32-g,c(this.low<<g|this.high>>>q,this.high<<g|this.low>>>q,this.unsigned)):(g-=32,q=32-g,c(this.high<<g|this.low>>>q,this.low<<g|this.high>>>q,this.unsigned))},m.rotl=m.rotateLeft,m.rotateRight=function(g){var q;return r(g)&&(g=g.toInt()),(g&=63)===0?this:g===32?c(this.high,this.low,this.unsigned):g<32?(q=32-g,c(this.high<<q|this.low>>>g,this.low<<q|this.high>>>g,this.unsigned)):(g-=32,q=32-g,c(this.low<<q|this.high>>>g,this.high<<q|this.low>>>g,this.unsigned))},m.rotr=m.rotateRight,m.toSigned=function(){return this.unsigned?c(this.low,this.high,!1):this},m.toUnsigned=function(){return this.unsigned?this:c(this.low,this.high,!0)},m.toBytes=function(g){return g?this.toBytesLE():this.toBytesBE()},m.toBytesLE=function(){var g=this.high,q=this.low;return[q&255,q>>>8&255,q>>>16&255,q>>>24,g&255,g>>>8&255,g>>>16&255,g>>>24]},m.toBytesBE=function(){var g=this.high,q=this.low;return[g>>>24,g>>>16&255,g>>>8&255,g&255,q>>>24,q>>>16&255,q>>>8&255,q&255]},t.fromBytes=function(g,q,me){return me?t.fromBytesLE(g,q):t.fromBytesBE(g,q)},t.fromBytesLE=function(g,q){return new t(g[0]|g[1]<<8|g[2]<<16|g[3]<<24,g[4]|g[5]<<8|g[6]<<16|g[7]<<24,q)},t.fromBytesBE=function(g,q){return new t(g[4]<<24|g[5]<<16|g[6]<<8|g[7],g[0]<<24|g[1]<<16|g[2]<<8|g[3],q)};var C=t;return n.default=C,"default"in n?n.default:n}({});typeof define=="function"&&define.amd?define([],function(){return eM}):typeof rw=="object"&&typeof tM=="object"&&(rw.exports=eM)});var aw=A(yt=>{"use strict";Object.defineProperty(yt,"__esModule",{value:!0});yt.loadFileDescriptorSetFromObject=yt.loadFileDescriptorSetFromBuffer=yt.fromJSON=yt.loadSync=yt.load=yt.IdempotencyLevel=yt.isAnyExtension=yt.Long=void 0;var yH=G1(),Mr=Qp(),sw=$P(),ow=ZP(),_H=nM();yt.Long=_H;function vH(n){return"@type"in n&&typeof n["@type"]=="string"}yt.isAnyExtension=vH;var sM;(function(n){n.IDEMPOTENCY_UNKNOWN="IDEMPOTENCY_UNKNOWN",n.NO_SIDE_EFFECTS="NO_SIDE_EFFECTS",n.IDEMPOTENT="IDEMPOTENT"})(sM=yt.IdempotencyLevel||(yt.IdempotencyLevel={}));var oM={longs:String,enums:String,bytes:String,defaults:!0,oneofs:!0,json:!0};function EH(n,e){return n===""?e:n+"."+e}function SH(n){return n instanceof Mr.Service||n instanceof Mr.Type||n instanceof Mr.Enum}function CH(n){return n instanceof Mr.Namespace||n instanceof Mr.Root}function aM(n,e){let t=EH(e,n.name);return SH(n)?[[t,n]]:CH(n)&&typeof n.nested<"u"?Object.keys(n.nested).map(r=>aM(n.nested[r],t)).reduce((r,i)=>r.concat(i),[]):[]}function rM(n,e){return function(r){return n.toObject(n.decode(r),e)}}function iM(n){return function(t){if(Array.isArray(t))throw new Error(`Failed to serialize message: expected object with ${n.name} structure, got array instead`);let r=n.fromObject(t);return n.encode(r).finish()}}function wH(n){return(n||[]).reduce((e,t)=>{for(let[r,i]of Object.entries(t))switch(r){case"uninterpreted_option":e.uninterpreted_option.push(t.uninterpreted_option);break;default:e[r]=i}return e},{deprecated:!1,idempotency_level:sM.IDEMPOTENCY_UNKNOWN,uninterpreted_option:[]})}function TH(n,e,t,r){let i=n.resolvedRequestType,s=n.resolvedResponseType;return{path:"/"+e+"/"+n.name,requestStream:!!n.requestStream,responseStream:!!n.responseStream,requestSerialize:iM(i),requestDeserialize:rM(i,t),responseSerialize:iM(s),responseDeserialize:rM(s,t),originalName:yH(n.name),requestType:iw(i,r),responseType:iw(s,r),options:wH(n.parsedOptions)}}function bH(n,e,t,r){let i={};for(let s of n.methodsArray)i[s.name]=TH(s,e,t,r);return i}function iw(n,e){let t=n.toDescriptor("proto3");return{format:"Protocol Buffer 3 DescriptorProto",type:t.$type.toObject(t,oM),fileDescriptorProtos:e}}function IH(n,e){let t=n.toDescriptor("proto3");return{format:"Protocol Buffer 3 EnumDescriptorProto",type:t.$type.toObject(t,oM),fileDescriptorProtos:e}}function AH(n,e,t,r){if(n instanceof Mr.Service)return bH(n,e,t,r);if(n instanceof Mr.Type)return iw(n,r);if(n instanceof Mr.Enum)return IH(n,r);throw new Error("Type mismatch in reflection object handling")}function Jp(n,e){let t={};n.resolveAll();let i=n.toDescriptor("proto3").file.map(s=>Buffer.from(sw.FileDescriptorProto.encode(s).finish()));for(let[s,o]of aM(n,""))t[s]=AH(o,s,e,i);return t}function lM(n,e){e=e||{};let t=Mr.Root.fromDescriptor(n);return t.resolveAll(),Jp(t,e)}function RH(n,e){return(0,ow.loadProtosWithOptions)(n,e).then(t=>Jp(t,e))}yt.load=RH;function DH(n,e){let t=(0,ow.loadProtosWithOptionsSync)(n,e);return Jp(t,e)}yt.loadSync=DH;function NH(n,e){e=e||{};let t=Mr.Root.fromJSON(n);return t.resolveAll(),Jp(t,e)}yt.fromJSON=NH;function kH(n,e){let t=sw.FileDescriptorSet.decode(n);return lM(t,e)}yt.loadFileDescriptorSetFromBuffer=kH;function OH(n,e){let t=sw.FileDescriptorSet.fromObject(n);return lM(t,e)}yt.loadFileDescriptorSetFromObject=OH;(0,ow.addCommonProtos)()});var Eo=A(ze=>{"use strict";Object.defineProperty(ze,"__esModule",{value:!0});ze.setup=ze.getChannelzServiceDefinition=ze.getChannelzHandlers=ze.unregisterChannelzRef=ze.registerChannelzSocket=ze.registerChannelzServer=ze.registerChannelzSubchannel=ze.registerChannelzChannel=ze.ChannelzCallTracker=ze.ChannelzChildrenTracker=ze.ChannelzTrace=void 0;var cM=X("net"),Xu=Dn(),Zu=we(),xH=Ir(),PH=vp(),MH=iC();function lw(n){return{channel_id:n.id,name:n.name}}function hw(n){return{subchannel_id:n.id,name:n.name}}function FH(n){return{server_id:n.id}}function em(n){return{socket_id:n.id,name:n.name}}var uM=32,cw=class{constructor(){this.events=[],this.eventsLogged=0,this.creationTimestamp=new Date}addTrace(e,t,r){let i=new Date;this.events.push({description:t,severity:e,timestamp:i,childChannel:r?.kind==="channel"?r:void 0,childSubchannel:r?.kind==="subchannel"?r:void 0}),this.events.length>=uM*2&&(this.events=this.events.slice(uM)),this.eventsLogged+=1}getTraceMessage(){return{creation_timestamp:ui(this.creationTimestamp),num_events_logged:this.eventsLogged,events:this.events.map(e=>({description:e.description,severity:e.severity,timestamp:ui(e.timestamp),channel_ref:e.childChannel?lw(e.childChannel):null,subchannel_ref:e.childSubchannel?hw(e.childSubchannel):null}))}}};ze.ChannelzTrace=cw;var uw=class{constructor(){this.channelChildren=new Map,this.subchannelChildren=new Map,this.socketChildren=new Map}refChild(e){var t,r,i;switch(e.kind){case"channel":{let s=(t=this.channelChildren.get(e.id))!==null&&t!==void 0?t:{ref:e,count:0};s.count+=1,this.channelChildren.set(e.id,s);break}case"subchannel":{let s=(r=this.subchannelChildren.get(e.id))!==null&&r!==void 0?r:{ref:e,count:0};s.count+=1,this.subchannelChildren.set(e.id,s);break}case"socket":{let s=(i=this.socketChildren.get(e.id))!==null&&i!==void 0?i:{ref:e,count:0};s.count+=1,this.socketChildren.set(e.id,s);break}}}unrefChild(e){switch(e.kind){case"channel":{let t=this.channelChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.channelChildren.delete(e.id):this.channelChildren.set(e.id,t));break}case"subchannel":{let t=this.subchannelChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.subchannelChildren.delete(e.id):this.subchannelChildren.set(e.id,t));break}case"socket":{let t=this.socketChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.socketChildren.delete(e.id):this.socketChildren.set(e.id,t));break}}}getChildLists(){let e=[];for(let{ref:i}of this.channelChildren.values())e.push(i);let t=[];for(let{ref:i}of this.subchannelChildren.values())t.push(i);let r=[];for(let{ref:i}of this.socketChildren.values())r.push(i);return{channels:e,subchannels:t,sockets:r}}};ze.ChannelzChildrenTracker=uw;var dw=class{constructor(){this.callsStarted=0,this.callsSucceeded=0,this.callsFailed=0,this.lastCallStartedTimestamp=null}addCallStarted(){this.callsStarted+=1,this.lastCallStartedTimestamp=new Date}addCallSucceeded(){this.callsSucceeded+=1}addCallFailed(){this.callsFailed+=1}};ze.ChannelzCallTracker=dw;var LH=1;function tm(){return LH++}var Ju=[],fw=[],os=[],pw=[];function BH(n,e,t){let r=tm(),i={id:r,name:n,kind:"channel"};return t&&(Ju[r]={ref:i,getInfo:e}),i}ze.registerChannelzChannel=BH;function VH(n,e,t){let r=tm(),i={id:r,name:n,kind:"subchannel"};return t&&(fw[r]={ref:i,getInfo:e}),i}ze.registerChannelzSubchannel=VH;function UH(n,e){let t=tm(),r={id:t,kind:"server"};return e&&(os[t]={ref:r,getInfo:n}),r}ze.registerChannelzServer=UH;function qH(n,e,t){let r=tm(),i={id:r,name:n,kind:"socket"};return t&&(pw[r]={ref:i,getInfo:e}),i}ze.registerChannelzSocket=qH;function zH(n){switch(n.kind){case"channel":delete Ju[n.id];return;case"subchannel":delete fw[n.id];return;case"server":delete os[n.id];return;case"socket":delete pw[n.id];return}}ze.unregisterChannelzRef=zH;function GH(n){let e=Number.parseInt(n,16);return[e/256|0,e%256]}function dM(n){if(n==="")return[];let e=n.split(":").map(r=>GH(r));return[].concat(...e)}function WH(n){if((0,cM.isIPv4)(n))return Buffer.from(Uint8Array.from(n.split(".").map(e=>Number.parseInt(e))));if((0,cM.isIPv6)(n)){let e,t,r=n.indexOf("::");r===-1?(e=n,t=""):(e=n.substring(0,r),t=n.substring(r+2));let i=Buffer.from(dM(e)),s=Buffer.from(dM(t)),o=Buffer.alloc(16-i.length-s.length,0);return Buffer.concat([i,o,s])}else return null}function fM(n){switch(n){case Xu.ConnectivityState.CONNECTING:return{state:"CONNECTING"};case Xu.ConnectivityState.IDLE:return{state:"IDLE"};case Xu.ConnectivityState.READY:return{state:"READY"};case Xu.ConnectivityState.SHUTDOWN:return{state:"SHUTDOWN"};case Xu.ConnectivityState.TRANSIENT_FAILURE:return{state:"TRANSIENT_FAILURE"};default:return{state:"UNKNOWN"}}}function ui(n){if(!n)return null;let e=n.getTime();return{seconds:e/1e3|0,nanos:e%1e3*1e6}}function pM(n){let e=n.getInfo();return{ref:lw(n.ref),data:{target:e.target,state:fM(e.state),calls_started:e.callTracker.callsStarted,calls_succeeded:e.callTracker.callsSucceeded,calls_failed:e.callTracker.callsFailed,last_call_started_timestamp:ui(e.callTracker.lastCallStartedTimestamp),trace:e.trace.getTraceMessage()},channel_ref:e.children.channels.map(t=>lw(t)),subchannel_ref:e.children.subchannels.map(t=>hw(t))}}function jH(n,e){let t=Number.parseInt(n.request.channel_id),r=Ju[t];if(r===void 0){e({code:Zu.Status.NOT_FOUND,details:"No channel data found for id "+t});return}e(null,{channel:pM(r)})}function $H(n,e){let t=Number.parseInt(n.request.max_results),r=[],i=Number.parseInt(n.request.start_channel_id);for(;i<Ju.length;i++){let s=Ju[i];if(s!==void 0&&(r.push(pM(s)),r.length>=t))break}e(null,{channel:r,end:i>=os.length})}function mM(n){let e=n.getInfo();return{ref:FH(n.ref),data:{calls_started:e.callTracker.callsStarted,calls_succeeded:e.callTracker.callsSucceeded,calls_failed:e.callTracker.callsFailed,last_call_started_timestamp:ui(e.callTracker.lastCallStartedTimestamp),trace:e.trace.getTraceMessage()},listen_socket:e.listenerChildren.sockets.map(t=>em(t))}}function HH(n,e){let t=Number.parseInt(n.request.server_id),r=os[t];if(r===void 0){e({code:Zu.Status.NOT_FOUND,details:"No server data found for id "+t});return}e(null,{server:mM(r)})}function KH(n,e){let t=Number.parseInt(n.request.max_results),r=[],i=Number.parseInt(n.request.start_server_id);for(;i<os.length;i++){let s=os[i];if(s!==void 0&&(r.push(mM(s)),r.length>=t))break}e(null,{server:r,end:i>=os.length})}function QH(n,e){let t=Number.parseInt(n.request.subchannel_id),r=fw[t];if(r===void 0){e({code:Zu.Status.NOT_FOUND,details:"No subchannel data found for id "+t});return}let i=r.getInfo(),s={ref:hw(r.ref),data:{target:i.target,state:fM(i.state),calls_started:i.callTracker.callsStarted,calls_succeeded:i.callTracker.callsSucceeded,calls_failed:i.callTracker.callsFailed,last_call_started_timestamp:ui(i.callTracker.lastCallStartedTimestamp),trace:i.trace.getTraceMessage()},socket_ref:i.children.sockets.map(o=>em(o))};e(null,{subchannel:s})}function hM(n){var e;return(0,xH.isTcpSubchannelAddress)(n)?{address:"tcpip_address",tcpip_address:{ip_address:(e=WH(n.host))!==null&&e!==void 0?e:void 0,port:n.port}}:{address:"uds_address",uds_address:{filename:n.path}}}function YH(n,e){var t,r,i,s,o;let a=Number.parseInt(n.request.socket_id),l=pw[a];if(l===void 0){e({code:Zu.Status.NOT_FOUND,details:"No socket data found for id "+a});return}let c=l.getInfo(),u=c.security?{model:"tls",tls:{cipher_suite:c.security.cipherSuiteStandardName?"standard_name":"other_name",standard_name:(t=c.security.cipherSuiteStandardName)!==null&&t!==void 0?t:void 0,other_name:(r=c.security.cipherSuiteOtherName)!==null&&r!==void 0?r:void 0,local_certificate:(i=c.security.localCertificate)!==null&&i!==void 0?i:void 0,remote_certificate:(s=c.security.remoteCertificate)!==null&&s!==void 0?s:void 0}}:null,d={ref:em(l.ref),local:c.localAddress?hM(c.localAddress):null,remote:c.remoteAddress?hM(c.remoteAddress):null,remote_name:(o=c.remoteName)!==null&&o!==void 0?o:void 0,security:u,data:{keep_alives_sent:c.keepAlivesSent,streams_started:c.streamsStarted,streams_succeeded:c.streamsSucceeded,streams_failed:c.streamsFailed,last_local_stream_created_timestamp:ui(c.lastLocalStreamCreatedTimestamp),last_remote_stream_created_timestamp:ui(c.lastRemoteStreamCreatedTimestamp),messages_received:c.messagesReceived,messages_sent:c.messagesSent,last_message_received_timestamp:ui(c.lastMessageReceivedTimestamp),last_message_sent_timestamp:ui(c.lastMessageSentTimestamp),local_flow_control_window:c.localFlowControlWindow?{value:c.localFlowControlWindow}:null,remote_flow_control_window:c.remoteFlowControlWindow?{value:c.remoteFlowControlWindow}:null}};e(null,{socket:d})}function XH(n,e){let t=Number.parseInt(n.request.server_id),r=os[t];if(r===void 0){e({code:Zu.Status.NOT_FOUND,details:"No server data found for id "+t});return}let i=Number.parseInt(n.request.start_socket_id),s=Number.parseInt(n.request.max_results),a=r.getInfo().sessionChildren.sockets.sort((u,d)=>u.id-d.id),l=[],c=0;for(;c<a.length&&!(a[c].id>=i&&(l.push(em(a[c])),l.length>=s));c++);e(null,{socket_ref:l,end:c>=a.length})}function gM(){return{GetChannel:jH,GetTopChannels:$H,GetServer:HH,GetServers:KH,GetSubchannel:QH,GetSocket:YH,GetServerSockets:XH}}ze.getChannelzHandlers=gM;var Zp=null;function yM(){if(Zp)return Zp;let n=aw().loadSync,e=n("channelz.proto",{keepCase:!0,longs:String,enums:String,defaults:!0,oneofs:!0,includeDirs:[`${__dirname}/../../proto`]});return Zp=(0,MH.loadPackageDefinition)(e).grpc.channelz.v1.Channelz.service,Zp}ze.getChannelzServiceDefinition=yM;function JH(){(0,PH.registerAdminService)(yM,gM)}ze.setup=JH});var _M=A(rm=>{"use strict";Object.defineProperty(rm,"__esModule",{value:!0});rm.Subchannel=void 0;var xe=Dn(),ZH=Ou(),mw=Xe(),nm=we(),e9=mn(),t9=Ir(),ol=Eo(),n9="subchannel",r9=~(1<<31),gw=class{constructor(e,t,r,i,s){var o;this.channelTarget=e,this.subchannelAddress=t,this.options=r,this.credentials=i,this.connector=s,this.connectivityState=xe.ConnectivityState.IDLE,this.transport=null,this.continueConnecting=!1,this.stateListeners=new Set,this.refcount=0,this.channelzEnabled=!0,this.callTracker=new ol.ChannelzCallTracker,this.childrenTracker=new ol.ChannelzChildrenTracker,this.streamTracker=new ol.ChannelzCallTracker;let a={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new ZH.BackoffTimeout(()=>{this.handleBackoffTimer()},a),this.backoffTimeout.unref(),this.subchannelAddressString=(0,t9.subchannelAddressToString)(t),this.keepaliveTime=(o=r["grpc.keepalive_time_ms"])!==null&&o!==void 0?o:-1,r["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzTrace=new ol.ChannelzTrace,this.channelzRef=(0,ol.registerChannelzSubchannel)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Subchannel created"),this.trace("Subchannel constructed with options "+JSON.stringify(r,void 0,2))}getChannelzInfo(){return{state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists(),target:this.subchannelAddressString}}trace(e){mw.trace(nm.LogVerbosity.DEBUG,n9,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}refTrace(e){mw.trace(nm.LogVerbosity.DEBUG,"subchannel_refcount","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}handleBackoffTimer(){this.continueConnecting?this.transitionToState([xe.ConnectivityState.TRANSIENT_FAILURE],xe.ConnectivityState.CONNECTING):this.transitionToState([xe.ConnectivityState.TRANSIENT_FAILURE],xe.ConnectivityState.IDLE)}startBackoff(){this.backoffTimeout.runOnce()}stopBackoff(){this.backoffTimeout.stop(),this.backoffTimeout.reset()}startConnectingInternal(){let e=this.options;if(e["grpc.keepalive_time_ms"]){let t=Math.min(this.keepaliveTime,r9);e=Object.assign(Object.assign({},e),{"grpc.keepalive_time_ms":t})}this.connector.connect(this.subchannelAddress,this.credentials,e).then(t=>{this.transitionToState([xe.ConnectivityState.CONNECTING],xe.ConnectivityState.READY)?(this.transport=t,this.channelzEnabled&&this.childrenTracker.refChild(t.getChannelzRef()),t.addDisconnectListener(r=>{this.transitionToState([xe.ConnectivityState.READY],xe.ConnectivityState.IDLE),r&&this.keepaliveTime>0&&(this.keepaliveTime*=2,mw.log(nm.LogVerbosity.ERROR,`Connection to ${(0,e9.uriToString)(this.channelTarget)} at ${this.subchannelAddressString} rejected by server because of excess pings. Increasing ping interval to ${this.keepaliveTime} ms`))})):t.shutdown()},t=>{this.transitionToState([xe.ConnectivityState.CONNECTING],xe.ConnectivityState.TRANSIENT_FAILURE,`${t}`)})}transitionToState(e,t,r){var i,s;if(e.indexOf(this.connectivityState)===-1)return!1;this.trace(xe.ConnectivityState[this.connectivityState]+" -> "+xe.ConnectivityState[t]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+xe.ConnectivityState[t]);let o=this.connectivityState;switch(this.connectivityState=t,t){case xe.ConnectivityState.READY:this.stopBackoff();break;case xe.ConnectivityState.CONNECTING:this.startBackoff(),this.startConnectingInternal(),this.continueConnecting=!1;break;case xe.ConnectivityState.TRANSIENT_FAILURE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),(i=this.transport)===null||i===void 0||i.shutdown(),this.transport=null,this.backoffTimeout.isRunning()||process.nextTick(()=>{this.handleBackoffTimer()});break;case xe.ConnectivityState.IDLE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),(s=this.transport)===null||s===void 0||s.shutdown(),this.transport=null;break;default:throw new Error(`Invalid state: unknown ConnectivityState ${t}`)}for(let a of this.stateListeners)a(this,o,t,this.keepaliveTime,r);return!0}ref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount+1)),this.refcount+=1}unref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount-1)),this.refcount-=1,this.refcount===0&&(this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Shutting down"),this.channelzEnabled&&(0,ol.unregisterChannelzRef)(this.channelzRef),process.nextTick(()=>{this.transitionToState([xe.ConnectivityState.CONNECTING,xe.ConnectivityState.READY],xe.ConnectivityState.IDLE)}))}unrefIfOneRef(){return this.refcount===1?(this.unref(),!0):!1}createCall(e,t,r,i){if(!this.transport)throw new Error("Cannot create call, subchannel not READY");let s;return this.channelzEnabled?(this.callTracker.addCallStarted(),this.streamTracker.addCallStarted(),s={onCallEnd:o=>{o.code===nm.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}}):s={},this.transport.createCall(e,t,r,i,s)}startConnecting(){process.nextTick(()=>{this.transitionToState([xe.ConnectivityState.IDLE],xe.ConnectivityState.CONNECTING)||this.connectivityState===xe.ConnectivityState.TRANSIENT_FAILURE&&(this.continueConnecting=!0)})}getConnectivityState(){return this.connectivityState}addConnectivityStateListener(e){this.stateListeners.add(e)}removeConnectivityStateListener(e){this.stateListeners.delete(e)}resetBackoff(){process.nextTick(()=>{this.backoffTimeout.reset(),this.transitionToState([xe.ConnectivityState.TRANSIENT_FAILURE],xe.ConnectivityState.CONNECTING)})}getAddress(){return this.subchannelAddressString}getChannelzRef(){return this.channelzRef}getRealSubchannel(){return this}realSubchannelEquals(e){return e.getRealSubchannel()===this}throttleKeepalive(e){e>this.keepaliveTime&&(this.keepaliveTime=e)}};rm.Subchannel=gw});var Ew=A(cs=>{"use strict";Object.defineProperty(cs,"__esModule",{value:!0});cs.setup=cs.DEFAULT_PORT=void 0;var vM=Tr(),SM=X("dns"),CM=X("util"),i9=kS(),yw=we(),_w=tn(),s9=Xe(),o9=we(),as=mn(),EM=X("net"),a9=Ou(),l9="dns_resolver";function ls(n){s9.trace(o9.LogVerbosity.DEBUG,l9,n)}cs.DEFAULT_PORT=443;var c9=3e4,u9=CM.promisify(SM.resolveTxt),d9=CM.promisify(SM.lookup);function h9(...n){let e=[];for(let t=0;t<Math.max.apply(null,n.map(r=>r.length));t++)for(let r of n)t<r.length&&e.push(r[t]);return e}var vw=class{constructor(e,t,r){var i,s,o;this.target=e,this.listener=t,this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.continueResolving=!1,this.isNextResolutionTimerRunning=!1,this.isServiceConfigEnabled=!0,this.returnedIpResult=!1,ls("Resolver constructed for target "+(0,as.uriToString)(e));let a=(0,as.splitHostPort)(e.path);a===null?(this.ipResult=null,this.dnsHostname=null,this.port=null):(0,EM.isIPv4)(a.host)||(0,EM.isIPv6)(a.host)?(this.ipResult=[{host:a.host,port:(i=a.port)!==null&&i!==void 0?i:cs.DEFAULT_PORT}],this.dnsHostname=null,this.port=null):(this.ipResult=null,this.dnsHostname=a.host,this.port=(s=a.port)!==null&&s!==void 0?s:cs.DEFAULT_PORT),this.percentage=Math.random()*100,r["grpc.service_config_disable_resolution"]===1&&(this.isServiceConfigEnabled=!1),this.defaultResolutionError={code:yw.Status.UNAVAILABLE,details:`Name resolution failed for target ${(0,as.uriToString)(this.target)}`,metadata:new _w.Metadata};let l={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoff=new a9.BackoffTimeout(()=>{this.continueResolving&&this.startResolutionWithBackoff()},l),this.backoff.unref(),this.minTimeBetweenResolutionsMs=(o=r["grpc.dns_min_time_between_resolutions_ms"])!==null&&o!==void 0?o:c9,this.nextResolutionTimer=setTimeout(()=>{},0),clearTimeout(this.nextResolutionTimer)}startResolution(){if(this.ipResult!==null){this.returnedIpResult||(ls("Returning IP address for target "+(0,as.uriToString)(this.target)),setImmediate(()=>{this.listener.onSuccessfulResolution(this.ipResult,null,null,null,{})}),this.returnedIpResult=!0),this.backoff.stop(),this.backoff.reset(),this.stopNextResolutionTimer();return}if(this.dnsHostname===null)ls("Failed to parse DNS address "+(0,as.uriToString)(this.target)),setImmediate(()=>{this.listener.onError({code:yw.Status.UNAVAILABLE,details:`Failed to parse DNS address ${(0,as.uriToString)(this.target)}`,metadata:new _w.Metadata})}),this.stopNextResolutionTimer();else{if(this.pendingLookupPromise!==null)return;ls("Looking up DNS hostname "+this.dnsHostname),this.latestLookupResult=null;let e=this.dnsHostname;this.pendingLookupPromise=d9(e,{all:!0}),this.pendingLookupPromise.then(t=>{if(this.pendingLookupPromise===null)return;this.pendingLookupPromise=null,this.backoff.reset(),this.backoff.stop();let r=t.filter(o=>o.family===4),i=t.filter(o=>o.family===6);this.latestLookupResult=h9(i,r).map(o=>({host:o.address,port:+this.port}));let s="["+this.latestLookupResult.map(o=>o.host+":"+o.port).join(",")+"]";if(ls("Resolved addresses for target "+(0,as.uriToString)(this.target)+": "+s),this.latestLookupResult.length===0){this.listener.onError(this.defaultResolutionError);return}this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})},t=>{this.pendingLookupPromise!==null&&(ls("Resolution error for target "+(0,as.uriToString)(this.target)+": "+t.message),this.pendingLookupPromise=null,this.stopNextResolutionTimer(),this.listener.onError(this.defaultResolutionError))}),this.isServiceConfigEnabled&&this.pendingTxtPromise===null&&(this.pendingTxtPromise=u9(e),this.pendingTxtPromise.then(t=>{if(this.pendingTxtPromise!==null){this.pendingTxtPromise=null;try{this.latestServiceConfig=(0,i9.extractAndSelectServiceConfig)(t,this.percentage)}catch(r){this.latestServiceConfigError={code:yw.Status.UNAVAILABLE,details:`Parsing service config failed with error ${r.message}`,metadata:new _w.Metadata}}this.latestLookupResult!==null&&this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})}},t=>{}))}}startNextResolutionTimer(){var e,t;clearTimeout(this.nextResolutionTimer),this.nextResolutionTimer=(t=(e=setTimeout(()=>{this.stopNextResolutionTimer(),this.continueResolving&&this.startResolutionWithBackoff()},this.minTimeBetweenResolutionsMs)).unref)===null||t===void 0?void 0:t.call(e),this.isNextResolutionTimerRunning=!0}stopNextResolutionTimer(){clearTimeout(this.nextResolutionTimer),this.isNextResolutionTimerRunning=!1}startResolutionWithBackoff(){this.pendingLookupPromise===null&&(this.continueResolving=!1,this.backoff.runOnce(),this.startNextResolutionTimer(),this.startResolution())}updateResolution(){this.pendingLookupPromise===null&&(this.isNextResolutionTimerRunning||this.backoff.isRunning()?(this.isNextResolutionTimerRunning?ls('resolution update delayed by "min time between resolutions" rate limit'):ls("resolution update delayed by backoff timer until "+this.backoff.getEndTime().toISOString()),this.continueResolving=!0):this.startResolutionWithBackoff())}destroy(){this.continueResolving=!1,this.backoff.reset(),this.backoff.stop(),this.stopNextResolutionTimer(),this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.returnedIpResult=!1}static getDefaultAuthority(e){return e.path}};function f9(){(0,vM.registerResolver)("dns",vw),(0,vM.registerDefaultScheme)("dns")}cs.setup=f9});var Sw=A(cl=>{"use strict";Object.defineProperty(cl,"__esModule",{value:!0});cl.getProxiedConnection=cl.mapProxyName=void 0;var ed=Xe(),al=we(),p9=Tr(),m9=X("http"),g9=X("tls"),y9=Xe(),wM=Ir(),ll=mn(),_9=X("url"),v9=Ew(),E9="proxy";function us(n){y9.trace(al.LogVerbosity.DEBUG,E9,n)}function S9(){let n="",e="";if(process.env.grpc_proxy)e="grpc_proxy",n=process.env.grpc_proxy;else if(process.env.https_proxy)e="https_proxy",n=process.env.https_proxy;else if(process.env.http_proxy)e="http_proxy",n=process.env.http_proxy;else return{};let t;try{t=new _9.URL(n)}catch{return(0,ed.log)(al.LogVerbosity.ERROR,`cannot parse value of "${e}" env var`),{}}if(t.protocol!=="http:")return(0,ed.log)(al.LogVerbosity.ERROR,`"${t.protocol}" scheme not supported in proxy URI`),{};let r=null;t.username&&(t.password?((0,ed.log)(al.LogVerbosity.INFO,"userinfo found in proxy URI"),r=`${t.username}:${t.password}`):r=t.username);let i=t.hostname,s=t.port;s===""&&(s="80");let o={address:`${i}:${s}`};return r&&(o.creds=r),us("Proxy server "+o.address+" set by environment variable "+e),o}function C9(){let n=process.env.no_grpc_proxy,e="no_grpc_proxy";return n||(n=process.env.no_proxy,e="no_proxy"),n?(us("No proxy server list set by environment variable "+e),n.split(",")):[]}function w9(n,e){var t;let r={target:n,extraOptions:{}};if(((t=e["grpc.enable_http_proxy"])!==null&&t!==void 0?t:1)===0||n.scheme==="unix")return r;let i=S9();if(!i.address)return r;let s=(0,ll.splitHostPort)(n.path);if(!s)return r;let o=s.host;for(let l of C9())if(l===o)return us("Not using proxy for target in no_proxy list: "+(0,ll.uriToString)(n)),r;let a={"grpc.http_connect_target":(0,ll.uriToString)(n)};return i.creds&&(a["grpc.http_connect_creds"]=i.creds),{target:{scheme:"dns",path:i.address},extraOptions:a}}cl.mapProxyName=w9;function T9(n,e,t){var r;if(!("grpc.http_connect_target"in e))return Promise.resolve({});let i=e["grpc.http_connect_target"],s=(0,ll.parseUri)(i);if(s===null)return Promise.resolve({});let o=(0,ll.splitHostPort)(s.path);if(o===null)return Promise.resolve({});let a=`${o.host}:${(r=o.port)!==null&&r!==void 0?r:v9.DEFAULT_PORT}`,l={method:"CONNECT",path:a},c={Host:a};(0,wM.isTcpSubchannelAddress)(n)?(l.host=n.host,l.port=n.port):l.socketPath=n.path,"grpc.http_connect_creds"in e&&(c["Proxy-Authorization"]="Basic "+Buffer.from(e["grpc.http_connect_creds"]).toString("base64")),l.headers=c;let u=(0,wM.subchannelAddressToString)(n);return us("Using proxy "+u+" to connect to "+l.path),new Promise((d,h)=>{let p=m9.request(l);p.once("connect",(E,w,b)=>{var N;if(p.removeAllListeners(),w.removeAllListeners(),E.statusCode===200)if(us("Successfully connected to "+l.path+" through proxy "+u),"secureContext"in t){let D=(0,p9.getDefaultAuthority)(s),O=(0,ll.splitHostPort)(D),F=(N=O?.host)!==null&&N!==void 0?N:D,G=g9.connect(Object.assign({host:F,servername:F,socket:w},t),()=>{us("Successfully established a TLS connection to "+l.path+" through proxy "+u),d({socket:G,realTarget:s})});G.on("error",J=>{us("Failed to establish a TLS connection to "+l.path+" through proxy "+u+" with error "+J.message),h()})}else us("Successfully established a plaintext connection to "+l.path+" through proxy "+u),d({socket:w,realTarget:s});else(0,ed.log)(al.LogVerbosity.ERROR,"Failed to connect to "+l.path+" through proxy "+u+" with status "+E.statusCode),h()}),p.once("error",E=>{p.removeAllListeners(),(0,ed.log)(al.LogVerbosity.ERROR,"Failed to connect to proxy "+u+" with error "+E.message),h()}),p.end()})}cl.getProxiedConnection=T9});var ww=A(im=>{"use strict";Object.defineProperty(im,"__esModule",{value:!0});im.StreamDecoder=void 0;var di=function(n){return n[n.NO_DATA=0]="NO_DATA",n[n.READING_SIZE=1]="READING_SIZE",n[n.READING_MESSAGE=2]="READING_MESSAGE",n}(di||{}),Cw=class{constructor(e){this.maxReadMessageLength=e,this.readState=di.NO_DATA,this.readCompressFlag=Buffer.alloc(1),this.readPartialSize=Buffer.alloc(4),this.readSizeRemaining=4,this.readMessageSize=0,this.readPartialMessage=[],this.readMessageRemaining=0}write(e){let t=0,r,i=[];for(;t<e.length;)switch(this.readState){case di.NO_DATA:this.readCompressFlag=e.slice(t,t+1),t+=1,this.readState=di.READING_SIZE,this.readPartialSize.fill(0),this.readSizeRemaining=4,this.readMessageSize=0,this.readMessageRemaining=0,this.readPartialMessage=[];break;case di.READING_SIZE:if(r=Math.min(e.length-t,this.readSizeRemaining),e.copy(this.readPartialSize,4-this.readSizeRemaining,t,t+r),this.readSizeRemaining-=r,t+=r,this.readSizeRemaining===0){if(this.readMessageSize=this.readPartialSize.readUInt32BE(0),this.maxReadMessageLength!==-1&&this.readMessageSize>this.maxReadMessageLength)throw new Error(`Received message larger than max (${this.readMessageSize} vs ${this.maxReadMessageLength})`);if(this.readMessageRemaining=this.readMessageSize,this.readMessageRemaining>0)this.readState=di.READING_MESSAGE;else{let s=Buffer.concat([this.readCompressFlag,this.readPartialSize],5);this.readState=di.NO_DATA,i.push(s)}}break;case di.READING_MESSAGE:if(r=Math.min(e.length-t,this.readMessageRemaining),this.readPartialMessage.push(e.slice(t,t+r)),this.readMessageRemaining-=r,t+=r,this.readMessageRemaining===0){let s=[this.readCompressFlag,this.readPartialSize].concat(this.readPartialMessage),o=Buffer.concat(s,this.readMessageSize+5);this.readState=di.NO_DATA,i.push(o)}break;default:throw new Error("Unexpected read state")}return i}};im.StreamDecoder=Cw});var TM=A(sm=>{"use strict";Object.defineProperty(sm,"__esModule",{value:!0});sm.Http2SubchannelCall=void 0;var hi=X("http2"),b9=X("os"),be=we(),ds=tn(),I9=ww(),A9=Xe(),R9=we(),D9="subchannel_call";function N9(n){for(let[e,t]of Object.entries(b9.constants.errno))if(t===n)return e;return"Unknown system error "+n}var Tw=class{constructor(e,t,r,i,s){var o;this.http2Stream=e,this.callEventTracker=t,this.listener=r,this.transport=i,this.callId=s,this.isReadFilterPending=!1,this.isPushPending=!1,this.canPush=!1,this.readsClosed=!1,this.statusOutput=!1,this.unpushedReadMessages=[],this.mappedStatusCode=be.Status.UNKNOWN,this.finalStatus=null,this.internalError=null;let a=(o=i.getOptions()["grpc.max_receive_message_length"])!==null&&o!==void 0?o:be.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH;this.decoder=new I9.StreamDecoder(a),e.on("response",(l,c)=>{let u="";for(let d of Object.keys(l))u+="		"+d+": "+l[d]+`
`;switch(this.trace(`Received server headers:
`+u),l[":status"]){case 400:this.mappedStatusCode=be.Status.INTERNAL;break;case 401:this.mappedStatusCode=be.Status.UNAUTHENTICATED;break;case 403:this.mappedStatusCode=be.Status.PERMISSION_DENIED;break;case 404:this.mappedStatusCode=be.Status.UNIMPLEMENTED;break;case 429:case 502:case 503:case 504:this.mappedStatusCode=be.Status.UNAVAILABLE;break;default:this.mappedStatusCode=be.Status.UNKNOWN}if(c&hi.constants.NGHTTP2_FLAG_END_STREAM)this.handleTrailers(l);else{let d;try{d=ds.Metadata.fromHttp2Headers(l)}catch(h){this.endCall({code:be.Status.UNKNOWN,details:h.message,metadata:new ds.Metadata});return}this.listener.onReceiveMetadata(d)}}),e.on("trailers",l=>{this.handleTrailers(l)}),e.on("data",l=>{if(this.statusOutput)return;this.trace("receive HTTP/2 data frame of length "+l.length);let c;try{c=this.decoder.write(l)}catch(u){this.cancelWithStatus(be.Status.RESOURCE_EXHAUSTED,u.message);return}for(let u of c)this.trace("parsed message of length "+u.length),this.callEventTracker.addMessageReceived(),this.tryPush(u)}),e.on("end",()=>{this.readsClosed=!0,this.maybeOutputStatus()}),e.on("close",()=>{process.nextTick(()=>{var l;if(this.trace("HTTP/2 stream closed with code "+e.rstCode),((l=this.finalStatus)===null||l===void 0?void 0:l.code)===be.Status.OK)return;let c,u="";switch(e.rstCode){case hi.constants.NGHTTP2_NO_ERROR:if(this.finalStatus!==null)return;c=be.Status.INTERNAL,u=`Received RST_STREAM with code ${e.rstCode}`;break;case hi.constants.NGHTTP2_REFUSED_STREAM:c=be.Status.UNAVAILABLE,u="Stream refused by server";break;case hi.constants.NGHTTP2_CANCEL:c=be.Status.CANCELLED,u="Call cancelled";break;case hi.constants.NGHTTP2_ENHANCE_YOUR_CALM:c=be.Status.RESOURCE_EXHAUSTED,u="Bandwidth exhausted or memory limit exceeded";break;case hi.constants.NGHTTP2_INADEQUATE_SECURITY:c=be.Status.PERMISSION_DENIED,u="Protocol not secure enough";break;case hi.constants.NGHTTP2_INTERNAL_ERROR:c=be.Status.INTERNAL,this.internalError===null?u=`Received RST_STREAM with code ${e.rstCode} (Internal server error)`:this.internalError.code==="ECONNRESET"||this.internalError.code==="ETIMEDOUT"?(c=be.Status.UNAVAILABLE,u=this.internalError.message):u=`Received RST_STREAM with code ${e.rstCode} triggered by internal client error: ${this.internalError.message}`;break;default:c=be.Status.INTERNAL,u=`Received RST_STREAM with code ${e.rstCode}`}this.endCall({code:c,details:u,metadata:new ds.Metadata,rstCode:e.rstCode})})}),e.on("error",l=>{l.code!=="ERR_HTTP2_STREAM_ERROR"&&(this.trace("Node error event: message="+l.message+" code="+l.code+" errno="+N9(l.errno)+" syscall="+l.syscall),this.internalError=l),this.callEventTracker.onStreamEnd(!1)})}onDisconnect(){this.endCall({code:be.Status.UNAVAILABLE,details:"Connection dropped",metadata:new ds.Metadata})}outputStatus(){this.statusOutput||(this.statusOutput=!0,this.trace("ended with status: code="+this.finalStatus.code+' details="'+this.finalStatus.details+'"'),this.callEventTracker.onCallEnd(this.finalStatus),process.nextTick(()=>{this.listener.onReceiveStatus(this.finalStatus)}),this.http2Stream.resume())}trace(e){A9.trace(R9.LogVerbosity.DEBUG,D9,"["+this.callId+"] "+e)}endCall(e){(this.finalStatus===null||this.finalStatus.code===be.Status.OK)&&(this.finalStatus=e,this.maybeOutputStatus()),this.destroyHttp2Stream()}maybeOutputStatus(){this.finalStatus!==null&&(this.finalStatus.code!==be.Status.OK||this.readsClosed&&this.unpushedReadMessages.length===0&&!this.isReadFilterPending&&!this.isPushPending)&&this.outputStatus()}push(e){this.trace("pushing to reader message of length "+(e instanceof Buffer?e.length:null)),this.canPush=!1,this.isPushPending=!0,process.nextTick(()=>{this.isPushPending=!1,!this.statusOutput&&(this.listener.onReceiveMessage(e),this.maybeOutputStatus())})}tryPush(e){this.canPush?(this.http2Stream.pause(),this.push(e)):(this.trace("unpushedReadMessages.push message of length "+e.length),this.unpushedReadMessages.push(e))}handleTrailers(e){this.callEventTracker.onStreamEnd(!0);let t="";for(let l of Object.keys(e))t+="		"+l+": "+e[l]+`
`;this.trace(`Received server trailers:
`+t);let r;try{r=ds.Metadata.fromHttp2Headers(e)}catch{r=new ds.Metadata}let i=r.getMap(),s=this.mappedStatusCode;if(s===be.Status.UNKNOWN&&typeof i["grpc-status"]=="string"){let l=Number(i["grpc-status"]);l in be.Status&&(s=l,this.trace("received status code "+l+" from server")),r.remove("grpc-status")}let o="";if(typeof i["grpc-message"]=="string"){try{o=decodeURI(i["grpc-message"])}catch{o=i["grpc-message"]}r.remove("grpc-message"),this.trace('received status details string "'+o+'" from server')}let a={code:s,details:o,metadata:r};this.endCall(a)}destroyHttp2Stream(){var e;if(!this.http2Stream.destroyed){let t;((e=this.finalStatus)===null||e===void 0?void 0:e.code)===be.Status.OK?t=hi.constants.NGHTTP2_NO_ERROR:t=hi.constants.NGHTTP2_CANCEL,this.trace("close http2 stream with code "+t),this.http2Stream.close(t)}}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.endCall({code:e,details:t,metadata:new ds.Metadata})}getStatus(){return this.finalStatus}getPeer(){return this.transport.getPeerName()}getCallNumber(){return this.callId}startRead(){if(this.finalStatus!==null&&this.finalStatus.code!==be.Status.OK){this.readsClosed=!0,this.maybeOutputStatus();return}if(this.canPush=!0,this.unpushedReadMessages.length>0){let e=this.unpushedReadMessages.shift();this.push(e);return}this.http2Stream.resume()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length);let r=i=>{process.nextTick(()=>{var s;let o=be.Status.UNAVAILABLE;i?.code==="ERR_STREAM_WRITE_AFTER_END"&&(o=be.Status.INTERNAL),i&&this.cancelWithStatus(o,`Write error: ${i.message}`),(s=e.callback)===null||s===void 0||s.call(e)})};this.trace("sending data chunk of length "+t.length),this.callEventTracker.addMessageSent();try{this.http2Stream.write(t,r)}catch(i){this.endCall({code:be.Status.UNAVAILABLE,details:`Write failed with error ${i.message}`,metadata:new ds.Metadata})}}halfClose(){this.trace("end() called"),this.trace("calling end() on HTTP/2 stream"),this.http2Stream.end()}};sm.Http2SubchannelCall=Tw});var bw=A(om=>{"use strict";Object.defineProperty(om,"__esModule",{value:!0});om.getNextCallNumber=void 0;var k9=0;function O9(){return k9++}om.getNextCallNumber=O9});var AM=A(lm=>{"use strict";Object.defineProperty(lm,"__esModule",{value:!0});lm.Http2SubchannelConnector=void 0;var Nw=X("http2"),bM=X("tls"),Iw=Eo(),td=we(),x9=Sw(),dl=Xe(),IM=Tr(),am=Ir(),ul=mn(),P9=X("net"),M9=TM(),F9=bw(),Aw="transport",L9="transport_flowctrl",B9=fS().version,{HTTP2_HEADER_AUTHORITY:V9,HTTP2_HEADER_CONTENT_TYPE:U9,HTTP2_HEADER_METHOD:q9,HTTP2_HEADER_PATH:z9,HTTP2_HEADER_TE:G9,HTTP2_HEADER_USER_AGENT:W9}=Nw.constants,j9=2e4,$9=Buffer.from("too_many_pings","ascii"),Rw=class{constructor(e,t,r,i){this.session=e,this.options=r,this.remoteName=i,this.keepaliveTimeMs=-1,this.keepaliveTimeoutMs=j9,this.keepaliveTimerId=null,this.pendingSendKeepalivePing=!1,this.keepaliveTimeoutId=null,this.keepaliveWithoutCalls=!1,this.activeCalls=new Set,this.disconnectListeners=[],this.disconnectHandled=!1,this.channelzEnabled=!0,this.streamTracker=new Iw.ChannelzCallTracker,this.keepalivesSent=0,this.messagesSent=0,this.messagesReceived=0,this.lastMessageSentTimestamp=null,this.lastMessageReceivedTimestamp=null,this.subchannelAddressString=(0,am.subchannelAddressToString)(t),r["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzRef=(0,Iw.registerChannelzSocket)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.userAgent=[r["grpc.primary_user_agent"],`grpc-node-js/${B9}`,r["grpc.secondary_user_agent"]].filter(s=>s).join(" "),"grpc.keepalive_time_ms"in r&&(this.keepaliveTimeMs=r["grpc.keepalive_time_ms"]),"grpc.keepalive_timeout_ms"in r&&(this.keepaliveTimeoutMs=r["grpc.keepalive_timeout_ms"]),"grpc.keepalive_permit_without_calls"in r?this.keepaliveWithoutCalls=r["grpc.keepalive_permit_without_calls"]===1:this.keepaliveWithoutCalls=!1,e.once("close",()=>{this.trace("session closed"),this.stopKeepalivePings(),this.handleDisconnect()}),e.once("goaway",(s,o,a)=>{let l=!1;s===Nw.constants.NGHTTP2_ENHANCE_YOUR_CALM&&a&&a.equals($9)&&(l=!0),this.trace("connection closed by GOAWAY with code "+s+" and data "+a?.toString()),this.reportDisconnectToOwner(l)}),e.once("error",s=>{this.trace("connection closed with error "+s.message)}),dl.isTracerEnabled(Aw)&&(e.on("remoteSettings",s=>{this.trace("new settings received"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(s))}),e.on("localSettings",s=>{this.trace("local settings acknowledged by remote"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(s))})),this.keepaliveWithoutCalls&&this.maybeStartKeepalivePingTimer()}getChannelzInfo(){var e,t,r;let i=this.session.socket,s=i.remoteAddress?(0,am.stringToSubchannelAddress)(i.remoteAddress,i.remotePort):null,o=i.localAddress?(0,am.stringToSubchannelAddress)(i.localAddress,i.localPort):null,a;if(this.session.encrypted){let c=i,u=c.getCipher(),d=c.getCertificate(),h=c.getPeerCertificate();a={cipherSuiteStandardName:(e=u.standardName)!==null&&e!==void 0?e:null,cipherSuiteOtherName:u.standardName?null:u.name,localCertificate:d&&"raw"in d?d.raw:null,remoteCertificate:h&&"raw"in h?h.raw:null}}else a=null;return{remoteAddress:s,localAddress:o,security:a,remoteName:this.remoteName,streamsStarted:this.streamTracker.callsStarted,streamsSucceeded:this.streamTracker.callsSucceeded,streamsFailed:this.streamTracker.callsFailed,messagesSent:this.messagesSent,messagesReceived:this.messagesReceived,keepAlivesSent:this.keepalivesSent,lastLocalStreamCreatedTimestamp:this.streamTracker.lastCallStartedTimestamp,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:this.lastMessageSentTimestamp,lastMessageReceivedTimestamp:this.lastMessageReceivedTimestamp,localFlowControlWindow:(t=this.session.state.localWindowSize)!==null&&t!==void 0?t:null,remoteFlowControlWindow:(r=this.session.state.remoteWindowSize)!==null&&r!==void 0?r:null}}trace(e){dl.trace(td.LogVerbosity.DEBUG,Aw,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}keepaliveTrace(e){dl.trace(td.LogVerbosity.DEBUG,"keepalive","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}flowControlTrace(e){dl.trace(td.LogVerbosity.DEBUG,L9,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}internalsTrace(e){dl.trace(td.LogVerbosity.DEBUG,"transport_internals","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}reportDisconnectToOwner(e){this.disconnectHandled||(this.disconnectHandled=!0,this.disconnectListeners.forEach(t=>t(e)))}handleDisconnect(){this.reportDisconnectToOwner(!1),setImmediate(()=>{for(let e of this.activeCalls)e.onDisconnect()})}addDisconnectListener(e){this.disconnectListeners.push(e)}clearKeepaliveTimer(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null)}clearKeepaliveTimeout(){this.keepaliveTimeoutId&&(clearTimeout(this.keepaliveTimeoutId),this.keepaliveTimeoutId=null)}canSendPing(){return this.keepaliveTimeMs>0&&(this.keepaliveWithoutCalls||this.activeCalls.size>0)}maybeSendPing(){var e,t;if(this.clearKeepaliveTimer(),!this.canSendPing()){this.pendingSendKeepalivePing=!0;return}this.channelzEnabled&&(this.keepalivesSent+=1),this.keepaliveTrace("Sending ping with timeout "+this.keepaliveTimeoutMs+"ms"),this.keepaliveTimeoutId||(this.keepaliveTimeoutId=setTimeout(()=>{this.keepaliveTrace("Ping timeout passed without response"),this.handleDisconnect()},this.keepaliveTimeoutMs),(t=(e=this.keepaliveTimeoutId).unref)===null||t===void 0||t.call(e));try{this.session.ping((r,i,s)=>{r&&(this.keepaliveTrace("Ping failed with error "+r.message),this.handleDisconnect()),this.keepaliveTrace("Received ping response"),this.clearKeepaliveTimeout(),this.maybeStartKeepalivePingTimer()})}catch{this.handleDisconnect()}}maybeStartKeepalivePingTimer(){var e,t;this.canSendPing()&&(this.pendingSendKeepalivePing?(this.pendingSendKeepalivePing=!1,this.maybeSendPing()):!this.keepaliveTimerId&&!this.keepaliveTimeoutId&&(this.keepaliveTrace("Starting keepalive timer for "+this.keepaliveTimeMs+"ms"),this.keepaliveTimerId=(t=(e=setTimeout(()=>{this.maybeSendPing()},this.keepaliveTimeMs)).unref)===null||t===void 0?void 0:t.call(e)))}stopKeepalivePings(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null),this.clearKeepaliveTimeout()}removeActiveCall(e){this.activeCalls.delete(e),this.activeCalls.size===0&&this.session.unref()}addActiveCall(e){this.activeCalls.add(e),this.activeCalls.size===1&&(this.session.ref(),this.keepaliveWithoutCalls||this.maybeStartKeepalivePingTimer())}createCall(e,t,r,i,s){let o=e.toHttp2Headers();o[V9]=t,o[W9]=this.userAgent,o[U9]="application/grpc",o[q9]="POST",o[z9]=r,o[G9]="trailers";let a;try{a=this.session.request(o)}catch(u){throw this.handleDisconnect(),u}this.flowControlTrace("local window size: "+this.session.state.localWindowSize+" remote window size: "+this.session.state.remoteWindowSize),this.internalsTrace("session.closed="+this.session.closed+" session.destroyed="+this.session.destroyed+" session.socket.destroyed="+this.session.socket.destroyed);let l,c;return this.channelzEnabled?(this.streamTracker.addCallStarted(),l={addMessageSent:()=>{var u;this.messagesSent+=1,this.lastMessageSentTimestamp=new Date,(u=s.addMessageSent)===null||u===void 0||u.call(s)},addMessageReceived:()=>{var u;this.messagesReceived+=1,this.lastMessageReceivedTimestamp=new Date,(u=s.addMessageReceived)===null||u===void 0||u.call(s)},onCallEnd:u=>{var d;(d=s.onCallEnd)===null||d===void 0||d.call(s,u),this.removeActiveCall(c)},onStreamEnd:u=>{var d;u?this.streamTracker.addCallSucceeded():this.streamTracker.addCallFailed(),(d=s.onStreamEnd)===null||d===void 0||d.call(s,u)}}):l={addMessageSent:()=>{var u;(u=s.addMessageSent)===null||u===void 0||u.call(s)},addMessageReceived:()=>{var u;(u=s.addMessageReceived)===null||u===void 0||u.call(s)},onCallEnd:u=>{var d;(d=s.onCallEnd)===null||d===void 0||d.call(s,u),this.removeActiveCall(c)},onStreamEnd:u=>{var d;(d=s.onStreamEnd)===null||d===void 0||d.call(s,u)}},c=new M9.Http2SubchannelCall(a,l,i,this,(0,F9.getNextCallNumber)()),this.addActiveCall(c),c}getChannelzRef(){return this.channelzRef}getPeerName(){return this.subchannelAddressString}getOptions(){return this.options}shutdown(){this.session.close(),(0,Iw.unregisterChannelzRef)(this.channelzRef)}},Dw=class{constructor(e){this.channelTarget=e,this.session=null,this.isShutdown=!1}trace(e){dl.trace(td.LogVerbosity.DEBUG,Aw,(0,ul.uriToString)(this.channelTarget)+" "+e)}createSession(e,t,r,i){return this.isShutdown?Promise.reject():new Promise((s,o)=>{var a,l,c;let u;i.realTarget?(u=(0,ul.uriToString)(i.realTarget),this.trace("creating HTTP/2 session through proxy to "+(0,ul.uriToString)(i.realTarget))):(u=null,this.trace("creating HTTP/2 session to "+(0,am.subchannelAddressToString)(e)));let d=(0,IM.getDefaultAuthority)((a=i.realTarget)!==null&&a!==void 0?a:this.channelTarget),h=t._getConnectionOptions()||{};h.maxSendHeaderBlockLength=Number.MAX_SAFE_INTEGER,"grpc-node.max_session_memory"in r?h.maxSessionMemory=r["grpc-node.max_session_memory"]:h.maxSessionMemory=Number.MAX_SAFE_INTEGER;let p="http://";if("secureContext"in h){if(p="https://",r["grpc.ssl_target_name_override"]){let b=r["grpc.ssl_target_name_override"];h.checkServerIdentity=(N,D)=>(0,bM.checkServerIdentity)(b,D),h.servername=b}else{let b=(c=(l=(0,ul.splitHostPort)(d))===null||l===void 0?void 0:l.host)!==null&&c!==void 0?c:"localhost";h.servername=b}i.socket&&(h.createConnection=(b,N)=>i.socket)}else h.createConnection=(b,N)=>i.socket?i.socket:P9.connect(e);h=Object.assign(Object.assign(Object.assign({},h),e),{enableTrace:r["grpc-node.tls_enable_trace"]===1});let E=Nw.connect(p+d,h);this.session=E;let w="Failed to connect";E.unref(),E.once("connect",()=>{E.removeAllListeners(),s(new Rw(E,e,r,u)),this.session=null}),E.once("close",()=>{this.session=null,setImmediate(()=>{o(`${w} (${new Date().toISOString()})`)})}),E.once("error",b=>{w=b.message,this.trace("connection failed with error "+w)})})}connect(e,t,r){var i,s;if(this.isShutdown)return Promise.reject();let o=t._getConnectionOptions()||{};if("secureContext"in o){if(o.ALPNProtocols=["h2"],r["grpc.ssl_target_name_override"]){let a=r["grpc.ssl_target_name_override"];o.checkServerIdentity=(l,c)=>(0,bM.checkServerIdentity)(a,c),o.servername=a}else if("grpc.http_connect_target"in r){let a=(0,IM.getDefaultAuthority)((i=(0,ul.parseUri)(r["grpc.http_connect_target"]))!==null&&i!==void 0?i:{path:"localhost"}),l=(0,ul.splitHostPort)(a);o.servername=(s=l?.host)!==null&&s!==void 0?s:a}r["grpc-node.tls_enable_trace"]&&(o.enableTrace=!0)}return(0,x9.getProxiedConnection)(e,r,o).then(a=>this.createSession(e,t,r,a))}shutdown(){var e;this.isShutdown=!0,(e=this.session)===null||e===void 0||e.close(),this.session=null}};lm.Http2SubchannelConnector=Dw});var RM=A(hl=>{"use strict";Object.defineProperty(hl,"__esModule",{value:!0});hl.getSubchannelPool=hl.SubchannelPool=void 0;var H9=d1(),K9=_M(),Q9=Ir(),Y9=mn(),X9=AM(),J9=1e4,nd=class{constructor(){this.pool=Object.create(null),this.cleanupTimer=null}unrefUnusedSubchannels(){let e=!0;for(let t in this.pool){let i=this.pool[t].filter(s=>!s.subchannel.unrefIfOneRef());i.length>0&&(e=!1),this.pool[t]=i}e&&this.cleanupTimer!==null&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null)}ensureCleanupTask(){var e,t;this.cleanupTimer===null&&(this.cleanupTimer=setInterval(()=>{this.unrefUnusedSubchannels()},J9),(t=(e=this.cleanupTimer).unref)===null||t===void 0||t.call(e))}getOrCreateSubchannel(e,t,r,i){this.ensureCleanupTask();let s=(0,Y9.uriToString)(e);if(s in this.pool){let a=this.pool[s];for(let l of a)if((0,Q9.subchannelAddressEqual)(t,l.subchannelAddress)&&(0,H9.channelOptionsEqual)(r,l.channelArguments)&&i._equals(l.channelCredentials))return l.subchannel}let o=new K9.Subchannel(e,t,r,i,new X9.Http2SubchannelConnector(e));return s in this.pool||(this.pool[s]=[]),this.pool[s].push({subchannelAddress:t,channelArguments:r,channelCredentials:i,subchannel:o}),o.ref(),o}};hl.SubchannelPool=nd;var Z9=new nd;function eK(n){return n?Z9:new nd}hl.getSubchannelPool=eK});var Ow=A(fl=>{"use strict";Object.defineProperty(fl,"__esModule",{value:!0});fl.FilterStackFactory=fl.FilterStack=void 0;var cm=class{constructor(e){this.filters=e}sendMetadata(e){let t=e;for(let r=0;r<this.filters.length;r++)t=this.filters[r].sendMetadata(t);return t}receiveMetadata(e){let t=e;for(let r=this.filters.length-1;r>=0;r--)t=this.filters[r].receiveMetadata(t);return t}sendMessage(e){let t=e;for(let r=0;r<this.filters.length;r++)t=this.filters[r].sendMessage(t);return t}receiveMessage(e){let t=e;for(let r=this.filters.length-1;r>=0;r--)t=this.filters[r].receiveMessage(t);return t}receiveTrailers(e){let t=e;for(let r=this.filters.length-1;r>=0;r--)t=this.filters[r].receiveTrailers(t);return t}push(e){this.filters.unshift(...e)}getFilters(){return this.filters}};fl.FilterStack=cm;var kw=class n{constructor(e){this.factories=e}push(e){this.factories.unshift(...e)}clone(){return new n([...this.factories])}createFilter(){return new cm(this.factories.map(e=>e.createFilter()))}};fl.FilterStackFactory=kw});var xw=A(um=>{"use strict";Object.defineProperty(um,"__esModule",{value:!0});um.CompressionAlgorithms=void 0;var DM=function(n){return n[n.identity=0]="identity",n[n.deflate=1]="deflate",n[n.gzip=2]="gzip",n}(DM||(um.CompressionAlgorithms=DM={}))});var Mw=A(dm=>{"use strict";Object.defineProperty(dm,"__esModule",{value:!0});dm.BaseFilter=void 0;var Pw=class{sendMetadata(e){return T(this,null,function*(){return e})}receiveMetadata(e){return e}sendMessage(e){return T(this,null,function*(){return e})}receiveMessage(e){return T(this,null,function*(){return e})}receiveTrailers(e){return e}};dm.BaseFilter=Pw});var OM=A(ml=>{"use strict";Object.defineProperty(ml,"__esModule",{value:!0});ml.CompressionFilterFactory=ml.CompressionFilter=void 0;var hm=X("zlib"),kM=xw(),fm=we(),tK=Mw(),nK=Xe(),rK=n=>typeof n=="number"&&typeof kM.CompressionAlgorithms[n]=="string",pl=class{writeMessage(e,t){return T(this,null,function*(){let r=e;t&&(r=yield this.compressMessage(r));let i=Buffer.allocUnsafe(r.length+5);return i.writeUInt8(t?1:0,0),i.writeUInt32BE(r.length,1),r.copy(i,5),i})}readMessage(e){return T(this,null,function*(){let t=e.readUInt8(0)===1,r=e.slice(5);return t&&(r=yield this.decompressMessage(r)),r})}},So=class extends pl{compressMessage(e){return T(this,null,function*(){return e})}writeMessage(e,t){return T(this,null,function*(){let r=Buffer.allocUnsafe(e.length+5);return r.writeUInt8(0,0),r.writeUInt32BE(e.length,1),e.copy(r,5),r})}decompressMessage(e){return Promise.reject(new Error('Received compressed message but "grpc-encoding" header was identity'))}},Fw=class extends pl{constructor(e){super(),this.maxRecvMessageLength=e}compressMessage(e){return new Promise((t,r)=>{hm.deflate(e,(i,s)=>{i?r(i):t(s)})})}decompressMessage(e){return new Promise((t,r)=>{let i=0,s=[],o=hm.createInflate();o.on("data",a=>{s.push(a),i+=a.byteLength,this.maxRecvMessageLength!==-1&&i>this.maxRecvMessageLength&&(o.destroy(),r({code:fm.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),o.on("end",()=>{t(Buffer.concat(s))}),o.write(e),o.end()})}},Lw=class extends pl{constructor(e){super(),this.maxRecvMessageLength=e}compressMessage(e){return new Promise((t,r)=>{hm.gzip(e,(i,s)=>{i?r(i):t(s)})})}decompressMessage(e){return new Promise((t,r)=>{let i=0,s=[],o=hm.createGunzip();o.on("data",a=>{s.push(a),i+=a.byteLength,this.maxRecvMessageLength!==-1&&i>this.maxRecvMessageLength&&(o.destroy(),r({code:fm.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),o.on("end",()=>{t(Buffer.concat(s))}),o.write(e),o.end()})}},Bw=class extends pl{constructor(e){super(),this.compressionName=e}compressMessage(e){return Promise.reject(new Error(`Received message compressed with unsupported compression method ${this.compressionName}`))}decompressMessage(e){return Promise.reject(new Error(`Compression method not supported: ${this.compressionName}`))}};function NM(n,e){switch(n){case"identity":return new So;case"deflate":return new Fw(e);case"gzip":return new Lw(e);default:return new Bw(n)}}var pm=class extends tK.BaseFilter{constructor(e,t){var r,i;super(),this.sharedFilterConfig=t,this.sendCompression=new So,this.receiveCompression=new So,this.currentCompressionAlgorithm="identity";let s=e["grpc.default_compression_algorithm"];if(this.maxReceiveMessageLength=(r=e["grpc.max_receive_message_length"])!==null&&r!==void 0?r:fm.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,s!==void 0)if(rK(s)){let o=kM.CompressionAlgorithms[s],a=(i=t.serverSupportedEncodingHeader)===null||i===void 0?void 0:i.split(",");(!a||a.includes(o))&&(this.currentCompressionAlgorithm=o,this.sendCompression=NM(this.currentCompressionAlgorithm,-1))}else nK.log(fm.LogVerbosity.ERROR,`Invalid value provided for grpc.default_compression_algorithm option: ${s}`)}sendMetadata(e){return T(this,null,function*(){let t=yield e;return t.set("grpc-accept-encoding","identity,deflate,gzip"),t.set("accept-encoding","identity"),this.currentCompressionAlgorithm==="identity"?t.remove("grpc-encoding"):t.set("grpc-encoding",this.currentCompressionAlgorithm),t})}receiveMetadata(e){let t=e.get("grpc-encoding");if(t.length>0){let i=t[0];typeof i=="string"&&(this.receiveCompression=NM(i,this.maxReceiveMessageLength))}e.remove("grpc-encoding");let r=e.get("grpc-accept-encoding")[0];return r&&(this.sharedFilterConfig.serverSupportedEncodingHeader=r,r.split(",").includes(this.currentCompressionAlgorithm)||(this.sendCompression=new So,this.currentCompressionAlgorithm="identity")),e.remove("grpc-accept-encoding"),e}sendMessage(e){return T(this,null,function*(){var t;let r=yield e,i;return this.sendCompression instanceof So?i=!1:i=(((t=r.flags)!==null&&t!==void 0?t:0)&2)===0,{message:yield this.sendCompression.writeMessage(r.message,i),flags:r.flags}})}receiveMessage(e){return T(this,null,function*(){return this.receiveCompression.readMessage(yield e)})}};ml.CompressionFilter=pm;var Vw=class{constructor(e,t){this.options=t,this.sharedFilterConfig={}}createFilter(){return new pm(this.options,this.sharedFilterConfig)}};ml.CompressionFilterFactory=Vw});var mm=A(Fr=>{"use strict";Object.defineProperty(Fr,"__esModule",{value:!0});Fr.deadlineToString=Fr.getRelativeTimeout=Fr.getDeadlineTimeoutString=Fr.minDeadline=void 0;function iK(...n){let e=1/0;for(let t of n){let r=t instanceof Date?t.getTime():t;r<e&&(e=r)}return e}Fr.minDeadline=iK;var sK=[["m",1],["S",1e3],["M",60*1e3],["H",60*60*1e3]];function oK(n){let e=new Date().getTime();n instanceof Date&&(n=n.getTime());let t=Math.max(n-e,0);for(let[r,i]of sK){let s=t/i;if(s<1e8)return String(Math.ceil(s))+r}throw new Error("Deadline is too far in the future")}Fr.getDeadlineTimeoutString=oK;var aK=2147483647;function lK(n){let e=n instanceof Date?n.getTime():n,t=new Date().getTime(),r=e-t;return r<0?0:r>aK?1/0:r}Fr.getRelativeTimeout=lK;function cK(n){if(n instanceof Date)return n.toISOString();{let e=new Date(n);return Number.isNaN(e.getTime())?""+n:e.toISOString()}}Fr.deadlineToString=cK});var ym=A(gm=>{"use strict";Object.defineProperty(gm,"__esModule",{value:!0});gm.restrictControlPlaneStatusCode=void 0;var Lr=we(),uK=[Lr.Status.OK,Lr.Status.INVALID_ARGUMENT,Lr.Status.NOT_FOUND,Lr.Status.ALREADY_EXISTS,Lr.Status.FAILED_PRECONDITION,Lr.Status.ABORTED,Lr.Status.OUT_OF_RANGE,Lr.Status.DATA_LOSS];function dK(n,e){return uK.includes(n)?{code:Lr.Status.INTERNAL,details:`Invalid status from control plane: ${n} ${Lr.Status[n]} ${e}`}:{code:n,details:e}}gm.restrictControlPlaneStatusCode=dK});var PM=A(Em=>{"use strict";Object.defineProperty(Em,"__esModule",{value:!0});Em.LoadBalancingCall=void 0;var xM=Dn(),_m=we(),hK=mm(),vm=tn(),rd=Qi(),fK=mn(),pK=Xe(),Uw=ym(),mK=X("http2"),gK="load_balancing_call",qw=class{constructor(e,t,r,i,s,o,a){var l,c;this.channel=e,this.callConfig=t,this.methodName=r,this.host=i,this.credentials=s,this.deadline=o,this.callNumber=a,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.metadata=null,this.listener=null,this.onCallEnded=null;let u=this.methodName.split("/"),d="";u.length>=2&&(d=u[1]);let h=(c=(l=(0,fK.splitHostPort)(this.host))===null||l===void 0?void 0:l.host)!==null&&c!==void 0?c:"localhost";this.serviceUrl=`https://${h}/${d}`}trace(e){pK.trace(_m.LogVerbosity.DEBUG,gK,"["+this.callNumber+"] "+e)}outputStatus(e,t){var r,i;if(!this.ended){this.ended=!0,this.trace("ended with status: code="+e.code+' details="'+e.details+'"');let s=Object.assign(Object.assign({},e),{progress:t});(r=this.listener)===null||r===void 0||r.onReceiveStatus(s),(i=this.onCallEnded)===null||i===void 0||i.call(this,s.code)}}doPick(){var e,t;if(this.ended)return;if(!this.metadata)throw new Error("doPick called before start");this.trace("Pick called");let r=this.channel.doPick(this.metadata,this.callConfig.pickInformation),i=r.subchannel?"("+r.subchannel.getChannelzRef().id+") "+r.subchannel.getAddress():""+r.subchannel;switch(this.trace("Pick result: "+rd.PickResultType[r.pickResultType]+" subchannel: "+i+" status: "+((e=r.status)===null||e===void 0?void 0:e.code)+" "+((t=r.status)===null||t===void 0?void 0:t.details)),r.pickResultType){case rd.PickResultType.COMPLETE:this.credentials.generateMetadata({service_url:this.serviceUrl}).then(a=>{var l,c,u;if(this.ended){this.trace("Credentials metadata generation finished after call ended");return}let d=this.metadata.clone();if(d.merge(a),d.get("authorization").length>1&&this.outputStatus({code:_m.Status.INTERNAL,details:'"authorization" metadata cannot have multiple values',metadata:new vm.Metadata},"PROCESSED"),r.subchannel.getConnectivityState()!==xM.ConnectivityState.READY){this.trace("Picked subchannel "+i+" has state "+xM.ConnectivityState[r.subchannel.getConnectivityState()]+" after getting credentials metadata. Retrying pick"),this.doPick();return}this.deadline!==1/0&&d.set("grpc-timeout",(0,hK.getDeadlineTimeoutString)(this.deadline));try{this.child=r.subchannel.getRealSubchannel().createCall(d,this.host,this.methodName,{onReceiveMetadata:h=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(h)},onReceiveMessage:h=>{this.trace("Received message"),this.listener.onReceiveMessage(h)},onReceiveStatus:h=>{this.trace("Received status"),h.rstCode===mK.constants.NGHTTP2_REFUSED_STREAM?this.outputStatus(h,"REFUSED"):this.outputStatus(h,"PROCESSED")}})}catch(h){this.trace("Failed to start call on picked subchannel "+i+" with error "+h.message),this.outputStatus({code:_m.Status.INTERNAL,details:"Failed to start HTTP/2 stream with error "+h.message,metadata:new vm.Metadata},"NOT_STARTED");return}(c=(l=this.callConfig).onCommitted)===null||c===void 0||c.call(l),(u=r.onCallStarted)===null||u===void 0||u.call(r),this.onCallEnded=r.onCallEnded,this.trace("Created child call ["+this.child.getCallNumber()+"]"),this.readPending&&this.child.startRead(),this.pendingMessage&&this.child.sendMessageWithContext(this.pendingMessage.context,this.pendingMessage.message),this.pendingHalfClose&&this.child.halfClose()},a=>{let{code:l,details:c}=(0,Uw.restrictControlPlaneStatusCode)(typeof a.code=="number"?a.code:_m.Status.UNKNOWN,`Getting metadata from plugin failed with error: ${a.message}`);this.outputStatus({code:l,details:c,metadata:new vm.Metadata},"PROCESSED")});break;case rd.PickResultType.DROP:let{code:s,details:o}=(0,Uw.restrictControlPlaneStatusCode)(r.status.code,r.status.details);setImmediate(()=>{this.outputStatus({code:s,details:o,metadata:r.status.metadata},"DROP")});break;case rd.PickResultType.TRANSIENT_FAILURE:if(this.metadata.getOptions().waitForReady)this.channel.queueCallForPick(this);else{let{code:a,details:l}=(0,Uw.restrictControlPlaneStatusCode)(r.status.code,r.status.details);setImmediate(()=>{this.outputStatus({code:a,details:l,metadata:r.status.metadata},"PROCESSED")})}break;case rd.PickResultType.QUEUE:this.channel.queueCallForPick(this)}}cancelWithStatus(e,t){var r;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),(r=this.child)===null||r===void 0||r.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new vm.Metadata},"PROCESSED")}getPeer(){var e,t;return(t=(e=this.child)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.listener=t,this.metadata=e,this.doPick()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.child.sendMessageWithContext(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){throw new Error("Method not implemented.")}getCallNumber(){return this.callNumber}};Em.LoadBalancingCall=qw});var FM=A(Cm=>{"use strict";Object.defineProperty(Cm,"__esModule",{value:!0});Cm.ResolvingCall=void 0;var gl=we(),Sm=mm(),MM=tn(),yK=Xe(),_K=ym(),vK="resolving_call",zw=class{constructor(e,t,r,i,s,o){this.channel=e,this.method=t,this.filterStackFactory=i,this.credentials=s,this.callNumber=o,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.readFilterPending=!1,this.writeFilterPending=!1,this.pendingChildStatus=null,this.metadata=null,this.listener=null,this.statusWatchers=[],this.deadlineTimer=setTimeout(()=>{},0),this.filterStack=null,this.deadline=r.deadline,this.host=r.host,r.parentCall&&(r.flags&gl.Propagate.CANCELLATION&&r.parentCall.on("cancelled",()=>{this.cancelWithStatus(gl.Status.CANCELLED,"Cancelled by parent call")}),r.flags&gl.Propagate.DEADLINE&&(this.trace("Propagating deadline from parent: "+r.parentCall.getDeadline()),this.deadline=(0,Sm.minDeadline)(this.deadline,r.parentCall.getDeadline()))),this.trace("Created"),this.runDeadlineTimer()}trace(e){yK.trace(gl.LogVerbosity.DEBUG,vK,"["+this.callNumber+"] "+e)}runDeadlineTimer(){clearTimeout(this.deadlineTimer),this.trace("Deadline: "+(0,Sm.deadlineToString)(this.deadline));let e=(0,Sm.getRelativeTimeout)(this.deadline);if(e!==1/0){this.trace("Deadline will be reached in "+e+"ms");let t=()=>{this.cancelWithStatus(gl.Status.DEADLINE_EXCEEDED,"Deadline exceeded")};e<=0?process.nextTick(t):this.deadlineTimer=setTimeout(t,e)}}outputStatus(e){if(!this.ended){this.ended=!0,this.filterStack||(this.filterStack=this.filterStackFactory.createFilter()),clearTimeout(this.deadlineTimer);let t=this.filterStack.receiveTrailers(e);this.trace("ended with status: code="+t.code+' details="'+t.details+'"'),this.statusWatchers.forEach(r=>r(t)),process.nextTick(()=>{var r;(r=this.listener)===null||r===void 0||r.onReceiveStatus(t)})}}sendMessageOnChild(e,t){if(!this.child)throw new Error("sendMessageonChild called with child not populated");let r=this.child;this.writeFilterPending=!0,this.filterStack.sendMessage(Promise.resolve({message:t,flags:e.flags})).then(i=>{this.writeFilterPending=!1,r.sendMessageWithContext(e,i.message),this.pendingHalfClose&&r.halfClose()},i=>{this.cancelWithStatus(i.code,i.details)})}getConfig(){if(this.ended)return;if(!this.metadata||!this.listener)throw new Error("getConfig called before start");let e=this.channel.getConfig(this.method,this.metadata);if(e.type==="NONE"){this.channel.queueCallForConfig(this);return}else if(e.type==="ERROR"){this.metadata.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e.error);return}let t=e.config;if(t.status!==gl.Status.OK){let{code:r,details:i}=(0,_K.restrictControlPlaneStatusCode)(t.status,"Failed to route call to method "+this.method);this.outputStatus({code:r,details:i,metadata:new MM.Metadata});return}if(t.methodConfig.timeout){let r=new Date;r.setSeconds(r.getSeconds()+t.methodConfig.timeout.seconds),r.setMilliseconds(r.getMilliseconds()+t.methodConfig.timeout.nanos/1e6),this.deadline=(0,Sm.minDeadline)(this.deadline,r),this.runDeadlineTimer()}this.filterStackFactory.push(t.dynamicFilterFactories),this.filterStack=this.filterStackFactory.createFilter(),this.filterStack.sendMetadata(Promise.resolve(this.metadata)).then(r=>{this.child=this.channel.createInnerCall(t,this.method,this.host,this.credentials,this.deadline),this.trace("Created child ["+this.child.getCallNumber()+"]"),this.child.start(r,{onReceiveMetadata:i=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(this.filterStack.receiveMetadata(i))},onReceiveMessage:i=>{this.trace("Received message"),this.readFilterPending=!0,this.filterStack.receiveMessage(i).then(s=>{this.trace("Finished filtering received message"),this.readFilterPending=!1,this.listener.onReceiveMessage(s),this.pendingChildStatus&&this.outputStatus(this.pendingChildStatus)},s=>{this.cancelWithStatus(s.code,s.details)})},onReceiveStatus:i=>{this.trace("Received status"),this.readFilterPending?this.pendingChildStatus=i:this.outputStatus(i)}}),this.readPending&&this.child.startRead(),this.pendingMessage?this.sendMessageOnChild(this.pendingMessage.context,this.pendingMessage.message):this.pendingHalfClose&&this.child.halfClose()},r=>{this.outputStatus(r)})}reportResolverError(e){var t;!((t=this.metadata)===null||t===void 0)&&t.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e)}cancelWithStatus(e,t){var r;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),(r=this.child)===null||r===void 0||r.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new MM.Metadata})}getPeer(){var e,t;return(t=(e=this.child)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.metadata=e.clone(),this.listener=t,this.getConfig()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.sendMessageOnChild(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child&&!this.writeFilterPending?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){this.credentials=this.credentials.compose(e)}addStatusWatcher(e){this.statusWatchers.push(e)}getCallNumber(){return this.callNumber}};Cm.ResolvingCall=zw});var LM=A(hs=>{"use strict";Object.defineProperty(hs,"__esModule",{value:!0});hs.RetryingCall=hs.MessageBufferTracker=hs.RetryThrottler=void 0;var wm=we(),EK=tn(),SK=Xe(),CK="retrying_call",Ww=class{constructor(e,t,r){this.maxTokens=e,this.tokenRatio=t,r?this.tokens=r.tokens*(e/r.maxTokens):this.tokens=e}addCallSucceeded(){this.tokens=Math.max(this.tokens+this.tokenRatio,this.maxTokens)}addCallFailed(){this.tokens=Math.min(this.tokens-1,0)}canRetryCall(){return this.tokens>this.maxTokens/2}};hs.RetryThrottler=Ww;var jw=class{constructor(e,t){this.totalLimit=e,this.limitPerCall=t,this.totalAllocated=0,this.allocatedPerCall=new Map}allocate(e,t){var r;let i=(r=this.allocatedPerCall.get(t))!==null&&r!==void 0?r:0;return this.limitPerCall-i<e||this.totalLimit-this.totalAllocated<e?!1:(this.allocatedPerCall.set(t,i+e),this.totalAllocated+=e,!0)}free(e,t){var r;if(this.totalAllocated<e)throw new Error(`Invalid buffer allocation state: call ${t} freed ${e} > total allocated ${this.totalAllocated}`);this.totalAllocated-=e;let i=(r=this.allocatedPerCall.get(t))!==null&&r!==void 0?r:0;if(i<e)throw new Error(`Invalid buffer allocation state: call ${t} freed ${e} > allocated for call ${i}`);this.allocatedPerCall.set(t,i-e)}freeAll(e){var t;let r=(t=this.allocatedPerCall.get(e))!==null&&t!==void 0?t:0;if(this.totalAllocated<r)throw new Error(`Invalid buffer allocation state: call ${e} allocated ${r} > total allocated ${this.totalAllocated}`);this.totalAllocated-=r,this.allocatedPerCall.delete(e)}};hs.MessageBufferTracker=jw;var Gw="grpc-previous-rpc-attempts",$w=class{constructor(e,t,r,i,s,o,a,l,c){if(this.channel=e,this.callConfig=t,this.methodName=r,this.host=i,this.credentials=s,this.deadline=o,this.callNumber=a,this.bufferTracker=l,this.retryThrottler=c,this.listener=null,this.initialMetadata=null,this.underlyingCalls=[],this.writeBuffer=[],this.writeBufferOffset=0,this.readStarted=!1,this.transparentRetryUsed=!1,this.attempts=0,this.hedgingTimer=null,this.committedCallIndex=null,this.initialRetryBackoffSec=0,this.nextRetryBackoffSec=0,t.methodConfig.retryPolicy){this.state="RETRY";let u=t.methodConfig.retryPolicy;this.nextRetryBackoffSec=this.initialRetryBackoffSec=Number(u.initialBackoff.substring(0,u.initialBackoff.length-1))}else t.methodConfig.hedgingPolicy?this.state="HEDGING":this.state="TRANSPARENT_ONLY"}getCallNumber(){return this.callNumber}trace(e){SK.trace(wm.LogVerbosity.DEBUG,CK,"["+this.callNumber+"] "+e)}reportStatus(e){this.trace("ended with status: code="+e.code+' details="'+e.details+'"'),this.bufferTracker.freeAll(this.callNumber),this.writeBufferOffset=this.writeBufferOffset+this.writeBuffer.length,this.writeBuffer=[],process.nextTick(()=>{var t;(t=this.listener)===null||t===void 0||t.onReceiveStatus({code:e.code,details:e.details,metadata:e.metadata})})}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.reportStatus({code:e,details:t,metadata:new EK.Metadata});for(let{call:r}of this.underlyingCalls)r.cancelWithStatus(e,t)}getPeer(){return this.committedCallIndex!==null?this.underlyingCalls[this.committedCallIndex].call.getPeer():"unknown"}getBufferEntry(e){var t;return(t=this.writeBuffer[e-this.writeBufferOffset])!==null&&t!==void 0?t:{entryType:"FREED",allocated:!1}}getNextBufferIndex(){return this.writeBufferOffset+this.writeBuffer.length}clearSentMessages(){if(this.state!=="COMMITTED")return;let e=this.underlyingCalls[this.committedCallIndex].nextMessageToSend;for(let t=this.writeBufferOffset;t<e;t++){let r=this.getBufferEntry(t);r.allocated&&this.bufferTracker.free(r.message.message.length,this.callNumber)}this.writeBuffer=this.writeBuffer.slice(e-this.writeBufferOffset),this.writeBufferOffset=e}commitCall(e){if(this.state!=="COMMITTED"&&this.underlyingCalls[e].state!=="COMPLETED"){this.trace("Committing call ["+this.underlyingCalls[e].call.getCallNumber()+"] at index "+e),this.state="COMMITTED",this.committedCallIndex=e;for(let t=0;t<this.underlyingCalls.length;t++)t!==e&&this.underlyingCalls[t].state!=="COMPLETED"&&(this.underlyingCalls[t].state="COMPLETED",this.underlyingCalls[t].call.cancelWithStatus(wm.Status.CANCELLED,"Discarded in favor of other hedged attempt"));this.clearSentMessages()}}commitCallWithMostMessages(){if(this.state==="COMMITTED")return;let e=-1,t=-1;for(let[r,i]of this.underlyingCalls.entries())i.state==="ACTIVE"&&i.nextMessageToSend>e&&(e=i.nextMessageToSend,t=r);t===-1?this.state="TRANSPARENT_ONLY":this.commitCall(t)}isStatusCodeInList(e,t){return e.some(r=>r===t||r.toString().toLowerCase()===wm.Status[t].toLowerCase())}getNextRetryBackoffMs(){var e;let t=(e=this.callConfig)===null||e===void 0?void 0:e.methodConfig.retryPolicy;if(!t)return 0;let r=Math.random()*this.nextRetryBackoffSec*1e3,i=Number(t.maxBackoff.substring(0,t.maxBackoff.length-1));return this.nextRetryBackoffSec=Math.min(this.nextRetryBackoffSec*t.backoffMultiplier,i),r}maybeRetryCall(e,t){if(this.state!=="RETRY"){t(!1);return}let r=this.callConfig.methodConfig.retryPolicy;if(this.attempts>=Math.min(r.maxAttempts,5)){t(!1);return}let i;if(e===null)i=this.getNextRetryBackoffMs();else if(e<0){this.state="TRANSPARENT_ONLY",t(!1);return}else i=e,this.nextRetryBackoffSec=this.initialRetryBackoffSec;setTimeout(()=>{var s,o;if(this.state!=="RETRY"){t(!1);return}(!((o=(s=this.retryThrottler)===null||s===void 0?void 0:s.canRetryCall())!==null&&o!==void 0)||o)&&(t(!0),this.attempts+=1,this.startNewAttempt())},i)}countActiveCalls(){let e=0;for(let t of this.underlyingCalls)t?.state==="ACTIVE"&&(e+=1);return e}handleProcessedStatus(e,t,r){var i,s,o;switch(this.state){case"COMMITTED":case"TRANSPARENT_ONLY":this.commitCall(t),this.reportStatus(e);break;case"HEDGING":if(this.isStatusCodeInList((i=this.callConfig.methodConfig.hedgingPolicy.nonFatalStatusCodes)!==null&&i!==void 0?i:[],e.code)){(s=this.retryThrottler)===null||s===void 0||s.addCallFailed();let a;if(r===null)a=0;else if(r<0){this.state="TRANSPARENT_ONLY",this.commitCall(t),this.reportStatus(e);return}else a=r;setTimeout(()=>{this.maybeStartHedgingAttempt(),this.countActiveCalls()===0&&(this.commitCall(t),this.reportStatus(e))},a)}else this.commitCall(t),this.reportStatus(e);break;case"RETRY":this.isStatusCodeInList(this.callConfig.methodConfig.retryPolicy.retryableStatusCodes,e.code)?((o=this.retryThrottler)===null||o===void 0||o.addCallFailed(),this.maybeRetryCall(r,a=>{a||(this.commitCall(t),this.reportStatus(e))})):(this.commitCall(t),this.reportStatus(e));break}}getPushback(e){let t=e.get("grpc-retry-pushback-ms");if(t.length===0)return null;try{return parseInt(t[0])}catch{return-1}}handleChildStatus(e,t){var r;if(this.underlyingCalls[t].state==="COMPLETED")return;if(this.trace("state="+this.state+" handling status with progress "+e.progress+" from child ["+this.underlyingCalls[t].call.getCallNumber()+"] in state "+this.underlyingCalls[t].state),this.underlyingCalls[t].state="COMPLETED",e.code===wm.Status.OK){(r=this.retryThrottler)===null||r===void 0||r.addCallSucceeded(),this.commitCall(t),this.reportStatus(e);return}if(this.state==="COMMITTED"){this.reportStatus(e);return}let i=this.getPushback(e.metadata);switch(e.progress){case"NOT_STARTED":this.startNewAttempt();break;case"REFUSED":this.transparentRetryUsed?this.handleProcessedStatus(e,t,i):(this.transparentRetryUsed=!0,this.startNewAttempt());break;case"DROP":this.commitCall(t),this.reportStatus(e);break;case"PROCESSED":this.handleProcessedStatus(e,t,i);break}}maybeStartHedgingAttempt(){if(this.state!=="HEDGING"||!this.callConfig.methodConfig.hedgingPolicy)return;let e=this.callConfig.methodConfig.hedgingPolicy;this.attempts>=Math.min(e.maxAttempts,5)||(this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer())}maybeStartHedgingTimer(){var e,t,r;if(this.hedgingTimer&&clearTimeout(this.hedgingTimer),this.state!=="HEDGING"||!this.callConfig.methodConfig.hedgingPolicy)return;let i=this.callConfig.methodConfig.hedgingPolicy;if(this.attempts>=Math.min(i.maxAttempts,5))return;let s=(e=i.hedgingDelay)!==null&&e!==void 0?e:"0s",o=Number(s.substring(0,s.length-1));this.hedgingTimer=setTimeout(()=>{this.maybeStartHedgingAttempt()},o*1e3),(r=(t=this.hedgingTimer).unref)===null||r===void 0||r.call(t)}startNewAttempt(){let e=this.channel.createLoadBalancingCall(this.callConfig,this.methodName,this.host,this.credentials,this.deadline);this.trace("Created child call ["+e.getCallNumber()+"] for attempt "+this.attempts);let t=this.underlyingCalls.length;this.underlyingCalls.push({state:"ACTIVE",call:e,nextMessageToSend:0});let r=this.attempts-1,i=this.initialMetadata.clone();r>0&&i.set(Gw,`${r}`);let s=!1;e.start(i,{onReceiveMetadata:o=>{this.trace("Received metadata from child ["+e.getCallNumber()+"]"),this.commitCall(t),s=!0,r>0&&o.set(Gw,`${r}`),this.underlyingCalls[t].state==="ACTIVE"&&this.listener.onReceiveMetadata(o)},onReceiveMessage:o=>{this.trace("Received message from child ["+e.getCallNumber()+"]"),this.commitCall(t),this.underlyingCalls[t].state==="ACTIVE"&&this.listener.onReceiveMessage(o)},onReceiveStatus:o=>{this.trace("Received status from child ["+e.getCallNumber()+"]"),!s&&r>0&&o.metadata.set(Gw,`${r}`),this.handleChildStatus(o,t)}}),this.sendNextChildMessage(t),this.readStarted&&e.startRead()}start(e,t){this.trace("start called"),this.listener=t,this.initialMetadata=e,this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer()}handleChildWriteCompleted(e){var t,r;let i=this.underlyingCalls[e],s=i.nextMessageToSend;(r=(t=this.getBufferEntry(s)).callback)===null||r===void 0||r.call(t),this.clearSentMessages(),i.nextMessageToSend+=1,this.sendNextChildMessage(e)}sendNextChildMessage(e){let t=this.underlyingCalls[e];if(t.state!=="COMPLETED"&&this.getBufferEntry(t.nextMessageToSend)){let r=this.getBufferEntry(t.nextMessageToSend);switch(r.entryType){case"MESSAGE":t.call.sendMessageWithContext({callback:i=>{this.handleChildWriteCompleted(e)}},r.message.message);break;case"HALF_CLOSE":t.nextMessageToSend+=1,t.call.halfClose();break;case"FREED":break}}}sendMessageWithContext(e,t){var r;this.trace("write() called with message of length "+t.length);let i={message:t,flags:e.flags},s=this.getNextBufferIndex(),o={entryType:"MESSAGE",message:i,allocated:this.bufferTracker.allocate(t.length,this.callNumber)};if(this.writeBuffer.push(o),o.allocated){(r=e.callback)===null||r===void 0||r.call(e);for(let[a,l]of this.underlyingCalls.entries())l.state==="ACTIVE"&&l.nextMessageToSend===s&&l.call.sendMessageWithContext({callback:c=>{this.handleChildWriteCompleted(a)}},t)}else{if(this.commitCallWithMostMessages(),this.committedCallIndex===null)return;let a=this.underlyingCalls[this.committedCallIndex];o.callback=e.callback,a.state==="ACTIVE"&&a.nextMessageToSend===s&&a.call.sendMessageWithContext({callback:l=>{this.handleChildWriteCompleted(this.committedCallIndex)}},t)}}startRead(){this.trace("startRead called"),this.readStarted=!0;for(let e of this.underlyingCalls)e?.state==="ACTIVE"&&e.call.startRead()}halfClose(){this.trace("halfClose called");let e=this.getNextBufferIndex();this.writeBuffer.push({entryType:"HALF_CLOSE",allocated:!1});for(let t of this.underlyingCalls)t?.state==="ACTIVE"&&t.nextMessageToSend===e&&(t.nextMessageToSend+=1,t.call.halfClose())}setCredentials(e){throw new Error("Method not implemented.")}getMethod(){return this.methodName}getHost(){return this.host}};hs.RetryingCall=$w});var bm=A(Tm=>{"use strict";Object.defineProperty(Tm,"__esModule",{value:!0});Tm.BaseSubchannelWrapper=void 0;var Hw=class{constructor(e){this.child=e}getConnectivityState(){return this.child.getConnectivityState()}addConnectivityStateListener(e){this.child.addConnectivityStateListener(e)}removeConnectivityStateListener(e){this.child.removeConnectivityStateListener(e)}startConnecting(){this.child.startConnecting()}getAddress(){return this.child.getAddress()}throttleKeepalive(e){this.child.throttleKeepalive(e)}ref(){this.child.ref()}unref(){this.child.unref()}getChannelzRef(){return this.child.getChannelzRef()}getRealSubchannel(){return this.child.getRealSubchannel()}realSubchannelEquals(e){return this.getRealSubchannel()===e.getRealSubchannel()}};Tm.BaseSubchannelWrapper=Hw});var UM=A(Rm=>{"use strict";Object.defineProperty(Rm,"__esModule",{value:!0});Rm.InternalChannel=void 0;var wK=up(),TK=u1(),bK=RM(),BM=Qi(),id=we(),IK=Ow(),AK=OM(),VM=Tr(),Kw=Xe(),RK=Sw(),Im=mn(),Br=Dn(),sd=Eo(),DK=PM(),NK=mm(),kK=FM(),Qw=bw(),OK=ym(),Yw=LM(),xK=bm(),PK=2147483647,MK=1e3,FK=30*60*1e3,Am=new Map,LK=1<<24,BK=1<<20,Xw=class extends xK.BaseSubchannelWrapper{constructor(e,t){super(e),this.channel=t,this.refCount=0,this.subchannelStateListener=(r,i,s,o)=>{t.throttleKeepalive(o)},e.addConnectivityStateListener(this.subchannelStateListener)}ref(){this.child.ref(),this.refCount+=1}unref(){this.child.unref(),this.refCount-=1,this.refCount<=0&&(this.child.removeConnectivityStateListener(this.subchannelStateListener),this.channel.removeWrappedSubchannel(this))}},Jw=class{constructor(e,t,r){var i,s,o,a,l,c,u,d;if(this.credentials=t,this.options=r,this.connectivityState=Br.ConnectivityState.IDLE,this.currentPicker=new BM.UnavailablePicker,this.configSelectionQueue=[],this.pickQueue=[],this.connectivityStateWatchers=[],this.configSelector=null,this.currentResolutionError=null,this.wrappedSubchannels=new Set,this.callCount=0,this.idleTimer=null,this.channelzEnabled=!0,this.callTracker=new sd.ChannelzCallTracker,this.childrenTracker=new sd.ChannelzChildrenTracker,typeof e!="string")throw new TypeError("Channel target must be a string");if(!(t instanceof wK.ChannelCredentials))throw new TypeError("Channel credentials must be a ChannelCredentials object");if(r&&typeof r!="object")throw new TypeError("Channel options must be an object");this.originalTarget=e;let h=(0,Im.parseUri)(e);if(h===null)throw new Error(`Could not parse target name "${e}"`);let p=(0,VM.mapUriDefaultScheme)(h);if(p===null)throw new Error(`Could not find a default scheme for target name "${e}"`);this.callRefTimer=setInterval(()=>{},PK),(s=(i=this.callRefTimer).unref)===null||s===void 0||s.call(i),this.options["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzTrace=new sd.ChannelzTrace,this.channelzRef=(0,sd.registerChannelzChannel)(e,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Channel created"),this.options["grpc.default_authority"]?this.defaultAuthority=this.options["grpc.default_authority"]:this.defaultAuthority=(0,VM.getDefaultAuthority)(p);let E=(0,RK.mapProxyName)(p,r);this.target=E.target,this.options=Object.assign({},this.options,E.extraOptions),this.subchannelPool=(0,bK.getSubchannelPool)(((o=r["grpc.use_local_subchannel_pool"])!==null&&o!==void 0?o:0)===0),this.retryBufferTracker=new Yw.MessageBufferTracker((a=r["grpc.retry_buffer_size"])!==null&&a!==void 0?a:LK,(l=r["grpc.per_rpc_retry_buffer_size"])!==null&&l!==void 0?l:BK),this.keepaliveTime=(c=r["grpc.keepalive_time_ms"])!==null&&c!==void 0?c:-1,this.idleTimeoutMs=Math.max((u=r["grpc.client_idle_timeout_ms"])!==null&&u!==void 0?u:FK,MK);let w={createSubchannel:(N,D)=>{let O=this.subchannelPool.getOrCreateSubchannel(this.target,N,Object.assign({},this.options,D),this.credentials);O.throttleKeepalive(this.keepaliveTime),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Created subchannel or used existing subchannel",O.getChannelzRef());let F=new Xw(O,this);return this.wrappedSubchannels.add(F),F},updateState:(N,D)=>{this.currentPicker=D;let O=this.pickQueue.slice();this.pickQueue=[],O.length>0&&this.callRefTimerUnref();for(let F of O)F.doPick();this.updateState(N)},requestReresolution:()=>{throw new Error("Resolving load balancer should never call requestReresolution")},addChannelzChild:N=>{this.channelzEnabled&&this.childrenTracker.refChild(N)},removeChannelzChild:N=>{this.channelzEnabled&&this.childrenTracker.unrefChild(N)}};this.resolvingLoadBalancer=new TK.ResolvingLoadBalancer(this.target,w,r,(N,D)=>{N.retryThrottling?Am.set(this.getTarget(),new Yw.RetryThrottler(N.retryThrottling.maxTokens,N.retryThrottling.tokenRatio,Am.get(this.getTarget()))):Am.delete(this.getTarget()),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Address resolution succeeded"),this.configSelector=D,this.currentResolutionError=null,process.nextTick(()=>{let O=this.configSelectionQueue;this.configSelectionQueue=[],O.length>0&&this.callRefTimerUnref();for(let F of O)F.getConfig()})},N=>{this.channelzEnabled&&this.channelzTrace.addTrace("CT_WARNING","Address resolution failed with code "+N.code+' and details "'+N.details+'"'),this.configSelectionQueue.length>0&&this.trace("Name resolution failed with calls queued for config selection"),this.configSelector===null&&(this.currentResolutionError=Object.assign(Object.assign({},(0,OK.restrictControlPlaneStatusCode)(N.code,N.details)),{metadata:N.metadata}));let D=this.configSelectionQueue;this.configSelectionQueue=[],D.length>0&&this.callRefTimerUnref();for(let O of D)O.reportResolverError(N)}),this.filterStackFactory=new IK.FilterStackFactory([new AK.CompressionFilterFactory(this,this.options)]),this.trace("Channel constructed with options "+JSON.stringify(r,void 0,2));let b=new Error;(0,Kw.trace)(id.LogVerbosity.DEBUG,"channel_stacktrace","("+this.channelzRef.id+`) Channel constructed 
`+((d=b.stack)===null||d===void 0?void 0:d.substring(b.stack.indexOf(`
`)+1))),this.lastActivityTimestamp=new Date}getChannelzInfo(){return{target:this.originalTarget,state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists()}}trace(e,t){(0,Kw.trace)(t??id.LogVerbosity.DEBUG,"channel","("+this.channelzRef.id+") "+(0,Im.uriToString)(this.target)+" "+e)}callRefTimerRef(){var e,t,r,i;!((t=(e=this.callRefTimer).hasRef)===null||t===void 0)&&t.call(e)||(this.trace("callRefTimer.ref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),(i=(r=this.callRefTimer).ref)===null||i===void 0||i.call(r))}callRefTimerUnref(){var e,t;(!this.callRefTimer.hasRef||this.callRefTimer.hasRef())&&(this.trace("callRefTimer.unref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),(t=(e=this.callRefTimer).unref)===null||t===void 0||t.call(e))}removeConnectivityStateWatcher(e){let t=this.connectivityStateWatchers.findIndex(r=>r===e);t>=0&&this.connectivityStateWatchers.splice(t,1)}updateState(e){(0,Kw.trace)(id.LogVerbosity.DEBUG,"connectivity_state","("+this.channelzRef.id+") "+(0,Im.uriToString)(this.target)+" "+Br.ConnectivityState[this.connectivityState]+" -> "+Br.ConnectivityState[e]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+Br.ConnectivityState[e]),this.connectivityState=e;let t=this.connectivityStateWatchers.slice();for(let r of t)e!==r.currentState&&(r.timer&&clearTimeout(r.timer),this.removeConnectivityStateWatcher(r),r.callback());e!==Br.ConnectivityState.TRANSIENT_FAILURE&&(this.currentResolutionError=null)}throttleKeepalive(e){if(e>this.keepaliveTime){this.keepaliveTime=e;for(let t of this.wrappedSubchannels)t.throttleKeepalive(e)}}removeWrappedSubchannel(e){this.wrappedSubchannels.delete(e)}doPick(e,t){return this.currentPicker.pick({metadata:e,extraPickInfo:t})}queueCallForPick(e){this.pickQueue.push(e),this.callRefTimerRef()}getConfig(e,t){return this.resolvingLoadBalancer.exitIdle(),this.configSelector?{type:"SUCCESS",config:this.configSelector(e,t)}:this.currentResolutionError?{type:"ERROR",error:this.currentResolutionError}:{type:"NONE"}}queueCallForConfig(e){this.configSelectionQueue.push(e),this.callRefTimerRef()}enterIdle(){this.resolvingLoadBalancer.destroy(),this.updateState(Br.ConnectivityState.IDLE),this.currentPicker=new BM.QueuePicker(this.resolvingLoadBalancer),this.idleTimer&&(clearTimeout(this.idleTimer),this.idleTimer=null)}startIdleTimeout(e){var t,r;this.idleTimer=setTimeout(()=>{if(this.callCount>0){this.startIdleTimeout(this.idleTimeoutMs);return}let s=new Date().valueOf()-this.lastActivityTimestamp.valueOf();s>=this.idleTimeoutMs?(this.trace("Idle timer triggered after "+this.idleTimeoutMs+"ms of inactivity"),this.enterIdle()):this.startIdleTimeout(this.idleTimeoutMs-s)},e),(r=(t=this.idleTimer).unref)===null||r===void 0||r.call(t)}maybeStartIdleTimer(){this.connectivityState!==Br.ConnectivityState.SHUTDOWN&&!this.idleTimer&&this.startIdleTimeout(this.idleTimeoutMs)}onCallStart(){this.channelzEnabled&&this.callTracker.addCallStarted(),this.callCount+=1}onCallEnd(e){this.channelzEnabled&&(e.code===id.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()),this.callCount-=1,this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()}createLoadBalancingCall(e,t,r,i,s){let o=(0,Qw.getNextCallNumber)();return this.trace("createLoadBalancingCall ["+o+'] method="'+t+'"'),new DK.LoadBalancingCall(this,e,t,r,i,s,o)}createRetryingCall(e,t,r,i,s){let o=(0,Qw.getNextCallNumber)();return this.trace("createRetryingCall ["+o+'] method="'+t+'"'),new Yw.RetryingCall(this,e,t,r,i,s,o,this.retryBufferTracker,Am.get(this.getTarget()))}createInnerCall(e,t,r,i,s){return this.options["grpc.enable_retries"]===0?this.createLoadBalancingCall(e,t,r,i,s):this.createRetryingCall(e,t,r,i,s)}createResolvingCall(e,t,r,i,s){let o=(0,Qw.getNextCallNumber)();this.trace("createResolvingCall ["+o+'] method="'+e+'", deadline='+(0,NK.deadlineToString)(t));let a={deadline:t,flags:s??id.Propagate.DEFAULTS,host:r??this.defaultAuthority,parentCall:i},l=new kK.ResolvingCall(this,e,a,this.filterStackFactory.clone(),this.credentials._getCallCredentials(),o);return this.onCallStart(),l.addStatusWatcher(c=>{this.onCallEnd(c)}),l}close(){this.resolvingLoadBalancer.destroy(),this.updateState(Br.ConnectivityState.SHUTDOWN),clearInterval(this.callRefTimer),this.idleTimer&&clearTimeout(this.idleTimer),this.channelzEnabled&&(0,sd.unregisterChannelzRef)(this.channelzRef),this.subchannelPool.unrefUnusedSubchannels()}getTarget(){return(0,Im.uriToString)(this.target)}getConnectivityState(e){let t=this.connectivityState;return e&&(this.resolvingLoadBalancer.exitIdle(),this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()),t}watchConnectivityState(e,t,r){if(this.connectivityState===Br.ConnectivityState.SHUTDOWN)throw new Error("Channel has been shut down");let i=null;if(t!==1/0){let o=t instanceof Date?t:new Date(t),a=new Date;if(t===-1/0||o<=a){process.nextTick(r,new Error("Deadline passed without connectivity state change"));return}i=setTimeout(()=>{this.removeConnectivityStateWatcher(s),r(new Error("Deadline passed without connectivity state change"))},o.getTime()-a.getTime())}let s={currentState:e,callback:r,timer:i};this.connectivityStateWatchers.push(s)}getChannelzRef(){return this.channelzRef}createCall(e,t,r,i,s){if(typeof e!="string")throw new TypeError("Channel#createCall: method must be a string");if(!(typeof t=="number"||t instanceof Date))throw new TypeError("Channel#createCall: deadline must be a number or Date");if(this.connectivityState===Br.ConnectivityState.SHUTDOWN)throw new Error("Channel has been shut down");return this.createResolvingCall(e,t,r,i,s)}};Rm.InternalChannel=Jw});var nC=A(Dm=>{"use strict";Object.defineProperty(Dm,"__esModule",{value:!0});Dm.ChannelImplementation=void 0;var VK=up(),UK=UM(),Zw=class{constructor(e,t,r){if(typeof e!="string")throw new TypeError("Channel target must be a string");if(!(t instanceof VK.ChannelCredentials))throw new TypeError("Channel credentials must be a ChannelCredentials object");if(r&&typeof r!="object")throw new TypeError("Channel options must be an object");this.internalChannel=new UK.InternalChannel(e,t,r)}close(){this.internalChannel.close()}getTarget(){return this.internalChannel.getTarget()}getConnectivityState(e){return this.internalChannel.getConnectivityState(e)}watchConnectivityState(e,t,r){this.internalChannel.watchConnectivityState(e,t,r)}getChannelzRef(){return this.internalChannel.getChannelzRef()}createCall(e,t,r,i,s){if(typeof e!="string")throw new TypeError("Channel#createCall: method must be a string");if(!(typeof t=="number"||t instanceof Date))throw new TypeError("Channel#createCall: deadline must be a number or Date");return this.internalChannel.createCall(e,t,r,i,s)}};Dm.ChannelImplementation=Zw});var QM=A(Bn=>{"use strict";Object.defineProperty(Bn,"__esModule",{value:!0});Bn.Http2ServerCallStream=Bn.ServerDuplexStreamImpl=Bn.ServerWritableStreamImpl=Bn.ServerReadableStreamImpl=Bn.ServerUnaryCallImpl=void 0;var $M=X("events"),yl=X("http2"),nT=X("stream"),qM=X("zlib"),Me=we(),rT=tn(),qK=ww(),HM=Xe(),ad=ip(),KM="server_call";function od(n){HM.trace(Me.LogVerbosity.DEBUG,KM,n)}var zK="grpc-accept-encoding",GK="grpc-encoding",zM="grpc-message",GM="grpc-status",WM="grpc-timeout",WK=/(\d{1,8})\s*([HMSmun])/,jK={H:36e5,M:6e4,S:1e3,m:1,u:.001,n:1e-6},$K={[zK]:"identity,deflate,gzip",[GK]:"identity"},jM={[yl.constants.HTTP2_HEADER_STATUS]:yl.constants.HTTP_STATUS_OK,[yl.constants.HTTP2_HEADER_CONTENT_TYPE]:"application/grpc+proto"},HK={waitForTrailers:!0},eT=class extends $M.EventEmitter{constructor(e,t,r){super(),this.call=e,this.metadata=t,this.request=r,this.cancelled=!1,this.call.setupSurfaceCall(this)}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}};Bn.ServerUnaryCallImpl=eT;var Nm=class extends nT.Readable{constructor(e,t,r,i){super({objectMode:!0}),this.call=e,this.metadata=t,this.deserialize=r,this.cancelled=!1,this.call.setupSurfaceCall(this),this.call.setupReadable(this,i)}_read(e){this.call.consumeUnpushedMessages(this)&&this.call.resume()}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}};Bn.ServerReadableStreamImpl=Nm;var ld=class extends nT.Writable{constructor(e,t,r,i){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=r,this.request=i,this.cancelled=!1,this.trailingMetadata=new rT.Metadata,this.call.setupSurfaceCall(this),this.on("error",s=>{this.call.sendError(s),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}_write(e,t,r){try{let i=this.call.serializeMessage(e);if(!this.call.write(i)){this.call.once("drain",r);return}}catch(i){this.emit("error",{details:(0,ad.getErrorMessage)(i),code:Me.Status.INTERNAL})}r()}_final(e){this.call.sendStatus({code:Me.Status.OK,details:"OK",metadata:this.trailingMetadata}),e(null)}end(e){return e&&(this.trailingMetadata=e),super.end()}};Bn.ServerWritableStreamImpl=ld;var _l=class extends nT.Duplex{constructor(e,t,r,i,s){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=r,this.deserialize=i,this.cancelled=!1,this.trailingMetadata=new rT.Metadata,this.call.setupSurfaceCall(this),this.call.setupReadable(this,s),this.on("error",o=>{this.call.sendError(o),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}end(e){return e&&(this.trailingMetadata=e),super.end()}};Bn.ServerDuplexStreamImpl=_l;_l.prototype._read=Nm.prototype._read;_l.prototype._write=ld.prototype._write;_l.prototype._final=ld.prototype._final;var tT=class extends $M.EventEmitter{constructor(e,t,r){super(),this.stream=e,this.handler=t,this.cancelled=!1,this.deadlineTimer=null,this.statusSent=!1,this.deadline=1/0,this.wantTrailers=!1,this.metadataSent=!1,this.canPush=!1,this.isPushPending=!1,this.bufferedMessages=[],this.messagesToPush=[],this.maxSendMessageSize=Me.DEFAULT_MAX_SEND_MESSAGE_LENGTH,this.maxReceiveMessageSize=Me.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,this.stream.once("error",i=>{}),this.stream.once("close",()=>{var i;od("Request to method "+((i=this.handler)===null||i===void 0?void 0:i.path)+" stream closed with rstCode "+this.stream.rstCode),this.statusSent||(this.cancelled=!0,this.emit("cancelled","cancelled"),this.emit("streamEnd",!1),this.sendStatus({code:Me.Status.CANCELLED,details:"Cancelled by client",metadata:null}),this.deadlineTimer&&clearTimeout(this.deadlineTimer))}),this.stream.on("drain",()=>{this.emit("drain")}),"grpc.max_send_message_length"in r&&(this.maxSendMessageSize=r["grpc.max_send_message_length"]),"grpc.max_receive_message_length"in r&&(this.maxReceiveMessageSize=r["grpc.max_receive_message_length"])}checkCancelled(){return(this.stream.destroyed||this.stream.closed)&&(this.cancelled=!0),this.cancelled}getDecompressedMessage(e,t){let r=e.subarray(5);if(t==="identity")return r;if(t==="deflate"||t==="gzip"){let i;return t==="deflate"?i=qM.createInflate():i=qM.createGunzip(),new Promise((s,o)=>{let a=0,l=[];i.on("data",c=>{l.push(c),a+=c.byteLength,this.maxReceiveMessageSize!==-1&&a>this.maxReceiveMessageSize&&(i.destroy(),o({code:Me.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxReceiveMessageSize}`}))}),i.on("end",()=>{s(Buffer.concat(l))}),i.write(r),i.end()})}else return Promise.reject({code:Me.Status.UNIMPLEMENTED,details:`Received message compressed with unsupported encoding "${t}"`})}sendMetadata(e){if(this.checkCancelled()||this.metadataSent)return;this.metadataSent=!0;let t=e?e.toHttp2Headers():null,r=Object.assign(Object.assign(Object.assign({},jM),$K),t);this.stream.respond(r,HK)}receiveMetadata(e){let t=rT.Metadata.fromHttp2Headers(e);HM.isTracerEnabled(KM)&&od("Request to "+this.handler.path+" received headers "+JSON.stringify(t.toJSON()));let r=t.get(WM);if(r.length>0){let i=r[0].toString().match(WK);if(i===null){let a=new Error("Invalid deadline");return a.code=Me.Status.OUT_OF_RANGE,this.sendError(a),t}let s=+i[1]*jK[i[2]]|0,o=new Date;this.deadline=o.setMilliseconds(o.getMilliseconds()+s),this.deadlineTimer=setTimeout(KK,s,this),t.remove(WM)}return t.remove(yl.constants.HTTP2_HEADER_ACCEPT_ENCODING),t.remove(yl.constants.HTTP2_HEADER_TE),t.remove(yl.constants.HTTP2_HEADER_CONTENT_TYPE),t.remove("grpc-accept-encoding"),t}receiveUnaryMessage(e){return new Promise((t,r)=>{let{stream:i}=this,s=0,o=this,a=[],l=this.maxReceiveMessageSize;this.stream.on("data",c),this.stream.on("end",u),this.stream.on("error",u);function c(d){if(s+=d.byteLength,l!==-1&&s>l){i.removeListener("data",c),i.removeListener("end",u),i.removeListener("error",u),r({code:Me.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${s} vs. ${l})`});return}a.push(d)}function u(d){if(i.removeListener("data",c),i.removeListener("end",u),i.removeListener("error",u),d!==void 0){r({code:Me.Status.INTERNAL,details:d.message});return}if(s===0){r({code:Me.Status.INTERNAL,details:"received empty unary message"});return}o.emit("receiveMessage");let h=Buffer.concat(a,s),E=h.readUInt8(0)===1?e:"identity",w=o.getDecompressedMessage(h,E);if(Buffer.isBuffer(w)){t(o.deserializeMessageWithInternalError(w));return}w.then(b=>t(o.deserializeMessageWithInternalError(b)),b=>r(b.code?b:{code:Me.Status.INTERNAL,details:`Received "grpc-encoding" header "${e}" but ${e} decompression failed`}))}})}deserializeMessageWithInternalError(e){return T(this,null,function*(){try{return this.deserializeMessage(e)}catch(t){throw{details:(0,ad.getErrorMessage)(t),code:Me.Status.INTERNAL}}})}serializeMessage(e){let t=this.handler.serialize(e),r=t.byteLength,i=Buffer.allocUnsafe(r+5);return i.writeUInt8(0,0),i.writeUInt32BE(r,1),t.copy(i,5),i}deserializeMessage(e){return this.handler.deserialize(e)}sendUnaryMessage(e,t,r,i){return T(this,null,function*(){if(!this.checkCancelled()){if(r===void 0&&(r=null),e){!Object.prototype.hasOwnProperty.call(e,"metadata")&&r&&(e.metadata=r),this.sendError(e);return}try{let s=this.serializeMessage(t);this.write(s),this.sendStatus({code:Me.Status.OK,details:"OK",metadata:r})}catch(s){this.sendError({details:(0,ad.getErrorMessage)(s),code:Me.Status.INTERNAL})}}})}sendStatus(e){var t,r;if(this.emit("callEnd",e.code),this.emit("streamEnd",e.code===Me.Status.OK),!this.checkCancelled())if(od("Request to method "+((t=this.handler)===null||t===void 0?void 0:t.path)+" ended with status code: "+Me.Status[e.code]+" details: "+e.details),this.deadlineTimer&&clearTimeout(this.deadlineTimer),this.stream.headersSent)this.wantTrailers||(this.wantTrailers=!0,this.stream.once("wantTrailers",()=>{var i;let s=Object.assign({[GM]:e.code,[zM]:encodeURI(e.details)},(i=e.metadata)===null||i===void 0?void 0:i.toHttp2Headers());this.stream.sendTrailers(s),this.statusSent=!0}),this.stream.end());else{let i=Object.assign(Object.assign({[GM]:e.code,[zM]:encodeURI(e.details)},jM),(r=e.metadata)===null||r===void 0?void 0:r.toHttp2Headers());this.stream.respond(i,{endStream:!0}),this.statusSent=!0}}sendError(e){let t={code:Me.Status.UNKNOWN,details:"message"in e?e.message:"Unknown Error",metadata:"metadata"in e&&e.metadata!==void 0?e.metadata:null};"code"in e&&typeof e.code=="number"&&Number.isInteger(e.code)&&(t.code=e.code,"details"in e&&typeof e.details=="string"&&(t.details=e.details)),this.sendStatus(t)}write(e){if(!this.checkCancelled()){if(this.maxSendMessageSize!==-1&&e.length>this.maxSendMessageSize){this.sendError({code:Me.Status.RESOURCE_EXHAUSTED,details:`Sent message larger than max (${e.length} vs. ${this.maxSendMessageSize})`});return}return this.sendMetadata(),this.emit("sendMessage"),this.stream.write(e)}}resume(){this.stream.resume()}setupSurfaceCall(e){this.once("cancelled",t=>{e.cancelled=!0,e.emit("cancelled",t)}),this.once("callEnd",t=>e.emit("callEnd",t))}setupReadable(e,t){let r=new qK.StreamDecoder(this.maxReceiveMessageSize),i=!1,s=!1,o=!1,a=()=>T(this,null,function*(){!o&&i&&!s&&(o=!0,yield this.pushOrBufferMessage(e,null))});this.stream.on("data",l=>T(this,null,function*(){let c;try{c=r.write(l)}catch(u){this.sendError({code:Me.Status.RESOURCE_EXHAUSTED,details:u.message});return}s=!0,this.stream.pause();for(let u of c){this.emit("receiveMessage");let h=u.readUInt8(0)===1?t:"identity",p;try{p=yield this.getDecompressedMessage(u,h)}catch(E){this.sendError(E);return}if(!p)return;yield this.pushOrBufferMessage(e,p)}s=!1,this.stream.resume(),yield a()})),this.stream.once("end",()=>T(this,null,function*(){i=!0,yield a()}))}consumeUnpushedMessages(e){for(this.canPush=!0;this.messagesToPush.length>0;){let t=this.messagesToPush.shift(),r=e.push(t);if(t===null||r===!1){this.canPush=!1;break}}return this.canPush}pushOrBufferMessage(e,t){return T(this,null,function*(){this.isPushPending?this.bufferedMessages.push(t):yield this.pushMessage(e,t)})}pushMessage(e,t){return T(this,null,function*(){if(t===null){od("Received end of stream"),this.canPush?e.push(null):this.messagesToPush.push(null);return}od("Received message of length "+t.length),this.isPushPending=!0;try{let r=yield this.deserializeMessage(t);this.canPush?e.push(r)||(this.canPush=!1,this.stream.pause()):this.messagesToPush.push(r)}catch(r){this.bufferedMessages.length=0;let i=(0,ad.getErrorCode)(r);(i===null||i<Me.Status.OK||i>Me.Status.UNAUTHENTICATED)&&(i=Me.Status.INTERNAL),e.emit("error",{details:(0,ad.getErrorMessage)(r),code:i})}this.isPushPending=!1,this.bufferedMessages.length>0&&(yield this.pushMessage(e,this.bufferedMessages.shift()))})}getPeer(){var e;let t=(e=this.stream.session)===null||e===void 0?void 0:e.socket;return t?.remoteAddress?t.remotePort?`${t.remoteAddress}:${t.remotePort}`:t.remoteAddress:"unknown"}getDeadline(){return this.deadline}getPath(){return this.handler.path}};Bn.Http2ServerCallStream=tT;function KK(n){let e=new Error("Deadline exceeded");e.code=Me.Status.DEADLINE_EXCEEDED,n.sendError(e),n.cancelled=!0,n.emit("cancelled","deadline")}});var oT=A(km=>{"use strict";Object.defineProperty(km,"__esModule",{value:!0});km.ServerCredentials=void 0;var YM=IS(),cd=class{static createInsecure(){return new iT}static createSsl(e,t,r=!1){if(e!==null&&!Buffer.isBuffer(e))throw new TypeError("rootCerts must be null or a Buffer");if(!Array.isArray(t))throw new TypeError("keyCertPairs must be an array");if(typeof r!="boolean")throw new TypeError("checkClientCertificate must be a boolean");let i=[],s=[];for(let o=0;o<t.length;o++){let a=t[o];if(a===null||typeof a!="object")throw new TypeError(`keyCertPair[${o}] must be an object`);if(!Buffer.isBuffer(a.private_key))throw new TypeError(`keyCertPair[${o}].private_key must be a Buffer`);if(!Buffer.isBuffer(a.cert_chain))throw new TypeError(`keyCertPair[${o}].cert_chain must be a Buffer`);i.push(a.cert_chain),s.push(a.private_key)}return new sT({ca:e||(0,YM.getDefaultRootsData)()||void 0,cert:i,key:s,requestCert:r,ciphers:YM.CIPHER_SUITES})}};km.ServerCredentials=cd;var iT=class extends cd{_isSecure(){return!1}_getSettings(){return null}},sT=class extends cd{constructor(e){super(),this.options=e}_isSecure(){return!0}_getSettings(){return this.options}}});var ZM=A(Pm=>{"use strict";Object.defineProperty(Pm,"__esModule",{value:!0});Pm.Server=void 0;var fs=X("http2"),fi=we(),Co=QM(),QK=oT(),XM=Tr(),Om=Xe(),nr=Ir(),YK=mn(),sn=Eo(),xm=~(1<<31),XK=~(1<<31),JK=2e4,{HTTP2_HEADER_PATH:JM}=fs.constants,ZK="server";function e5(){}function aT(n){return{code:fi.Status.UNIMPLEMENTED,details:`The server does not implement the method ${n}`}}function t5(n,e){let t=aT(e);switch(n){case"unary":return(r,i)=>{i(t,null)};case"clientStream":return(r,i)=>{i(t,null)};case"serverStream":return r=>{r.emit("error",t)};case"bidi":return r=>{r.emit("error",t)};default:throw new Error(`Invalid handlerType ${n}`)}}var lT=class{constructor(e){var t,r,i,s;this.http2ServerList=[],this.handlers=new Map,this.sessions=new Map,this.started=!1,this.shutdown=!1,this.serverAddressString="null",this.channelzEnabled=!0,this.channelzTrace=new sn.ChannelzTrace,this.callTracker=new sn.ChannelzCallTracker,this.listenerChildrenTracker=new sn.ChannelzChildrenTracker,this.sessionChildrenTracker=new sn.ChannelzChildrenTracker,this.options=e??{},this.options["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzRef=(0,sn.registerChannelzServer)(()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Server created"),this.maxConnectionAgeMs=(t=this.options["grpc.max_connection_age_ms"])!==null&&t!==void 0?t:xm,this.maxConnectionAgeGraceMs=(r=this.options["grpc.max_connection_age_grace_ms"])!==null&&r!==void 0?r:xm,this.keepaliveTimeMs=(i=this.options["grpc.keepalive_time_ms"])!==null&&i!==void 0?i:XK,this.keepaliveTimeoutMs=(s=this.options["grpc.keepalive_timeout_ms"])!==null&&s!==void 0?s:JK,this.trace("Server constructed")}getChannelzInfo(){return{trace:this.channelzTrace,callTracker:this.callTracker,listenerChildren:this.listenerChildrenTracker.getChildLists(),sessionChildren:this.sessionChildrenTracker.getChildLists()}}getChannelzSessionInfoGetter(e){return()=>{var t,r,i;let s=this.sessions.get(e),o=e.socket,a=o.remoteAddress?(0,nr.stringToSubchannelAddress)(o.remoteAddress,o.remotePort):null,l=o.localAddress?(0,nr.stringToSubchannelAddress)(o.localAddress,o.localPort):null,c;if(e.encrypted){let d=o,h=d.getCipher(),p=d.getCertificate(),E=d.getPeerCertificate();c={cipherSuiteStandardName:(t=h.standardName)!==null&&t!==void 0?t:null,cipherSuiteOtherName:h.standardName?null:h.name,localCertificate:p&&"raw"in p?p.raw:null,remoteCertificate:E&&"raw"in E?E.raw:null}}else c=null;return{remoteAddress:a,localAddress:l,security:c,remoteName:null,streamsStarted:s.streamTracker.callsStarted,streamsSucceeded:s.streamTracker.callsSucceeded,streamsFailed:s.streamTracker.callsFailed,messagesSent:s.messagesSent,messagesReceived:s.messagesReceived,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:s.streamTracker.lastCallStartedTimestamp,lastMessageSentTimestamp:s.lastMessageSentTimestamp,lastMessageReceivedTimestamp:s.lastMessageReceivedTimestamp,localFlowControlWindow:(r=e.state.localWindowSize)!==null&&r!==void 0?r:null,remoteFlowControlWindow:(i=e.state.remoteWindowSize)!==null&&i!==void 0?i:null}}}trace(e){Om.trace(fi.LogVerbosity.DEBUG,ZK,"("+this.channelzRef.id+") "+e)}addProtoService(){throw new Error("Not implemented. Use addService() instead")}addService(e,t){if(e===null||typeof e!="object"||t===null||typeof t!="object")throw new Error("addService() requires two objects as arguments");let r=Object.keys(e);if(r.length===0)throw new Error("Cannot add an empty service to a server");r.forEach(i=>{let s=e[i],o;s.requestStream?s.responseStream?o="bidi":o="clientStream":s.responseStream?o="serverStream":o="unary";let a=t[i],l;if(a===void 0&&typeof s.originalName=="string"&&(a=t[s.originalName]),a!==void 0?l=a.bind(t):l=t5(o,i),this.register(s.path,l,s.responseSerialize,s.requestDeserialize,o)===!1)throw new Error(`Method handler for ${s.path} already provided.`)})}removeService(e){if(e===null||typeof e!="object")throw new Error("removeService() requires object as argument");Object.keys(e).forEach(r=>{let i=e[r];this.unregister(i.path)})}bind(e,t){throw new Error("Not implemented. Use bindAsync() instead")}bindAsync(e,t,r){if(this.started===!0)throw new Error("server is already started");if(this.shutdown)throw new Error("bindAsync called after shutdown");if(typeof e!="string")throw new TypeError("port must be a string");if(t===null||!(t instanceof QK.ServerCredentials))throw new TypeError("creds must be a ServerCredentials object");if(typeof r!="function")throw new TypeError("callback must be a function");let i=(0,YK.parseUri)(e);if(i===null)throw new Error(`Could not parse port "${e}"`);let s=(0,XM.mapUriDefaultScheme)(i);if(s===null)throw new Error(`Could not get a default scheme for port "${e}"`);let o={maxSendHeaderBlockLength:Number.MAX_SAFE_INTEGER};"grpc-node.max_session_memory"in this.options?o.maxSessionMemory=this.options["grpc-node.max_session_memory"]:o.maxSessionMemory=Number.MAX_SAFE_INTEGER,"grpc.max_concurrent_streams"in this.options&&(o.settings={maxConcurrentStreams:this.options["grpc.max_concurrent_streams"]});let a=(p,E)=>{process.nextTick(()=>r(p,E))},l=()=>{let p;if(t._isSecure()){let E=Object.assign(o,t._getSettings());E.enableTrace=this.options["grpc-node.tls_enable_trace"]===1,p=fs.createSecureServer(E),p.on("secureConnection",w=>{w.on("error",b=>{this.trace("An incoming TLS connection closed with error: "+b.message)})})}else p=fs.createServer(o);return p.setTimeout(0,e5),this._setupHandlers(p),p},c=(p,E,w)=>p.length===0?Promise.resolve({port:E,count:w}):Promise.all(p.map(b=>{this.trace("Attempting to bind "+(0,nr.subchannelAddressToString)(b));let N;(0,nr.isTcpSubchannelAddress)(b)?N={host:b.host,port:E}:N=b;let D=l();return new Promise((O,F)=>{let G=J=>{this.trace("Failed to bind "+(0,nr.subchannelAddressToString)(b)+" with error "+J.message),O(J)};D.once("error",G),D.listen(N,()=>{if(this.shutdown){D.close(),O(new Error("bindAsync failed because server is shutdown"));return}let J=D.address(),S;typeof J=="string"?S={path:J}:S={host:J.address,port:J.port};let y=(0,sn.registerChannelzSocket)((0,nr.subchannelAddressToString)(S),()=>({localAddress:S,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(y),this.http2ServerList.push({server:D,channelzRef:y}),this.trace("Successfully bound "+(0,nr.subchannelAddressToString)(S)),O("port"in S?S.port:E),D.removeListener("error",G)})})})).then(b=>{let N=0;for(let D of b)if(typeof D=="number"&&(N+=1,D!==E))throw new Error("Invalid state: multiple port numbers added from single address");return{port:E,count:N+w}}),u=p=>{if(p.length===0)return Promise.resolve({port:0,count:0});let E=p[0],w=l();return new Promise((b,N)=>{let D=O=>{this.trace("Failed to bind "+(0,nr.subchannelAddressToString)(E)+" with error "+O.message),b(u(p.slice(1)))};w.once("error",D),w.listen(E,()=>{if(this.shutdown){w.close(),b({port:0,count:0});return}let O=w.address(),F={host:O.address,port:O.port},G=(0,sn.registerChannelzSocket)((0,nr.subchannelAddressToString)(F),()=>({localAddress:F,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(G),this.http2ServerList.push({server:w,channelzRef:G}),this.trace("Successfully bound "+(0,nr.subchannelAddressToString)(F)),b(c(p.slice(1),O.port,1)),w.removeListener("error",D)})})},d={onSuccessfulResolution:(p,E,w)=>{if(d.onSuccessfulResolution=()=>{},this.shutdown&&a(new Error("bindAsync failed because server is shutdown"),0),p.length===0){a(new Error(`No addresses resolved for port ${e}`),0);return}let b;(0,nr.isTcpSubchannelAddress)(p[0])?p[0].port===0?b=u(p):b=c(p,p[0].port,0):b=c(p,1,0),b.then(N=>{if(N.count===0){let D=`No address added out of total ${p.length} resolved`;Om.log(fi.LogVerbosity.ERROR,D),a(new Error(D),0)}else N.count<p.length&&Om.log(fi.LogVerbosity.INFO,`WARNING Only ${N.count} addresses added out of total ${p.length} resolved`),a(null,N.port)},N=>{let D=`No address added out of total ${p.length} resolved`;Om.log(fi.LogVerbosity.ERROR,D),a(new Error(D),0)})},onError:p=>{a(new Error(p.details),0)}};(0,XM.createResolver)(s,d,this.options).updateResolution()}forceShutdown(){for(let{server:e,channelzRef:t}of this.http2ServerList)e.listening&&e.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(t),(0,sn.unregisterChannelzRef)(t))});this.started=!1,this.shutdown=!0,this.sessions.forEach((e,t)=>{t.destroy(fs.constants.NGHTTP2_CANCEL)}),this.sessions.clear(),this.channelzEnabled&&(0,sn.unregisterChannelzRef)(this.channelzRef)}register(e,t,r,i,s){return this.handlers.has(e)?!1:(this.handlers.set(e,{func:t,serialize:r,deserialize:i,type:s,path:e}),!0)}unregister(e){return this.handlers.delete(e)}start(){if(this.http2ServerList.length===0||this.http2ServerList.every(({server:e})=>e.listening!==!0))throw new Error("server must be bound in order to start");if(this.started===!0)throw new Error("server is already started");this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Starting"),this.started=!0}tryShutdown(e){let t=s=>{this.channelzEnabled&&(0,sn.unregisterChannelzRef)(this.channelzRef),e(s)},r=0;function i(){r--,r===0&&t()}this.started=!1,this.shutdown=!0;for(let{server:s,channelzRef:o}of this.http2ServerList)s.listening&&(r++,s.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(o),(0,sn.unregisterChannelzRef)(o)),i()}));this.sessions.forEach((s,o)=>{o.closed||(r+=1,o.close(i))}),r===0&&t()}addHttp2Port(){throw new Error("Not yet implemented")}getChannelzRef(){return this.channelzRef}_verifyContentType(e,t){let r=t[fs.constants.HTTP2_HEADER_CONTENT_TYPE];return typeof r!="string"||!r.startsWith("application/grpc")?(e.respond({[fs.constants.HTTP2_HEADER_STATUS]:fs.constants.HTTP_STATUS_UNSUPPORTED_MEDIA_TYPE},{endStream:!0}),!1):!0}_retrieveHandler(e){this.trace("Received call to method "+e+" at address "+this.serverAddressString);let t=this.handlers.get(e);return t===void 0?(this.trace("No handler registered for method "+e+". Sending UNIMPLEMENTED status."),null):t}_respondWithError(e,t,r=null){let i=new Co.Http2ServerCallStream(t,null,this.options);e.code===void 0&&(e.code=fi.Status.INTERNAL),this.channelzEnabled&&(this.callTracker.addCallFailed(),r?.streamTracker.addCallFailed()),i.sendError(e)}_channelzHandler(e,t){let r=this.sessions.get(e.session);if(this.callTracker.addCallStarted(),r?.streamTracker.addCallStarted(),!this._verifyContentType(e,t)){this.callTracker.addCallFailed(),r?.streamTracker.addCallFailed();return}let i=t[JM],s=this._retrieveHandler(i);if(!s){this._respondWithError(aT(i),e,r);return}let o=new Co.Http2ServerCallStream(e,s,this.options);o.once("callEnd",a=>{a===fi.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}),r&&(o.once("streamEnd",a=>{a?r.streamTracker.addCallSucceeded():r.streamTracker.addCallFailed()}),o.on("sendMessage",()=>{r.messagesSent+=1,r.lastMessageSentTimestamp=new Date}),o.on("receiveMessage",()=>{r.messagesReceived+=1,r.lastMessageReceivedTimestamp=new Date})),this._runHandlerForCall(o,s,t)||(this.callTracker.addCallFailed(),r?.streamTracker.addCallFailed(),o.sendError({code:fi.Status.INTERNAL,details:`Unknown handler type: ${s.type}`}))}_streamHandler(e,t){if(this._verifyContentType(e,t)!==!0)return;let r=t[JM],i=this._retrieveHandler(r);if(!i){this._respondWithError(aT(r),e,null);return}let s=new Co.Http2ServerCallStream(e,i,this.options);this._runHandlerForCall(s,i,t)||s.sendError({code:fi.Status.INTERNAL,details:`Unknown handler type: ${i.type}`})}_runHandlerForCall(e,t,r){var i;let s=e.receiveMetadata(r),o=(i=s.get("grpc-encoding")[0])!==null&&i!==void 0?i:"identity";s.remove("grpc-encoding");let{type:a}=t;if(a==="unary")n5(e,t,s,o);else if(a==="clientStream")r5(e,t,s,o);else if(a==="serverStream")i5(e,t,s,o);else if(a==="bidi")s5(e,t,s,o);else return!1;return!0}_setupHandlers(e){if(e===null)return;let t=e.address(),r="null";t&&(typeof t=="string"?r=t:r=t.address+":"+t.port),this.serverAddressString=r;let i=this.channelzEnabled?this._channelzHandler:this._streamHandler;e.on("stream",i.bind(this)),e.on("session",s=>{var o,a,l,c,u;if(!this.started){s.destroy();return}let d=(0,sn.registerChannelzSocket)((o=s.socket.remoteAddress)!==null&&o!==void 0?o:"unknown",this.getChannelzSessionInfoGetter(s),this.channelzEnabled),h={ref:d,streamTracker:new sn.ChannelzCallTracker,messagesSent:0,messagesReceived:0,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null};this.sessions.set(s,h);let p=s.socket.remoteAddress;this.channelzEnabled&&(this.channelzTrace.addTrace("CT_INFO","Connection established by client "+p),this.sessionChildrenTracker.refChild(d));let E=null,w=null,b=!1;if(this.maxConnectionAgeMs!==xm){let D=this.maxConnectionAgeMs/10,O=Math.random()*D*2-D;E=(l=(a=setTimeout(()=>{var F,G;b=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by max connection age from "+p);try{s.goaway(fs.constants.NGHTTP2_NO_ERROR,~(1<<31),Buffer.from("max_age"))}catch{s.destroy();return}s.close(),this.maxConnectionAgeGraceMs!==xm&&(w=(G=(F=setTimeout(()=>{s.destroy()},this.maxConnectionAgeGraceMs)).unref)===null||G===void 0?void 0:G.call(F))},this.maxConnectionAgeMs+O)).unref)===null||l===void 0?void 0:l.call(a)}let N=(u=(c=setInterval(()=>{var D,O;let F=(O=(D=setTimeout(()=>{b=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by keepalive timeout from "+p),s.close()},this.keepaliveTimeoutMs)).unref)===null||O===void 0?void 0:O.call(D);try{s.ping((G,J,S)=>{clearTimeout(F)})}catch{s.destroy()}},this.keepaliveTimeMs)).unref)===null||u===void 0?void 0:u.call(c);s.on("close",()=>{this.channelzEnabled&&(b||this.channelzTrace.addTrace("CT_INFO","Connection dropped by client "+p),this.sessionChildrenTracker.unrefChild(d),(0,sn.unregisterChannelzRef)(d)),E&&clearTimeout(E),w&&clearTimeout(w),N&&clearTimeout(N),this.sessions.delete(s)})})}};Pm.Server=lT;function n5(n,e,t,r){return T(this,null,function*(){try{let i=yield n.receiveUnaryMessage(r);if(i===void 0||n.cancelled)return;let s=new Co.ServerUnaryCallImpl(n,t,i);e.func(s,(o,a,l,c)=>{n.sendUnaryMessage(o,a,l,c)})}catch(i){n.sendError(i)}})}function r5(n,e,t,r){let i=new Co.ServerReadableStreamImpl(n,t,e.deserialize,r);function s(o,a,l,c){i.destroy(),n.sendUnaryMessage(o,a,l,c)}n.cancelled||(i.on("error",s),e.func(i,s))}function i5(n,e,t,r){return T(this,null,function*(){try{let i=yield n.receiveUnaryMessage(r);if(i===void 0||n.cancelled)return;let s=new Co.ServerWritableStreamImpl(n,t,e.serialize,i);e.func(s)}catch(i){n.sendError(i)}})}function s5(n,e,t,r){let i=new Co.ServerDuplexStreamImpl(n,t,e.serialize,e.deserialize,r);n.cancelled||e.func(i)}});var eF=A(Mm=>{"use strict";Object.defineProperty(Mm,"__esModule",{value:!0});Mm.StatusBuilder=void 0;var cT=class{constructor(){this.code=null,this.details=null,this.metadata=null}withCode(e){return this.code=e,this}withDetails(e){return this.details=e,this}withMetadata(e){return this.metadata=e,this}build(){let e={};return this.code!==null&&(e.code=this.code),this.details!==null&&(e.details=this.details),this.metadata!==null&&(e.metadata=this.metadata),e}};Mm.StatusBuilder=cT});var uT=A(ps=>{"use strict";Object.defineProperty(ps,"__esModule",{value:!0});ps.isDuration=ps.durationToMs=ps.msToDuration=void 0;function o5(n){return{seconds:n/1e3|0,nanos:n%1e3*1e6|0}}ps.msToDuration=o5;function a5(n){return n.seconds*1e3+n.nanos/1e6|0}ps.durationToMs=a5;function l5(n){return typeof n.seconds=="number"&&typeof n.nanos=="number"}ps.isDuration=l5});var _T=A(ms=>{"use strict";var dT;Object.defineProperty(ms,"__esModule",{value:!0});ms.setup=ms.OutlierDetectionLoadBalancer=ms.OutlierDetectionLoadBalancingConfig=void 0;var Lm=Dn(),nF=we(),wo=uT(),rF=vT(),iF=ji(),c5=yp(),u5=Qi(),tF=Ir(),d5=bm(),h5=Xe(),f5="outlier_detection";function It(n){h5.trace(nF.LogVerbosity.DEBUG,f5,n)}var yT="outlier_detection",p5=((dT=process.env.GRPC_EXPERIMENTAL_ENABLE_OUTLIER_DETECTION)!==null&&dT!==void 0?dT:"true")==="true",m5={stdev_factor:1900,enforcement_percentage:100,minimum_hosts:5,request_volume:100},g5={threshold:85,enforcement_percentage:100,minimum_hosts:5,request_volume:50};function vl(n,e,t,r){if(e in n&&typeof n[e]!==t){let i=r?`${r}.${e}`:e;throw new Error(`outlier detection config ${i} parse error: expected ${t}, got ${typeof n[e]}`)}}function hT(n,e,t){let r=t?`${t}.${e}`:e;if(e in n){if(!(0,wo.isDuration)(n[e]))throw new Error(`outlier detection config ${r} parse error: expected Duration, got ${typeof n[e]}`);if(!(n[e].seconds>=0&&n[e].seconds<=315576e6&&n[e].nanos>=0&&n[e].nanos<=999999999))throw new Error(`outlier detection config ${r} parse error: values out of range for non-negative Duaration`)}}function Fm(n,e,t){let r=t?`${t}.${e}`:e;if(vl(n,e,"number",t),e in n&&!(n[e]>=0&&n[e]<=100))throw new Error(`outlier detection config ${r} parse error: value out of range for percentage (0-100)`)}var ud=class n{constructor(e,t,r,i,s,o,a){if(this.childPolicy=a,a.length>0&&a[0].getLoadBalancerName()==="pick_first")throw new Error("outlier_detection LB policy cannot have a pick_first child policy");this.intervalMs=e??1e4,this.baseEjectionTimeMs=t??3e4,this.maxEjectionTimeMs=r??3e5,this.maxEjectionPercent=i??10,this.successRateEjection=s?Object.assign(Object.assign({},m5),s):null,this.failurePercentageEjection=o?Object.assign(Object.assign({},g5),o):null}getLoadBalancerName(){return yT}toJsonObject(){return{interval:(0,wo.msToDuration)(this.intervalMs),base_ejection_time:(0,wo.msToDuration)(this.baseEjectionTimeMs),max_ejection_time:(0,wo.msToDuration)(this.maxEjectionTimeMs),max_ejection_percent:this.maxEjectionPercent,success_rate_ejection:this.successRateEjection,failure_percentage_ejection:this.failurePercentageEjection,child_policy:this.childPolicy.map(e=>e.toJsonObject())}}getIntervalMs(){return this.intervalMs}getBaseEjectionTimeMs(){return this.baseEjectionTimeMs}getMaxEjectionTimeMs(){return this.maxEjectionTimeMs}getMaxEjectionPercent(){return this.maxEjectionPercent}getSuccessRateEjectionConfig(){return this.successRateEjection}getFailurePercentageEjectionConfig(){return this.failurePercentageEjection}getChildPolicy(){return this.childPolicy}copyWithChildPolicy(e){return new n(this.intervalMs,this.baseEjectionTimeMs,this.maxEjectionTimeMs,this.maxEjectionPercent,this.successRateEjection,this.failurePercentageEjection,e)}static createFromJson(e){var t;if(hT(e,"interval"),hT(e,"base_ejection_time"),hT(e,"max_ejection_time"),Fm(e,"max_ejection_percent"),"success_rate_ejection"in e){if(typeof e.success_rate_ejection!="object")throw new Error("outlier detection config success_rate_ejection must be an object");vl(e.success_rate_ejection,"stdev_factor","number","success_rate_ejection"),Fm(e.success_rate_ejection,"enforcement_percentage","success_rate_ejection"),vl(e.success_rate_ejection,"minimum_hosts","number","success_rate_ejection"),vl(e.success_rate_ejection,"request_volume","number","success_rate_ejection")}if("failure_percentage_ejection"in e){if(typeof e.failure_percentage_ejection!="object")throw new Error("outlier detection config failure_percentage_ejection must be an object");Fm(e.failure_percentage_ejection,"threshold","failure_percentage_ejection"),Fm(e.failure_percentage_ejection,"enforcement_percentage","failure_percentage_ejection"),vl(e.failure_percentage_ejection,"minimum_hosts","number","failure_percentage_ejection"),vl(e.failure_percentage_ejection,"request_volume","number","failure_percentage_ejection")}return new n(e.interval?(0,wo.durationToMs)(e.interval):null,e.base_ejection_time?(0,wo.durationToMs)(e.base_ejection_time):null,e.max_ejection_time?(0,wo.durationToMs)(e.max_ejection_time):null,(t=e.max_ejection_percent)!==null&&t!==void 0?t:null,e.success_rate_ejection,e.failure_percentage_ejection,e.child_policy.map(iF.validateLoadBalancingConfig))}};ms.OutlierDetectionLoadBalancingConfig=ud;var pT=class extends d5.BaseSubchannelWrapper{constructor(e,t){super(e),this.mapEntry=t,this.stateListeners=[],this.ejected=!1,this.refCount=0,this.childSubchannelState=e.getConnectivityState(),e.addConnectivityStateListener((r,i,s,o)=>{if(this.childSubchannelState=s,!this.ejected)for(let a of this.stateListeners)a(this,i,s,o)})}getConnectivityState(){return this.ejected?Lm.ConnectivityState.TRANSIENT_FAILURE:this.childSubchannelState}addConnectivityStateListener(e){this.stateListeners.push(e)}removeConnectivityStateListener(e){let t=this.stateListeners.indexOf(e);t>-1&&this.stateListeners.splice(t,1)}ref(){this.child.ref(),this.refCount+=1}unref(){if(this.child.unref(),this.refCount-=1,this.refCount<=0&&this.mapEntry){let e=this.mapEntry.subchannelWrappers.indexOf(this);e>=0&&this.mapEntry.subchannelWrappers.splice(e,1)}}eject(){this.ejected=!0;for(let e of this.stateListeners)e(this,this.childSubchannelState,Lm.ConnectivityState.TRANSIENT_FAILURE,-1)}uneject(){this.ejected=!1;for(let e of this.stateListeners)e(this,Lm.ConnectivityState.TRANSIENT_FAILURE,this.childSubchannelState,-1)}getMapEntry(){return this.mapEntry}getWrappedSubchannel(){return this.child}};function fT(){return{success:0,failure:0}}var mT=class{constructor(){this.activeBucket=fT(),this.inactiveBucket=fT()}addSuccess(){this.activeBucket.success+=1}addFailure(){this.activeBucket.failure+=1}switchBuckets(){this.inactiveBucket=this.activeBucket,this.activeBucket=fT()}getLastSuccesses(){return this.inactiveBucket.success}getLastFailures(){return this.inactiveBucket.failure}},gT=class{constructor(e,t){this.wrappedPicker=e,this.countCalls=t}pick(e){let t=this.wrappedPicker.pick(e);if(t.pickResultType===u5.PickResultType.COMPLETE){let r=t.subchannel,i=r.getMapEntry();if(i){let s=t.onCallEnded;return this.countCalls&&(s=o=>{var a;o===nF.Status.OK?i.counter.addSuccess():i.counter.addFailure(),(a=t.onCallEnded)===null||a===void 0||a.call(t,o)}),Object.assign(Object.assign({},t),{subchannel:r.getWrappedSubchannel(),onCallEnded:s})}else return Object.assign(Object.assign({},t),{subchannel:r.getWrappedSubchannel()})}else return t}},Bm=class{constructor(e){this.addressMap=new Map,this.latestConfig=null,this.timerStartTime=null,this.childBalancer=new c5.ChildLoadBalancerHandler((0,rF.createChildChannelControlHelper)(e,{createSubchannel:(t,r)=>{let i=e.createSubchannel(t,r),s=this.addressMap.get((0,tF.subchannelAddressToString)(t)),o=new pT(i,s);return s?.currentEjectionTimestamp!==null&&o.eject(),s?.subchannelWrappers.push(o),o},updateState:(t,r)=>{t===Lm.ConnectivityState.READY?e.updateState(t,new gT(r,this.isCountingEnabled())):e.updateState(t,r)}})),this.ejectionTimer=setInterval(()=>{},0),clearInterval(this.ejectionTimer)}isCountingEnabled(){return this.latestConfig!==null&&(this.latestConfig.getSuccessRateEjectionConfig()!==null||this.latestConfig.getFailurePercentageEjectionConfig()!==null)}getCurrentEjectionPercent(){let e=0;for(let t of this.addressMap.values())t.currentEjectionTimestamp!==null&&(e+=1);return e*100/this.addressMap.size}runSuccessRateCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getSuccessRateEjectionConfig();if(!t)return;It("Running success rate check");let r=t.request_volume,i=0,s=[];for(let[d,h]of this.addressMap){let p=h.counter.getLastSuccesses(),E=h.counter.getLastFailures();It("Stats for "+d+": successes="+p+" failures="+E+" targetRequestVolume="+r),p+E>=r&&(i+=1,s.push(p/(p+E)))}if(It("Found "+i+" success rate candidates; currentEjectionPercent="+this.getCurrentEjectionPercent()+" successRates=["+s+"]"),i<t.minimum_hosts)return;let o=s.reduce((d,h)=>d+h)/s.length,a=0;for(let d of s){let h=d-o;a+=h*h}let l=a/s.length,c=Math.sqrt(l),u=o-c*(t.stdev_factor/1e3);It("stdev="+c+" ejectionThreshold="+u);for(let[d,h]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let p=h.counter.getLastSuccesses(),E=h.counter.getLastFailures();if(p+E<r)continue;let w=p/(p+E);if(It("Checking candidate "+d+" successRate="+w),w<u){let b=Math.random()*100;It("Candidate "+d+" randomNumber="+b+" enforcement_percentage="+t.enforcement_percentage),b<t.enforcement_percentage&&(It("Ejecting candidate "+d),this.eject(h,e))}}}runFailurePercentageCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getFailurePercentageEjectionConfig();if(!t)return;It("Running failure percentage check. threshold="+t.threshold+" request volume threshold="+t.request_volume);let r=0;for(let i of this.addressMap.values()){let s=i.counter.getLastSuccesses(),o=i.counter.getLastFailures();s+o>=t.request_volume&&(r+=1)}if(!(r<t.minimum_hosts))for(let[i,s]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let o=s.counter.getLastSuccesses(),a=s.counter.getLastFailures();if(It("Candidate successes="+o+" failures="+a),o+a<t.request_volume)continue;if(a*100/(a+o)>t.threshold){let c=Math.random()*100;It("Candidate "+i+" randomNumber="+c+" enforcement_percentage="+t.enforcement_percentage),c<t.enforcement_percentage&&(It("Ejecting candidate "+i),this.eject(s,e))}}}eject(e,t){e.currentEjectionTimestamp=new Date,e.ejectionTimeMultiplier+=1;for(let r of e.subchannelWrappers)r.eject()}uneject(e){e.currentEjectionTimestamp=null;for(let t of e.subchannelWrappers)t.uneject()}switchAllBuckets(){for(let e of this.addressMap.values())e.counter.switchBuckets()}startTimer(e){var t,r;this.ejectionTimer=setTimeout(()=>this.runChecks(),e),(r=(t=this.ejectionTimer).unref)===null||r===void 0||r.call(t)}runChecks(){let e=new Date;if(It("Ejection timer running"),this.switchAllBuckets(),!!this.latestConfig){this.timerStartTime=e,this.startTimer(this.latestConfig.getIntervalMs()),this.runSuccessRateCheck(e),this.runFailurePercentageCheck(e);for(let[t,r]of this.addressMap.entries())if(r.currentEjectionTimestamp===null)r.ejectionTimeMultiplier>0&&(r.ejectionTimeMultiplier-=1);else{let i=this.latestConfig.getBaseEjectionTimeMs(),s=this.latestConfig.getMaxEjectionTimeMs(),o=new Date(r.currentEjectionTimestamp.getTime());o.setMilliseconds(o.getMilliseconds()+Math.min(i*r.ejectionTimeMultiplier,Math.max(i,s))),o<new Date&&(It("Unejecting "+t),this.uneject(r))}}}updateAddressList(e,t,r){if(!(t instanceof ud))return;let i=new Set;for(let o of e)i.add((0,tF.subchannelAddressToString)(o));for(let o of i)this.addressMap.has(o)||(It("Adding map entry for "+o),this.addressMap.set(o,{counter:new mT,currentEjectionTimestamp:null,ejectionTimeMultiplier:0,subchannelWrappers:[]}));for(let o of this.addressMap.keys())i.has(o)||(It("Removing map entry for "+o),this.addressMap.delete(o));let s=(0,iF.getFirstUsableConfig)(t.getChildPolicy(),!0);if(this.childBalancer.updateAddressList(e,s,r),t.getSuccessRateEjectionConfig()||t.getFailurePercentageEjectionConfig())if(this.timerStartTime){It("Previous timer existed. Replacing timer"),clearTimeout(this.ejectionTimer);let o=t.getIntervalMs()-(new Date().getTime()-this.timerStartTime.getTime());this.startTimer(o)}else It("Starting new timer"),this.timerStartTime=new Date,this.startTimer(t.getIntervalMs()),this.switchAllBuckets();else{It("Counting disabled. Cancelling timer."),this.timerStartTime=null,clearTimeout(this.ejectionTimer);for(let o of this.addressMap.values())this.uneject(o),o.ejectionTimeMultiplier=0}this.latestConfig=t}exitIdle(){this.childBalancer.exitIdle()}resetBackoff(){this.childBalancer.resetBackoff()}destroy(){clearTimeout(this.ejectionTimer),this.childBalancer.destroy()}getTypeName(){return yT}};ms.OutlierDetectionLoadBalancer=Bm;function y5(){p5&&(0,rF.registerLoadBalancerType)(yT,Bm,ud)}ms.setup=y5});var vT=A(te=>{"use strict";Object.defineProperty(te,"__esModule",{value:!0});te.OutlierDetectionLoadBalancingConfig=te.BaseSubchannelWrapper=te.registerAdminService=te.FilterStackFactory=te.BaseFilter=te.PickResultType=te.QueuePicker=te.UnavailablePicker=te.ChildLoadBalancerHandler=te.subchannelAddressToString=te.validateLoadBalancingConfig=te.getFirstUsableConfig=te.registerLoadBalancerType=te.createChildChannelControlHelper=te.BackoffTimeout=te.durationToMs=te.uriToString=te.createResolver=te.registerResolver=te.log=te.trace=void 0;var sF=Xe();Object.defineProperty(te,"trace",{enumerable:!0,get:function(){return sF.trace}});Object.defineProperty(te,"log",{enumerable:!0,get:function(){return sF.log}});var oF=Tr();Object.defineProperty(te,"registerResolver",{enumerable:!0,get:function(){return oF.registerResolver}});Object.defineProperty(te,"createResolver",{enumerable:!0,get:function(){return oF.createResolver}});var _5=mn();Object.defineProperty(te,"uriToString",{enumerable:!0,get:function(){return _5.uriToString}});var v5=uT();Object.defineProperty(te,"durationToMs",{enumerable:!0,get:function(){return v5.durationToMs}});var E5=Ou();Object.defineProperty(te,"BackoffTimeout",{enumerable:!0,get:function(){return E5.BackoffTimeout}});var Vm=ji();Object.defineProperty(te,"createChildChannelControlHelper",{enumerable:!0,get:function(){return Vm.createChildChannelControlHelper}});Object.defineProperty(te,"registerLoadBalancerType",{enumerable:!0,get:function(){return Vm.registerLoadBalancerType}});Object.defineProperty(te,"getFirstUsableConfig",{enumerable:!0,get:function(){return Vm.getFirstUsableConfig}});Object.defineProperty(te,"validateLoadBalancingConfig",{enumerable:!0,get:function(){return Vm.validateLoadBalancingConfig}});var S5=Ir();Object.defineProperty(te,"subchannelAddressToString",{enumerable:!0,get:function(){return S5.subchannelAddressToString}});var C5=yp();Object.defineProperty(te,"ChildLoadBalancerHandler",{enumerable:!0,get:function(){return C5.ChildLoadBalancerHandler}});var ET=Qi();Object.defineProperty(te,"UnavailablePicker",{enumerable:!0,get:function(){return ET.UnavailablePicker}});Object.defineProperty(te,"QueuePicker",{enumerable:!0,get:function(){return ET.QueuePicker}});Object.defineProperty(te,"PickResultType",{enumerable:!0,get:function(){return ET.PickResultType}});var w5=Mw();Object.defineProperty(te,"BaseFilter",{enumerable:!0,get:function(){return w5.BaseFilter}});var T5=Ow();Object.defineProperty(te,"FilterStackFactory",{enumerable:!0,get:function(){return T5.FilterStackFactory}});var b5=vp();Object.defineProperty(te,"registerAdminService",{enumerable:!0,get:function(){return b5.registerAdminService}});var I5=bm();Object.defineProperty(te,"BaseSubchannelWrapper",{enumerable:!0,get:function(){return I5.BaseSubchannelWrapper}});var A5=_T();Object.defineProperty(te,"OutlierDetectionLoadBalancingConfig",{enumerable:!0,get:function(){return A5.OutlierDetectionLoadBalancingConfig}})});var aF=A(Um=>{"use strict";Object.defineProperty(Um,"__esModule",{value:!0});Um.setup=void 0;var R5=Tr(),ST=class{constructor(e,t,r){this.listener=t,this.addresses=[],this.hasReturnedResult=!1;let i;e.authority===""?i="/"+e.path:i=e.path,this.addresses=[{path:i}]}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(this.listener.onSuccessfulResolution,this.addresses,null,null,null,{}))}destroy(){}static getDefaultAuthority(e){return"localhost"}};function D5(){(0,R5.registerResolver)("unix",ST)}Um.setup=D5});var hF=A(Gm=>{"use strict";Object.defineProperty(Gm,"__esModule",{value:!0});Gm.setup=void 0;var lF=X("net"),qm=we(),CT=tn(),cF=Tr(),uF=mn(),N5=Xe(),k5="ip_resolver";function dF(n){N5.trace(qm.LogVerbosity.DEBUG,k5,n)}var wT="ipv4",TT="ipv6",O5=443,zm=class{constructor(e,t,r){var i;this.listener=t,this.addresses=[],this.error=null,this.hasReturnedResult=!1,dF("Resolver constructed for target "+(0,uF.uriToString)(e));let s=[];if(!(e.scheme===wT||e.scheme===TT)){this.error={code:qm.Status.UNAVAILABLE,details:`Unrecognized scheme ${e.scheme} in IP resolver`,metadata:new CT.Metadata};return}let o=e.path.split(",");for(let a of o){let l=(0,uF.splitHostPort)(a);if(l===null){this.error={code:qm.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${a}`,metadata:new CT.Metadata};return}if(e.scheme===wT&&!(0,lF.isIPv4)(l.host)||e.scheme===TT&&!(0,lF.isIPv6)(l.host)){this.error={code:qm.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${a}`,metadata:new CT.Metadata};return}s.push({host:l.host,port:(i=l.port)!==null&&i!==void 0?i:O5})}this.addresses=s,dF("Parsed "+e.scheme+" address list "+this.addresses)}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(()=>{this.error?this.listener.onError(this.error):this.listener.onSuccessfulResolution(this.addresses,null,null,null,{})}))}destroy(){this.hasReturnedResult=!1}static getDefaultAuthority(e){return e.path.split(",")[0]}};function x5(){(0,cF.registerResolver)(wT,zm),(0,cF.registerResolver)(TT,zm)}Gm.setup=x5});var mF=A(Vr=>{"use strict";Object.defineProperty(Vr,"__esModule",{value:!0});Vr.setup=Vr.PickFirstLoadBalancer=Vr.shuffled=Vr.PickFirstLoadBalancingConfig=void 0;var fF=ji(),Mt=Dn(),Wm=Qi(),P5=Xe(),M5=we(),F5="pick_first";function bT(n){P5.trace(M5.LogVerbosity.DEBUG,F5,n)}var dd="pick_first",L5=250,hd=class n{constructor(e){this.shuffleAddressList=e}getLoadBalancerName(){return dd}toJsonObject(){return{[dd]:{shuffleAddressList:this.shuffleAddressList}}}getShuffleAddressList(){return this.shuffleAddressList}static createFromJson(e){if("shuffleAddressList"in e&&typeof e.shuffleAddressList!="boolean")throw new Error("pick_first config field shuffleAddressList must be a boolean if provided");return new n(e.shuffleAddressList===!0)}};Vr.PickFirstLoadBalancingConfig=hd;var IT=class{constructor(e){this.subchannel=e}pick(e){return{pickResultType:Wm.PickResultType.COMPLETE,subchannel:this.subchannel,status:null,onCallStarted:null,onCallEnded:null}}};function pF(n){let e=n.slice();for(let t=e.length-1;t>1;t--){let r=Math.floor(Math.random()*(t+1)),i=e[t];e[t]=e[r],e[r]=i}return e}Vr.shuffled=pF;var jm=class{constructor(e){this.channelControlHelper=e,this.children=[],this.currentState=Mt.ConnectivityState.IDLE,this.currentSubchannelIndex=0,this.currentPick=null,this.subchannelStateListener=(t,r,i,s,o)=>{this.onSubchannelStateUpdate(t,r,i,o)},this.triedAllSubchannels=!1,this.stickyTransientFailureMode=!1,this.requestedResolutionSinceLastUpdate=!1,this.lastError=null,this.latestAddressList=null,this.connectionDelayTimeout=setTimeout(()=>{},0),clearTimeout(this.connectionDelayTimeout)}allChildrenHaveReportedTF(){return this.children.every(e=>e.hasReportedTransientFailure)}calculateAndReportNewState(){this.currentPick?this.updateState(Mt.ConnectivityState.READY,new IT(this.currentPick)):this.children.length===0?this.updateState(Mt.ConnectivityState.IDLE,new Wm.QueuePicker(this)):this.stickyTransientFailureMode?this.updateState(Mt.ConnectivityState.TRANSIENT_FAILURE,new Wm.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(Mt.ConnectivityState.CONNECTING,new Wm.QueuePicker(this))}requestReresolution(){this.requestedResolutionSinceLastUpdate=!0,this.channelControlHelper.requestReresolution()}maybeEnterStickyTransientFailureMode(){if(this.allChildrenHaveReportedTF()&&(this.requestedResolutionSinceLastUpdate||this.requestReresolution(),!this.stickyTransientFailureMode)){this.stickyTransientFailureMode=!0;for(let{subchannel:e}of this.children)e.startConnecting();this.calculateAndReportNewState()}}removeCurrentPick(){if(this.currentPick!==null){let e=this.currentPick;this.currentPick=null,e.unref(),e.removeConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.removeChannelzChild(e.getChannelzRef())}}onSubchannelStateUpdate(e,t,r,i){var s;if(!((s=this.currentPick)===null||s===void 0)&&s.realSubchannelEquals(e)){r!==Mt.ConnectivityState.READY&&(this.removeCurrentPick(),this.calculateAndReportNewState(),this.requestReresolution());return}for(let[o,a]of this.children.entries())if(e.realSubchannelEquals(a.subchannel)){r===Mt.ConnectivityState.READY&&this.pickSubchannel(a.subchannel),r===Mt.ConnectivityState.TRANSIENT_FAILURE&&(a.hasReportedTransientFailure=!0,i&&(this.lastError=i),this.maybeEnterStickyTransientFailureMode(),o===this.currentSubchannelIndex&&this.startNextSubchannelConnecting(o+1)),a.subchannel.startConnecting();return}}startNextSubchannelConnecting(e){if(clearTimeout(this.connectionDelayTimeout),!this.triedAllSubchannels){for(let[t,r]of this.children.entries())if(t>=e){let i=r.subchannel.getConnectivityState();if(i===Mt.ConnectivityState.IDLE||i===Mt.ConnectivityState.CONNECTING){this.startConnecting(t);return}}this.triedAllSubchannels=!0,this.maybeEnterStickyTransientFailureMode()}}startConnecting(e){var t,r;clearTimeout(this.connectionDelayTimeout),this.currentSubchannelIndex=e,this.children[e].subchannel.getConnectivityState()===Mt.ConnectivityState.IDLE&&(bT("Start connecting to subchannel with address "+this.children[e].subchannel.getAddress()),process.nextTick(()=>{var i;(i=this.children[e])===null||i===void 0||i.subchannel.startConnecting()})),this.connectionDelayTimeout=(r=(t=setTimeout(()=>{this.startNextSubchannelConnecting(e+1)},L5)).unref)===null||r===void 0?void 0:r.call(t)}pickSubchannel(e){this.currentPick&&e.realSubchannelEquals(this.currentPick)||(bT("Pick subchannel with address "+e.getAddress()),this.stickyTransientFailureMode=!1,this.currentPick!==null&&(this.currentPick.unref(),this.channelControlHelper.removeChannelzChild(this.currentPick.getChannelzRef()),this.currentPick.removeConnectivityStateListener(this.subchannelStateListener)),this.currentPick=e,e.ref(),this.channelControlHelper.addChannelzChild(e.getChannelzRef()),this.resetSubchannelList(),clearTimeout(this.connectionDelayTimeout),this.calculateAndReportNewState())}updateState(e,t){bT(Mt.ConnectivityState[this.currentState]+" -> "+Mt.ConnectivityState[e]),this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.children)this.currentPick&&e.subchannel.realSubchannelEquals(this.currentPick)||e.subchannel.removeConnectivityStateListener(this.subchannelStateListener),e.subchannel.unref(),this.channelControlHelper.removeChannelzChild(e.subchannel.getChannelzRef());this.currentSubchannelIndex=0,this.children=[],this.triedAllSubchannels=!1,this.requestedResolutionSinceLastUpdate=!1}connectToAddressList(e){let t=e.map(r=>({subchannel:this.channelControlHelper.createSubchannel(r,{}),hasReportedTransientFailure:!1}));for(let{subchannel:r}of t)r.ref(),this.channelControlHelper.addChannelzChild(r.getChannelzRef());this.resetSubchannelList(),this.children=t;for(let{subchannel:r}of this.children)if(r.addConnectivityStateListener(this.subchannelStateListener),r.getConnectivityState()===Mt.ConnectivityState.READY){this.pickSubchannel(r);return}for(let r of this.children)r.subchannel.getConnectivityState()===Mt.ConnectivityState.TRANSIENT_FAILURE&&(r.hasReportedTransientFailure=!0);this.startNextSubchannelConnecting(0),this.calculateAndReportNewState()}updateAddressList(e,t){t instanceof hd&&(t.getShuffleAddressList()&&(e=pF(e)),this.latestAddressList=e,this.connectToAddressList(e))}exitIdle(){this.currentState===Mt.ConnectivityState.IDLE&&this.latestAddressList&&this.connectToAddressList(this.latestAddressList)}resetBackoff(){}destroy(){this.resetSubchannelList(),this.removeCurrentPick()}getTypeName(){return dd}};Vr.PickFirstLoadBalancer=jm;function B5(){(0,fF.registerLoadBalancerType)(dd,jm,hd),(0,fF.registerDefaultLoadBalancerType)(dd)}Vr.setup=B5});var yF=A(El=>{"use strict";Object.defineProperty(El,"__esModule",{value:!0});El.setup=El.RoundRobinLoadBalancer=void 0;var V5=ji(),Ft=Dn(),$m=Qi(),U5=Ir(),q5=Xe(),z5=we(),G5="round_robin";function gF(n){q5.trace(z5.LogVerbosity.DEBUG,G5,n)}var Hm="round_robin",AT=class n{getLoadBalancerName(){return Hm}constructor(){}toJsonObject(){return{[Hm]:{}}}static createFromJson(e){return new n}},RT=class{constructor(e,t=0){this.subchannelList=e,this.nextIndex=t}pick(e){let t=this.subchannelList[this.nextIndex];return this.nextIndex=(this.nextIndex+1)%this.subchannelList.length,{pickResultType:$m.PickResultType.COMPLETE,subchannel:t,status:null,onCallStarted:null,onCallEnded:null}}peekNextSubchannel(){return this.subchannelList[this.nextIndex]}},Km=class{constructor(e){this.channelControlHelper=e,this.subchannels=[],this.currentState=Ft.ConnectivityState.IDLE,this.currentReadyPicker=null,this.lastError=null,this.subchannelStateListener=(t,r,i,s,o)=>{this.calculateAndUpdateState(),(i===Ft.ConnectivityState.TRANSIENT_FAILURE||i===Ft.ConnectivityState.IDLE)&&(o&&(this.lastError=o),this.channelControlHelper.requestReresolution(),t.startConnecting())}}countSubchannelsWithState(e){return this.subchannels.filter(t=>t.getConnectivityState()===e).length}calculateAndUpdateState(){if(this.countSubchannelsWithState(Ft.ConnectivityState.READY)>0){let e=this.subchannels.filter(r=>r.getConnectivityState()===Ft.ConnectivityState.READY),t=0;this.currentReadyPicker!==null&&(t=e.indexOf(this.currentReadyPicker.peekNextSubchannel()),t<0&&(t=0)),this.updateState(Ft.ConnectivityState.READY,new RT(e,t))}else this.countSubchannelsWithState(Ft.ConnectivityState.CONNECTING)>0?this.updateState(Ft.ConnectivityState.CONNECTING,new $m.QueuePicker(this)):this.countSubchannelsWithState(Ft.ConnectivityState.TRANSIENT_FAILURE)>0?this.updateState(Ft.ConnectivityState.TRANSIENT_FAILURE,new $m.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(Ft.ConnectivityState.IDLE,new $m.QueuePicker(this))}updateState(e,t){gF(Ft.ConnectivityState[this.currentState]+" -> "+Ft.ConnectivityState[e]),e===Ft.ConnectivityState.READY?this.currentReadyPicker=t:this.currentReadyPicker=null,this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.subchannels)e.removeConnectivityStateListener(this.subchannelStateListener),e.unref(),this.channelControlHelper.removeChannelzChild(e.getChannelzRef());this.subchannels=[]}updateAddressList(e,t){this.resetSubchannelList(),gF("Connect to address list "+e.map(r=>(0,U5.subchannelAddressToString)(r))),this.subchannels=e.map(r=>this.channelControlHelper.createSubchannel(r,{}));for(let r of this.subchannels){r.ref(),r.addConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.addChannelzChild(r.getChannelzRef());let i=r.getConnectivityState();(i===Ft.ConnectivityState.IDLE||i===Ft.ConnectivityState.TRANSIENT_FAILURE)&&r.startConnecting()}this.calculateAndUpdateState()}exitIdle(){for(let e of this.subchannels)e.startConnecting()}resetBackoff(){}destroy(){this.resetSubchannelList()}getTypeName(){return Hm}};El.RoundRobinLoadBalancer=Km;function W5(){(0,V5.registerLoadBalancerType)(Hm,Km,AT)}El.setup=W5});var SF=A(W=>{"use strict";Object.defineProperty(W,"__esModule",{value:!0});W.experimental=W.addAdminServicesToServer=W.getChannelzHandlers=W.getChannelzServiceDefinition=W.InterceptorConfigurationError=W.InterceptingCall=W.RequesterBuilder=W.ListenerBuilder=W.StatusBuilder=W.getClientChannel=W.ServerCredentials=W.Server=W.setLogVerbosity=W.setLogger=W.load=W.loadObject=W.CallCredentials=W.ChannelCredentials=W.waitForClientReady=W.closeClient=W.Channel=W.makeGenericClientConstructor=W.makeClientConstructor=W.loadPackageDefinition=W.Client=W.compressionAlgorithms=W.propagate=W.connectivityState=W.status=W.logVerbosity=W.Metadata=W.credentials=void 0;var Qm=TS();Object.defineProperty(W,"CallCredentials",{enumerable:!0,get:function(){return Qm.CallCredentials}});var j5=nC();Object.defineProperty(W,"Channel",{enumerable:!0,get:function(){return j5.ChannelImplementation}});var $5=xw();Object.defineProperty(W,"compressionAlgorithms",{enumerable:!0,get:function(){return $5.CompressionAlgorithms}});var H5=Dn();Object.defineProperty(W,"connectivityState",{enumerable:!0,get:function(){return H5.ConnectivityState}});var Ym=up();Object.defineProperty(W,"ChannelCredentials",{enumerable:!0,get:function(){return Ym.ChannelCredentials}});var _F=tC();Object.defineProperty(W,"Client",{enumerable:!0,get:function(){return _F.Client}});var DT=we();Object.defineProperty(W,"logVerbosity",{enumerable:!0,get:function(){return DT.LogVerbosity}});Object.defineProperty(W,"status",{enumerable:!0,get:function(){return DT.Status}});Object.defineProperty(W,"propagate",{enumerable:!0,get:function(){return DT.Propagate}});var vF=Xe(),NT=iC();Object.defineProperty(W,"loadPackageDefinition",{enumerable:!0,get:function(){return NT.loadPackageDefinition}});Object.defineProperty(W,"makeClientConstructor",{enumerable:!0,get:function(){return NT.makeClientConstructor}});Object.defineProperty(W,"makeGenericClientConstructor",{enumerable:!0,get:function(){return NT.makeClientConstructor}});var K5=tn();Object.defineProperty(W,"Metadata",{enumerable:!0,get:function(){return K5.Metadata}});var Q5=ZM();Object.defineProperty(W,"Server",{enumerable:!0,get:function(){return Q5.Server}});var Y5=oT();Object.defineProperty(W,"ServerCredentials",{enumerable:!0,get:function(){return Y5.ServerCredentials}});var X5=eF();Object.defineProperty(W,"StatusBuilder",{enumerable:!0,get:function(){return X5.StatusBuilder}});W.credentials={combineChannelCredentials:(n,...e)=>e.reduce((t,r)=>t.compose(r),n),combineCallCredentials:(n,...e)=>e.reduce((t,r)=>t.compose(r),n),createInsecure:Ym.ChannelCredentials.createInsecure,createSsl:Ym.ChannelCredentials.createSsl,createFromSecureContext:Ym.ChannelCredentials.createFromSecureContext,createFromMetadataGenerator:Qm.CallCredentials.createFromMetadataGenerator,createFromGoogleCredential:Qm.CallCredentials.createFromGoogleCredential,createEmpty:Qm.CallCredentials.createEmpty};var J5=n=>n.close();W.closeClient=J5;var Z5=(n,e,t)=>n.waitForReady(e,t);W.waitForClientReady=Z5;var e8=(n,e)=>{throw new Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")};W.loadObject=e8;var t8=(n,e,t)=>{throw new Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")};W.load=t8;var n8=n=>{vF.setLogger(n)};W.setLogger=n8;var r8=n=>{vF.setLoggerVerbosity(n)};W.setLogVerbosity=r8;var i8=n=>_F.Client.prototype.getChannel.call(n);W.getClientChannel=i8;var Xm=JS();Object.defineProperty(W,"ListenerBuilder",{enumerable:!0,get:function(){return Xm.ListenerBuilder}});Object.defineProperty(W,"RequesterBuilder",{enumerable:!0,get:function(){return Xm.RequesterBuilder}});Object.defineProperty(W,"InterceptingCall",{enumerable:!0,get:function(){return Xm.InterceptingCall}});Object.defineProperty(W,"InterceptorConfigurationError",{enumerable:!0,get:function(){return Xm.InterceptorConfigurationError}});var EF=Eo();Object.defineProperty(W,"getChannelzServiceDefinition",{enumerable:!0,get:function(){return EF.getChannelzServiceDefinition}});Object.defineProperty(W,"getChannelzHandlers",{enumerable:!0,get:function(){return EF.getChannelzHandlers}});var s8=vp();Object.defineProperty(W,"addAdminServicesToServer",{enumerable:!0,get:function(){return s8.addAdminServicesToServer}});var o8=vT();W.experimental=o8;var a8=Ew(),l8=aF(),c8=hF(),u8=mF(),d8=yF(),h8=_T(),f8=Eo();a8.setup(),l8.setup(),c8.setup(),u8.setup(),d8.setup(),h8.setup(),f8.setup()});var lR=(()=>{class n{constructor(){this.title="employee-management-system"}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=fr({type:n,selectors:[["app-root"]],standalone:!0,features:[mr],decls:12,vars:0,consts:[[1,"navbar"],[1,"logo"],[1,"list"],[1,"item"],["href","#"],[1,"container","my-4"]],template:function(r,i){r&1&&(ve(0,"nav",0)(1,"div",1),Te(2,"Employeeeep"),he(),ve(3,"ul",2)(4,"li",3)(5,"a",4),Te(6,"Home"),he()(),ve(7,"li",3)(8,"a"),Te(9,"EmployeeList"),he()()()(),ve(10,"div",5),Zr(11,"router-outlet"),he())},dependencies:[vh],styles:["ul[_ngcontent-%COMP%]{display:flex;list-style:none;list-style-type:none}li[_ngcontent-%COMP%]{padding:15px}a[_ngcontent-%COMP%]{text-decoration:none;color:#fff}a[_ngcontent-%COMP%]:hover{color:#00aeff}.logo[_ngcontent-%COMP%]{font-size:32px;font-weight:700}.navbar[_ngcontent-%COMP%]{background-color:#000;padding:0 50px;color:#fff}"]})}}return n})();var uR=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=fr({type:n,selectors:[["app-home"]],standalone:!0,features:[mr],decls:2,vars:0,consts:[["type","button","routerLink","employee-list",1,"btn","btn-primary"]],template:function(r,i){r&1&&(ve(0,"button",0),Te(1,` Employee List
`),he())},dependencies:[ia,oa,sa]})}}return n})();var Zy=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=fr({type:n,selectors:[["app-employee-details"]],standalone:!0,features:[mr],decls:2,vars:0,template:function(r,i){r&1&&(ve(0,"p"),Te(1,"employee-details works!"),he())}})}}return n})();var _V="firebase",vV="10.14.1";et(_V,vV,"app");var St=new Wy("ANGULARFIRE2_VERSION");function ca(n,e,t){if(e){if(e.length===1)return e[0];let s=e.filter(o=>o.app===t);if(s.length===1)return s[0]}return t.container.getProvider(n).getImmediate({optional:!0})}var $s=(n,e)=>{let t=e?[e]:Dh(),r=[];return t.forEach(i=>{i.container.getProvider(n).instances.forEach(o=>{r.includes(o)||r.push(o)})}),r},qt=class{constructor(){return $s(EV)}},EV="app-check";function la(){}var Nh=class{zone;delegate;constructor(e,t=NA){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,r){let i=this.zone,s=function(o){i.runGuarded(()=>{e.apply(this,[o])})};return this.delegate.schedule(s,t,r)}},e_=class{zone;task=null;constructor(e){this.zone=e}call(e,t){let r=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",la,{},la,la)),t.pipe(MA({next:r,complete:r,error:r})).subscribe(e).add(r)}unscheduleTask(){setTimeout(()=>{this.task!=null&&this.task.state==="scheduled"&&(this.task.invoke(),this.task=null)},10)}},en=(()=>{class n{ngZone;outsideAngular;insideAngular;constructor(t){this.ngZone=t,this.outsideAngular=t.runOutsideAngular(()=>new Nh(Zone.current)),this.insideAngular=t.run(()=>new Nh(Zone.current,ra)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(r){return new(r||n)(Z(vt))};static \u0275prov=Cn({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function kh(){let n=globalThis.\u0275AngularFireScheduler;if(!n)throw new Error(`Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using
provideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).`);return n}function SV(n){return kh().ngZone.runOutsideAngular(()=>n())}function js(n){return kh().ngZone.run(()=>n())}function Ye(n){return CV(kh())(n)}function CV(n){return function(t){return t=t.lift(new e_(n.ngZone)),t.pipe(Us(n.outsideAngular),wi(n.insideAngular))}}var wV=(n,e)=>function(){let r=arguments;return e&&setTimeout(()=>{e.state==="scheduled"&&e.invoke()},10),js(()=>n.apply(void 0,r))},Ri=(n,e)=>function(){let t,r=arguments;for(let s=0;s<arguments.length;s++)typeof r[s]=="function"&&(e&&(t||=js(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",la,{},la,la))),r[s]=wV(r[s],t));let i=SV(()=>n.apply(this,r));if(!e)if(i instanceof ur){let s=kh();return i.pipe(Us(s.outsideAngular),wi(s.insideAngular))}else return js(()=>i);return i instanceof ur?i.pipe(Ye):i instanceof Promise?js(()=>new Promise((s,o)=>i.then(a=>js(()=>s(a)),a=>js(()=>o(a))))):typeof i=="function"&&t?function(){return setTimeout(()=>{t&&t.state==="scheduled"&&t.invoke()},10),i.apply(this,arguments)}:js(()=>i)};var jn=class{constructor(e){return e}},ei=class{constructor(){return Dh()}};function TV(n){return n&&n.length===1?n[0]:new jn(Ws())}var n_=new ge("angularfire2._apps"),bV={provide:jn,useFactory:TV,deps:[[new pt,n_]]},IV={provide:ei,deps:[[new pt,n_]]};function AV(n){return(e,t)=>{let r=t.get(pr);et("angularfire",St.full,"core"),et("angularfire",St.full,"app"),et("angular",yh.full,r.toString());let i=e.runOutsideAngular(()=>n(t));return new jn(i)}}function dR(n,...e){return Ti([bV,IV,{provide:n_,useFactory:AV(n),multi:!0,deps:[vt,Jr,en,...e]}])}var hR=Ri(aR,!0);var RV=new Map,DV={activated:!1,tokenObservers:[]},NV={initialized:!1,enabled:!1};function $n(n){return RV.get(n)||Object.assign({},DV)}function yR(){return NV}var kV="https://content-firebaseappcheck.googleapis.com/v1";var OV="exchangeDebugToken",fR={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},one=24*60*60*1e3;var i_=class{constructor(e,t,r,i,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=r,this.lowerBound=i,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=i,i>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return T(this,null,function*(){this.stop();try{this.pending=new Et,this.pending.promise.catch(t=>{}),yield xV(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new Et,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};function xV(n){return new Promise(e=>{setTimeout(e,n)})}var PV={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"},Di=new tR("appCheck","AppCheck",PV);function _R(n){if(!$n(n).activated)throw Di.create("use-before-activation",{appName:n.name})}function vR(r,i){return T(this,arguments,function*({url:n,body:e},t){let s={"Content-Type":"application/json"},o=t.getImmediate({optional:!0});if(o){let p=yield o.getHeartbeatsHeader();p&&(s["X-Firebase-Client"]=p)}let a={method:"POST",body:JSON.stringify(e),headers:s},l;try{l=yield fetch(n,a)}catch(p){throw Di.create("fetch-network-error",{originalErrorMessage:p?.message})}if(l.status!==200)throw Di.create("fetch-status-error",{httpStatus:l.status});let c;try{c=yield l.json()}catch(p){throw Di.create("fetch-parse-error",{originalErrorMessage:p?.message})}let u=c.ttl.match(/^([\d.]+)(s)$/);if(!u||!u[2]||isNaN(Number(u[1])))throw Di.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${c.ttl}`});let d=Number(u[1])*1e3,h=Date.now();return{token:c.token,expireTimeMillis:h+d,issuedAtTimeMillis:h}})}function ER(n,e){let{projectId:t,appId:r,apiKey:i}=n.options;return{url:`${kV}/projects/${t}/apps/${r}:${OV}?key=${i}`,body:{debug_token:e}}}var MV="firebase-app-check-database",FV=1,s_="firebase-app-check-store";var Oh=null;function LV(){return Oh||(Oh=new Promise((n,e)=>{try{let t=indexedDB.open(MV,FV);t.onsuccess=r=>{n(r.target.result)},t.onerror=r=>{var i;e(Di.create("storage-open",{originalErrorMessage:(i=r.target.error)===null||i===void 0?void 0:i.message}))},t.onupgradeneeded=r=>{let i=r.target.result;switch(r.oldVersion){case 0:i.createObjectStore(s_,{keyPath:"compositeKey"})}}}catch(t){e(Di.create("storage-open",{originalErrorMessage:t?.message}))}}),Oh)}function BV(n,e){return VV(UV(n),e)}function VV(n,e){return T(this,null,function*(){let r=(yield LV()).transaction(s_,"readwrite"),s=r.objectStore(s_).put({compositeKey:n,value:e});return new Promise((o,a)=>{s.onsuccess=l=>{o()},r.onerror=l=>{var c;a(Di.create("storage-set",{originalErrorMessage:(c=l.target.error)===null||c===void 0?void 0:c.message}))}})})}function UV(n){return`${n.options.appId}-${n.name}`}var o_=new Ai("@firebase/app-check");function r_(n,e){return Th()?BV(n,e).catch(t=>{o_.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function SR(){return yR().enabled}function CR(){return T(this,null,function*(){let n=yR();if(n.enabled&&n.token)return n.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var qV={error:"UNKNOWN_ERROR"};function zV(n){return Sh.encodeString(JSON.stringify(n),!1)}function a_(n,e=!1){return T(this,null,function*(){let t=n.app;_R(t);let r=$n(t),i=r.token,s;if(i&&!Ac(i)&&(r.token=void 0,i=void 0),!i){let l=yield r.cachedTokenPromise;l&&(Ac(l)?i=l:yield r_(t,void 0))}if(!e&&i&&Ac(i))return{token:i.token};let o=!1;if(SR()){r.exchangeTokenPromise||(r.exchangeTokenPromise=vR(ER(t,yield CR()),n.heartbeatServiceProvider).finally(()=>{r.exchangeTokenPromise=void 0}),o=!0);let l=yield r.exchangeTokenPromise;return yield r_(t,l),r.token=l,{token:l.token}}try{r.exchangeTokenPromise||(r.exchangeTokenPromise=r.provider.getToken().finally(()=>{r.exchangeTokenPromise=void 0}),o=!0),i=yield $n(t).exchangeTokenPromise}catch(l){l.code==="appCheck/throttled"?o_.warn(l.message):o_.error(l),s=l}let a;return i?s?Ac(i)?a={token:i.token,internalError:s}:a=mR(s):(a={token:i.token},r.token=i,yield r_(t,i)):a=mR(s),o&&$V(t,a),a})}function GV(n){return T(this,null,function*(){let e=n.app;_R(e);let{provider:t}=$n(e);if(SR()){let r=yield CR(),{token:i}=yield vR(ER(e,r),n.heartbeatServiceProvider);return{token:i}}else{let{token:r}=yield t.getToken();return{token:r}}})}function WV(n,e,t,r){let{app:i}=n,s=$n(i),o={next:t,error:r,type:e};if(s.tokenObservers=[...s.tokenObservers,o],s.token&&Ac(s.token)){let a=s.token;Promise.resolve().then(()=>{t({token:a.token}),pR(n)}).catch(()=>{})}s.cachedTokenPromise.then(()=>pR(n))}function wR(n,e){let t=$n(n),r=t.tokenObservers.filter(i=>i.next!==e);r.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=r}function pR(n){let{app:e}=n,t=$n(e),r=t.tokenRefresher;r||(r=jV(n),t.tokenRefresher=r),!r.isRunning()&&t.isTokenAutoRefreshEnabled&&r.start()}function jV(n){let{app:e}=n;return new i_(()=>T(this,null,function*(){let t=$n(e),r;if(t.token?r=yield a_(n,!0):r=yield a_(n),r.error)throw r.error;if(r.internalError)throw r.internalError}),()=>!0,()=>{let t=$n(e);if(t.token){let r=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,i=t.token.expireTimeMillis-5*60*1e3;return r=Math.min(r,i),Math.max(0,r-Date.now())}else return 0},fR.RETRIAL_MIN_WAIT,fR.RETRIAL_MAX_WAIT)}function $V(n,e){let t=$n(n).tokenObservers;for(let r of t)try{r.type==="EXTERNAL"&&e.error!=null?r.error(e.error):r.next(e)}catch{}}function Ac(n){return n.expireTimeMillis-Date.now()>0}function mR(n){return{token:zV(qV),error:n}}var l_=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=$n(this.app);for(let t of e)wR(this.app,t.next);return Promise.resolve()}};function HV(n,e){return new l_(n,e)}function KV(n){return{getToken:e=>a_(n,e),getLimitedUseToken:()=>GV(n),addTokenListener:e=>WV(n,"INTERNAL",e),removeTokenListener:e=>wR(n.app,e)}}var QV="@firebase/app-check",YV="0.8.8";var XV="app-check",gR="app-check-internal";function JV(){Gs(new ln(XV,n=>{let e=n.getProvider("app").getImmediate(),t=n.getProvider("heartbeat");return HV(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(gR).initialize()})),Gs(new ln(gR,n=>{let e=n.getProvider("app-check").getImmediate();return KV(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),et(QV,YV)}JV();var ZV=["localhost","0.0.0.0","127.0.0.1"],_ne=typeof window<"u"&&ZV.includes(window.location.hostname);var eU="firebase",tU="10.14.1";gt.registerVersion(eU,tU,"app-compat");var nU=["ngOnDestroy"],bR=(n,e,t,r={})=>new Proxy(n,{get:(i,s)=>t.runOutsideAngular(()=>{if(n[s])return r?.spy?.get&&r.spy.get(s,n[s]),n[s];if(nU.indexOf(s)>-1)return()=>{};let o=e.toPromise().then(a=>{let l=a?.[s];return typeof l=="function"?l.bind(a):l?.then?l.then(c=>t.run(()=>c)):t.run(()=>l)});return new Proxy(()=>{},{get:(a,l)=>o[l],apply:(a,l,c)=>o.then(u=>{let d=u?.(...c);return r?.spy?.apply&&r.spy.apply(s,c,d),d})})})});var xh=class{constructor(e){return e}},Ni=new ge("angularfire2.app.options"),ki=new ge("angularfire2.app.name");function Hs(n,e,t){let r=typeof t=="string"&&t||"[DEFAULT]",i=typeof t=="object"&&t||{};i.name=i.name||r;let o=gt.apps.filter(a=>a&&a.name===i.name)[0]||e.runOutsideAngular(()=>gt.initializeApp(n,i));try{if(JSON.stringify(n)!==JSON.stringify(o.options)){let a=!!module.hot;rU("error",`${o.name} Firebase App already initialized with different options${a?", you may need to reload as Firebase is not HMR aware.":"."}`)}}catch{}return new xh(o)}var rU=(n,...e)=>{jy()&&typeof console<"u"&&console[n](...e)},iU={provide:xh,useFactory:Hs,deps:[Ni,vt,[new pt,ki]]},IR=(()=>{class n{static initializeApp(t,r){return{ngModule:n,providers:[{provide:Ni,useValue:t},{provide:ki,useValue:r}]}}constructor(t){gt.registerVersion("angularfire",St.full,"core"),gt.registerVersion("angularfire",St.full,"app-compat"),gt.registerVersion("angular",yh.full,t.toString())}static \u0275fac=function(r){return new(r||n)(Z(pr))};static \u0275mod=Gn({type:n});static \u0275inj=zn({providers:[iU]})}return n})();function ua(n,e,t,r,i){let[,s,o]=globalThis.\u0275AngularfireInstanceCache.find(a=>a[0]===n)||[];if(s)return sU(i,o)||(TR("error",`${e} was already initialized on the ${t} Firebase App with different settings.${oU?" You may need to reload as Firebase is not HMR aware.":""}`),TR("warn",{is:i,was:o})),s;{let a=r();return globalThis.\u0275AngularfireInstanceCache.push([n,a,i]),a}}function sU(n,e){try{return n.toString()===e.toString()}catch{return n===e}}var oU=typeof module<"u"&&!!module.hot,TR=(n,...e)=>{jy()&&typeof console<"u"&&console[n](...e)};globalThis.\u0275AngularfireInstanceCache||=[];var Rc=new ge("angularfire2.auth.use-emulator"),Dc=new ge("angularfire2.auth.settings"),Nc=new ge("angularfire2.auth.tenant-id"),kc=new ge("angularfire2.auth.langugage-code"),Oc=new ge("angularfire2.auth.use-device-language"),xc=new ge("angularfire.auth.persistence"),Pc=(n,e,t,r,i,s,o,a)=>ua(`${n.name}.auth`,"AngularFireAuth",n.name,()=>{let l=e.runOutsideAngular(()=>n.auth());if(t&&l.useEmulator(...t),r&&(l.tenantId=r),l.languageCode=i,s&&l.useDeviceLanguage(),o)for(let[c,u]of Object.entries(o))l.settings[c]=u;return a&&l.setPersistence(a),l},[t,r,i,s,o,a]),Mc=(()=>{class n{authState;idToken;user;idTokenResult;credential;constructor(t,r,i,s,o,a,l,c,u,d,h,p){let E=new DA,w=hr(void 0).pipe(wi(o.outsideAngular),Yr(()=>s.runOutsideAngular(()=>import("./chunk-FSYHEBWN.mjs"))),Be(()=>Hs(t,s,r)),Be(b=>Pc(b,s,a,c,u,d,l,h)),My({bufferSize:1,refCount:!1}));if(_h(i))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=hr(null);else{w.pipe(OA()).subscribe();let b=w.pipe(Yr(O=>O.getRedirectResult().then(F=>F,()=>null)),Ye,My({bufferSize:1,refCount:!1})),N=w.pipe(Yr(O=>new ur(F=>({unsubscribe:s.runOutsideAngular(()=>O.onAuthStateChanged(G=>F.next(G),G=>F.error(G),()=>F.complete()))})))),D=w.pipe(Yr(O=>new ur(F=>({unsubscribe:s.runOutsideAngular(()=>O.onIdTokenChanged(G=>F.next(G),G=>F.error(G),()=>F.complete()))}))));this.authState=b.pipe(Fy(N),Us(o.outsideAngular),wi(o.insideAngular)),this.user=b.pipe(Fy(D),Us(o.outsideAngular),wi(o.insideAngular)),this.idToken=this.user.pipe(Yr(O=>O?dr(O.getIdToken()):hr(null))),this.idTokenResult=this.user.pipe(Yr(O=>O?dr(O.getIdTokenResult()):hr(null))),this.credential=gc(b,E,this.authState.pipe(yc(O=>!O))).pipe(Be(O=>O?.user?O:null),Us(o.outsideAngular),wi(o.insideAngular))}return bR(this,w,s,{spy:{apply:(b,N,D)=>{(b.startsWith("signIn")||b.startsWith("createUser"))&&D.then(O=>E.next(O))}}})}static \u0275fac=function(r){return new(r||n)(Z(Ni),Z(ki,8),Z(pr),Z(vt),Z(en),Z(Rc,8),Z(Dc,8),Z(Nc,8),Z(kc,8),Z(Oc,8),Z(xc,8),Z(qt,8))};static \u0275prov=Cn({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),AR=(()=>{class n{constructor(){gt.registerVersion("angularfire",St.full,"auth-compat")}static \u0275fac=function(r){return new(r||n)};static \u0275mod=Gn({type:n});static \u0275inj=zn({providers:[Mc]})}return n})();var zN=uh(cN(),1);var Xh="5",GN="v",WN="s",jN="r",$N="f",HN=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,KN="ls",QN="p",Y_="ac",YN="websocket",XN="long_polling";var X_=class{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),lt(t))}get(e){let t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:bh(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}};var J_=class{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return Tn(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}};var JN=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){let e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new X_(e)}}catch{}return new J_},ro=JN("localStorage"),Z_=JN("sessionStorage");var _a=new Ai("@firebase/database"),ZN=function(){let n=1;return function(){return n++}}(),ek=function(n){let e=oR(n),t=new sR;t.update(e);let r=t.digest();return Sh.encodeByteArray(r)},gu=function(...n){let e="";for(let t=0;t<n.length;t++){let r=n[t];Array.isArray(r)||r&&typeof r=="object"&&typeof r.length=="number"?e+=gu.apply(null,r):typeof r=="object"?e+=lt(r):e+=r,e+=" "}return e},io=null,uN=!0,tk=function(n,e){L(!e||n===!0||n===!1,"Can't turn on custom loggers persistently."),n===!0?(_a.logLevel=bn.VERBOSE,io=_a.log.bind(_a),e&&Z_.set("logging_enabled",!0)):typeof n=="function"?io=n:(io=null,Z_.remove("logging_enabled"))},Ct=function(...n){if(uN===!0&&(uN=!1,io===null&&Z_.get("logging_enabled")===!0&&tk(!0)),io){let e=gu.apply(null,n);io(e)}},yu=function(n){return function(...e){Ct(n,...e)}},ev=function(...n){let e="FIREBASE INTERNAL ERROR: "+gu(...n);_a.error(e)},Sr=function(...n){let e=`FIREBASE FATAL ERROR: ${gu(...n)}`;throw _a.error(e),new Error(e)},Ot=function(...n){let e="FIREBASE WARNING: "+gu(...n);_a.warn(e)},fq=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&Ot("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},wf=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},pq=function(n){if(gr()||document.readyState==="complete")n();else{let e=!1,t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},Li="[MIN_NAME]",ti="[MAX_NAME]",oo=function(n,e){if(n===e)return 0;if(n===Li||e===ti)return-1;if(e===Li||n===ti)return 1;{let t=dN(n),r=dN(e);return t!==null?r!==null?t-r===0?n.length-e.length:t-r:-1:r!==null?1:n<e?-1:1}},mq=function(n,e){return n===e?0:n<e?-1:1},$c=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+lt(e))},eE=function(n){if(typeof n!="object"||n===null)return lt(n);let e=[];for(let r in n)e.push(r);e.sort();let t="{";for(let r=0;r<e.length;r++)r!==0&&(t+=","),t+=lt(e[r]),t+=":",t+=eE(n[e[r]]);return t+="}",t},nk=function(n,e){let t=n.length;if(t<=e)return[n];let r=[];for(let i=0;i<t;i+=e)i+e>t?r.push(n.substring(i,t)):r.push(n.substring(i,i+e));return r};function wt(n,e){for(let t in n)n.hasOwnProperty(t)&&e(t,n[t])}var rk=function(n){L(!wf(n),"Invalid JSON number");let e=11,t=52,r=(1<<e-1)-1,i,s,o,a,l;n===0?(s=0,o=0,i=1/n===-1/0?1:0):(i=n<0,n=Math.abs(n),n>=Math.pow(2,1-r)?(a=Math.min(Math.floor(Math.log(n)/Math.LN2),r),s=a+r,o=Math.round(n*Math.pow(2,t-a)-Math.pow(2,t))):(s=0,o=Math.round(n/Math.pow(2,1-r-t))));let c=[];for(l=t;l;l-=1)c.push(o%2?1:0),o=Math.floor(o/2);for(l=e;l;l-=1)c.push(s%2?1:0),s=Math.floor(s/2);c.push(i?1:0),c.reverse();let u=c.join(""),d="";for(l=0;l<64;l+=8){let h=parseInt(u.substr(l,8),2).toString(16);h.length===1&&(h="0"+h),d=d+h}return d.toLowerCase()},gq=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},yq=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function _q(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");let r=new Error(n+" at "+e._path.toString()+": "+t);return r.code=n.toUpperCase(),r}var vq=new RegExp("^-?(0*)\\d{1,10}$"),Eq=-2147483648,Sq=2147483647,dN=function(n){if(vq.test(n)){let e=Number(n);if(e>=Eq&&e<=Sq)return e}return null},Aa=function(n){try{n()}catch(e){setTimeout(()=>{let t=e.stack||"";throw Ot("Exception was thrown by user callback.",t),e},Math.floor(0))}},Cq=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Yc=function(n,e){let t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};var Jh=class{constructor(e,t,r,i,s=!1,o="",a=!1,l=!1){this.secure=t,this.namespace=r,this.webSocketOnly=i,this.nodeAdmin=s,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=l,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=ro.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&ro.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){let e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}};function wq(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function ik(n,e,t){L(typeof e=="string","typeof type must == string"),L(typeof t=="object","typeof params must == object");let r;if(e===YN)r=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===XN)r=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);wq(n)&&(t.ns=n.namespace);let i=[];return wt(t,(s,o)=>{i.push(s+"="+o)}),r+i.join("&")}var tv=class{constructor(){this.counters_={}}incrementCounter(e,t=1){Tn(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return JA(this.counters_)}};var G_={},W_={};function tE(n){let e=n.toString();return G_[e]||(G_[e]=new tv),G_[e]}function Tq(n,e){let t=n.toString();return W_[t]||(W_[t]=e()),W_[t]}var nE="";function rE(n){nE=n}var bq=16384,Iq=45e3,tu=null;typeof MozWebSocket<"u"?tu=MozWebSocket:typeof WebSocket<"u"&&(tu=WebSocket);function Aq(n){tu=n}var ga=(()=>{class n{constructor(t,r,i,s,o,a,l){this.connId=t,this.applicationId=i,this.appCheckToken=s,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=yu(this.connId),this.stats_=tE(r),this.connURL=n.connectionURL_(r,a,l,s,i),this.nodeAdmin=r.nodeAdmin}static connectionURL_(t,r,i,s,o){let a={};return a[GN]=Xh,!gr()&&typeof location<"u"&&location.hostname&&HN.test(location.hostname)&&(a[jN]=$N),r&&(a[WN]=r),i&&(a[KN]=i),s&&(a[Y_]=s),o&&(a[QN]=o),ik(t,YN,a)}open(t,r){this.onDisconnect=r,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,ro.set("previous_websocket_failure",!0);try{let i;if(gr()){let s=this.nodeAdmin?"AdminNode":"Node";i={headers:{"User-Agent":`Firebase/${Xh}/${nE}/${process.platform}/${s}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(i.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(i.headers["X-Firebase-AppCheck"]=this.appCheckToken);let o=process.env,a=this.connURL.indexOf("wss://")===0?o.HTTPS_PROXY||o.https_proxy:o.HTTP_PROXY||o.http_proxy;a&&(i.proxy={origin:a})}this.mySock=new tu(this.connURL,[],i)}catch(i){this.log_("Error instantiating WebSocket.");let s=i.message||i.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=i=>{this.handleIncomingFrame(i)},this.mySock.onerror=i=>{this.log_("WebSocket error.  Closing connection.");let s=i.message||i.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){let t=!1;if(typeof navigator<"u"&&navigator.userAgent){let r=/Android ([0-9]{0,}\.[0-9]{0,})/,i=navigator.userAgent.match(r);i&&i.length>1&&parseFloat(i[1])<4.4&&(t=!0)}return!t&&tu!==null&&!n.forceDisallow_}static previouslyFailed(){return ro.isInMemoryStorage||ro.get("previous_websocket_failure")===!0}markConnectionHealthy(){ro.remove("previous_websocket_failure")}appendFrame_(t){if(this.frames.push(t),this.frames.length===this.totalFrames){let r=this.frames.join("");this.frames=null;let i=bh(r);this.onMessage(i)}}handleNewFrameCount_(t){this.totalFrames=t,this.frames=[]}extractFrameCount_(t){if(L(this.frames===null,"We already have a frame buffer"),t.length<=6){let r=Number(t);if(!isNaN(r))return this.handleNewFrameCount_(r),null}return this.handleNewFrameCount_(1),t}handleIncomingFrame(t){if(this.mySock===null)return;let r=t.data;if(this.bytesReceived+=r.length,this.stats_.incrementCounter("bytes_received",r.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(r);else{let i=this.extractFrameCount_(r);i!==null&&this.appendFrame_(i)}}send(t){this.resetKeepAlive();let r=lt(t);this.bytesSent+=r.length,this.stats_.incrementCounter("bytes_sent",r.length);let i=nk(r,bq);i.length>1&&this.sendString_(String(i.length));for(let s=0;s<i.length;s++)this.sendString_(i[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(Iq))}sendString_(t){try{this.mySock.send(t)}catch(r){this.log_("Exception thrown from WebSocket.send():",r.message||r.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}return n.responsesRequiredToBeHealthy=2,n.healthyTimeout=3e4,n})(),hN="@firebase/database",fN="1.0.8";var nv=class{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(r=>this.appCheck=r)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,r)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)===null||t===void 0||t.get().then(r=>r.addTokenListener(e))}notifyForInvalidToken(){Ot(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}};var rv=class{constructor(e,t,r){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit(i=>this.auth_=i)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(Ct("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,r)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Ot(e)}},Xc=(()=>{class n{constructor(t){this.accessToken=t}getToken(t){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(t){t(this.accessToken)}removeTokenChangeListener(t){}notifyForInvalidToken(){}}n.OWNER="owner";return n})(),iv=class{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){let r=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let i=0;i<r.length;++i)r[i]&&Aa(()=>{this.onMessage_(r[i])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}};var pN="start",Rq="close",Dq="pLPCommand",Nq="pRTLPCB",sk="id",ok="pw",ak="ser",kq="cb",Oq="seg",xq="ts",Pq="d",Mq="dframe",lk=1870,ck=30,Fq=lk-ck,Lq=25e3,Bq=3e4,nu=class n{constructor(e,t,r,i,s,o,a){this.connId=e,this.repoInfo=t,this.applicationId=r,this.appCheckToken=i,this.authToken=s,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=yu(e),this.stats_=tE(t),this.urlFn=l=>(this.appCheckToken&&(l[Y_]=this.appCheckToken),ik(t,XN,l))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new iv(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(Bq)),pq(()=>{if(this.isClosed_)return;this.scriptTagHolder=new sv((...s)=>{let[o,a,l,c,u]=s;if(this.incrementIncomingBytes_(s),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===pN)this.id=a,this.password=l;else if(o===Rq)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...s)=>{let[o,a]=s;this.incrementIncomingBytes_(s),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);let r={};r[pN]="t",r[ak]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(r[kq]=this.scriptTagHolder.uniqueCallbackIdentifier),r[GN]=Xh,this.transportSessionId&&(r[WN]=this.transportSessionId),this.lastSessionId&&(r[KN]=this.lastSessionId),this.applicationId&&(r[QN]=this.applicationId),this.appCheckToken&&(r[Y_]=this.appCheckToken),typeof location<"u"&&location.hostname&&HN.test(location.hostname)&&(r[jN]=$N);let i=this.urlFn(r);this.log_("Connecting via long-poll to "+i),this.scriptTagHolder.addTag(i,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){n.forceAllow_=!0}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){return gr()?!1:n.forceAllow_?!0:!n.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!gq()&&!yq()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){let t=lt(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let r=XA(t),i=nk(r,Fq);for(let s=0;s<i.length;s++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[s]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(gr())return;this.myDisconnFrame=document.createElement("iframe");let r={};r[Mq]="t",r[sk]=e,r[ok]=t,this.myDisconnFrame.src=this.urlFn(r),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let t=lt(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}},sv=class n{constructor(e,t,r,i){if(this.onDisconnect=r,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0,gr())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=ZN(),window[Dq+this.uniqueCallbackIdentifier]=e,window[Nq+this.uniqueCallbackIdentifier]=t,this.myIFrame=n.createIFrame_();let s="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(s='<script>document.domain="'+document.domain+'";</script>');let o="<html><body>"+s+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){Ct("frame writing exception"),a.stack&&Ct(a.stack),Ct(a)}}}static createIFrame_(){let e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||Ct("No IE domain setting required")}catch{let r=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+r+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;let e={};e[sk]=this.myID,e[ok]=this.myPW,e[ak]=this.currentSerial;let t=this.urlFn(e),r="",i=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+ck+r.length<=lk;){let o=this.pendingSegs.shift();r=r+"&"+Oq+i+"="+o.seg+"&"+xq+i+"="+o.ts+"&"+Pq+i+"="+o.d,i++}return t=t+r,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,r){this.pendingSegs.push({seg:e,ts:t,d:r}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);let r=()=>{this.outstandingRequests.delete(t),this.newRequest_()},i=setTimeout(r,Math.floor(Lq)),s=()=>{clearTimeout(i),r()};this.addTag(e,s)}addTag(e,t){gr()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;let r=this.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){let i=r.readyState;(!i||i==="loaded"||i==="complete")&&(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),t())},r.onerror=()=>{Ct("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(r)}catch{}},Math.floor(1))}};var uk=(()=>{class n{constructor(t){this.initTransports_(t)}static get ALL_TRANSPORTS(){return[nu,ga]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(t){let r=ga&&ga.isAvailable(),i=r&&!ga.previouslyFailed();if(t.webSocketOnly&&(r||Ot("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),i=!0),i)this.transports_=[ga];else{let s=this.transports_=[];for(let o of n.ALL_TRANSPORTS)o&&o.isAvailable()&&s.push(o);n.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}n.globalTransportInitialized_=!1;return n})(),Vq=6e4,Uq=5e3,qq=10*1024,zq=100*1024,j_="t",mN="d",Gq="s",gN="r",Wq="e",yN="o",_N="a",vN="n",EN="p",jq="h",ov=class{constructor(e,t,r,i,s,o,a,l,c,u){this.id=e,this.repoInfo_=t,this.applicationId_=r,this.appCheckToken_=i,this.authToken_=s,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=l,this.onKill_=c,this.lastSessionId=u,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=yu("c:"+this.id+":"),this.transportManager_=new uk(t),this.log_("Connection created"),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,r)},Math.floor(0));let i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=Yc(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>zq?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>qq?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){let t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(j_ in e){let t=e[j_];t===_N?this.upgradeIfSecondaryHealthy_():t===gN?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===yN&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let t=$c("t",e),r=$c("d",e);if(t==="c")this.onSecondaryControl_(r);else if(t==="d")this.pendingDataMessages.push(r);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:EN,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:_N,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:vN,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let t=$c("t",e),r=$c("d",e);t==="c"?this.onControl_(r):t==="d"&&this.onDataMessage_(r)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let t=$c(j_,e);if(mN in e){let r=e[mN];if(t===jq){let i=Object.assign({},r);this.repoInfo_.isUsingEmulator&&(i.h=this.repoInfo_.host),this.onHandshake_(i)}else if(t===vN){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let i=0;i<this.pendingDataMessages.length;++i)this.onDataMessage_(this.pendingDataMessages[i]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===Gq?this.onConnectionShutdown_(r):t===gN?this.onReset_(r):t===Wq?ev("Server Error: "+r):t===yN?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):ev("Unknown control packet command: "+t)}}onHandshake_(e){let t=e.ts,r=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),Xh!==r&&Ot("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,r),Yc(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(Vq))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Yc(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(Uq))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:EN,d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(ro.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}};var Zh=class{put(e,t,r,i){}merge(e,t,r,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,r){}onDisconnectMerge(e,t,r){}onDisconnectCancel(e,t){}reportStats(e){}};var ef=class{constructor(e){this.allowedEvents_=e,this.listeners_={},L(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){let r=[...this.listeners_[e]];for(let i=0;i<r.length;i++)r[i].callback.apply(r[i].context,t)}}on(e,t,r){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:r});let i=this.getInitialEvent(e);i&&t.apply(r,i)}off(e,t,r){this.validateEventType_(e);let i=this.listeners_[e]||[];for(let s=0;s<i.length;s++)if(i[s].callback===t&&(!r||r===i[s].context)){i.splice(s,1);return}}validateEventType_(e){L(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}};var tf=class n extends ef{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!Hy()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new n}getInitialEvent(e){return L(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}};var SN=32,CN=768,Se=class{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let r=0;for(let i=0;i<this.pieces_.length;i++)this.pieces_[i].length>0&&(this.pieces_[r]=this.pieces_[i],r++);this.pieces_.length=r,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}};function Ee(){return new Se("")}function oe(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function Bi(n){return n.pieces_.length-n.pieceNum_}function Re(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new Se(n.pieces_,e)}function iE(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function $q(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function ru(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function dk(n){if(n.pieceNum_>=n.pieces_.length)return null;let e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new Se(e,0)}function qe(n,e){let t=[];for(let r=n.pieceNum_;r<n.pieces_.length;r++)t.push(n.pieces_[r]);if(e instanceof Se)for(let r=e.pieceNum_;r<e.pieces_.length;r++)t.push(e.pieces_[r]);else{let r=e.split("/");for(let i=0;i<r.length;i++)r[i].length>0&&t.push(r[i])}return new Se(t,0)}function ae(n){return n.pieceNum_>=n.pieces_.length}function Wt(n,e){let t=oe(n),r=oe(e);if(t===null)return e;if(t===r)return Wt(Re(n),Re(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function Hq(n,e){let t=ru(n,0),r=ru(e,0);for(let i=0;i<t.length&&i<r.length;i++){let s=oo(t[i],r[i]);if(s!==0)return s}return t.length===r.length?0:t.length<r.length?-1:1}function sE(n,e){if(Bi(n)!==Bi(e))return!1;for(let t=n.pieceNum_,r=e.pieceNum_;t<=n.pieces_.length;t++,r++)if(n.pieces_[t]!==e.pieces_[r])return!1;return!0}function In(n,e){let t=n.pieceNum_,r=e.pieceNum_;if(Bi(n)>Bi(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[r])return!1;++t,++r}return!0}var av=class{constructor(e,t){this.errorPrefix_=t,this.parts_=ru(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let r=0;r<this.parts_.length;r++)this.byteLength_+=bc(this.parts_[r]);hk(this)}};function Kq(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=bc(e),hk(n)}function Qq(n){let e=n.parts_.pop();n.byteLength_-=bc(e),n.parts_.length>0&&(n.byteLength_-=1)}function hk(n){if(n.byteLength_>CN)throw new Error(n.errorPrefix_+"has a key path longer than "+CN+" bytes ("+n.byteLength_+").");if(n.parts_.length>SN)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+SN+") or object contains a cycle "+no(n))}function no(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}var lv=class n extends ef{constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{let r=!document[e];r!==this.visible_&&(this.visible_=r,this.trigger("visible",r))},!1)}static getInstance(){return new n}getInitialEvent(e){return L(e==="visible","Unknown event type: "+e),[this.visible_]}};var Hc=1e3,Yq=60*5*1e3,wN=30*1e3,Xq=1.3,Jq=3e4,Zq="server_kill",TN=3,oE=(()=>{class n extends Zh{constructor(t,r,i,s,o,a,l,c){if(super(),this.repoInfo_=t,this.applicationId_=r,this.onDataUpdate_=i,this.onConnectStatus_=s,this.onServerInfoUpdate_=o,this.authTokenProvider_=a,this.appCheckTokenProvider_=l,this.authOverride_=c,this.id=n.nextPersistentConnectionId_++,this.log_=yu("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Hc,this.maxReconnectDelay_=Yq,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c&&!gr())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");lv.getInstance().on("visible",this.onVisible_,this),t.host.indexOf("fblocal")===-1&&tf.getInstance().on("online",this.onOnline_,this)}sendRequest(t,r,i){let s=++this.requestNumber_,o={r:s,a:t,b:r};this.log_(lt(o)),L(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(o),i&&(this.requestCBHash_[s]=i)}get(t){this.initConnection_();let r=new Et,s={action:"g",request:{p:t._path.toString(),q:t._queryObject},onComplete:a=>{let l=a.d;a.s==="ok"?r.resolve(l):r.reject(l)}};this.outstandingGets_.push(s),this.outstandingGetCount_++;let o=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(o),r.promise}listen(t,r,i,s){this.initConnection_();let o=t._queryIdentifier,a=t._path.toString();this.log_("Listen called for "+a+" "+o),this.listens.has(a)||this.listens.set(a,new Map),L(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),L(!this.listens.get(a).has(o),"listen() called twice for same path/queryId.");let l={onComplete:s,hashFn:r,query:t,tag:i};this.listens.get(a).set(o,l),this.connected_&&this.sendListen_(l)}sendGet_(t){let r=this.outstandingGets_[t];this.sendRequest("g",r.request,i=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),r.onComplete&&r.onComplete(i)})}sendListen_(t){let r=t.query,i=r._path.toString(),s=r._queryIdentifier;this.log_("Listen on "+i+" for "+s);let o={p:i},a="q";t.tag&&(o.q=r._queryObject,o.t=t.tag),o.h=t.hashFn(),this.sendRequest(a,o,l=>{let c=l.d,u=l.s;n.warnOnListenWarnings_(c,r),(this.listens.get(i)&&this.listens.get(i).get(s))===t&&(this.log_("listen response",l),u!=="ok"&&this.removeListen_(i,s),t.onComplete&&t.onComplete(u,c))})}static warnOnListenWarnings_(t,r){if(t&&typeof t=="object"&&Tn(t,"w")){let i=Ii(t,"w");if(Array.isArray(i)&&~i.indexOf("no_index")){let s='".indexOn": "'+r._queryParams.getIndex().toString()+'"',o=r._path.toString();Ot(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${o} to your security rules for better performance.`)}}}refreshAuthToken(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(t)}reduceReconnectDelayIfAdminCredential_(t){(t&&t.length===40||rR(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=wN)}refreshAppCheckToken(t){this.appCheckToken_=t,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let t=this.authToken_,r=nR(t)?"auth":"gauth",i={cred:t};this.authOverride_===null?i.noauth=!0:typeof this.authOverride_=="object"&&(i.authvar=this.authOverride_),this.sendRequest(r,i,s=>{let o=s.s,a=s.d||"error";this.authToken_===t&&(o==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(o,a))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},t=>{let r=t.s,i=t.d||"error";r==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(r,i)})}unlisten(t,r){let i=t._path.toString(),s=t._queryIdentifier;this.log_("Unlisten called for "+i+" "+s),L(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(i,s)&&this.connected_&&this.sendUnlisten_(i,s,t._queryObject,r)}sendUnlisten_(t,r,i,s){this.log_("Unlisten on "+t+" for "+r);let o={p:t},a="n";s&&(o.q=i,o.t=s),this.sendRequest(a,o)}onDisconnectPut(t,r,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",t,r,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:r,onComplete:i})}onDisconnectMerge(t,r,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",t,r,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:r,onComplete:i})}onDisconnectCancel(t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",t,null,r):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:r})}sendOnDisconnect_(t,r,i,s){let o={p:r,d:i};this.log_("onDisconnect "+t,o),this.sendRequest(t,o,a=>{s&&setTimeout(()=>{s(a.s,a.d)},Math.floor(0))})}put(t,r,i,s){this.putInternal("p",t,r,i,s)}merge(t,r,i,s){this.putInternal("m",t,r,i,s)}putInternal(t,r,i,s,o){this.initConnection_();let a={p:r,d:i};o!==void 0&&(a.h=o),this.outstandingPuts_.push({action:t,request:a,onComplete:s}),this.outstandingPutCount_++;let l=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(l):this.log_("Buffering put: "+r)}sendPut_(t){let r=this.outstandingPuts_[t].action,i=this.outstandingPuts_[t].request,s=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(r,i,o=>{this.log_(r+" response",o),delete this.outstandingPuts_[t],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),s&&s(o.s,o.d)})}reportStats(t){if(this.connected_){let r={c:t};this.log_("reportStats",r),this.sendRequest("s",r,i=>{if(i.s!=="ok"){let o=i.d;this.log_("reportStats","Error sending stats: "+o)}})}}onDataMessage_(t){if("r"in t){this.log_("from server: "+lt(t));let r=t.r,i=this.requestCBHash_[r];i&&(delete this.requestCBHash_[r],i(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}}onDataPush_(t,r){this.log_("handleServerMessage",t,r),t==="d"?this.onDataUpdate_(r.p,r.d,!1,r.t):t==="m"?this.onDataUpdate_(r.p,r.d,!0,r.t):t==="c"?this.onListenRevoked_(r.p,r.q):t==="ac"?this.onAuthRevoked_(r.s,r.d):t==="apc"?this.onAppCheckRevoked_(r.s,r.d):t==="sd"?this.onSecurityDebugPacket_(r):ev("Unrecognized action received from server: "+lt(t)+`
Are you using the latest client?`)}onReady_(t,r){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(t),this.lastSessionId=r,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(t){L(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(t))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Hc,this.realtime_||this.scheduleConnect_(0)),this.visible_=t}onOnline_(t){t?(this.log_("Browser went online."),this.reconnectDelay_=Hc,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>Jq&&(this.reconnectDelay_=Hc),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let t=new Date().getTime()-this.lastConnectionAttemptTime_,r=Math.max(0,this.reconnectDelay_-t);r=Math.random()*r,this.log_("Trying to reconnect in "+r+"ms"),this.scheduleConnect_(r),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*Xq)}this.onConnectStatus_(!1)}establishConnection_(){return T(this,null,function*(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let t=this.onDataMessage_.bind(this),r=this.onReady_.bind(this),i=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+n.nextConnectionId_++,o=this.lastSessionId,a=!1,l=null,c=function(){l?l.close():(a=!0,i())},u=function(h){L(l,"sendRequest call when we're not connected not allowed."),l.sendRequest(h)};this.realtime_={close:c,sendRequest:u};let d=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[h,p]=yield Promise.all([this.authTokenProvider_.getToken(d),this.appCheckTokenProvider_.getToken(d)]);a?Ct("getToken() completed but was canceled"):(Ct("getToken() completed. Creating connection."),this.authToken_=h&&h.accessToken,this.appCheckToken_=p&&p.token,l=new ov(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,r,i,E=>{Ot(E+" ("+this.repoInfo_.toString()+")"),this.interrupt(Zq)},o))}catch(h){this.log_("Failed to get token: "+h),a||(this.repoInfo_.nodeAdmin&&Ot(h),c())}}})}interrupt(t){Ct("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(t){Ct("Resuming connection for reason: "+t),delete this.interruptReasons_[t],Ih(this.interruptReasons_)&&(this.reconnectDelay_=Hc,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(t){let r=t-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:r})}cancelSentTransactions_(){for(let t=0;t<this.outstandingPuts_.length;t++){let r=this.outstandingPuts_[t];r&&"h"in r.request&&r.queued&&(r.onComplete&&r.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(t,r){let i;r?i=r.map(o=>eE(o)).join("$"):i="default";let s=this.removeListen_(t,i);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(t,r){let i=new Se(t).toString(),s;if(this.listens.has(i)){let o=this.listens.get(i);s=o.get(r),o.delete(r),o.size===0&&this.listens.delete(i)}else s=void 0;return s}onAuthRevoked_(t,r){Ct("Auth token revoked: "+t+"/"+r),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(t==="invalid_token"||t==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=TN&&(this.reconnectDelay_=wN,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(t,r){Ct("App check token revoked: "+t+"/"+r),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(t==="invalid_token"||t==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=TN&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(let t of this.listens.values())for(let r of t.values())this.sendListen_(r);for(let t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);for(;this.onDisconnectRequestQueue_.length;){let t=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(t.action,t.pathString,t.data,t.onComplete)}for(let t=0;t<this.outstandingGets_.length;t++)this.outstandingGets_[t]&&this.sendGet_(t)}sendConnectStats_(){let t={},r="js";gr()&&(this.repoInfo_.nodeAdmin?r="admin_node":r="node"),t["sdk."+r+"."+nE.replace(/\./g,"-")]=1,Hy()?t["framework.cordova"]=1:ZA()&&(t["framework.reactnative"]=1),this.reportStats(t)}shouldReconnect_(){let t=tf.getInstance().currentlyOnline();return Ih(this.interruptReasons_)&&t}}n.nextPersistentConnectionId_=0,n.nextConnectionId_=0;return n})(),le=class n{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new n(e,t)}};var va=class{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){let r=new le(Li,e),i=new le(Li,t);return this.compare(r,i)!==0}minPost(){return le.MIN}};var Yh,nf=class extends va{static get __EMPTY_NODE(){return Yh}static set __EMPTY_NODE(e){Yh=e}compare(e,t){return oo(e.name,t.name)}isDefinedOn(e){throw aa("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return le.MIN}maxPost(){return new le(ti,Yh)}makePost(e,t){return L(typeof e=="string","KeyIndex indexValue must always be a string."),new le(e,Yh)}toString(){return".key"}},Er=new nf;var ya=class{constructor(e,t,r,i,s=null){this.isReverse_=i,this.resultGenerator_=s,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?r(e.key,t):1,i&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},Hn=(()=>{class n{constructor(t,r,i,s,o){this.key=t,this.value=r,this.color=i??n.RED,this.left=s??An.EMPTY_NODE,this.right=o??An.EMPTY_NODE}copy(t,r,i,s,o){return new n(t??this.key,r??this.value,i??this.color,s??this.left,o??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,r,i){let s=this,o=i(t,s.key);return o<0?s=s.copy(null,null,null,s.left.insert(t,r,i),null):o===0?s=s.copy(null,r,null,null,null):s=s.copy(null,null,null,null,s.right.insert(t,r,i)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return An.EMPTY_NODE;let t=this;return!t.left.isRed_()&&!t.left.left.isRed_()&&(t=t.moveRedLeft_()),t=t.copy(null,null,null,t.left.removeMin_(),null),t.fixUp_()}remove(t,r){let i,s;if(i=this,r(t,i.key)<0)!i.left.isEmpty()&&!i.left.isRed_()&&!i.left.left.isRed_()&&(i=i.moveRedLeft_()),i=i.copy(null,null,null,i.left.remove(t,r),null);else{if(i.left.isRed_()&&(i=i.rotateRight_()),!i.right.isEmpty()&&!i.right.isRed_()&&!i.right.left.isRed_()&&(i=i.moveRedRight_()),r(t,i.key)===0){if(i.right.isEmpty())return An.EMPTY_NODE;s=i.right.min_(),i=i.copy(s.key,s.value,null,null,i.right.removeMin_())}i=i.copy(null,null,null,null,i.right.remove(t,r))}return i.fixUp_()}isRed_(){return this.color}fixUp_(){let t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t}moveRedLeft_(){let t=this.colorFlip_();return t.right.left.isRed_()&&(t=t.copy(null,null,null,null,t.right.rotateRight_()),t=t.rotateLeft_(),t=t.colorFlip_()),t}moveRedRight_(){let t=this.colorFlip_();return t.left.left.isRed_()&&(t=t.rotateRight_(),t=t.colorFlip_()),t}rotateLeft_(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){let t=this.left.copy(null,null,!this.left.color,null,null),r=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,r)}checkMaxDepth_(){let t=this.check_();return Math.pow(2,t)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");let t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)}}return n.RED=!0,n.BLACK=!1,n})(),cv=class{copy(e,t,r,i,s){return this}insert(e,t,r){return new Hn(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}},An=class n{constructor(e,t=n.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new n(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Hn.BLACK,null,null))}remove(e){return new n(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Hn.BLACK,null,null))}get(e){let t,r=this.root_;for(;!r.isEmpty();){if(t=this.comparator_(e,r.key),t===0)return r.value;t<0?r=r.left:t>0&&(r=r.right)}return null}getPredecessorKey(e){let t,r=this.root_,i=null;for(;!r.isEmpty();)if(t=this.comparator_(e,r.key),t===0){if(r.left.isEmpty())return i?i.key:null;for(r=r.left;!r.right.isEmpty();)r=r.right;return r.key}else t<0?r=r.left:t>0&&(i=r,r=r.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new ya(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new ya(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new ya(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new ya(this.root_,null,this.comparator_,!0,e)}};An.EMPTY_NODE=new cv;function e3(n,e){return oo(n.name,e.name)}function aE(n,e){return oo(n,e)}var uv;function t3(n){uv=n}var fk=function(n){return typeof n=="number"?"number:"+rk(n):"string:"+n},pk=function(n){if(n.isLeafNode()){let e=n.val();L(typeof e=="string"||typeof e=="number"||typeof e=="object"&&Tn(e,".sv"),"Priority must be a string or number.")}else L(n===uv||n.isEmpty(),"priority of unexpected type.");L(n===uv||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};var bN,Ea=(()=>{class n{constructor(t,r=n.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=r,this.lazyHash_=null,L(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),pk(this.priorityNode_)}static set __childrenNodeConstructor(t){bN=t}static get __childrenNodeConstructor(){return bN}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new n(this.value_,t)}getImmediateChild(t){return t===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return ae(t)?this:oe(t)===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(t,r){return null}updateImmediateChild(t,r){return t===".priority"?this.updatePriority(r):r.isEmpty()&&t!==".priority"?this:n.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,r).updatePriority(this.priorityNode_)}updateChild(t,r){let i=oe(t);return i===null?r:r.isEmpty()&&i!==".priority"?this:(L(i!==".priority"||Bi(t)===1,".priority must be the last token in a path"),this.updateImmediateChild(i,n.__childrenNodeConstructor.EMPTY_NODE.updateChild(Re(t),r)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(t,r){return!1}val(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let t="";this.priorityNode_.isEmpty()||(t+="priority:"+fk(this.priorityNode_.val())+":");let r=typeof this.value_;t+=r+":",r==="number"?t+=rk(this.value_):t+=this.value_,this.lazyHash_=ek(t)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===n.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof n.__childrenNodeConstructor?-1:(L(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){let r=typeof t.value_,i=typeof this.value_,s=n.VALUE_TYPE_ORDER.indexOf(r),o=n.VALUE_TYPE_ORDER.indexOf(i);return L(s>=0,"Unknown leaf type: "+r),L(o>=0,"Unknown leaf type: "+i),s===o?i==="object"?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:o-s}withIndex(){return this}isIndexed(){return!0}equals(t){if(t===this)return!0;if(t.isLeafNode()){let r=t;return this.value_===r.value_&&this.priorityNode_.equals(r.priorityNode_)}else return!1}}n.VALUE_TYPE_ORDER=["object","boolean","number","string"];return n})(),mk,gk;function n3(n){mk=n}function r3(n){gk=n}var dv=class extends va{compare(e,t){let r=e.node.getPriority(),i=t.node.getPriority(),s=r.compareTo(i);return s===0?oo(e.name,t.name):s}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return le.MIN}maxPost(){return new le(ti,new Ea("[PRIORITY-POST]",gk))}makePost(e,t){let r=mk(e);return new le(t,new Ea("[PRIORITY-POST]",r))}toString(){return".priority"}},ke=new dv;var i3=Math.log(2),hv=class{constructor(e){let t=s=>parseInt(Math.log(s)/i3,10),r=s=>parseInt(Array(s+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;let i=r(this.count);this.bits_=e+1&i}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}},rf=function(n,e,t,r){n.sort(e);let i=function(l,c){let u=c-l,d,h;if(u===0)return null;if(u===1)return d=n[l],h=t?t(d):d,new Hn(h,d.node,Hn.BLACK,null,null);{let p=parseInt(u/2,10)+l,E=i(l,p),w=i(p+1,c);return d=n[p],h=t?t(d):d,new Hn(h,d.node,Hn.BLACK,E,w)}},s=function(l){let c=null,u=null,d=n.length,h=function(E,w){let b=d-E,N=d;d-=E;let D=i(b+1,N),O=n[b],F=t?t(O):O;p(new Hn(F,O.node,w,null,D))},p=function(E){c?(c.left=E,c=E):(u=E,c=E)};for(let E=0;E<l.count;++E){let w=l.nextBitIsOne(),b=Math.pow(2,l.count-(E+1));w?h(b,Hn.BLACK):(h(b,Hn.BLACK),h(b,Hn.RED))}return u},o=new hv(n.length),a=s(o);return new An(r||e,a)};var $_,ma={},Sa=class n{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return L(ma&&ke,"ChildrenNode.ts has not been loaded"),$_=$_||new n({".priority":ma},{".priority":ke}),$_}get(e){let t=Ii(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof An?t:null}hasIndex(e){return Tn(this.indexSet_,e.toString())}addIndex(e,t){L(e!==Er,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let r=[],i=!1,s=t.getIterator(le.Wrap),o=s.getNext();for(;o;)i=i||e.isDefinedOn(o.node),r.push(o),o=s.getNext();let a;i?a=rf(r,e.getCompare()):a=ma;let l=e.toString(),c=Object.assign({},this.indexSet_);c[l]=e;let u=Object.assign({},this.indexes_);return u[l]=a,new n(u,c)}addToIndexes(e,t){let r=Tc(this.indexes_,(i,s)=>{let o=Ii(this.indexSet_,s);if(L(o,"Missing index implementation for "+s),i===ma)if(o.isDefinedOn(e.node)){let a=[],l=t.getIterator(le.Wrap),c=l.getNext();for(;c;)c.name!==e.name&&a.push(c),c=l.getNext();return a.push(e),rf(a,o.getCompare())}else return ma;else{let a=t.get(e.name),l=i;return a&&(l=l.remove(new le(e.name,a))),l.insert(e,e.node)}});return new n(r,this.indexSet_)}removeFromIndexes(e,t){let r=Tc(this.indexes_,i=>{if(i===ma)return i;{let s=t.get(e.name);return s?i.remove(new le(e.name,s)):i}});return new n(r,this.indexSet_)}};var Kc,re=(()=>{class n{constructor(t,r,i){this.children_=t,this.priorityNode_=r,this.indexMap_=i,this.lazyHash_=null,this.priorityNode_&&pk(this.priorityNode_),this.children_.isEmpty()&&L(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return Kc||(Kc=new n(new An(aE),null,Sa.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Kc}updatePriority(t){return this.children_.isEmpty()?this:new n(this.children_,t,this.indexMap_)}getImmediateChild(t){if(t===".priority")return this.getPriority();{let r=this.children_.get(t);return r===null?Kc:r}}getChild(t){let r=oe(t);return r===null?this:this.getImmediateChild(r).getChild(Re(t))}hasChild(t){return this.children_.get(t)!==null}updateImmediateChild(t,r){if(L(r,"We should always be passing snapshot nodes"),t===".priority")return this.updatePriority(r);{let i=new le(t,r),s,o;r.isEmpty()?(s=this.children_.remove(t),o=this.indexMap_.removeFromIndexes(i,this.children_)):(s=this.children_.insert(t,r),o=this.indexMap_.addToIndexes(i,this.children_));let a=s.isEmpty()?Kc:this.priorityNode_;return new n(s,a,o)}}updateChild(t,r){let i=oe(t);if(i===null)return r;{L(oe(t)!==".priority"||Bi(t)===1,".priority must be the last token in a path");let s=this.getImmediateChild(i).updateChild(Re(t),r);return this.updateImmediateChild(i,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;let r={},i=0,s=0,o=!0;if(this.forEachChild(ke,(a,l)=>{r[a]=l.val(t),i++,o&&n.INTEGER_REGEXP_.test(a)?s=Math.max(s,Number(a)):o=!1}),!t&&o&&s<2*i){let a=[];for(let l in r)a[l]=r[l];return a}else return t&&!this.getPriority().isEmpty()&&(r[".priority"]=this.getPriority().val()),r}hash(){if(this.lazyHash_===null){let t="";this.getPriority().isEmpty()||(t+="priority:"+fk(this.getPriority().val())+":"),this.forEachChild(ke,(r,i)=>{let s=i.hash();s!==""&&(t+=":"+r+":"+s)}),this.lazyHash_=t===""?"":ek(t)}return this.lazyHash_}getPredecessorChildName(t,r,i){let s=this.resolveIndex_(i);if(s){let o=s.getPredecessorKey(new le(t,r));return o?o.name:null}else return this.children_.getPredecessorKey(t)}getFirstChildName(t){let r=this.resolveIndex_(t);if(r){let i=r.minKey();return i&&i.name}else return this.children_.minKey()}getFirstChild(t){let r=this.getFirstChildName(t);return r?new le(r,this.children_.get(r)):null}getLastChildName(t){let r=this.resolveIndex_(t);if(r){let i=r.maxKey();return i&&i.name}else return this.children_.maxKey()}getLastChild(t){let r=this.getLastChildName(t);return r?new le(r,this.children_.get(r)):null}forEachChild(t,r){let i=this.resolveIndex_(t);return i?i.inorderTraversal(s=>r(s.name,s.node)):this.children_.inorderTraversal(r)}getIterator(t){return this.getIteratorFrom(t.minPost(),t)}getIteratorFrom(t,r){let i=this.resolveIndex_(r);if(i)return i.getIteratorFrom(t,s=>s);{let s=this.children_.getIteratorFrom(t.name,le.Wrap),o=s.peek();for(;o!=null&&r.compare(o,t)<0;)s.getNext(),o=s.peek();return s}}getReverseIterator(t){return this.getReverseIteratorFrom(t.maxPost(),t)}getReverseIteratorFrom(t,r){let i=this.resolveIndex_(r);if(i)return i.getReverseIteratorFrom(t,s=>s);{let s=this.children_.getReverseIteratorFrom(t.name,le.Wrap),o=s.peek();for(;o!=null&&r.compare(o,t)>0;)s.getNext(),o=s.peek();return s}}compareTo(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===_u?-1:0}withIndex(t){if(t===Er||this.indexMap_.hasIndex(t))return this;{let r=this.indexMap_.addIndex(t,this.children_);return new n(this.children_,this.priorityNode_,r)}}isIndexed(t){return t===Er||this.indexMap_.hasIndex(t)}equals(t){if(t===this)return!0;if(t.isLeafNode())return!1;{let r=t;if(this.getPriority().equals(r.getPriority()))if(this.children_.count()===r.children_.count()){let i=this.getIterator(ke),s=r.getIterator(ke),o=i.getNext(),a=s.getNext();for(;o&&a;){if(o.name!==a.name||!o.node.equals(a.node))return!1;o=i.getNext(),a=s.getNext()}return o===null&&a===null}else return!1;else return!1}}resolveIndex_(t){return t===Er?null:this.indexMap_.get(t.toString())}}return n.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,n})(),fv=class extends re{constructor(){super(new An(aE),re.EMPTY_NODE,Sa.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return re.EMPTY_NODE}isEmpty(){return!1}},_u=new fv;Object.defineProperties(le,{MIN:{value:new le(Li,re.EMPTY_NODE)},MAX:{value:new le(ti,_u)}});nf.__EMPTY_NODE=re.EMPTY_NODE;Ea.__childrenNodeConstructor=re;t3(_u);r3(_u);var s3=!0;function je(n,e=null){if(n===null)return re.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),L(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){let t=n;return new Ea(t,je(e))}if(!(n instanceof Array)&&s3){let t=[],r=!1;if(wt(n,(o,a)=>{if(o.substring(0,1)!=="."){let l=je(a);l.isEmpty()||(r=r||!l.getPriority().isEmpty(),t.push(new le(o,l)))}}),t.length===0)return re.EMPTY_NODE;let s=rf(t,e3,o=>o.name,aE);if(r){let o=rf(t,ke.getCompare());return new re(s,je(e),new Sa({".priority":o},{".priority":ke}))}else return new re(s,je(e),Sa.Default)}else{let t=re.EMPTY_NODE;return wt(n,(r,i)=>{if(Tn(n,r)&&r.substring(0,1)!=="."){let s=je(i);(s.isLeafNode()||!s.isEmpty())&&(t=t.updateImmediateChild(r,s))}}),t.updatePriority(je(e))}}n3(je);var iu=class extends va{constructor(e){super(),this.indexPath_=e,L(!ae(e)&&oe(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){let r=this.extractChild(e.node),i=this.extractChild(t.node),s=r.compareTo(i);return s===0?oo(e.name,t.name):s}makePost(e,t){let r=je(e),i=re.EMPTY_NODE.updateChild(this.indexPath_,r);return new le(t,i)}maxPost(){let e=re.EMPTY_NODE.updateChild(this.indexPath_,_u);return new le(ti,e)}toString(){return ru(this.indexPath_,0).join("/")}};var pv=class extends va{compare(e,t){let r=e.node.compareTo(t.node);return r===0?oo(e.name,t.name):r}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return le.MIN}maxPost(){return le.MAX}makePost(e,t){let r=je(e);return new le(t,r)}toString(){return".value"}},lE=new pv;function yk(n){return{type:"value",snapshotNode:n}}function Ca(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function su(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function ou(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function o3(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}var au=class{constructor(e){this.index_=e}updateChild(e,t,r,i,s,o){L(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");let a=e.getImmediateChild(t);return a.getChild(i).equals(r.getChild(i))&&a.isEmpty()===r.isEmpty()||(o!=null&&(r.isEmpty()?e.hasChild(t)?o.trackChildChange(su(t,a)):L(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(Ca(t,r)):o.trackChildChange(ou(t,r,a))),e.isLeafNode()&&r.isEmpty())?e:e.updateImmediateChild(t,r).withIndex(this.index_)}updateFullNode(e,t,r){return r!=null&&(e.isLeafNode()||e.forEachChild(ke,(i,s)=>{t.hasChild(i)||r.trackChildChange(su(i,s))}),t.isLeafNode()||t.forEachChild(ke,(i,s)=>{if(e.hasChild(i)){let o=e.getImmediateChild(i);o.equals(s)||r.trackChildChange(ou(i,s,o))}else r.trackChildChange(Ca(i,s))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?re.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}};var sf=class n{constructor(e){this.indexedFilter_=new au(e.getIndex()),this.index_=e.getIndex(),this.startPost_=n.getStartPost_(e),this.endPost_=n.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){let t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,r=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&r}updateChild(e,t,r,i,s,o){return this.matches(new le(t,r))||(r=re.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,r,i,s,o)}updateFullNode(e,t,r){t.isLeafNode()&&(t=re.EMPTY_NODE);let i=t.withIndex(this.index_);i=i.updatePriority(re.EMPTY_NODE);let s=this;return t.forEachChild(ke,(o,a)=>{s.matches(new le(o,a))||(i=i.updateImmediateChild(o,re.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,i,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){let t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){let t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}};var mv=class{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{let r=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?r<=0:r<0},this.withinEndPost=t=>{let r=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?r<=0:r<0},this.rangedFilter_=new sf(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,r,i,s,o){return this.rangedFilter_.matches(new le(t,r))||(r=re.EMPTY_NODE),e.getImmediateChild(t).equals(r)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,r,i,s,o):this.fullLimitUpdateChild_(e,t,r,s,o)}updateFullNode(e,t,r){let i;if(t.isLeafNode()||t.isEmpty())i=re.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){i=re.EMPTY_NODE.withIndex(this.index_);let s;this.reverse_?s=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):s=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;s.hasNext()&&o<this.limit_;){let a=s.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))i=i.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{i=t.withIndex(this.index_),i=i.updatePriority(re.EMPTY_NODE);let s;this.reverse_?s=i.getReverseIterator(this.index_):s=i.getIterator(this.index_);let o=0;for(;s.hasNext();){let a=s.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:i=i.updateImmediateChild(a.name,re.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,i,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,r,i,s){let o;if(this.reverse_){let d=this.index_.getCompare();o=(h,p)=>d(p,h)}else o=this.index_.getCompare();let a=e;L(a.numChildren()===this.limit_,"");let l=new le(t,r),c=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),u=this.rangedFilter_.matches(l);if(a.hasChild(t)){let d=a.getImmediateChild(t),h=i.getChildAfterChild(this.index_,c,this.reverse_);for(;h!=null&&(h.name===t||a.hasChild(h.name));)h=i.getChildAfterChild(this.index_,h,this.reverse_);let p=h==null?1:o(h,l);if(u&&!r.isEmpty()&&p>=0)return s?.trackChildChange(ou(t,r,d)),a.updateImmediateChild(t,r);{s?.trackChildChange(su(t,d));let w=a.updateImmediateChild(t,re.EMPTY_NODE);return h!=null&&this.rangedFilter_.matches(h)?(s?.trackChildChange(Ca(h.name,h.node)),w.updateImmediateChild(h.name,h.node)):w}}else return r.isEmpty()?e:u&&o(c,l)>=0?(s!=null&&(s.trackChildChange(su(c.name,c.node)),s.trackChildChange(Ca(t,r))),a.updateImmediateChild(t,r).updateImmediateChild(c.name,re.EMPTY_NODE)):e}};var lu=class n{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=ke}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return L(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return L(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Li}hasEnd(){return this.endSet_}getIndexEndValue(){return L(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return L(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:ti}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return L(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===ke}copy(){let e=new n;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}};function a3(n){return n.loadsAllData()?new au(n.getIndex()):n.hasLimit()?new mv(n):new sf(n)}function l3(n,e){let t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="l",t}function c3(n,e){let t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="r",t}function gv(n,e,t){let r=n.copy();return r.startSet_=!0,e===void 0&&(e=null),r.indexStartValue_=e,t!=null?(r.startNameSet_=!0,r.indexStartName_=t):(r.startNameSet_=!1,r.indexStartName_=""),r}function u3(n,e,t){let r;return n.index_===Er||t?r=gv(n,e,t):r=gv(n,e,ti),r.startAfterSet_=!0,r}function yv(n,e,t){let r=n.copy();return r.endSet_=!0,e===void 0&&(e=null),r.indexEndValue_=e,t!==void 0?(r.endNameSet_=!0,r.indexEndName_=t):(r.endNameSet_=!1,r.indexEndName_=""),r}function d3(n,e,t){let r;return n.index_===Er||t?r=yv(n,e,t):r=yv(n,e,Li),r.endBeforeSet_=!0,r}function Tf(n,e){let t=n.copy();return t.index_=e,t}function IN(n){let e={};if(n.isDefault())return e;let t;if(n.index_===ke?t="$priority":n.index_===lE?t="$value":n.index_===Er?t="$key":(L(n.index_ instanceof iu,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=lt(t),n.startSet_){let r=n.startAfterSet_?"startAfter":"startAt";e[r]=lt(n.indexStartValue_),n.startNameSet_&&(e[r]+=","+lt(n.indexStartName_))}if(n.endSet_){let r=n.endBeforeSet_?"endBefore":"endAt";e[r]=lt(n.indexEndValue_),n.endNameSet_&&(e[r]+=","+lt(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function AN(n){let e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==ke&&(e.i=n.index_.toString()),e}var _v=class n extends Zh{constructor(e,t,r,i){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=r,this.appCheckTokenProvider_=i,this.log_=yu("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(L(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,r,i){let s=e._path.toString();this.log_("Listen called for "+s+" "+e._queryIdentifier);let o=n.getListenId_(e,r),a={};this.listens_[o]=a;let l=IN(e._queryParams);this.restRequest_(s+".json",l,(c,u)=>{let d=u;if(c===404&&(d=null,c=null),c===null&&this.onDataUpdate_(s,d,!1,r),Ii(this.listens_,o)===a){let h;c?c===401?h="permission_denied":h="rest_error:"+c:h="ok",i(h,null)}})}unlisten(e,t){let r=n.getListenId_(e,t);delete this.listens_[r]}get(e){let t=IN(e._queryParams),r=e._path.toString(),i=new Et;return this.restRequest_(r+".json",t,(s,o)=>{let a=o;s===404&&(a=null,s=null),s===null?(this.onDataUpdate_(r,a,!1,null),i.resolve(a)):i.reject(new Error(a))}),i.promise}refreshAuthToken(e){}restRequest_(e,t={},r){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([i,s])=>{i&&i.accessToken&&(t.auth=i.accessToken),s&&s.token&&(t.ac=s.token);let o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+iR(t);this.log_("Sending REST request for "+o);let a=new XMLHttpRequest;a.onreadystatechange=()=>{if(r&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let l=null;if(a.status>=200&&a.status<300){try{l=bh(a.responseText)}catch{Ot("Failed to parse JSON response for "+o+": "+a.responseText)}r(null,l)}else a.status!==401&&a.status!==404&&Ot("Got unsuccessful REST response for "+o+" Status: "+a.status),r(a.status);r=null}},a.open("GET",o,!0),a.send()})}};var vv=class{constructor(){this.rootNode_=re.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}};function of(){return{value:null,children:new Map}}function Ra(n,e,t){if(ae(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{let r=oe(e);n.children.has(r)||n.children.set(r,of());let i=n.children.get(r);e=Re(e),Ra(i,e,t)}}function Ev(n,e){if(ae(e))return n.value=null,n.children.clear(),!0;if(n.value!==null){if(n.value.isLeafNode())return!1;{let t=n.value;return n.value=null,t.forEachChild(ke,(r,i)=>{Ra(n,new Se(r),i)}),Ev(n,e)}}else if(n.children.size>0){let t=oe(e);return e=Re(e),n.children.has(t)&&Ev(n.children.get(t),e)&&n.children.delete(t),n.children.size===0}else return!0}function Sv(n,e,t){n.value!==null?t(e,n.value):h3(n,(r,i)=>{let s=new Se(e.toString()+"/"+r);Sv(i,s,t)})}function h3(n,e){n.children.forEach((t,r)=>{e(r,t)})}var Cv=class{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),t=Object.assign({},e);return this.last_&&wt(this.last_,(r,i)=>{t[r]=t[r]-i}),this.last_=e,t}};var RN=10*1e3,f3=30*1e3,p3=5*60*1e3,wv=class{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Cv(e);let r=RN+(f3-RN)*Math.random();Yc(this.reportStats_.bind(this),Math.floor(r))}reportStats_(){let e=this.statsListener_.get(),t={},r=!1;wt(e,(i,s)=>{s>0&&Tn(this.statsToReport_,i)&&(t[i]=s,r=!0)}),r&&this.server_.reportStats(t),Yc(this.reportStats_.bind(this),Math.floor(Math.random()*2*p3))}};var vr=function(n){return n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE",n}(vr||{});function cE(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function uE(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function dE(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}var Tv=class n{constructor(e,t,r){this.path=e,this.affectedTree=t,this.revert=r,this.type=vr.ACK_USER_WRITE,this.source=cE()}operationForChild(e){if(ae(this.path)){if(this.affectedTree.value!=null)return L(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let t=this.affectedTree.subtree(new Se(e));return new n(Ee(),t,this.revert)}}else return L(oe(this.path)===e,"operationForChild called for unrelated child."),new n(Re(this.path),this.affectedTree,this.revert)}};var af=class n{constructor(e,t){this.source=e,this.path=t,this.type=vr.LISTEN_COMPLETE}operationForChild(e){return ae(this.path)?new n(this.source,Ee()):new n(this.source,Re(this.path))}};var wa=class n{constructor(e,t,r){this.source=e,this.path=t,this.snap=r,this.type=vr.OVERWRITE}operationForChild(e){return ae(this.path)?new n(this.source,Ee(),this.snap.getImmediateChild(e)):new n(this.source,Re(this.path),this.snap)}};var cu=class n{constructor(e,t,r){this.source=e,this.path=t,this.children=r,this.type=vr.MERGE}operationForChild(e){if(ae(this.path)){let t=this.children.subtree(new Se(e));return t.isEmpty()?null:t.value?new wa(this.source,Ee(),t.value):new n(this.source,Ee(),t)}else return L(oe(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new n(this.source,Re(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}};var Cr=class{constructor(e,t,r){this.node_=e,this.fullyInitialized_=t,this.filtered_=r}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(ae(e))return this.isFullyInitialized()&&!this.filtered_;let t=oe(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}};var bv=class{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}};function m3(n,e,t,r){let i=[],s=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&s.push(o3(o.childName,o.snapshotNode))}),Qc(n,i,"child_removed",e,r,t),Qc(n,i,"child_added",e,r,t),Qc(n,i,"child_moved",s,r,t),Qc(n,i,"child_changed",e,r,t),Qc(n,i,"value",e,r,t),i}function Qc(n,e,t,r,i,s){let o=r.filter(a=>a.type===t);o.sort((a,l)=>y3(n,a,l)),o.forEach(a=>{let l=g3(n,a,s);i.forEach(c=>{c.respondsTo(a.type)&&e.push(c.createEvent(l,n.query_))})})}function g3(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function y3(n,e,t){if(e.childName==null||t.childName==null)throw aa("Should only compare child_ events.");let r=new le(e.childName,e.snapshotNode),i=new le(t.childName,t.snapshotNode);return n.index_.compare(r,i)}function bf(n,e){return{eventCache:n,serverCache:e}}function Jc(n,e,t,r){return bf(new Cr(e,t,r),n.serverCache)}function _k(n,e,t,r){return bf(n.eventCache,new Cr(e,t,r))}function lf(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function so(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}var H_,_3=()=>(H_||(H_=new An(mq)),H_),jt=class n{constructor(e,t=_3()){this.value=e,this.children=t}static fromObject(e){let t=new n(null);return wt(e,(r,i)=>{t=t.set(new Se(r),i)}),t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:Ee(),value:this.value};if(ae(e))return null;{let r=oe(e),i=this.children.get(r);if(i!==null){let s=i.findRootMostMatchingPathAndValue(Re(e),t);return s!=null?{path:qe(new Se(r),s.path),value:s.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(ae(e))return this;{let t=oe(e),r=this.children.get(t);return r!==null?r.subtree(Re(e)):new n(null)}}set(e,t){if(ae(e))return new n(t,this.children);{let r=oe(e),s=(this.children.get(r)||new n(null)).set(Re(e),t),o=this.children.insert(r,s);return new n(this.value,o)}}remove(e){if(ae(e))return this.children.isEmpty()?new n(null):new n(null,this.children);{let t=oe(e),r=this.children.get(t);if(r){let i=r.remove(Re(e)),s;return i.isEmpty()?s=this.children.remove(t):s=this.children.insert(t,i),this.value===null&&s.isEmpty()?new n(null):new n(this.value,s)}else return this}}get(e){if(ae(e))return this.value;{let t=oe(e),r=this.children.get(t);return r?r.get(Re(e)):null}}setTree(e,t){if(ae(e))return t;{let r=oe(e),s=(this.children.get(r)||new n(null)).setTree(Re(e),t),o;return s.isEmpty()?o=this.children.remove(r):o=this.children.insert(r,s),new n(this.value,o)}}fold(e){return this.fold_(Ee(),e)}fold_(e,t){let r={};return this.children.inorderTraversal((i,s)=>{r[i]=s.fold_(qe(e,i),t)}),t(e,this.value,r)}findOnPath(e,t){return this.findOnPath_(e,Ee(),t)}findOnPath_(e,t,r){let i=this.value?r(t,this.value):!1;if(i)return i;if(ae(e))return null;{let s=oe(e),o=this.children.get(s);return o?o.findOnPath_(Re(e),qe(t,s),r):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,Ee(),t)}foreachOnPath_(e,t,r){if(ae(e))return this;{this.value&&r(t,this.value);let i=oe(e),s=this.children.get(i);return s?s.foreachOnPath_(Re(e),qe(t,i),r):new n(null)}}foreach(e){this.foreach_(Ee(),e)}foreach_(e,t){this.children.inorderTraversal((r,i)=>{i.foreach_(qe(e,r),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,r)=>{r.value&&e(t,r.value)})}};var Kn=class n{constructor(e){this.writeTree_=e}static empty(){return new n(new jt(null))}};function Zc(n,e,t){if(ae(e))return new Kn(new jt(t));{let r=n.writeTree_.findRootMostValueAndPath(e);if(r!=null){let i=r.path,s=r.value,o=Wt(i,e);return s=s.updateChild(o,t),new Kn(n.writeTree_.set(i,s))}else{let i=new jt(t),s=n.writeTree_.setTree(e,i);return new Kn(s)}}}function Iv(n,e,t){let r=n;return wt(t,(i,s)=>{r=Zc(r,qe(e,i),s)}),r}function DN(n,e){if(ae(e))return Kn.empty();{let t=n.writeTree_.setTree(e,new jt(null));return new Kn(t)}}function Av(n,e){return ao(n,e)!=null}function ao(n,e){let t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(Wt(t.path,e)):null}function NN(n){let e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(ke,(r,i)=>{e.push(new le(r,i))}):n.writeTree_.children.inorderTraversal((r,i)=>{i.value!=null&&e.push(new le(r,i.value))}),e}function Mi(n,e){if(ae(e))return n;{let t=ao(n,e);return t!=null?new Kn(new jt(t)):new Kn(n.writeTree_.subtree(e))}}function Rv(n){return n.writeTree_.isEmpty()}function Ta(n,e){return vk(Ee(),n.writeTree_,e)}function vk(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let r=null;return e.children.inorderTraversal((i,s)=>{i===".priority"?(L(s.value!==null,"Priority writes must always be leaf nodes"),r=s.value):t=vk(qe(n,i),s,t)}),!t.getChild(n).isEmpty()&&r!==null&&(t=t.updateChild(qe(n,".priority"),r)),t}}function If(n,e){return wk(e,n)}function v3(n,e,t,r,i){L(r>n.lastWriteId,"Stacking an older write on top of newer ones"),i===void 0&&(i=!0),n.allWrites.push({path:e,snap:t,writeId:r,visible:i}),i&&(n.visibleWrites=Zc(n.visibleWrites,e,t)),n.lastWriteId=r}function E3(n,e,t,r){L(r>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:e,children:t,writeId:r,visible:!0}),n.visibleWrites=Iv(n.visibleWrites,e,t),n.lastWriteId=r}function S3(n,e){for(let t=0;t<n.allWrites.length;t++){let r=n.allWrites[t];if(r.writeId===e)return r}return null}function C3(n,e){let t=n.allWrites.findIndex(a=>a.writeId===e);L(t>=0,"removeWrite called with nonexistent writeId.");let r=n.allWrites[t];n.allWrites.splice(t,1);let i=r.visible,s=!1,o=n.allWrites.length-1;for(;i&&o>=0;){let a=n.allWrites[o];a.visible&&(o>=t&&w3(a,r.path)?i=!1:In(r.path,a.path)&&(s=!0)),o--}if(i){if(s)return T3(n),!0;if(r.snap)n.visibleWrites=DN(n.visibleWrites,r.path);else{let a=r.children;wt(a,l=>{n.visibleWrites=DN(n.visibleWrites,qe(r.path,l))})}return!0}else return!1}function w3(n,e){if(n.snap)return In(n.path,e);for(let t in n.children)if(n.children.hasOwnProperty(t)&&In(qe(n.path,t),e))return!0;return!1}function T3(n){n.visibleWrites=Ek(n.allWrites,b3,Ee()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function b3(n){return n.visible}function Ek(n,e,t){let r=Kn.empty();for(let i=0;i<n.length;++i){let s=n[i];if(e(s)){let o=s.path,a;if(s.snap)In(t,o)?(a=Wt(t,o),r=Zc(r,a,s.snap)):In(o,t)&&(a=Wt(o,t),r=Zc(r,Ee(),s.snap.getChild(a)));else if(s.children){if(In(t,o))a=Wt(t,o),r=Iv(r,a,s.children);else if(In(o,t))if(a=Wt(o,t),ae(a))r=Iv(r,Ee(),s.children);else{let l=Ii(s.children,oe(a));if(l){let c=l.getChild(Re(a));r=Zc(r,Ee(),c)}}}else throw aa("WriteRecord should have .snap or .children")}}return r}function Sk(n,e,t,r,i){if(!r&&!i){let s=ao(n.visibleWrites,e);if(s!=null)return s;{let o=Mi(n.visibleWrites,e);if(Rv(o))return t;if(t==null&&!Av(o,Ee()))return null;{let a=t||re.EMPTY_NODE;return Ta(o,a)}}}else{let s=Mi(n.visibleWrites,e);if(!i&&Rv(s))return t;if(!i&&t==null&&!Av(s,Ee()))return null;{let o=function(c){return(c.visible||i)&&(!r||!~r.indexOf(c.writeId))&&(In(c.path,e)||In(e,c.path))},a=Ek(n.allWrites,o,e),l=t||re.EMPTY_NODE;return Ta(a,l)}}}function I3(n,e,t){let r=re.EMPTY_NODE,i=ao(n.visibleWrites,e);if(i)return i.isLeafNode()||i.forEachChild(ke,(s,o)=>{r=r.updateImmediateChild(s,o)}),r;if(t){let s=Mi(n.visibleWrites,e);return t.forEachChild(ke,(o,a)=>{let l=Ta(Mi(s,new Se(o)),a);r=r.updateImmediateChild(o,l)}),NN(s).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}else{let s=Mi(n.visibleWrites,e);return NN(s).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}}function A3(n,e,t,r,i){L(r||i,"Either existingEventSnap or existingServerSnap must exist");let s=qe(e,t);if(Av(n.visibleWrites,s))return null;{let o=Mi(n.visibleWrites,s);return Rv(o)?i.getChild(t):Ta(o,i.getChild(t))}}function R3(n,e,t,r){let i=qe(e,t),s=ao(n.visibleWrites,i);if(s!=null)return s;if(r.isCompleteForChild(t)){let o=Mi(n.visibleWrites,i);return Ta(o,r.getNode().getImmediateChild(t))}else return null}function D3(n,e){return ao(n.visibleWrites,e)}function N3(n,e,t,r,i,s,o){let a,l=Mi(n.visibleWrites,e),c=ao(l,Ee());if(c!=null)a=c;else if(t!=null)a=Ta(l,t);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){let u=[],d=o.getCompare(),h=s?a.getReverseIteratorFrom(r,o):a.getIteratorFrom(r,o),p=h.getNext();for(;p&&u.length<i;)d(p,r)!==0&&u.push(p),p=h.getNext();return u}else return[]}function k3(){return{visibleWrites:Kn.empty(),allWrites:[],lastWriteId:-1}}function cf(n,e,t,r){return Sk(n.writeTree,n.treePath,e,t,r)}function hE(n,e){return I3(n.writeTree,n.treePath,e)}function kN(n,e,t,r){return A3(n.writeTree,n.treePath,e,t,r)}function uf(n,e){return D3(n.writeTree,qe(n.treePath,e))}function O3(n,e,t,r,i,s){return N3(n.writeTree,n.treePath,e,t,r,i,s)}function fE(n,e,t){return R3(n.writeTree,n.treePath,e,t)}function Ck(n,e){return wk(qe(n.treePath,e),n.writeTree)}function wk(n,e){return{treePath:n,writeTree:e}}var Dv=class{constructor(){this.changeMap=new Map}trackChildChange(e){let t=e.type,r=e.childName;L(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),L(r!==".priority","Only non-priority child changes can be tracked.");let i=this.changeMap.get(r);if(i){let s=i.type;if(t==="child_added"&&s==="child_removed")this.changeMap.set(r,ou(r,e.snapshotNode,i.snapshotNode));else if(t==="child_removed"&&s==="child_added")this.changeMap.delete(r);else if(t==="child_removed"&&s==="child_changed")this.changeMap.set(r,su(r,i.oldSnap));else if(t==="child_changed"&&s==="child_added")this.changeMap.set(r,Ca(r,e.snapshotNode));else if(t==="child_changed"&&s==="child_changed")this.changeMap.set(r,ou(r,e.snapshotNode,i.oldSnap));else throw aa("Illegal combination of changes: "+e+" occurred after "+i)}else this.changeMap.set(r,e)}getChanges(){return Array.from(this.changeMap.values())}};var Nv=class{getCompleteChild(e){return null}getChildAfterChild(e,t,r){return null}},Tk=new Nv,uu=class{constructor(e,t,r=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=r}getCompleteChild(e){let t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{let r=this.optCompleteServerCache_!=null?new Cr(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return fE(this.writes_,e,r)}}getChildAfterChild(e,t,r){let i=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:so(this.viewCache_),s=O3(this.writes_,i,t,1,r,e);return s.length===0?null:s[0]}};function x3(n){return{filter:n}}function P3(n,e){L(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),L(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function M3(n,e,t,r,i){let s=new Dv,o,a;if(t.type===vr.OVERWRITE){let c=t;c.source.fromUser?o=kv(n,e,c.path,c.snap,r,i,s):(L(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered()&&!ae(c.path),o=df(n,e,c.path,c.snap,r,i,a,s))}else if(t.type===vr.MERGE){let c=t;c.source.fromUser?o=L3(n,e,c.path,c.children,r,i,s):(L(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered(),o=Ov(n,e,c.path,c.children,r,i,a,s))}else if(t.type===vr.ACK_USER_WRITE){let c=t;c.revert?o=U3(n,e,c.path,r,i,s):o=B3(n,e,c.path,c.affectedTree,r,i,s)}else if(t.type===vr.LISTEN_COMPLETE)o=V3(n,e,t.path,r,s);else throw aa("Unknown operation type: "+t.type);let l=s.getChanges();return F3(e,o,l),{viewCache:o,changes:l}}function F3(n,e,t){let r=e.eventCache;if(r.isFullyInitialized()){let i=r.getNode().isLeafNode()||r.getNode().isEmpty(),s=lf(n);(t.length>0||!n.eventCache.isFullyInitialized()||i&&!r.getNode().equals(s)||!r.getNode().getPriority().equals(s.getPriority()))&&t.push(yk(lf(e)))}}function bk(n,e,t,r,i,s){let o=e.eventCache;if(uf(r,t)!=null)return e;{let a,l;if(ae(t))if(L(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){let c=so(e),u=c instanceof re?c:re.EMPTY_NODE,d=hE(r,u);a=n.filter.updateFullNode(e.eventCache.getNode(),d,s)}else{let c=cf(r,so(e));a=n.filter.updateFullNode(e.eventCache.getNode(),c,s)}else{let c=oe(t);if(c===".priority"){L(Bi(t)===1,"Can't have a priority with additional path components");let u=o.getNode();l=e.serverCache.getNode();let d=kN(r,t,u,l);d!=null?a=n.filter.updatePriority(u,d):a=o.getNode()}else{let u=Re(t),d;if(o.isCompleteForChild(c)){l=e.serverCache.getNode();let h=kN(r,t,o.getNode(),l);h!=null?d=o.getNode().getImmediateChild(c).updateChild(u,h):d=o.getNode().getImmediateChild(c)}else d=fE(r,c,e.serverCache);d!=null?a=n.filter.updateChild(o.getNode(),c,d,u,i,s):a=o.getNode()}}return Jc(e,a,o.isFullyInitialized()||ae(t),n.filter.filtersNodes())}}function df(n,e,t,r,i,s,o,a){let l=e.serverCache,c,u=o?n.filter:n.filter.getIndexedFilter();if(ae(t))c=u.updateFullNode(l.getNode(),r,null);else if(u.filtersNodes()&&!l.isFiltered()){let p=l.getNode().updateChild(t,r);c=u.updateFullNode(l.getNode(),p,null)}else{let p=oe(t);if(!l.isCompleteForPath(t)&&Bi(t)>1)return e;let E=Re(t),b=l.getNode().getImmediateChild(p).updateChild(E,r);p===".priority"?c=u.updatePriority(l.getNode(),b):c=u.updateChild(l.getNode(),p,b,E,Tk,null)}let d=_k(e,c,l.isFullyInitialized()||ae(t),u.filtersNodes()),h=new uu(i,d,s);return bk(n,d,t,i,h,a)}function kv(n,e,t,r,i,s,o){let a=e.eventCache,l,c,u=new uu(i,e,s);if(ae(t))c=n.filter.updateFullNode(e.eventCache.getNode(),r,o),l=Jc(e,c,!0,n.filter.filtersNodes());else{let d=oe(t);if(d===".priority")c=n.filter.updatePriority(e.eventCache.getNode(),r),l=Jc(e,c,a.isFullyInitialized(),a.isFiltered());else{let h=Re(t),p=a.getNode().getImmediateChild(d),E;if(ae(h))E=r;else{let w=u.getCompleteChild(d);w!=null?iE(h)===".priority"&&w.getChild(dk(h)).isEmpty()?E=w:E=w.updateChild(h,r):E=re.EMPTY_NODE}if(p.equals(E))l=e;else{let w=n.filter.updateChild(a.getNode(),d,E,h,u,o);l=Jc(e,w,a.isFullyInitialized(),n.filter.filtersNodes())}}}return l}function ON(n,e){return n.eventCache.isCompleteForChild(e)}function L3(n,e,t,r,i,s,o){let a=e;return r.foreach((l,c)=>{let u=qe(t,l);ON(e,oe(u))&&(a=kv(n,a,u,c,i,s,o))}),r.foreach((l,c)=>{let u=qe(t,l);ON(e,oe(u))||(a=kv(n,a,u,c,i,s,o))}),a}function xN(n,e,t){return t.foreach((r,i)=>{e=e.updateChild(r,i)}),e}function Ov(n,e,t,r,i,s,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let l=e,c;ae(t)?c=r:c=new jt(null).setTree(t,r);let u=e.serverCache.getNode();return c.children.inorderTraversal((d,h)=>{if(u.hasChild(d)){let p=e.serverCache.getNode().getImmediateChild(d),E=xN(n,p,h);l=df(n,l,new Se(d),E,i,s,o,a)}}),c.children.inorderTraversal((d,h)=>{let p=!e.serverCache.isCompleteForChild(d)&&h.value===null;if(!u.hasChild(d)&&!p){let E=e.serverCache.getNode().getImmediateChild(d),w=xN(n,E,h);l=df(n,l,new Se(d),w,i,s,o,a)}}),l}function B3(n,e,t,r,i,s,o){if(uf(i,t)!=null)return e;let a=e.serverCache.isFiltered(),l=e.serverCache;if(r.value!=null){if(ae(t)&&l.isFullyInitialized()||l.isCompleteForPath(t))return df(n,e,t,l.getNode().getChild(t),i,s,a,o);if(ae(t)){let c=new jt(null);return l.getNode().forEachChild(Er,(u,d)=>{c=c.set(new Se(u),d)}),Ov(n,e,t,c,i,s,a,o)}else return e}else{let c=new jt(null);return r.foreach((u,d)=>{let h=qe(t,u);l.isCompleteForPath(h)&&(c=c.set(u,l.getNode().getChild(h)))}),Ov(n,e,t,c,i,s,a,o)}}function V3(n,e,t,r,i){let s=e.serverCache,o=_k(e,s.getNode(),s.isFullyInitialized()||ae(t),s.isFiltered());return bk(n,o,t,r,Tk,i)}function U3(n,e,t,r,i,s){let o;if(uf(r,t)!=null)return e;{let a=new uu(r,e,i),l=e.eventCache.getNode(),c;if(ae(t)||oe(t)===".priority"){let u;if(e.serverCache.isFullyInitialized())u=cf(r,so(e));else{let d=e.serverCache.getNode();L(d instanceof re,"serverChildren would be complete if leaf node"),u=hE(r,d)}u=u,c=n.filter.updateFullNode(l,u,s)}else{let u=oe(t),d=fE(r,u,e.serverCache);d==null&&e.serverCache.isCompleteForChild(u)&&(d=l.getImmediateChild(u)),d!=null?c=n.filter.updateChild(l,u,d,Re(t),a,s):e.eventCache.getNode().hasChild(u)?c=n.filter.updateChild(l,u,re.EMPTY_NODE,Re(t),a,s):c=l,c.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=cf(r,so(e)),o.isLeafNode()&&(c=n.filter.updateFullNode(c,o,s)))}return o=e.serverCache.isFullyInitialized()||uf(r,Ee())!=null,Jc(e,c,o,n.filter.filtersNodes())}}var xv=class{constructor(e,t){this.query_=e,this.eventRegistrations_=[];let r=this.query_._queryParams,i=new au(r.getIndex()),s=a3(r);this.processor_=x3(s);let o=t.serverCache,a=t.eventCache,l=i.updateFullNode(re.EMPTY_NODE,o.getNode(),null),c=s.updateFullNode(re.EMPTY_NODE,a.getNode(),null),u=new Cr(l,o.isFullyInitialized(),i.filtersNodes()),d=new Cr(c,a.isFullyInitialized(),s.filtersNodes());this.viewCache_=bf(d,u),this.eventGenerator_=new bv(this.query_)}get query(){return this.query_}};function q3(n){return n.viewCache_.serverCache.getNode()}function z3(n){return lf(n.viewCache_)}function G3(n,e){let t=so(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!ae(e)&&!t.getImmediateChild(oe(e)).isEmpty())?t.getChild(e):null}function PN(n){return n.eventRegistrations_.length===0}function W3(n,e){n.eventRegistrations_.push(e)}function MN(n,e,t){let r=[];if(t){L(e==null,"A cancel should cancel all event registrations.");let i=n.query._path;n.eventRegistrations_.forEach(s=>{let o=s.createCancelEvent(t,i);o&&r.push(o)})}if(e){let i=[];for(let s=0;s<n.eventRegistrations_.length;++s){let o=n.eventRegistrations_[s];if(!o.matches(e))i.push(o);else if(e.hasAnyCallback()){i=i.concat(n.eventRegistrations_.slice(s+1));break}}n.eventRegistrations_=i}else n.eventRegistrations_=[];return r}function FN(n,e,t,r){e.type===vr.MERGE&&e.source.queryId!==null&&(L(so(n.viewCache_),"We should always have a full cache before handling merges"),L(lf(n.viewCache_),"Missing event cache, even though we have a server cache"));let i=n.viewCache_,s=M3(n.processor_,i,e,t,r);return P3(n.processor_,s.viewCache),L(s.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=s.viewCache,Ik(n,s.changes,s.viewCache.eventCache.getNode(),null)}function j3(n,e){let t=n.viewCache_.eventCache,r=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(ke,(s,o)=>{r.push(Ca(s,o))}),t.isFullyInitialized()&&r.push(yk(t.getNode())),Ik(n,r,t.getNode(),e)}function Ik(n,e,t,r){let i=r?[r]:n.eventRegistrations_;return m3(n.eventGenerator_,e,t,i)}var hf,ff=class{constructor(){this.views=new Map}};function $3(n){L(!hf,"__referenceConstructor has already been defined"),hf=n}function H3(){return L(hf,"Reference.ts has not been loaded"),hf}function K3(n){return n.views.size===0}function pE(n,e,t,r){let i=e.source.queryId;if(i!==null){let s=n.views.get(i);return L(s!=null,"SyncTree gave us an op for an invalid query."),FN(s,e,t,r)}else{let s=[];for(let o of n.views.values())s=s.concat(FN(o,e,t,r));return s}}function Ak(n,e,t,r,i){let s=e._queryIdentifier,o=n.views.get(s);if(!o){let a=cf(t,i?r:null),l=!1;a?l=!0:r instanceof re?(a=hE(t,r),l=!1):(a=re.EMPTY_NODE,l=!1);let c=bf(new Cr(a,l,!1),new Cr(r,i,!1));return new xv(e,c)}return o}function Q3(n,e,t,r,i,s){let o=Ak(n,e,r,i,s);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),W3(o,t),j3(o,t)}function Y3(n,e,t,r){let i=e._queryIdentifier,s=[],o=[],a=Vi(n);if(i==="default")for(let[l,c]of n.views.entries())o=o.concat(MN(c,t,r)),PN(c)&&(n.views.delete(l),c.query._queryParams.loadsAllData()||s.push(c.query));else{let l=n.views.get(i);l&&(o=o.concat(MN(l,t,r)),PN(l)&&(n.views.delete(i),l.query._queryParams.loadsAllData()||s.push(l.query)))}return a&&!Vi(n)&&s.push(new(H3())(e._repo,e._path)),{removed:s,events:o}}function Rk(n){let e=[];for(let t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function Fi(n,e){let t=null;for(let r of n.views.values())t=t||G3(r,e);return t}function Dk(n,e){if(e._queryParams.loadsAllData())return Af(n);{let r=e._queryIdentifier;return n.views.get(r)}}function Nk(n,e){return Dk(n,e)!=null}function Vi(n){return Af(n)!=null}function Af(n){for(let e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}var pf;function X3(n){L(!pf,"__referenceConstructor has already been defined"),pf=n}function J3(){return L(pf,"Reference.ts has not been loaded"),pf}var Z3=1,mf=class{constructor(e){this.listenProvider_=e,this.syncPointTree_=new jt(null),this.pendingWriteTree_=k3(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}};function mE(n,e,t,r,i){return v3(n.pendingWriteTree_,e,t,r,i),i?Da(n,new wa(cE(),e,t)):[]}function e4(n,e,t,r){E3(n.pendingWriteTree_,e,t,r);let i=jt.fromObject(t);return Da(n,new cu(cE(),e,i))}function Pi(n,e,t=!1){let r=S3(n.pendingWriteTree_,e);if(C3(n.pendingWriteTree_,e)){let s=new jt(null);return r.snap!=null?s=s.set(Ee(),!0):wt(r.children,o=>{s=s.set(new Se(o),!0)}),Da(n,new Tv(r.path,s,t))}else return[]}function vu(n,e,t){return Da(n,new wa(uE(),e,t))}function t4(n,e,t){let r=jt.fromObject(t);return Da(n,new cu(uE(),e,r))}function n4(n,e){return Da(n,new af(uE(),e))}function r4(n,e,t){let r=gE(n,t);if(r){let i=yE(r),s=i.path,o=i.queryId,a=Wt(s,e),l=new af(dE(o),a);return _E(n,s,l)}else return[]}function gf(n,e,t,r,i=!1){let s=e._path,o=n.syncPointTree_.get(s),a=[];if(o&&(e._queryIdentifier==="default"||Nk(o,e))){let l=Y3(o,e,t,r);K3(o)&&(n.syncPointTree_=n.syncPointTree_.remove(s));let c=l.removed;if(a=l.events,!i){let u=c.findIndex(h=>h._queryParams.loadsAllData())!==-1,d=n.syncPointTree_.findOnPath(s,(h,p)=>Vi(p));if(u&&!d){let h=n.syncPointTree_.subtree(s);if(!h.isEmpty()){let p=o4(h);for(let E=0;E<p.length;++E){let w=p[E],b=w.query,N=Pk(n,w);n.listenProvider_.startListening(eu(b),du(n,b),N.hashFn,N.onComplete)}}}!d&&c.length>0&&!r&&(u?n.listenProvider_.stopListening(eu(e),null):c.forEach(h=>{let p=n.queryToTagMap.get(Df(h));n.listenProvider_.stopListening(eu(h),p)}))}a4(n,c)}return a}function kk(n,e,t,r){let i=gE(n,r);if(i!=null){let s=yE(i),o=s.path,a=s.queryId,l=Wt(o,e),c=new wa(dE(a),l,t);return _E(n,o,c)}else return[]}function i4(n,e,t,r){let i=gE(n,r);if(i){let s=yE(i),o=s.path,a=s.queryId,l=Wt(o,e),c=jt.fromObject(t),u=new cu(dE(a),l,c);return _E(n,o,u)}else return[]}function Pv(n,e,t,r=!1){let i=e._path,s=null,o=!1;n.syncPointTree_.foreachOnPath(i,(h,p)=>{let E=Wt(h,i);s=s||Fi(p,E),o=o||Vi(p)});let a=n.syncPointTree_.get(i);a?(o=o||Vi(a),s=s||Fi(a,Ee())):(a=new ff,n.syncPointTree_=n.syncPointTree_.set(i,a));let l;s!=null?l=!0:(l=!1,s=re.EMPTY_NODE,n.syncPointTree_.subtree(i).foreachChild((p,E)=>{let w=Fi(E,Ee());w&&(s=s.updateImmediateChild(p,w))}));let c=Nk(a,e);if(!c&&!e._queryParams.loadsAllData()){let h=Df(e);L(!n.queryToTagMap.has(h),"View does not exist, but we have a tag");let p=l4();n.queryToTagMap.set(h,p),n.tagToQueryMap.set(p,h)}let u=If(n.pendingWriteTree_,i),d=Q3(a,e,t,u,s,l);if(!c&&!o&&!r){let h=Dk(a,e);d=d.concat(c4(n,e,h))}return d}function Rf(n,e,t){let i=n.pendingWriteTree_,s=n.syncPointTree_.findOnPath(e,(o,a)=>{let l=Wt(o,e),c=Fi(a,l);if(c)return c});return Sk(i,e,s,t,!0)}function s4(n,e){let t=e._path,r=null;n.syncPointTree_.foreachOnPath(t,(c,u)=>{let d=Wt(c,t);r=r||Fi(u,d)});let i=n.syncPointTree_.get(t);i?r=r||Fi(i,Ee()):(i=new ff,n.syncPointTree_=n.syncPointTree_.set(t,i));let s=r!=null,o=s?new Cr(r,!0,!1):null,a=If(n.pendingWriteTree_,e._path),l=Ak(i,e,a,s?o.getNode():re.EMPTY_NODE,s);return z3(l)}function Da(n,e){return Ok(e,n.syncPointTree_,null,If(n.pendingWriteTree_,Ee()))}function Ok(n,e,t,r){if(ae(n.path))return xk(n,e,t,r);{let i=e.get(Ee());t==null&&i!=null&&(t=Fi(i,Ee()));let s=[],o=oe(n.path),a=n.operationForChild(o),l=e.children.get(o);if(l&&a){let c=t?t.getImmediateChild(o):null,u=Ck(r,o);s=s.concat(Ok(a,l,c,u))}return i&&(s=s.concat(pE(i,n,r,t))),s}}function xk(n,e,t,r){let i=e.get(Ee());t==null&&i!=null&&(t=Fi(i,Ee()));let s=[];return e.children.inorderTraversal((o,a)=>{let l=t?t.getImmediateChild(o):null,c=Ck(r,o),u=n.operationForChild(o);u&&(s=s.concat(xk(u,a,l,c)))}),i&&(s=s.concat(pE(i,n,r,t))),s}function Pk(n,e){let t=e.query,r=du(n,t);return{hashFn:()=>(q3(e)||re.EMPTY_NODE).hash(),onComplete:i=>{if(i==="ok")return r?r4(n,t._path,r):n4(n,t._path);{let s=_q(i,t);return gf(n,t,null,s)}}}}function du(n,e){let t=Df(e);return n.queryToTagMap.get(t)}function Df(n){return n._path.toString()+"$"+n._queryIdentifier}function gE(n,e){return n.tagToQueryMap.get(e)}function yE(n){let e=n.indexOf("$");return L(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new Se(n.substr(0,e))}}function _E(n,e,t){let r=n.syncPointTree_.get(e);L(r,"Missing sync point for query tag that we're tracking");let i=If(n.pendingWriteTree_,e);return pE(r,t,i,null)}function o4(n){return n.fold((e,t,r)=>{if(t&&Vi(t))return[Af(t)];{let i=[];return t&&(i=Rk(t)),wt(r,(s,o)=>{i=i.concat(o)}),i}})}function eu(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(J3())(n._repo,n._path):n}function a4(n,e){for(let t=0;t<e.length;++t){let r=e[t];if(!r._queryParams.loadsAllData()){let i=Df(r),s=n.queryToTagMap.get(i);n.queryToTagMap.delete(i),n.tagToQueryMap.delete(s)}}}function l4(){return Z3++}function c4(n,e,t){let r=e._path,i=du(n,e),s=Pk(n,t),o=n.listenProvider_.startListening(eu(e),i,s.hashFn,s.onComplete),a=n.syncPointTree_.subtree(r);if(i)L(!Vi(a.value),"If we're adding a query, it shouldn't be shadowed");else{let l=a.fold((c,u,d)=>{if(!ae(c)&&u&&Vi(u))return[Af(u).query];{let h=[];return u&&(h=h.concat(Rk(u).map(p=>p.query))),wt(d,(p,E)=>{h=h.concat(E)}),h}});for(let c=0;c<l.length;++c){let u=l[c];n.listenProvider_.stopListening(eu(u),du(n,u))}}return o}var Mv=class n{constructor(e){this.node_=e}getImmediateChild(e){let t=this.node_.getImmediateChild(e);return new n(t)}node(){return this.node_}},Fv=class n{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){let t=qe(this.path_,e);return new n(this.syncTree_,t)}node(){return Rf(this.syncTree_,this.path_)}},u4=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},LN=function(n,e,t){if(!n||typeof n!="object")return n;if(L(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return d4(n[".sv"],e,t);if(typeof n[".sv"]=="object")return h4(n[".sv"],e);L(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},d4=function(n,e,t){switch(n){case"timestamp":return t.timestamp;default:L(!1,"Unexpected server value: "+n)}},h4=function(n,e,t){n.hasOwnProperty("increment")||L(!1,"Unexpected server value: "+JSON.stringify(n,null,2));let r=n.increment;typeof r!="number"&&L(!1,"Unexpected increment value: "+r);let i=e.node();if(L(i!==null&&typeof i<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;let o=i.getValue();return typeof o!="number"?r:o+r},Mk=function(n,e,t,r){return EE(e,new Fv(t,n),r)},vE=function(n,e,t){return EE(n,new Mv(e),t)};function EE(n,e,t){let r=n.getPriority().val(),i=LN(r,e.getImmediateChild(".priority"),t),s;if(n.isLeafNode()){let o=n,a=LN(o.getValue(),e,t);return a!==o.getValue()||i!==o.getPriority().val()?new Ea(a,je(i)):n}else{let o=n;return s=o,i!==o.getPriority().val()&&(s=s.updatePriority(new Ea(i))),o.forEachChild(ke,(a,l)=>{let c=EE(l,e.getImmediateChild(a),t);c!==l&&(s=s.updateImmediateChild(a,c))}),s}}var hu=class{constructor(e="",t=null,r={children:{},childCount:0}){this.name=e,this.parent=t,this.node=r}};function Nf(n,e){let t=e instanceof Se?e:new Se(e),r=n,i=oe(t);for(;i!==null;){let s=Ii(r.node.children,i)||{children:{},childCount:0};r=new hu(i,r,s),t=Re(t),i=oe(t)}return r}function lo(n){return n.node.value}function SE(n,e){n.node.value=e,Lv(n)}function Fk(n){return n.node.childCount>0}function f4(n){return lo(n)===void 0&&!Fk(n)}function kf(n,e){wt(n.node.children,(t,r)=>{e(new hu(t,n,r))})}function Lk(n,e,t,r){t&&!r&&e(n),kf(n,i=>{Lk(i,e,!0,r)}),t&&r&&e(n)}function p4(n,e,t){let r=t?n:n.parent;for(;r!==null;){if(e(r))return!0;r=r.parent}return!1}function Eu(n){return new Se(n.parent===null?n.name:Eu(n.parent)+"/"+n.name)}function Lv(n){n.parent!==null&&m4(n.parent,n.name,n)}function m4(n,e,t){let r=f4(t),i=Tn(n.node.children,e);r&&i?(delete n.node.children[e],n.node.childCount--,Lv(n)):!r&&!i&&(n.node.children[e]=t.node,n.node.childCount++,Lv(n))}var g4=/[\[\].#$\/\u0000-\u001F\u007F]/,y4=/[\[\].#$\u0000-\u001F\u007F]/,K_=10*1024*1024,Of=function(n){return typeof n=="string"&&n.length!==0&&!g4.test(n)},Bk=function(n){return typeof n=="string"&&n.length!==0&&!y4.test(n)},_4=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),Bk(n)},fu=function(n){return n===null||typeof n=="string"||typeof n=="number"&&!wf(n)||n&&typeof n=="object"&&Tn(n,".sv")},wr=function(n,e,t,r){r&&e===void 0||Su(Zt(n,"value"),e,t)},Su=function(n,e,t){let r=t instanceof Se?new av(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+no(r));if(typeof e=="function")throw new Error(n+"contains a function "+no(r)+" with contents = "+e.toString());if(wf(e))throw new Error(n+"contains "+e.toString()+" "+no(r));if(typeof e=="string"&&e.length>K_/3&&bc(e)>K_)throw new Error(n+"contains a string greater than "+K_+" utf8 bytes "+no(r)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let i=!1,s=!1;if(wt(e,(o,a)=>{if(o===".value")i=!0;else if(o!==".priority"&&o!==".sv"&&(s=!0,!Of(o)))throw new Error(n+" contains an invalid key ("+o+") "+no(r)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);Kq(r,o),Su(n,a,r),Qq(r)}),i&&s)throw new Error(n+' contains ".value" child '+no(r)+" in addition to actual children.")}},v4=function(n,e){let t,r;for(t=0;t<e.length;t++){r=e[t];let s=ru(r);for(let o=0;o<s.length;o++)if(!(s[o]===".priority"&&o===s.length-1)){if(!Of(s[o]))throw new Error(n+"contains an invalid key ("+s[o]+") in path "+r.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(Hq);let i=null;for(t=0;t<e.length;t++){if(r=e[t],i!==null&&In(i,r))throw new Error(n+"contains a path "+i.toString()+" that is ancestor of another path "+r.toString());i=r}},Vk=function(n,e,t,r){if(r&&e===void 0)return;let i=Zt(n,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(i+" must be an object containing the children to replace.");let s=[];wt(e,(o,a)=>{let l=new Se(o);if(Su(i,a,qe(t,l)),iE(l)===".priority"&&!fu(a))throw new Error(i+"contains an invalid value for '"+l.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(l)}),v4(i,s)},CE=function(n,e,t){if(!(t&&e===void 0)){if(wf(e))throw new Error(Zt(n,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!fu(e))throw new Error(Zt(n,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},Cu=function(n,e,t,r){if(!(r&&t===void 0)&&!Of(t))throw new Error(Zt(n,e)+'was an invalid key = "'+t+`".  Firebase keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]").`)},Na=function(n,e,t,r){if(!(r&&t===void 0)&&!Bk(t))throw new Error(Zt(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},E4=function(n,e,t,r){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Na(n,e,t,r)},un=function(n,e){if(oe(e)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},Uk=function(n,e){let t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!Of(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!_4(t))throw new Error(Zt(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};var Bv=class{constructor(){this.eventLists_=[],this.recursionDepth_=0}};function xf(n,e){let t=null;for(let r=0;r<e.length;r++){let i=e[r],s=i.getPath();t!==null&&!sE(s,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:s}),t.events.push(i)}t&&n.eventLists_.push(t)}function qk(n,e,t){xf(n,t),zk(n,r=>sE(r,e))}function dn(n,e,t){xf(n,t),zk(n,r=>In(r,e)||In(e,r))}function zk(n,e){n.recursionDepth_++;let t=!0;for(let r=0;r<n.eventLists_.length;r++){let i=n.eventLists_[r];if(i){let s=i.path;e(s)?(S4(n.eventLists_[r]),n.eventLists_[r]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function S4(n){for(let e=0;e<n.events.length;e++){let t=n.events[e];if(t!==null){n.events[e]=null;let r=t.getEventRunner();io&&Ct("event: "+t.toString()),Aa(r)}}}var Gk="repo_interrupt",C4=25,Vv=class{constructor(e,t,r,i){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=r,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Bv,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=of(),this.transactionQueueTree_=new hu,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}};function w4(n,e,t){if(n.stats_=tE(n.repoInfo_),n.forceRestClient_||Cq())n.server_=new _v(n.repoInfo_,(r,i,s,o)=>{BN(n,r,i,s,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>VN(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{lt(t)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}n.persistentConnection_=new oE(n.repoInfo_,e,(r,i,s,o)=>{BN(n,r,i,s,o)},r=>{VN(n,r)},r=>{T4(n,r)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(r=>{n.server_.refreshAuthToken(r)}),n.appCheckProvider_.addTokenChangeListener(r=>{n.server_.refreshAppCheckToken(r.token)}),n.statsReporter_=Tq(n.repoInfo_,()=>new wv(n.stats_,n.server_)),n.infoData_=new vv,n.infoSyncTree_=new mf({startListening:(r,i,s,o)=>{let a=[],l=n.infoData_.getNode(r._path);return l.isEmpty()||(a=vu(n.infoSyncTree_,r._path,l),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),wE(n,"connected",!1),n.serverSyncTree_=new mf({startListening:(r,i,s,o)=>(n.server_.listen(r,s,i,(a,l)=>{let c=o(a,l);dn(n.eventQueue_,r._path,c)}),[]),stopListening:(r,i)=>{n.server_.unlisten(r,i)}})}function Wk(n){let t=n.infoData_.getNode(new Se(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function wu(n){return u4({timestamp:Wk(n)})}function BN(n,e,t,r,i){n.dataUpdateCount++;let s=new Se(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(i)if(r){let l=Tc(t,c=>je(c));o=i4(n.serverSyncTree_,s,l,i)}else{let l=je(t);o=kk(n.serverSyncTree_,s,l,i)}else if(r){let l=Tc(t,c=>je(c));o=t4(n.serverSyncTree_,s,l)}else{let l=je(t);o=vu(n.serverSyncTree_,s,l)}let a=s;o.length>0&&(a=ba(n,s)),dn(n.eventQueue_,a,o)}function VN(n,e){wE(n,"connected",e),e===!1&&A4(n)}function T4(n,e){wt(e,(t,r)=>{wE(n,t,r)})}function wE(n,e,t){let r=new Se("/.info/"+e),i=je(t);n.infoData_.updateSnapshot(r,i);let s=vu(n.infoSyncTree_,r,i);dn(n.eventQueue_,r,s)}function Pf(n){return n.nextWriteId_++}function b4(n,e,t){let r=s4(n.serverSyncTree_,e);return r!=null?Promise.resolve(r):n.server_.get(e).then(i=>{let s=je(i).withIndex(e._queryParams.getIndex());Pv(n.serverSyncTree_,e,t,!0);let o;if(e._queryParams.loadsAllData())o=vu(n.serverSyncTree_,e._path,s);else{let a=du(n.serverSyncTree_,e);o=kk(n.serverSyncTree_,e._path,s,a)}return dn(n.eventQueue_,e._path,o),gf(n.serverSyncTree_,e,t,null,!0),s},i=>(ka(n,"get for query "+lt(e)+" failed: "+i),Promise.reject(new Error(i))))}function TE(n,e,t,r,i){ka(n,"set",{path:e.toString(),value:t,priority:r});let s=wu(n),o=je(t,r),a=Rf(n.serverSyncTree_,e),l=vE(o,a,s),c=Pf(n),u=mE(n.serverSyncTree_,e,l,c,!0);xf(n.eventQueue_,u),n.server_.put(e.toString(),o.val(!0),(h,p)=>{let E=h==="ok";E||Ot("set at "+e+" failed: "+h);let w=Pi(n.serverSyncTree_,c,!E);dn(n.eventQueue_,e,w),Ui(n,i,h,p)});let d=IE(n,e);ba(n,d),dn(n.eventQueue_,d,[])}function I4(n,e,t,r){ka(n,"update",{path:e.toString(),value:t});let i=!0,s=wu(n),o={};if(wt(t,(a,l)=>{i=!1,o[a]=Mk(qe(e,a),je(l),n.serverSyncTree_,s)}),i)Ct("update() called with empty data.  Don't do anything."),Ui(n,r,"ok",void 0);else{let a=Pf(n),l=e4(n.serverSyncTree_,e,o,a);xf(n.eventQueue_,l),n.server_.merge(e.toString(),t,(c,u)=>{let d=c==="ok";d||Ot("update at "+e+" failed: "+c);let h=Pi(n.serverSyncTree_,a,!d),p=h.length>0?ba(n,e):e;dn(n.eventQueue_,p,h),Ui(n,r,c,u)}),wt(t,c=>{let u=IE(n,qe(e,c));ba(n,u)}),dn(n.eventQueue_,e,[])}}function A4(n){ka(n,"onDisconnectEvents");let e=wu(n),t=of();Sv(n.onDisconnect_,Ee(),(i,s)=>{let o=Mk(i,s,n.serverSyncTree_,e);Ra(t,i,o)});let r=[];Sv(t,Ee(),(i,s)=>{r=r.concat(vu(n.serverSyncTree_,i,s));let o=IE(n,i);ba(n,o)}),n.onDisconnect_=of(),dn(n.eventQueue_,Ee(),r)}function R4(n,e,t){n.server_.onDisconnectCancel(e.toString(),(r,i)=>{r==="ok"&&Ev(n.onDisconnect_,e),Ui(n,t,r,i)})}function UN(n,e,t,r){let i=je(t);n.server_.onDisconnectPut(e.toString(),i.val(!0),(s,o)=>{s==="ok"&&Ra(n.onDisconnect_,e,i),Ui(n,r,s,o)})}function D4(n,e,t,r,i){let s=je(t,r);n.server_.onDisconnectPut(e.toString(),s.val(!0),(o,a)=>{o==="ok"&&Ra(n.onDisconnect_,e,s),Ui(n,i,o,a)})}function N4(n,e,t,r){if(Ih(t)){Ct("onDisconnect().update() called with empty data.  Don't do anything."),Ui(n,r,"ok",void 0);return}n.server_.onDisconnectMerge(e.toString(),t,(i,s)=>{i==="ok"&&wt(t,(o,a)=>{let l=je(a);Ra(n.onDisconnect_,qe(e,o),l)}),Ui(n,r,i,s)})}function k4(n,e,t){let r;oe(e._path)===".info"?r=Pv(n.infoSyncTree_,e,t):r=Pv(n.serverSyncTree_,e,t),qk(n.eventQueue_,e._path,r)}function Uv(n,e,t){let r;oe(e._path)===".info"?r=gf(n.infoSyncTree_,e,t):r=gf(n.serverSyncTree_,e,t),qk(n.eventQueue_,e._path,r)}function jk(n){n.persistentConnection_&&n.persistentConnection_.interrupt(Gk)}function O4(n){n.persistentConnection_&&n.persistentConnection_.resume(Gk)}function ka(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),Ct(t,...e)}function Ui(n,e,t,r){e&&Aa(()=>{if(t==="ok")e(null);else{let i=(t||"error").toUpperCase(),s=i;r&&(s+=": "+r);let o=new Error(s);o.code=i,e(o)}})}function x4(n,e,t,r,i,s){ka(n,"transaction on "+e);let o={path:e,update:t,onComplete:r,status:null,order:ZN(),applyLocally:s,retryCount:0,unwatcher:i,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=bE(n,e,void 0);o.currentInputSnapshot=a;let l=o.update(a.val());if(l===void 0)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{Su("transaction failed: Data returned ",l,o.path),o.status=0;let c=Nf(n.transactionQueueTree_,e),u=lo(c)||[];u.push(o),SE(c,u);let d;typeof l=="object"&&l!==null&&Tn(l,".priority")?(d=Ii(l,".priority"),L(fu(d),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):d=(Rf(n.serverSyncTree_,e)||re.EMPTY_NODE).getPriority().val();let h=wu(n),p=je(l,d),E=vE(p,a,h);o.currentOutputSnapshotRaw=p,o.currentOutputSnapshotResolved=E,o.currentWriteId=Pf(n);let w=mE(n.serverSyncTree_,e,E,o.currentWriteId,o.applyLocally);dn(n.eventQueue_,e,w),Mf(n,n.transactionQueueTree_)}}function bE(n,e,t){return Rf(n.serverSyncTree_,e,t)||re.EMPTY_NODE}function Mf(n,e=n.transactionQueueTree_){if(e||Ff(n,e),lo(e)){let t=Hk(n,e);L(t.length>0,"Sending zero length transaction queue"),t.every(i=>i.status===0)&&P4(n,Eu(e),t)}else Fk(e)&&kf(e,t=>{Mf(n,t)})}function P4(n,e,t){let r=t.map(c=>c.currentWriteId),i=bE(n,e,r),s=i,o=i.hash();for(let c=0;c<t.length;c++){let u=t[c];L(u.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),u.status=1,u.retryCount++;let d=Wt(e,u.path);s=s.updateChild(d,u.currentOutputSnapshotRaw)}let a=s.val(!0),l=e;n.server_.put(l.toString(),a,c=>{ka(n,"transaction put response",{path:l.toString(),status:c});let u=[];if(c==="ok"){let d=[];for(let h=0;h<t.length;h++)t[h].status=2,u=u.concat(Pi(n.serverSyncTree_,t[h].currentWriteId)),t[h].onComplete&&d.push(()=>t[h].onComplete(null,!0,t[h].currentOutputSnapshotResolved)),t[h].unwatcher();Ff(n,Nf(n.transactionQueueTree_,e)),Mf(n,n.transactionQueueTree_),dn(n.eventQueue_,e,u);for(let h=0;h<d.length;h++)Aa(d[h])}else{if(c==="datastale")for(let d=0;d<t.length;d++)t[d].status===3?t[d].status=4:t[d].status=0;else{Ot("transaction at "+l.toString()+" failed: "+c);for(let d=0;d<t.length;d++)t[d].status=4,t[d].abortReason=c}ba(n,e)}},o)}function ba(n,e){let t=$k(n,e),r=Eu(t),i=Hk(n,t);return M4(n,i,r),r}function M4(n,e,t){if(e.length===0)return;let r=[],i=[],o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){let l=e[a],c=Wt(t,l.path),u=!1,d;if(L(c!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),l.status===4)u=!0,d=l.abortReason,i=i.concat(Pi(n.serverSyncTree_,l.currentWriteId,!0));else if(l.status===0)if(l.retryCount>=C4)u=!0,d="maxretry",i=i.concat(Pi(n.serverSyncTree_,l.currentWriteId,!0));else{let h=bE(n,l.path,o);l.currentInputSnapshot=h;let p=e[a].update(h.val());if(p!==void 0){Su("transaction failed: Data returned ",p,l.path);let E=je(p);typeof p=="object"&&p!=null&&Tn(p,".priority")||(E=E.updatePriority(h.getPriority()));let b=l.currentWriteId,N=wu(n),D=vE(E,h,N);l.currentOutputSnapshotRaw=E,l.currentOutputSnapshotResolved=D,l.currentWriteId=Pf(n),o.splice(o.indexOf(b),1),i=i.concat(mE(n.serverSyncTree_,l.path,D,l.currentWriteId,l.applyLocally)),i=i.concat(Pi(n.serverSyncTree_,b,!0))}else u=!0,d="nodata",i=i.concat(Pi(n.serverSyncTree_,l.currentWriteId,!0))}dn(n.eventQueue_,t,i),i=[],u&&(e[a].status=2,function(h){setTimeout(h,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(d==="nodata"?r.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):r.push(()=>e[a].onComplete(new Error(d),!1,null))))}Ff(n,n.transactionQueueTree_);for(let a=0;a<r.length;a++)Aa(r[a]);Mf(n,n.transactionQueueTree_)}function $k(n,e){let t,r=n.transactionQueueTree_;for(t=oe(e);t!==null&&lo(r)===void 0;)r=Nf(r,t),e=Re(e),t=oe(e);return r}function Hk(n,e){let t=[];return Kk(n,e,t),t.sort((r,i)=>r.order-i.order),t}function Kk(n,e,t){let r=lo(e);if(r)for(let i=0;i<r.length;i++)t.push(r[i]);kf(e,i=>{Kk(n,i,t)})}function Ff(n,e){let t=lo(e);if(t){let r=0;for(let i=0;i<t.length;i++)t[i].status!==2&&(t[r]=t[i],r++);t.length=r,SE(e,t.length>0?t:void 0)}kf(e,r=>{Ff(n,r)})}function IE(n,e){let t=Eu($k(n,e)),r=Nf(n.transactionQueueTree_,e);return p4(r,i=>{Q_(n,i)}),Q_(n,r),Lk(r,i=>{Q_(n,i)}),t}function Q_(n,e){let t=lo(e);if(t){let r=[],i=[],s=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(L(s===o-1,"All SENT items should be at beginning of queue."),s=o,t[o].status=3,t[o].abortReason="set"):(L(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),i=i.concat(Pi(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&r.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));s===-1?SE(e,void 0):t.length=s+1,dn(n.eventQueue_,Eu(e),i);for(let o=0;o<r.length;o++)Aa(r[o])}}function F4(n){let e="",t=n.split("/");for(let r=0;r<t.length;r++)if(t[r].length>0){let i=t[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch{}e+="/"+i}return e}function L4(n){let e={};n.charAt(0)==="?"&&(n=n.substring(1));for(let t of n.split("&")){if(t.length===0)continue;let r=t.split("=");r.length===2?e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):Ot(`Invalid query segment '${t}' in query '${n}'`)}return e}var qv=function(n,e){let t=B4(n),r=t.namespace;t.domain==="firebase.com"&&Sr(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||r==="undefined")&&t.domain!=="localhost"&&Sr("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||fq();let i=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new Jh(t.host,t.secure,r,i,e,"",r!==t.subdomain),path:new Se(t.pathString)}},B4=function(n){let e="",t="",r="",i="",s="",o=!0,a="https",l=443;if(typeof n=="string"){let c=n.indexOf("//");c>=0&&(a=n.substring(0,c-1),n=n.substring(c+2));let u=n.indexOf("/");u===-1&&(u=n.length);let d=n.indexOf("?");d===-1&&(d=n.length),e=n.substring(0,Math.min(u,d)),u<d&&(i=F4(n.substring(u,d)));let h=L4(n.substring(Math.min(n.length,d)));c=e.indexOf(":"),c>=0?(o=a==="https"||a==="wss",l=parseInt(e.substring(c+1),10)):c=e.length;let p=e.slice(0,c);if(p.toLowerCase()==="localhost")t="localhost";else if(p.split(".").length<=2)t=p;else{let E=e.indexOf(".");r=e.substring(0,E).toLowerCase(),t=e.substring(E+1),s=r}"ns"in h&&(s=h.ns)}return{host:e,port:l,domain:t,subdomain:r,secure:o,scheme:a,pathString:i,namespace:s}};var qN="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",V4=function(){let n=0,e=[];return function(t){let r=t===n;n=t;let i,s=new Array(8);for(i=7;i>=0;i--)s[i]=qN.charAt(t%64),t=Math.floor(t/64);L(t===0,"Cannot push at time == 0");let o=s.join("");if(r){for(i=11;i>=0&&e[i]===63;i--)e[i]=0;e[i]++}else for(i=0;i<12;i++)e[i]=Math.floor(Math.random()*64);for(i=0;i<12;i++)o+=qN.charAt(e[i]);return L(o.length===20,"nextPushId: Length should be 20."),o}}();var yf=class{constructor(e,t,r,i){this.eventType=e,this.eventRegistration=t,this.snapshot=r,this.prevName=i}getPath(){let e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+lt(this.snapshot.exportVal())}},_f=class{constructor(e,t,r){this.eventRegistration=e,this.error=t,this.path=r}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}};var pu=class{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return L(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}};var vf=class{constructor(e,t){this._repo=e,this._path=t}cancel(){let e=new Et;return R4(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){un("OnDisconnect.remove",this._path);let e=new Et;return UN(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){un("OnDisconnect.set",this._path),wr("OnDisconnect.set",e,this._path,!1);let t=new Et;return UN(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){un("OnDisconnect.setWithPriority",this._path),wr("OnDisconnect.setWithPriority",e,this._path,!1),CE("OnDisconnect.setWithPriority",t,!1);let r=new Et;return D4(this._repo,this._path,e,t,r.wrapCallback(()=>{})),r.promise}update(e){un("OnDisconnect.update",this._path),Vk("OnDisconnect.update",e,this._path,!1);let t=new Et;return N4(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}};var $t=class n{constructor(e,t,r,i){this._repo=e,this._path=t,this._queryParams=r,this._orderByCalled=i}get key(){return ae(this._path)?null:iE(this._path)}get ref(){return new hn(this._repo,this._path)}get _queryIdentifier(){let e=AN(this._queryParams),t=eE(e);return t==="{}"?"default":t}get _queryObject(){return AN(this._queryParams)}isEqual(e){if(e=ue(e),!(e instanceof n))return!1;let t=this._repo===e._repo,r=sE(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return t&&r&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+$q(this._path)}};function Lf(n,e){if(n._orderByCalled===!0)throw new Error(e+": You can't combine multiple orderBy calls.")}function qi(n){let e=null,t=null;if(n.hasStart()&&(e=n.getIndexStartValue()),n.hasEnd()&&(t=n.getIndexEndValue()),n.getIndex()===Er){let r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(n.hasStart()){if(n.getIndexStartName()!==Li)throw new Error(r);if(typeof e!="string")throw new Error(i)}if(n.hasEnd()){if(n.getIndexEndName()!==ti)throw new Error(r);if(typeof t!="string")throw new Error(i)}}else if(n.getIndex()===ke){if(e!=null&&!fu(e)||t!=null&&!fu(t))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(L(n.getIndex()instanceof iu||n.getIndex()===lE,"unknown index type."),e!=null&&typeof e=="object"||t!=null&&typeof t=="object")throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function Bf(n){if(n.hasStart()&&n.hasEnd()&&n.hasLimit()&&!n.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}var hn=class n extends $t{constructor(e,t){super(e,t,new lu,!1)}get parent(){let e=dk(this._path);return e===null?null:new n(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}},Ia=class n{constructor(e,t,r){this._node=e,this.ref=t,this._index=r}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){let t=new Se(e),r=ni(this.ref,e);return new n(this._node.getChild(t),r,ke)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(r,i)=>e(new n(i,ni(this.ref,r),ke)))}hasChild(e){let t=new Se(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}};function Vf(n,e){return n=ue(n),n._checkNotDeleted("ref"),e!==void 0?ni(n._root,e):n._root}function Uf(n,e){n=ue(n),n._checkNotDeleted("refFromURL");let t=qv(e,n._repo.repoInfo_.nodeAdmin);Uk("refFromURL",t);let r=t.repoInfo;return!n._repo.repoInfo_.isCustomHost()&&r.host!==n._repo.repoInfo_.host&&Sr("refFromURL: Host name does not match the current database: (found "+r.host+" but expected "+n._repo.repoInfo_.host+")"),Vf(n,t.path.toString())}function ni(n,e){return n=ue(n),oe(n._path)===null?E4("child","path",e,!1):Na("child","path",e,!1),new hn(n._repo,qe(n._path,e))}function AE(n,e){n=ue(n),un("push",n._path),wr("push",e,n._path,!0);let t=Wk(n._repo),r=V4(t),i=ni(n,r),s=ni(n,r),o;return e!=null?o=Tu(s,e).then(()=>s):o=Promise.resolve(s),i.then=o.then.bind(o),i.catch=o.then.bind(o,void 0),i}function RE(n){return un("remove",n._path),Tu(n,null)}function Tu(n,e){n=ue(n),un("set",n._path),wr("set",e,n._path,!1);let t=new Et;return TE(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}function DE(n,e){n=ue(n),un("setPriority",n._path),CE("setPriority",e,!1);let t=new Et;return TE(n._repo,qe(n._path,".priority"),e,null,t.wrapCallback(()=>{})),t.promise}function NE(n,e,t){if(un("setWithPriority",n._path),wr("setWithPriority",e,n._path,!1),CE("setWithPriority",t,!1),n.key===".length"||n.key===".keys")throw"setWithPriority failed: "+n.key+" is a read-only object.";let r=new Et;return TE(n._repo,n._path,e,t,r.wrapCallback(()=>{})),r.promise}function kE(n,e){Vk("update",e,n._path,!1);let t=new Et;return I4(n._repo,n._path,e,t.wrapCallback(()=>{})),t.promise}function OE(n){n=ue(n);let e=new pu(()=>{}),t=new mu(e);return b4(n._repo,n,t).then(r=>new Ia(r,new hn(n._repo,n._path),n._queryParams.getIndex()))}var mu=class n{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){let r=t._queryParams.getIndex();return new yf("value",this,new Ia(e.snapshotNode,new hn(t._repo,t._path),r))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new _f(this,e,t):null}matches(e){return e instanceof n?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}},Ef=class n{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t=e==="children_added"?"child_added":e;return t=t==="children_removed"?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new _f(this,e,t):null}createEvent(e,t){L(e.childName!=null,"Child events should have a childName.");let r=ni(new hn(t._repo,t._path),e.childName),i=t._queryParams.getIndex();return new yf(e.type,this,new Ia(e.snapshotNode,r,i),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof n?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}};function bu(n,e,t,r,i){let s;if(typeof r=="object"&&(s=void 0,i=r),typeof r=="function"&&(s=r),i&&i.onlyOnce){let l=t,c=(u,d)=>{Uv(n._repo,n,a),l(u,d)};c.userCallback=t.userCallback,c.context=t.context,t=c}let o=new pu(t,s||void 0),a=e==="value"?new mu(o):new Ef(e,o);return k4(n._repo,n,a),()=>Uv(n._repo,n,a)}function Iu(n,e,t,r){return bu(n,"value",e,t,r)}function qf(n,e,t,r){return bu(n,"child_added",e,t,r)}function zf(n,e,t,r){return bu(n,"child_changed",e,t,r)}function Gf(n,e,t,r){return bu(n,"child_moved",e,t,r)}function Wf(n,e,t,r){return bu(n,"child_removed",e,t,r)}function jf(n,e,t){let r=null,i=t?new pu(t):null;e==="value"?r=new mu(i):e&&(r=new Ef(e,i)),Uv(n._repo,n,r)}var fn=class{},Sf=class extends fn{constructor(e,t){super(),this._value=e,this._key=t,this.type="endAt"}_apply(e){wr("endAt",this._value,e._path,!0);let t=yv(e._queryParams,this._value,this._key);if(Bf(t),qi(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new $t(e._repo,e._path,t,e._orderByCalled)}};function xE(n,e){return Cu("endAt","key",e,!0),new Sf(n,e)}var zv=class extends fn{constructor(e,t){super(),this._value=e,this._key=t,this.type="endBefore"}_apply(e){wr("endBefore",this._value,e._path,!1);let t=d3(e._queryParams,this._value,this._key);if(Bf(t),qi(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new $t(e._repo,e._path,t,e._orderByCalled)}};function PE(n,e){return Cu("endBefore","key",e,!0),new zv(n,e)}var Cf=class extends fn{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAt"}_apply(e){wr("startAt",this._value,e._path,!0);let t=gv(e._queryParams,this._value,this._key);if(Bf(t),qi(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new $t(e._repo,e._path,t,e._orderByCalled)}};function ME(n=null,e){return Cu("startAt","key",e,!0),new Cf(n,e)}var Gv=class extends fn{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAfter"}_apply(e){wr("startAfter",this._value,e._path,!1);let t=u3(e._queryParams,this._value,this._key);if(Bf(t),qi(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new $t(e._repo,e._path,t,e._orderByCalled)}};function FE(n,e){return Cu("startAfter","key",e,!0),new Gv(n,e)}var Wv=class extends fn{constructor(e){super(),this._limit=e,this.type="limitToFirst"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new $t(e._repo,e._path,l3(e._queryParams,this._limit),e._orderByCalled)}};function LE(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new Wv(n)}var jv=class extends fn{constructor(e){super(),this._limit=e,this.type="limitToLast"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new $t(e._repo,e._path,c3(e._queryParams,this._limit),e._orderByCalled)}};function BE(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new jv(n)}var $v=class extends fn{constructor(e){super(),this._path=e,this.type="orderByChild"}_apply(e){Lf(e,"orderByChild");let t=new Se(this._path);if(ae(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");let r=new iu(t),i=Tf(e._queryParams,r);return qi(i),new $t(e._repo,e._path,i,!0)}};function VE(n){if(n==="$key")throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if(n==="$priority")throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if(n==="$value")throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return Na("orderByChild","path",n,!1),new $v(n)}var Hv=class extends fn{constructor(){super(...arguments),this.type="orderByKey"}_apply(e){Lf(e,"orderByKey");let t=Tf(e._queryParams,Er);return qi(t),new $t(e._repo,e._path,t,!0)}};function UE(){return new Hv}var Kv=class extends fn{constructor(){super(...arguments),this.type="orderByPriority"}_apply(e){Lf(e,"orderByPriority");let t=Tf(e._queryParams,ke);return qi(t),new $t(e._repo,e._path,t,!0)}};function qE(){return new Kv}var Qv=class extends fn{constructor(){super(...arguments),this.type="orderByValue"}_apply(e){Lf(e,"orderByValue");let t=Tf(e._queryParams,lE);return qi(t),new $t(e._repo,e._path,t,!0)}};function zE(){return new Qv}var Yv=class extends fn{constructor(e,t){super(),this._value=e,this._key=t,this.type="equalTo"}_apply(e){if(wr("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new Sf(this._value,this._key)._apply(new Cf(this._value,this._key)._apply(e))}};function GE(n,e){return Cu("equalTo","key",e,!0),new Yv(n,e)}function pn(n,...e){let t=ue(n);for(let r of e)t=r._apply(t);return t}$3(hn);X3(hn);var U4="FIREBASE_DATABASE_EMULATOR_HOST",Xv={},q4=!1;function z4(n,e,t,r){n.repoInfo_=new Jh(`${e}:${t}`,!1,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0),r&&(n.authTokenProvider_=r)}function WE(n,e,t,r,i){let s=r||n.options.databaseURL;s===void 0&&(n.options.projectId||Sr("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Ct("Using default host for project ",n.options.projectId),s=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=qv(s,i),a=o.repoInfo,l,c;typeof process<"u"&&process.env&&(c=process.env[U4]),c?(l=!0,s=`http://${c}?ns=${a.namespace}`,o=qv(s,i),a=o.repoInfo):l=!o.repoInfo.secure;let u=i&&l?new Xc(Xc.OWNER):new rv(n.name,n.options,e);Uk("Invalid Firebase Database URL",o),ae(o.path)||Sr("Database URL must point to the root of a Firebase Database (not including a child path).");let d=W4(a,n,u,new nv(n.name,t));return new Jv(d,n)}function G4(n,e){let t=Xv[e];(!t||t[n.key]!==n)&&Sr(`Database ${e}(${n.repoInfo_}) has already been deleted.`),jk(n),delete t[n.key]}function W4(n,e,t,r){let i=Xv[e.name];i||(i={},Xv[e.name]=i);let s=i[n.toURLString()];return s&&Sr("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),s=new Vv(n,q4,t,r),i[n.toURLString()]=s,s}var Jv=class{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(w4(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new hn(this._repo,Ee())),this._rootInternal}_delete(){return this._rootInternal!==null&&(G4(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&Sr("Cannot call "+e+" on a deleted database.")}};function Qk(){uk.IS_TRANSPORT_INITIALIZED&&Ot("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function jE(){Qk(),nu.forceDisallow()}function $E(){Qk(),ga.forceDisallow(),nu.forceAllow()}function Yk(n=Ws(),e){let t=Ic(n,"database").getImmediate({identifier:e});if(!t._instanceStarted){let r=Ch("database");r&&$f(t,...r)}return t}function $f(n,e,t,r={}){n=ue(n),n._checkNotDeleted("useEmulator"),n._instanceStarted&&Sr("Cannot call useEmulator() after instance has already been initialized.");let i=n._repoInternal,s;if(i.repoInfo_.nodeAdmin)r.mockUserToken&&Sr('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),s=new Xc(Xc.OWNER);else if(r.mockUserToken){let o=typeof r.mockUserToken=="string"?r.mockUserToken:wh(r.mockUserToken,n.app.options.projectId);s=new Xc(o)}z4(i,e,t,s)}function HE(n){n=ue(n),n._checkNotDeleted("goOffline"),jk(n._repo)}function KE(n){n=ue(n),n._checkNotDeleted("goOnline"),O4(n._repo)}function QE(n,e){tk(n,e)}function j4(n){rE(Rh),Gs(new ln("database",(e,{instanceIdentifier:t})=>{let r=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),s=e.getProvider("app-check-internal");return WE(r,i,s,t)},"PUBLIC").setMultipleInstances(!0)),et(hN,fN,n),et(hN,fN,"esm2017")}var $4={".sv":"timestamp"};function YE(){return $4}function XE(n){return{".sv":{increment:n}}}var Zv=class{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}};function JE(n,e,t){var r;if(n=ue(n),un("Reference.transaction",n._path),n.key===".length"||n.key===".keys")throw"Reference.transaction failed: "+n.key+" is a read-only object.";let i=(r=t?.applyLocally)!==null&&r!==void 0?r:!0,s=new Et,o=(l,c,u)=>{let d=null;l?s.reject(l):(d=new Ia(u,new hn(n._repo,n._path),ke),s.resolve(new Zv(c,d)))},a=Iu(n,()=>{});return x4(n._repo,n._path,e,o,a,i),s.promise}oE.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};oE.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};Aq(zN.default.Client);j4("node");var H4="@firebase/database-compat",K4="1.0.8";var Q4=new Ai("@firebase/database-compat"),Xk=function(n){let e="FIREBASE WARNING: "+n;Q4.warn(e)};var Y4=function(n,e,t,r){if(!(r&&t===void 0)&&typeof t!="boolean")throw new Error(Zt(n,e)+"must be a boolean.")},X4=function(n,e,t){if(!(t&&e===void 0))switch(e){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(Zt(n,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}};var ZE=class{constructor(e){this._delegate=e}cancel(e){ee("OnDisconnect.cancel",0,1,arguments.length),mt("OnDisconnect.cancel","onComplete",e,!0);let t=this._delegate.cancel();return e&&t.then(()=>e(null),r=>e(r)),t}remove(e){ee("OnDisconnect.remove",0,1,arguments.length),mt("OnDisconnect.remove","onComplete",e,!0);let t=this._delegate.remove();return e&&t.then(()=>e(null),r=>e(r)),t}set(e,t){ee("OnDisconnect.set",1,2,arguments.length),mt("OnDisconnect.set","onComplete",t,!0);let r=this._delegate.set(e);return t&&r.then(()=>t(null),i=>t(i)),r}setWithPriority(e,t,r){ee("OnDisconnect.setWithPriority",2,3,arguments.length),mt("OnDisconnect.setWithPriority","onComplete",r,!0);let i=this._delegate.setWithPriority(e,t);return r&&i.then(()=>r(null),s=>r(s)),i}update(e,t){if(ee("OnDisconnect.update",1,2,arguments.length),Array.isArray(e)){let i={};for(let s=0;s<e.length;++s)i[""+s]=e[s];e=i,Xk("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}mt("OnDisconnect.update","onComplete",t,!0);let r=this._delegate.update(e);return t&&r.then(()=>t(null),i=>t(i)),r}};var eS=class{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return ee("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}};var co=class n{constructor(e,t){this._database=e,this._delegate=t}val(){return ee("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return ee("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return ee("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return ee("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(e){return ee("DataSnapshot.child",0,1,arguments.length),e=String(e),Na("DataSnapshot.child","path",e,!1),new n(this._database,this._delegate.child(e))}hasChild(e){return ee("DataSnapshot.hasChild",1,1,arguments.length),Na("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)}getPriority(){return ee("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(e){return ee("DataSnapshot.forEach",1,1,arguments.length),mt("DataSnapshot.forEach","action",e,!1),this._delegate.forEach(t=>e(new n(this._database,t)))}hasChildren(){return ee("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return ee("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return ee("DataSnapshot.ref",0,0,arguments.length),new ri(this._database,this._delegate.ref)}get ref(){return this.getRef()}},Hf=class n{constructor(e,t){this.database=e,this._delegate=t}on(e,t,r,i){var s;ee("Query.on",2,4,arguments.length),mt("Query.on","callback",t,!1);let o=n.getCancelAndContextArgs_("Query.on",r,i),a=(c,u)=>{t.call(o.context,new co(this.database,c),u)};a.userCallback=t,a.context=o.context;let l=(s=o.cancel)===null||s===void 0?void 0:s.bind(o.context);switch(e){case"value":return Iu(this._delegate,a,l),t;case"child_added":return qf(this._delegate,a,l),t;case"child_removed":return Wf(this._delegate,a,l),t;case"child_changed":return zf(this._delegate,a,l),t;case"child_moved":return Gf(this._delegate,a,l),t;default:throw new Error(Zt("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(e,t,r){if(ee("Query.off",0,3,arguments.length),X4("Query.off",e,!0),mt("Query.off","callback",t,!0),Yy("Query.off","context",r,!0),t){let i=()=>{};i.userCallback=t,i.context=r,jf(this._delegate,e,i)}else jf(this._delegate,e)}get(){return OE(this._delegate).then(e=>new co(this.database,e))}once(e,t,r,i){ee("Query.once",1,4,arguments.length),mt("Query.once","callback",t,!0);let s=n.getCancelAndContextArgs_("Query.once",r,i),o=new Et,a=(c,u)=>{let d=new co(this.database,c);t&&t.call(s.context,d,u),o.resolve(d)};a.userCallback=t,a.context=s.context;let l=c=>{s.cancel&&s.cancel.call(s.context,c),o.reject(c)};switch(e){case"value":Iu(this._delegate,a,l,{onlyOnce:!0});break;case"child_added":qf(this._delegate,a,l,{onlyOnce:!0});break;case"child_removed":Wf(this._delegate,a,l,{onlyOnce:!0});break;case"child_changed":zf(this._delegate,a,l,{onlyOnce:!0});break;case"child_moved":Gf(this._delegate,a,l,{onlyOnce:!0});break;default:throw new Error(Zt("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return o.promise}limitToFirst(e){return ee("Query.limitToFirst",1,1,arguments.length),new n(this.database,pn(this._delegate,LE(e)))}limitToLast(e){return ee("Query.limitToLast",1,1,arguments.length),new n(this.database,pn(this._delegate,BE(e)))}orderByChild(e){return ee("Query.orderByChild",1,1,arguments.length),new n(this.database,pn(this._delegate,VE(e)))}orderByKey(){return ee("Query.orderByKey",0,0,arguments.length),new n(this.database,pn(this._delegate,UE()))}orderByPriority(){return ee("Query.orderByPriority",0,0,arguments.length),new n(this.database,pn(this._delegate,qE()))}orderByValue(){return ee("Query.orderByValue",0,0,arguments.length),new n(this.database,pn(this._delegate,zE()))}startAt(e=null,t){return ee("Query.startAt",0,2,arguments.length),new n(this.database,pn(this._delegate,ME(e,t)))}startAfter(e=null,t){return ee("Query.startAfter",0,2,arguments.length),new n(this.database,pn(this._delegate,FE(e,t)))}endAt(e=null,t){return ee("Query.endAt",0,2,arguments.length),new n(this.database,pn(this._delegate,xE(e,t)))}endBefore(e=null,t){return ee("Query.endBefore",0,2,arguments.length),new n(this.database,pn(this._delegate,PE(e,t)))}equalTo(e,t){return ee("Query.equalTo",1,2,arguments.length),new n(this.database,pn(this._delegate,GE(e,t)))}toString(){return ee("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return ee("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(e){if(ee("Query.isEqual",1,1,arguments.length),!(e instanceof n)){let t="Query.isEqual failed: First argument must be an instance of firebase.database.Query.";throw new Error(t)}return this._delegate.isEqual(e._delegate)}static getCancelAndContextArgs_(e,t,r){let i={cancel:void 0,context:void 0};if(t&&r)i.cancel=t,mt(e,"cancel",i.cancel,!0),i.context=r,Yy(e,"context",i.context,!0);else if(t)if(typeof t=="object"&&t!==null)i.context=t;else if(typeof t=="function")i.cancel=t;else throw new Error(Zt(e,"cancelOrContext")+" must either be a cancel callback or a context object.");return i}get ref(){return new ri(this.database,new hn(this._delegate._repo,this._delegate._path))}},ri=class n extends Hf{constructor(e,t){super(e,new $t(t._repo,t._path,new lu,!1)),this.database=e,this._delegate=t}getKey(){return ee("Reference.key",0,0,arguments.length),this._delegate.key}child(e){return ee("Reference.child",1,1,arguments.length),typeof e=="number"&&(e=String(e)),new n(this.database,ni(this._delegate,e))}getParent(){ee("Reference.parent",0,0,arguments.length);let e=this._delegate.parent;return e?new n(this.database,e):null}getRoot(){return ee("Reference.root",0,0,arguments.length),new n(this.database,this._delegate.root)}set(e,t){ee("Reference.set",1,2,arguments.length),mt("Reference.set","onComplete",t,!0);let r=Tu(this._delegate,e);return t&&r.then(()=>t(null),i=>t(i)),r}update(e,t){if(ee("Reference.update",1,2,arguments.length),Array.isArray(e)){let i={};for(let s=0;s<e.length;++s)i[""+s]=e[s];e=i,Xk("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}un("Reference.update",this._delegate._path),mt("Reference.update","onComplete",t,!0);let r=kE(this._delegate,e);return t&&r.then(()=>t(null),i=>t(i)),r}setWithPriority(e,t,r){ee("Reference.setWithPriority",2,3,arguments.length),mt("Reference.setWithPriority","onComplete",r,!0);let i=NE(this._delegate,e,t);return r&&i.then(()=>r(null),s=>r(s)),i}remove(e){ee("Reference.remove",0,1,arguments.length),mt("Reference.remove","onComplete",e,!0);let t=RE(this._delegate);return e&&t.then(()=>e(null),r=>e(r)),t}transaction(e,t,r){ee("Reference.transaction",1,3,arguments.length),mt("Reference.transaction","transactionUpdate",e,!1),mt("Reference.transaction","onComplete",t,!0),Y4("Reference.transaction","applyLocally",r,!0);let i=JE(this._delegate,e,{applyLocally:r}).then(s=>new eS(s.committed,new co(this.database,s.snapshot)));return t&&i.then(s=>t(null,s.committed,s.snapshot),s=>t(s,!1,null)),i}setPriority(e,t){ee("Reference.setPriority",1,2,arguments.length),mt("Reference.setPriority","onComplete",t,!0);let r=DE(this._delegate,e);return t&&r.then(()=>t(null),i=>t(i)),r}push(e,t){ee("Reference.push",0,2,arguments.length),mt("Reference.push","onComplete",t,!0);let r=AE(this._delegate,e),i=r.then(o=>new n(this.database,o));t&&i.then(()=>t(null),o=>t(o));let s=new n(this.database,r);return s.then=i.then.bind(i),s.catch=i.catch.bind(i,void 0),s}onDisconnect(){return un("Reference.onDisconnect",this._delegate._path),new ZE(new vf(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}};var uo=class{constructor(e,t){this._delegate=e,this.app=t,this.INTERNAL={delete:()=>this._delegate._delete(),forceWebSockets:jE,forceLongPolling:$E}}useEmulator(e,t,r={}){$f(this._delegate,e,t,r)}ref(e){if(ee("database.ref",0,1,arguments.length),e instanceof ri){let t=Uf(this._delegate,e.toString());return new ri(this,t)}else{let t=Vf(this._delegate,e);return new ri(this,t)}}refFromURL(e){ee("database.refFromURL",1,1,arguments.length);let r=Uf(this._delegate,e);return new ri(this,r)}goOffline(){return ee("database.goOffline",0,0,arguments.length),HE(this._delegate)}goOnline(){return ee("database.goOnline",0,0,arguments.length),KE(this._delegate)}};uo.ServerValue={TIMESTAMP:YE(),increment:n=>XE(n)};function J4({app:n,url:e,version:t,customAuthImpl:r,customAppCheckImpl:i,namespace:s,nodeAdmin:o=!1}){rE(t);let a=new Xy("database-standalone"),l=new Ah("auth-internal",a);l.setComponent(new ln("auth-internal",()=>r,"PRIVATE"));let c;return i&&(c=new Ah("app-check-internal",a),c.setComponent(new ln("app-check-internal",()=>i,"PRIVATE"))),{instance:new uo(WE(n,l,c,e,o),n),namespace:s}}var Z4=Object.freeze({__proto__:null,initStandalone:J4});var ez=uo.ServerValue;function tz(n){n.INTERNAL.registerComponent(new ln("database-compat",(e,{instanceIdentifier:t})=>{let r=e.getProvider("app-compat").getImmediate(),i=e.getProvider("database").getImmediate({identifier:t});return new uo(i,r)},"PUBLIC").setServiceProps({Reference:ri,Query:Hf,Database:uo,DataSnapshot:co,enableLogging:QE,INTERNAL:Z4,ServerValue:ez}).setMultipleInstances(!0)),n.registerVersion(H4,K4,"node")}tz(gt);function Au(n,e,t="on",r=ra){return new ur(i=>{let s=null;return s=n[t](e,(o,a)=>{r.schedule(()=>{i.next({snapshot:o,prevKey:a})}),t==="once"&&r.schedule(()=>i.complete())},o=>{r.schedule(()=>i.error(o))}),t==="on"?{unsubscribe(){s!=null&&n.off(e,s)}}:{unsubscribe(){}}}).pipe(Be(i=>{let{snapshot:s,prevKey:o}=i,a=null;return s.exists()&&(a=s.key),{type:e,payload:s,prevKey:o,key:a}}),xA())}function nz(n){return typeof n=="string"}function rz(n){return typeof n.exportVal=="function"}function nO(n){return n==null}function rO(n){return typeof n.set=="function"}function Jk(n,e){return rO(e)?e:n.ref(e)}function iO(n,e){if(nz(n))return e.stringCase();if(rO(n))return e.firebaseCase();if(rz(n))return e.snapshotCase();throw new Error(`Expects a string, snapshot, or reference. Got: ${typeof n}`)}function sO(n){return(nO(n)||n.length===0)&&(n=["child_added","child_removed","child_changed","child_moved"]),n}function oO(n,e,t){e=sO(e);let r=e.map(i=>Au(n,i,"on",t));return gc(...r)}function iz(n,e,t){let r=oO(n,e).pipe(qs((i,s)=>[...i,s],[]));return oz(n,r,t)}function sz(n,e){return Au(n,"value","on",e).pipe(Be(t=>{let r;return t.payload.forEach(i=>(r=i.key,!1)),{data:t,lastKeyToLoad:r}}))}function oz(n,e,t){return sz(n,t).pipe(FA(e),Be(([i,s])=>{let o=i.lastKeyToLoad,a=s.map(l=>l.key);return{actions:s,lastKeyToLoad:o,loadedKeys:a}}),PA(i=>i.loadedKeys.indexOf(i.lastKeyToLoad)===-1),Be(i=>i.actions))}function Zk(n,e){return function(r,i){return iO(r,{stringCase:()=>n.child(r)[e](i),firebaseCase:()=>r[e](i),snapshotCase:()=>r.ref[e](i)})}}function az(n){return function(t){return t?iO(t,{stringCase:()=>n.child(t).remove(),firebaseCase:()=>t.remove(),snapshotCase:()=>t.ref.remove()}):n.remove()}}function lz(n,e,t){return Au(n,"value","once",t).pipe(Yr(r=>{let i=[hr(r)];return e.forEach(s=>i.push(Au(n,s,"on",t))),gc(...i).pipe(qs(uz,[]))}),dh())}function aO(n,e){let t=n.length;for(let r=0;r<t;r++)if(n[r].payload.key===e)return r;return-1}function cz(n,e){if(nO(e))return 0;{let t=aO(n,e);return t===-1?n.length:t+1}}function uz(n,e){let{payload:t,prevKey:r,key:i}=e,s=aO(n,i),o=cz(n,r);switch(e.type){case"value":if(e.payload?.exists()){let a=null;e.payload.forEach(l=>{let c={payload:l,type:"value",prevKey:a,key:l.key};return a=l.key,n=[...n,c],!1})}return n;case"child_added":if(s>-1)(n[s-1]?.key||null)!==r&&(n=n.filter(l=>l.payload.key!==t.key),n.splice(o,0,e));else{if(r==null)return[e,...n];n=n.slice(),n.splice(o,0,e)}return n;case"child_removed":return n.filter(a=>a.payload.key!==t.key);case"child_changed":return n.map(a=>a.payload.key===i?e:a);case"child_moved":if(s>-1){let a=n.splice(s,1)[0];return n=n.slice(),n.splice(o,0,a),n}return n;default:return n}}function eO(n,e,t){return e=sO(e),lz(n,e,t)}function dz(n,e){let t=e.schedulers.outsideAngular,r=e.schedulers.ngZone.run(()=>n.ref);return{query:n,update:Zk(r,"update"),set:Zk(r,"set"),push:i=>r.push(i),remove:az(r),snapshotChanges(i){return eO(n,i,t).pipe(Ye)},stateChanges(i){return oO(n,i,t).pipe(Ye)},auditTrail(i){return iz(n,i,t).pipe(Ye)},valueChanges(i,s){return eO(n,i,t).pipe(Be(a=>a.map(l=>s&&s.idField?Sn(Ut({},l.payload.val()),{[s.idField]:l.key}):l.payload.val())),Ye)}}}function tO(n,e){return function(){return Au(n,"value","on",e)}}function hz(n,e){return{query:n,snapshotChanges(){return tO(n,e.schedulers.outsideAngular)().pipe(Ye)},update(t){return n.ref.update(t)},set(t){return n.ref.set(t)},remove(){return n.ref.remove()},valueChanges(){return tO(n,e.schedulers.outsideAngular)().pipe(Ye,Be(r=>r.payload.exists()?r.payload.val():null))}}}var fz=new ge("angularfire2.realtimeDatabaseURL"),pz=new ge("angularfire2.database.use-emulator"),tS=(()=>{class n{schedulers;database;constructor(t,r,i,s,o,a,l,c,u,d,h,p,E,w,b){this.schedulers=a;let N=l,D=Hs(t,o,r);c&&Pc(D,o,u,h,p,E,d,w),this.database=ua(`${D.name}.database.${i}`,"AngularFireDatabase",D.name,()=>{let O=o.runOutsideAngular(()=>D.database(i||void 0));return N&&O.useEmulator(...N),O},[N])}list(t,r){let i=this.schedulers.ngZone.runOutsideAngular(()=>Jk(this.database,t)),s=i;return r&&(s=r(i)),dz(s,this)}object(t){let r=this.schedulers.ngZone.runOutsideAngular(()=>Jk(this.database,t));return hz(r,this)}createPushId(){return this.schedulers.ngZone.runOutsideAngular(()=>this.database.ref()).push().key}static \u0275fac=function(r){return new(r||n)(Z(Ni),Z(ki,8),Z(fz,8),Z(pr),Z(vt),Z(en),Z(pz,8),Z(Mc,8),Z(Rc,8),Z(Dc,8),Z(Nc,8),Z(kc,8),Z(Oc,8),Z(xc,8),Z(qt,8))};static \u0275prov=Cn({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),lO=(()=>{class n{constructor(){gt.registerVersion("angularfire",St.full,"rtdb-compat")}static \u0275fac=function(r){return new(r||n)};static \u0275mod=Gn({type:n});static \u0275inj=zn({providers:[tS]})}return n})();var Kf=(()=>{class n{constructor(t){this.db=t,this.dbPath="/employees",this.employeesRef=t.list(this.dbPath)}getAllEmployees(){return this.employeesRef}getEmployee(t){return this.db.object(`${this.dbPath}/${t}`)}addEmployee(t){this.employeesRef.push(t)}updateEmployee(t,r){this.employeesRef.update(t,r)}deleteEmployee(t){return this.employeesRef.remove(t)}static{this.\u0275fac=function(r){return new(r||n)(Z(tS))}}static{this.\u0275prov=Cn({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function gz(n,e){if(n&1){let t=GA();ve(0,"div",4)(1,"div",5)(2,"h2",6),Te(3),he(),ve(4,"h5",7),Te(5),he(),ve(6,"p",8),Te(7),he(),ve(8,"p",8),Te(9),he(),ve(10,"div",9)(11,"button",10),bi("click",function(){let i=By(t).$implicit,s=Gy();return Vy(s.editEmployee(i.key))}),Te(12," Edit "),he(),ve(13,"button",11),bi("click",function(){let i=By(t).$implicit,s=Gy();return Vy(s.removeEmployee(i.key))}),Te(14," Remove "),he()()()()}if(n&2){let t=e.$implicit;wn(3),Cc("Name: ",t.name,""),wn(2),Cc("Position: ",t.position,""),wn(2),Cc("Department: ",t.department,""),wn(2),Cc("Salary: ",t.salary,"")}}var uO=(()=>{class n{constructor(t,r){this.employeeService=t,this.router=r,this.employees=[],this.totalEmployees=0}ngOnInit(){this.getAllEmployees()}getAllEmployees(){this.employeeService.getAllEmployees().snapshotChanges().subscribe({next:t=>{this.employees=[],t.forEach(r=>{let i=r.payload.toJSON();this.totalEmployees+=parseInt(i.salary),this.employees.push({key:r.key||"",name:i.name,position:i.position,department:i.department,salary:i.salary})})}})}editEmployee(t){this.router.navigate(["/add-edit-employee/"+t])}removeEmployee(t){window.confirm("Are You Sure ??")&&this.employeeService.deleteEmployee(t)}static{this.\u0275fac=function(r){return new(r||n)(Ve(Kf),Ve(Eh))}}static{this.\u0275cmp=fr({type:n,selectors:[["app-employee-list"]],standalone:!0,features:[mr],decls:9,vars:0,consts:[[1,"mb-4","d-flex","justify-content-between","align-items-center"],["type","button","routerLink","",1,"btn","btn-danger"],["type","button","routerLink","/add-edit-employee",1,"btn","btn-primary"],[1,"d-flex","flex-column","gap-3"],[1,"card"],[1,"card-body"],[1,"fw-bold","text-success"],[1,"card-title"],[1,"card-text"],[1,"d-flex","gap-2"],[1,"btn","btn-sm","btn-success",3,"click"],[1,"btn","btn-sm","btn-danger",3,"click"]],template:function(r,i){r&1&&(ve(0,"div",0)(1,"button",1),Te(2,"Go Back"),he(),ve(3,"button",2),Te(4," Add Employee "),he()(),ve(5,"div",3),qA(6,gz,15,4,"div",4,UA),he(),Zr(8,"router-outlet")),r&2&&(wn(6),zA(i.employees))},dependencies:[ia,oa,vh,sa]})}}return n})();var vO=(()=>{class n{constructor(t,r){this._renderer=t,this._elementRef=r,this.onChange=i=>{},this.onTouched=()=>{}}setProperty(t,r){this._renderer.setProperty(this._elementRef.nativeElement,t,r)}registerOnTouched(t){this.onTouched=t}registerOnChange(t){this.onChange=t}setDisabledState(t){this.setProperty("disabled",t)}static{this.\u0275fac=function(r){return new(r||n)(Ve(qy),Ve(Uy))}}static{this.\u0275dir=Xr({type:n})}}return n})(),yz=(()=>{class n extends vO{static{this.\u0275fac=(()=>{let t;return function(i){return(t||(t=BA(n)))(i||n)}})()}static{this.\u0275dir=Xr({type:n,features:[zs]})}}return n})(),EO=new ge("");var _z={provide:EO,useExisting:mh(()=>np),multi:!0};function vz(){let n=$y()?$y().getUserAgent():"";return/android (\d+)/.test(n.toLowerCase())}var Ez=new ge(""),np=(()=>{class n extends vO{constructor(t,r,i){super(t,r),this._compositionMode=i,this._composing=!1,this._compositionMode==null&&(this._compositionMode=!vz())}writeValue(t){let r=t??"";this.setProperty("value",r)}_handleInput(t){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(t)}_compositionStart(){this._composing=!0}_compositionEnd(t){this._composing=!1,this._compositionMode&&this.onChange(t)}static{this.\u0275fac=function(r){return new(r||n)(Ve(qy),Ve(Uy),Ve(Ez,8))}}static{this.\u0275dir=Xr({type:n,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(r,i){r&1&&bi("input",function(o){return i._handleInput(o.target.value)})("blur",function(){return i.onTouched()})("compositionstart",function(){return i._compositionStart()})("compositionend",function(o){return i._compositionEnd(o.target.value)})},features:[gh([_z]),zs]})}}return n})();function zi(n){return n==null||(typeof n=="string"||Array.isArray(n))&&n.length===0}function SO(n){return n!=null&&typeof n.length=="number"}var CO=new ge(""),wO=new ge(""),Sz=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,ho=class{static min(e){return Cz(e)}static max(e){return wz(e)}static required(e){return Tz(e)}static requiredTrue(e){return bz(e)}static email(e){return Iz(e)}static minLength(e){return Az(e)}static maxLength(e){return Rz(e)}static pattern(e){return Dz(e)}static nullValidator(e){return TO(e)}static compose(e){return NO(e)}static composeAsync(e){return OO(e)}};function Cz(n){return e=>{if(zi(e.value)||zi(n))return null;let t=parseFloat(e.value);return!isNaN(t)&&t<n?{min:{min:n,actual:e.value}}:null}}function wz(n){return e=>{if(zi(e.value)||zi(n))return null;let t=parseFloat(e.value);return!isNaN(t)&&t>n?{max:{max:n,actual:e.value}}:null}}function Tz(n){return zi(n.value)?{required:!0}:null}function bz(n){return n.value===!0?null:{required:!0}}function Iz(n){return zi(n.value)||Sz.test(n.value)?null:{email:!0}}function Az(n){return e=>zi(e.value)||!SO(e.value)?null:e.value.length<n?{minlength:{requiredLength:n,actualLength:e.value.length}}:null}function Rz(n){return e=>SO(e.value)&&e.value.length>n?{maxlength:{requiredLength:n,actualLength:e.value.length}}:null}function Dz(n){if(!n)return TO;let e,t;return typeof n=="string"?(t="",n.charAt(0)!=="^"&&(t+="^"),t+=n,n.charAt(n.length-1)!=="$"&&(t+="$"),e=new RegExp(t)):(t=n.toString(),e=n),r=>{if(zi(r.value))return null;let i=r.value;return e.test(i)?null:{pattern:{requiredPattern:t,actualValue:i}}}}function TO(n){return null}function bO(n){return n!=null}function IO(n){return WA(n)?dr(n):n}function AO(n){let e={};return n.forEach(t=>{e=t!=null?Ut(Ut({},e),t):e}),Object.keys(e).length===0?null:e}function RO(n,e){return e.map(t=>t(n))}function Nz(n){return!n.validate}function DO(n){return n.map(e=>Nz(e)?e:t=>e.validate(t))}function NO(n){if(!n)return null;let e=n.filter(bO);return e.length==0?null:function(t){return AO(RO(t,e))}}function kO(n){return n!=null?NO(DO(n)):null}function OO(n){if(!n)return null;let e=n.filter(bO);return e.length==0?null:function(t){let r=RO(t,e).map(IO);return kA(r).pipe(Be(AO))}}function xO(n){return n!=null?OO(DO(n)):null}function dO(n,e){return n===null?[e]:Array.isArray(n)?[...n,e]:[n,e]}function PO(n){return n._rawValidators}function MO(n){return n._rawAsyncValidators}function nS(n){return n?Array.isArray(n)?n:[n]:[]}function Yf(n,e){return Array.isArray(n)?n.includes(e):n===e}function hO(n,e){let t=nS(e);return nS(n).forEach(i=>{Yf(t,i)||t.push(i)}),t}function fO(n,e){return nS(e).filter(t=>!Yf(n,t))}var Xf=class{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=kO(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=xO(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e=void 0){this.control&&this.control.reset(e)}hasError(e,t){return this.control?this.control.hasError(e,t):!1}getError(e,t){return this.control?this.control.getError(e,t):null}},xa=class extends Xf{get formDirective(){return null}get path(){return null}},Nu=class extends Xf{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}},Jf=class{constructor(e){this._cd=e}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}},kz={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},hie=Sn(Ut({},kz),{"[class.ng-submitted]":"isSubmitted"}),FO=(()=>{class n extends Jf{constructor(t){super(t)}static{this.\u0275fac=function(r){return new(r||n)(Ve(Nu,2))}}static{this.\u0275dir=Xr({type:n,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(r,i){r&2&&zy("ng-untouched",i.isUntouched)("ng-touched",i.isTouched)("ng-pristine",i.isPristine)("ng-dirty",i.isDirty)("ng-valid",i.isValid)("ng-invalid",i.isInvalid)("ng-pending",i.isPending)},features:[zs]})}}return n})(),LO=(()=>{class n extends Jf{constructor(t){super(t)}static{this.\u0275fac=function(r){return new(r||n)(Ve(xa,10))}}static{this.\u0275dir=Xr({type:n,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(r,i){r&2&&zy("ng-untouched",i.isUntouched)("ng-touched",i.isTouched)("ng-pristine",i.isPristine)("ng-dirty",i.isDirty)("ng-valid",i.isValid)("ng-invalid",i.isInvalid)("ng-pending",i.isPending)("ng-submitted",i.isSubmitted)},features:[zs]})}}return n})();var Ru="VALID",Qf="INVALID",Oa="PENDING",Du="DISABLED";function sS(n){return(rp(n)?n.validators:n)||null}function Oz(n){return Array.isArray(n)?kO(n):n||null}function oS(n,e){return(rp(e)?e.asyncValidators:n)||null}function xz(n){return Array.isArray(n)?xO(n):n||null}function rp(n){return n!=null&&!Array.isArray(n)&&typeof n=="object"}function BO(n,e,t){let r=n.controls;if(!(e?Object.keys(r):r).length)throw new ph(1e3,"");if(!r[t])throw new ph(1001,"")}function VO(n,e,t){n._forEachChild((r,i)=>{if(t[i]===void 0)throw new ph(1002,"")})}var Pa=class{constructor(e,t){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(e),this._assignAsyncValidators(t)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get valid(){return this.status===Ru}get invalid(){return this.status===Qf}get pending(){return this.status==Oa}get disabled(){return this.status===Du}get enabled(){return this.status!==Du}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._assignValidators(e)}setAsyncValidators(e){this._assignAsyncValidators(e)}addValidators(e){this.setValidators(hO(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(hO(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(fO(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(fO(e,this._rawAsyncValidators))}hasValidator(e){return Yf(this._rawValidators,e)}hasAsyncValidator(e){return Yf(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){this.touched=!0,this._parent&&!e.onlySelf&&this._parent.markAsTouched(e)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(e=>e.markAllAsTouched())}markAsUntouched(e={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(t=>{t.markAsUntouched({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}markAsDirty(e={}){this.pristine=!1,this._parent&&!e.onlySelf&&this._parent.markAsDirty(e)}markAsPristine(e={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(t=>{t.markAsPristine({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}markAsPending(e={}){this.status=Oa,e.emitEvent!==!1&&this.statusChanges.emit(this.status),this._parent&&!e.onlySelf&&this._parent.markAsPending(e)}disable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=Du,this.errors=null,this._forEachChild(r=>{r.disable(Sn(Ut({},e),{onlySelf:!0}))}),this._updateValue(),e.emitEvent!==!1&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Sn(Ut({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(r=>r(!0))}enable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=Ru,this._forEachChild(r=>{r.enable(Sn(Ut({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(Sn(Ut({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(r=>r(!1))}_updateAncestors(e){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(e){this._parent=e}getRawValue(){return this.value}updateValueAndValidity(e={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Ru||this.status===Oa)&&this._runAsyncValidator(e.emitEvent)),e.emitEvent!==!1&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(e)}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Du:Ru}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e){if(this.asyncValidator){this.status=Oa,this._hasOwnPendingAsyncValidator=!0;let t=IO(this.asyncValidator(this));this._asyncValidationSubscription=t.subscribe(r=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(r,{emitEvent:e})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(t.emitEvent!==!1)}get(e){let t=e;return t==null||(Array.isArray(t)||(t=t.split(".")),t.length===0)?null:t.reduce((r,i)=>r&&r._find(i),this)}getError(e,t){let r=t?this.get(t):this;return r&&r.errors?r.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(e)}_initObservables(){this.valueChanges=new vc,this.statusChanges=new vc}_calculateStatus(){return this._allControlsDisabled()?Du:this.errors?Qf:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Oa)?Oa:this._anyControlsHaveStatus(Qf)?Qf:Ru}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e={}){this.pristine=!this._anyControlsDirty(),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}_updateTouched(e={}){this.touched=this._anyControlsTouched(),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){rp(e)&&e.updateOn!=null&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){let t=this._parent&&this._parent.dirty;return!e&&!!t&&!this._parent._anyControlsDirty()}_find(e){return null}_assignValidators(e){this._rawValidators=Array.isArray(e)?e.slice():e,this._composedValidatorFn=Oz(this._rawValidators)}_assignAsyncValidators(e){this._rawAsyncValidators=Array.isArray(e)?e.slice():e,this._composedAsyncValidatorFn=xz(this._rawAsyncValidators)}},Zf=class extends Pa{constructor(e,t,r){super(sS(t),oS(r,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(e,t){return this.controls[e]?this.controls[e]:(this.controls[e]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(e,t,r={}){this.registerControl(e,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}removeControl(e,t={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}setControl(e,t,r={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],t&&this.registerControl(e,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}contains(e){return this.controls.hasOwnProperty(e)&&this.controls[e].enabled}setValue(e,t={}){VO(this,!0,e),Object.keys(e).forEach(r=>{BO(this,!0,r),this.controls[r].setValue(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){e!=null&&(Object.keys(e).forEach(r=>{let i=this.controls[r];i&&i.patchValue(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e={},t={}){this._forEachChild((r,i)=>{r.reset(e?e[i]:null,{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this._reduceChildren({},(e,t,r)=>(e[r]=t.getRawValue(),e))}_syncPendingControls(){let e=this._reduceChildren(!1,(t,r)=>r._syncPendingControls()?!0:t);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){Object.keys(this.controls).forEach(t=>{let r=this.controls[t];r&&e(r,t)})}_setUpControls(){this._forEachChild(e=>{e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(e){for(let[t,r]of Object.entries(this.controls))if(this.contains(t)&&e(r))return!0;return!1}_reduceValue(){let e={};return this._reduceChildren(e,(t,r,i)=>((r.enabled||this.disabled)&&(t[i]=r.value),t))}_reduceChildren(e,t){let r=e;return this._forEachChild((i,s)=>{r=t(r,i,s)}),r}_allControlsDisabled(){for(let e of Object.keys(this.controls))if(this.controls[e].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(e){return this.controls.hasOwnProperty(e)?this.controls[e]:null}};var rS=class extends Zf{};var UO=new ge("CallSetDisabledState",{providedIn:"root",factory:()=>aS}),aS="always";function Pz(n,e){return[...e.path,n]}function pO(n,e,t=aS){lS(n,e),e.valueAccessor.writeValue(n.value),(n.disabled||t==="always")&&e.valueAccessor.setDisabledState?.(n.disabled),Fz(n,e),Bz(n,e),Lz(n,e),Mz(n,e)}function mO(n,e,t=!0){let r=()=>{};e.valueAccessor&&(e.valueAccessor.registerOnChange(r),e.valueAccessor.registerOnTouched(r)),tp(n,e),n&&(e._invokeOnDestroyCallbacks(),n._registerOnCollectionChange(()=>{}))}function ep(n,e){n.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(e)})}function Mz(n,e){if(e.valueAccessor.setDisabledState){let t=r=>{e.valueAccessor.setDisabledState(r)};n.registerOnDisabledChange(t),e._registerOnDestroy(()=>{n._unregisterOnDisabledChange(t)})}}function lS(n,e){let t=PO(n);e.validator!==null?n.setValidators(dO(t,e.validator)):typeof t=="function"&&n.setValidators([t]);let r=MO(n);e.asyncValidator!==null?n.setAsyncValidators(dO(r,e.asyncValidator)):typeof r=="function"&&n.setAsyncValidators([r]);let i=()=>n.updateValueAndValidity();ep(e._rawValidators,i),ep(e._rawAsyncValidators,i)}function tp(n,e){let t=!1;if(n!==null){if(e.validator!==null){let i=PO(n);if(Array.isArray(i)&&i.length>0){let s=i.filter(o=>o!==e.validator);s.length!==i.length&&(t=!0,n.setValidators(s))}}if(e.asyncValidator!==null){let i=MO(n);if(Array.isArray(i)&&i.length>0){let s=i.filter(o=>o!==e.asyncValidator);s.length!==i.length&&(t=!0,n.setAsyncValidators(s))}}}let r=()=>{};return ep(e._rawValidators,r),ep(e._rawAsyncValidators,r),t}function Fz(n,e){e.valueAccessor.registerOnChange(t=>{n._pendingValue=t,n._pendingChange=!0,n._pendingDirty=!0,n.updateOn==="change"&&qO(n,e)})}function Lz(n,e){e.valueAccessor.registerOnTouched(()=>{n._pendingTouched=!0,n.updateOn==="blur"&&n._pendingChange&&qO(n,e),n.updateOn!=="submit"&&n.markAsTouched()})}function qO(n,e){n._pendingDirty&&n.markAsDirty(),n.setValue(n._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(n._pendingValue),n._pendingChange=!1}function Bz(n,e){let t=(r,i)=>{e.valueAccessor.writeValue(r),i&&e.viewToModelUpdate(r)};n.registerOnChange(t),e._registerOnDestroy(()=>{n._unregisterOnChange(t)})}function Vz(n,e){n==null,lS(n,e)}function Uz(n,e){return tp(n,e)}function qz(n,e){if(!n.hasOwnProperty("model"))return!1;let t=n.model;return t.isFirstChange()?!0:!Object.is(e,t.currentValue)}function zz(n){return Object.getPrototypeOf(n.constructor)===yz}function Gz(n,e){n._syncPendingControls(),e.forEach(t=>{let r=t.control;r.updateOn==="submit"&&r._pendingChange&&(t.viewToModelUpdate(r._pendingValue),r._pendingChange=!1)})}function Wz(n,e){if(!e)return null;Array.isArray(e);let t,r,i;return e.forEach(s=>{s.constructor===np?t=s:zz(s)?r=s:i=s}),i||r||t||null}function jz(n,e){let t=n.indexOf(e);t>-1&&n.splice(t,1)}function gO(n,e){let t=n.indexOf(e);t>-1&&n.splice(t,1)}function yO(n){return typeof n=="object"&&n!==null&&Object.keys(n).length===2&&"value"in n&&"disabled"in n}var ii=class extends Pa{constructor(e=null,t,r){super(sS(t),oS(r,t)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(e),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),rp(t)&&(t.nonNullable||t.initialValueIsDefault)&&(yO(e)?this.defaultValue=e.value:this.defaultValue=e)}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&t.emitModelToViewChange!==!1&&this._onChange.forEach(r=>r(this.value,t.emitViewToModelChange!==!1)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=this.defaultValue,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){gO(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){gO(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(e){yO(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}};var $z=n=>n instanceof ii;var zO=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275dir=Xr({type:n,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]})}}return n})();var GO=new ge("");var Hz={provide:xa,useExisting:mh(()=>cS)},cS=(()=>{class n extends xa{constructor(t,r,i){super(),this.callSetDisabledState=i,this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new vc,this._setValidators(t),this._setAsyncValidators(r)}ngOnChanges(t){this._checkFormPresent(),t.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(tp(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(t){let r=this.form.get(t.path);return pO(r,t,this.callSetDisabledState),r.updateValueAndValidity({emitEvent:!1}),this.directives.push(t),r}getControl(t){return this.form.get(t.path)}removeControl(t){mO(t.control||null,t,!1),jz(this.directives,t)}addFormGroup(t){this._setUpFormContainer(t)}removeFormGroup(t){this._cleanUpFormContainer(t)}getFormGroup(t){return this.form.get(t.path)}addFormArray(t){this._setUpFormContainer(t)}removeFormArray(t){this._cleanUpFormContainer(t)}getFormArray(t){return this.form.get(t.path)}updateModel(t,r){this.form.get(t.path).setValue(r)}onSubmit(t){return this.submitted=!0,Gz(this.form,this.directives),this.ngSubmit.emit(t),t?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(t=void 0){this.form.reset(t),this.submitted=!1}_updateDomValue(){this.directives.forEach(t=>{let r=t.control,i=this.form.get(t.path);r!==i&&(mO(r||null,t),$z(i)&&(pO(i,t,this.callSetDisabledState),t.control=i))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(t){let r=this.form.get(t.path);Vz(r,t),r.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(t){if(this.form){let r=this.form.get(t.path);r&&Uz(r,t)&&r.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){lS(this.form,this),this._oldForm&&tp(this._oldForm,this)}_checkFormPresent(){this.form}static{this.\u0275fac=function(r){return new(r||n)(Ve(CO,10),Ve(wO,10),Ve(UO,8))}}static{this.\u0275dir=Xr({type:n,selectors:[["","formGroup",""]],hostBindings:function(r,i){r&1&&bi("submit",function(o){return i.onSubmit(o)})("reset",function(){return i.onReset()})},inputs:{form:[_c.None,"formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[gh([Hz]),zs,Ly]})}}return n})();var Kz={provide:Nu,useExisting:mh(()=>uS)},uS=(()=>{class n extends Nu{set isDisabled(t){}static{this._ngModelWarningSentOnce=!1}constructor(t,r,i,s,o){super(),this._ngModelWarningConfig=o,this._added=!1,this.name=null,this.update=new vc,this._ngModelWarningSent=!1,this._parent=t,this._setValidators(r),this._setAsyncValidators(i),this.valueAccessor=Wz(this,s)}ngOnChanges(t){this._added||this._setUpControl(),qz(t,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}get path(){return Pz(this.name==null?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this._added=!0}static{this.\u0275fac=function(r){return new(r||n)(Ve(xa,13),Ve(CO,10),Ve(wO,10),Ve(EO,10),Ve(GO,8))}}static{this.\u0275dir=Xr({type:n,selectors:[["","formControlName",""]],inputs:{name:[_c.None,"formControlName","name"],isDisabled:[_c.None,"disabled","isDisabled"],model:[_c.None,"ngModel","model"]},outputs:{update:"ngModelChange"},features:[gh([Kz]),zs,Ly]})}}return n})();var Qz=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=Gn({type:n})}static{this.\u0275inj=zn({})}}return n})(),iS=class extends Pa{constructor(e,t,r){super(sS(t),oS(r,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(e){return this.controls[this._adjustIndex(e)]}push(e,t={}){this.controls.push(e),this._registerControl(e),this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}insert(e,t,r={}){this.controls.splice(e,0,t),this._registerControl(t),this.updateValueAndValidity({emitEvent:r.emitEvent})}removeAt(e,t={}){let r=this._adjustIndex(e);r<0&&(r=0),this.controls[r]&&this.controls[r]._registerOnCollectionChange(()=>{}),this.controls.splice(r,1),this.updateValueAndValidity({emitEvent:t.emitEvent})}setControl(e,t,r={}){let i=this._adjustIndex(e);i<0&&(i=0),this.controls[i]&&this.controls[i]._registerOnCollectionChange(()=>{}),this.controls.splice(i,1),t&&(this.controls.splice(i,0,t),this._registerControl(t)),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(e,t={}){VO(this,!1,e),e.forEach((r,i)=>{BO(this,!1,i),this.at(i).setValue(r,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){e!=null&&(e.forEach((r,i)=>{this.at(i)&&this.at(i).patchValue(r,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e=[],t={}){this._forEachChild((r,i)=>{r.reset(e[i],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this.controls.map(e=>e.getRawValue())}clear(e={}){this.controls.length<1||(this._forEachChild(t=>t._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:e.emitEvent}))}_adjustIndex(e){return e<0?e+this.length:e}_syncPendingControls(){let e=this.controls.reduce((t,r)=>r._syncPendingControls()?!0:t,!1);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){this.controls.forEach((t,r)=>{e(t,r)})}_updateValue(){this.value=this.controls.filter(e=>e.enabled||this.disabled).map(e=>e.value)}_anyControls(e){return this.controls.some(t=>t.enabled&&e(t))}_setUpControls(){this._forEachChild(e=>this._registerControl(e))}_allControlsDisabled(){for(let e of this.controls)if(e.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(e){e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)}_find(e){return this.at(e)??null}};function _O(n){return!!n&&(n.asyncValidators!==void 0||n.validators!==void 0||n.updateOn!==void 0)}var WO=(()=>{class n{constructor(){this.useNonNullable=!1}get nonNullable(){let t=new n;return t.useNonNullable=!0,t}group(t,r=null){let i=this._reduceControls(t),s={};return _O(r)?s=r:r!==null&&(s.validators=r.validator,s.asyncValidators=r.asyncValidator),new Zf(i,s)}record(t,r=null){let i=this._reduceControls(t);return new rS(i,r)}control(t,r,i){let s={};return this.useNonNullable?(_O(r)?s=r:(s.validators=r,s.asyncValidators=i),new ii(t,Sn(Ut({},s),{nonNullable:!0}))):new ii(t,r,i)}array(t,r,i){let s=t.map(o=>this._createControl(o));return new iS(s,r,i)}_reduceControls(t){let r={};return Object.keys(t).forEach(i=>{r[i]=this._createControl(t[i])}),r}_createControl(t){if(t instanceof ii)return t;if(t instanceof Pa)return t;if(Array.isArray(t)){let r=t[0],i=t.length>1?t[1]:null,s=t.length>2?t[2]:null;return this.control(r,i,s)}else return this.control(t)}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=Cn({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var jO=(()=>{class n{static withConfig(t){return{ngModule:n,providers:[{provide:GO,useValue:t.warnOnNgModelWithFormControl??"always"},{provide:UO,useValue:t.callSetDisabledState??aS}]}}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=Gn({type:n})}static{this.\u0275inj=zn({imports:[Qz]})}}return n})();function Xz(n,e){n&1&&(ve(0,"div",6),Te(1,"Name is required"),he())}function Jz(n,e){n&1&&(ve(0,"div",6),Te(1,"position is required"),he())}function Zz(n,e){n&1&&(ve(0,"div",6),Te(1,"department is required"),he())}function eG(n,e){n&1&&(ve(0,"div",6),Te(1,"salary is required"),he())}var dS=(()=>{class n{constructor(t,r,i,s){this.fb=t,this.employeeService=r,this.router=i,this.activatedRoute=s,this.employee=[],this.employeeId="",this.employeeForm=this.fb.group({name:new ii("",[ho.required]),position:new ii("",[ho.required]),department:new ii("",[ho.required]),salary:new ii("",[ho.required])})}ngOnInit(){this.activatedRoute.params.subscribe({next:t=>{this.employeeId=t.id,this.getEmployee(this.employeeId)}})}onSubmit(){this.employeeForm.valid?(this.employeeService.addEmployee(this.employeeForm.value),this.router.navigate(["/employee-list"])):this.employeeForm.markAllAsTouched()}getEmployee(t){this.employeeService.getEmployee(t).snapshotChanges().subscribe({next:r=>{let i=r.payload.toJSON();this.employeeForm.setValue(i)}})}static{this.\u0275fac=function(r){return new(r||n)(Ve(WO),Ve(Kf),Ve(Eh),Ve(QA))}}static{this.\u0275cmp=fr({type:n,selectors:[["app-add-edit-employee"]],standalone:!0,features:[mr],decls:30,vars:5,consts:[[1,"row","mt-5"],[1,"col-lg-6"],[3,"submit","formGroup"],[1,"mb-3"],["for","name",1,"form-label"],["type","text","id","name","placeholder","name","formControlName","name",1,"form-control"],[1,"form-text","text-danger"],["for","position",1,"form-label"],["type","text","id","position","placeholder","position","formControlName","position",1,"form-control"],["for","department",1,"form-label"],["type","text","id","department","placeholder","Department","formControlName","department",1,"form-control"],["for","salary",1,"form-label"],["type","text","id","salary","placeholder","Salary","formControlName","salary",1,"form-control"],[1,"mb-4","d-flex","justify-content-between","align-items-center"],["type","submit",1,"btn","btn-primary"],["type","button","routerLink","/employee-list",1,"btn","btn-danger","ms-5"]],template:function(r,i){if(r&1&&(ve(0,"div",0)(1,"div",1)(2,"h4"),Te(3,"Employee Form"),he(),ve(4,"form",2),bi("submit",function(){return i.onSubmit()}),ve(5,"div",3)(6,"label",4),Te(7,"Name"),he(),Zr(8,"input",5),Ec(9,Xz,2,0,"div",6),he(),ve(10,"div",3)(11,"label",7),Te(12,"Position"),he(),Zr(13,"input",8),Ec(14,Jz,2,0,"div",6),he(),ve(15,"div",3)(16,"label",9),Te(17,"Department"),he(),Zr(18,"input",10),Ec(19,Zz,2,0,"div",6),he(),ve(20,"div",3)(21,"label",11),Te(22,"salary"),he(),Zr(23,"input",12),Ec(24,eG,2,0,"div",6),he(),ve(25,"div",13)(26,"button",14),Te(27,"Save Changes"),he(),ve(28,"button",15),Te(29," Cancel "),he()()()()()),r&2){let s,o,a,l;wn(4),VA("formGroup",i.employeeForm),wn(5),Sc(9,(s=i.employeeForm.get("name"))!=null&&s.hasError("required")&&((s=i.employeeForm.get("name"))!=null&&s.touched)?9:-1),wn(5),Sc(14,(o=i.employeeForm.get("position"))!=null&&o.hasError("required")&&((o=i.employeeForm.get("position"))!=null&&o.touched)?14:-1),wn(5),Sc(19,(a=i.employeeForm.get("department"))!=null&&a.hasError("required")&&((a=i.employeeForm.get("department"))!=null&&a.touched)?19:-1),wn(5),Sc(24,(l=i.employeeForm.get("salary"))!=null&&l.hasError("required")&&((l=i.employeeForm.get("salary"))!=null&&l.touched)?24:-1)}},dependencies:[ia,oa,sa,jO,zO,np,FO,LO,cS,uS]})}}return n})();var $O=[{path:"",component:uR},{path:"employee-list",component:uO,children:[{path:"employee-details",component:Zy},{path:"employee-details/:id",component:Zy}]},{path:"add-edit-employee",component:dS},{path:"add-edit-employee/:id",component:dS}];var rse=uh(yV(),1);var HO="auth",ku=class{constructor(e){return e}},fo=class{constructor(){return $s(HO)}};var hS=new ge("angularfire2.auth-instances");function eW(n,e){let t=ca(HO,n,e);return t&&new ku(t)}function tW(n){return(e,t)=>{let r=e.runOutsideAngular(()=>n(t));return new ku(r)}}var nW={provide:fo,deps:[[new pt,hS]]},rW={provide:ku,useFactory:eW,deps:[[new pt,hS],jn]};function KO(n,...e){return et("angularfire",St.full,"auth"),Ti([rW,nW,{provide:hS,useFactory:tW(n),multi:!0,deps:[vt,Jr,en,ei,[new pt,qt],...e]}])}var QO=Ri(Jy,!0);import{inspect as p8,TextEncoder as m8,TextDecoder as g8}from"util";import{randomBytes as y8}from"crypto";var CF=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},wF={};var gs,kT;(function(){var n;function e(S,y){function _(){}_.prototype=y.prototype,S.D=y.prototype,S.prototype=new _,S.prototype.constructor=S,S.C=function(v,m,C){for(var f=Array(arguments.length-2),g=2;g<arguments.length;g++)f[g-2]=arguments[g];return y.prototype[m].apply(v,f)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(S,y,_){_||(_=0);var v=Array(16);if(typeof y=="string")for(var m=0;16>m;++m)v[m]=y.charCodeAt(_++)|y.charCodeAt(_++)<<8|y.charCodeAt(_++)<<16|y.charCodeAt(_++)<<24;else for(m=0;16>m;++m)v[m]=y[_++]|y[_++]<<8|y[_++]<<16|y[_++]<<24;y=S.g[0],_=S.g[1],m=S.g[2];var C=S.g[3],f=y+(C^_&(m^C))+v[0]+3614090360&4294967295;y=_+(f<<7&4294967295|f>>>25),f=C+(m^y&(_^m))+v[1]+3905402710&4294967295,C=y+(f<<12&4294967295|f>>>20),f=m+(_^C&(y^_))+v[2]+606105819&4294967295,m=C+(f<<17&4294967295|f>>>15),f=_+(y^m&(C^y))+v[3]+3250441966&4294967295,_=m+(f<<22&4294967295|f>>>10),f=y+(C^_&(m^C))+v[4]+4118548399&4294967295,y=_+(f<<7&4294967295|f>>>25),f=C+(m^y&(_^m))+v[5]+1200080426&4294967295,C=y+(f<<12&4294967295|f>>>20),f=m+(_^C&(y^_))+v[6]+2821735955&4294967295,m=C+(f<<17&4294967295|f>>>15),f=_+(y^m&(C^y))+v[7]+4249261313&4294967295,_=m+(f<<22&4294967295|f>>>10),f=y+(C^_&(m^C))+v[8]+1770035416&4294967295,y=_+(f<<7&4294967295|f>>>25),f=C+(m^y&(_^m))+v[9]+2336552879&4294967295,C=y+(f<<12&4294967295|f>>>20),f=m+(_^C&(y^_))+v[10]+4294925233&4294967295,m=C+(f<<17&4294967295|f>>>15),f=_+(y^m&(C^y))+v[11]+2304563134&4294967295,_=m+(f<<22&4294967295|f>>>10),f=y+(C^_&(m^C))+v[12]+1804603682&4294967295,y=_+(f<<7&4294967295|f>>>25),f=C+(m^y&(_^m))+v[13]+4254626195&4294967295,C=y+(f<<12&4294967295|f>>>20),f=m+(_^C&(y^_))+v[14]+2792965006&4294967295,m=C+(f<<17&4294967295|f>>>15),f=_+(y^m&(C^y))+v[15]+1236535329&4294967295,_=m+(f<<22&4294967295|f>>>10),f=y+(m^C&(_^m))+v[1]+4129170786&4294967295,y=_+(f<<5&4294967295|f>>>27),f=C+(_^m&(y^_))+v[6]+3225465664&4294967295,C=y+(f<<9&4294967295|f>>>23),f=m+(y^_&(C^y))+v[11]+643717713&4294967295,m=C+(f<<14&4294967295|f>>>18),f=_+(C^y&(m^C))+v[0]+3921069994&4294967295,_=m+(f<<20&4294967295|f>>>12),f=y+(m^C&(_^m))+v[5]+3593408605&4294967295,y=_+(f<<5&4294967295|f>>>27),f=C+(_^m&(y^_))+v[10]+38016083&4294967295,C=y+(f<<9&4294967295|f>>>23),f=m+(y^_&(C^y))+v[15]+3634488961&4294967295,m=C+(f<<14&4294967295|f>>>18),f=_+(C^y&(m^C))+v[4]+3889429448&4294967295,_=m+(f<<20&4294967295|f>>>12),f=y+(m^C&(_^m))+v[9]+568446438&4294967295,y=_+(f<<5&4294967295|f>>>27),f=C+(_^m&(y^_))+v[14]+3275163606&4294967295,C=y+(f<<9&4294967295|f>>>23),f=m+(y^_&(C^y))+v[3]+4107603335&4294967295,m=C+(f<<14&4294967295|f>>>18),f=_+(C^y&(m^C))+v[8]+1163531501&4294967295,_=m+(f<<20&4294967295|f>>>12),f=y+(m^C&(_^m))+v[13]+2850285829&4294967295,y=_+(f<<5&4294967295|f>>>27),f=C+(_^m&(y^_))+v[2]+4243563512&4294967295,C=y+(f<<9&4294967295|f>>>23),f=m+(y^_&(C^y))+v[7]+1735328473&4294967295,m=C+(f<<14&4294967295|f>>>18),f=_+(C^y&(m^C))+v[12]+2368359562&4294967295,_=m+(f<<20&4294967295|f>>>12),f=y+(_^m^C)+v[5]+4294588738&4294967295,y=_+(f<<4&4294967295|f>>>28),f=C+(y^_^m)+v[8]+2272392833&4294967295,C=y+(f<<11&4294967295|f>>>21),f=m+(C^y^_)+v[11]+1839030562&4294967295,m=C+(f<<16&4294967295|f>>>16),f=_+(m^C^y)+v[14]+4259657740&4294967295,_=m+(f<<23&4294967295|f>>>9),f=y+(_^m^C)+v[1]+2763975236&4294967295,y=_+(f<<4&4294967295|f>>>28),f=C+(y^_^m)+v[4]+1272893353&4294967295,C=y+(f<<11&4294967295|f>>>21),f=m+(C^y^_)+v[7]+4139469664&4294967295,m=C+(f<<16&4294967295|f>>>16),f=_+(m^C^y)+v[10]+3200236656&4294967295,_=m+(f<<23&4294967295|f>>>9),f=y+(_^m^C)+v[13]+681279174&4294967295,y=_+(f<<4&4294967295|f>>>28),f=C+(y^_^m)+v[0]+3936430074&4294967295,C=y+(f<<11&4294967295|f>>>21),f=m+(C^y^_)+v[3]+3572445317&4294967295,m=C+(f<<16&4294967295|f>>>16),f=_+(m^C^y)+v[6]+76029189&4294967295,_=m+(f<<23&4294967295|f>>>9),f=y+(_^m^C)+v[9]+3654602809&4294967295,y=_+(f<<4&4294967295|f>>>28),f=C+(y^_^m)+v[12]+3873151461&4294967295,C=y+(f<<11&4294967295|f>>>21),f=m+(C^y^_)+v[15]+530742520&4294967295,m=C+(f<<16&4294967295|f>>>16),f=_+(m^C^y)+v[2]+3299628645&4294967295,_=m+(f<<23&4294967295|f>>>9),f=y+(m^(_|~C))+v[0]+4096336452&4294967295,y=_+(f<<6&4294967295|f>>>26),f=C+(_^(y|~m))+v[7]+1126891415&4294967295,C=y+(f<<10&4294967295|f>>>22),f=m+(y^(C|~_))+v[14]+2878612391&4294967295,m=C+(f<<15&4294967295|f>>>17),f=_+(C^(m|~y))+v[5]+4237533241&4294967295,_=m+(f<<21&4294967295|f>>>11),f=y+(m^(_|~C))+v[12]+1700485571&4294967295,y=_+(f<<6&4294967295|f>>>26),f=C+(_^(y|~m))+v[3]+2399980690&4294967295,C=y+(f<<10&4294967295|f>>>22),f=m+(y^(C|~_))+v[10]+4293915773&4294967295,m=C+(f<<15&4294967295|f>>>17),f=_+(C^(m|~y))+v[1]+2240044497&4294967295,_=m+(f<<21&4294967295|f>>>11),f=y+(m^(_|~C))+v[8]+1873313359&4294967295,y=_+(f<<6&4294967295|f>>>26),f=C+(_^(y|~m))+v[15]+4264355552&4294967295,C=y+(f<<10&4294967295|f>>>22),f=m+(y^(C|~_))+v[6]+2734768916&4294967295,m=C+(f<<15&4294967295|f>>>17),f=_+(C^(m|~y))+v[13]+1309151649&4294967295,_=m+(f<<21&4294967295|f>>>11),f=y+(m^(_|~C))+v[4]+4149444226&4294967295,y=_+(f<<6&4294967295|f>>>26),f=C+(_^(y|~m))+v[11]+3174756917&4294967295,C=y+(f<<10&4294967295|f>>>22),f=m+(y^(C|~_))+v[2]+718787259&4294967295,m=C+(f<<15&4294967295|f>>>17),f=_+(C^(m|~y))+v[9]+3951481745&4294967295,S.g[0]=S.g[0]+y&4294967295,S.g[1]=S.g[1]+(m+(f<<21&4294967295|f>>>11))&4294967295,S.g[2]=S.g[2]+m&4294967295,S.g[3]=S.g[3]+C&4294967295}r.prototype.u=function(S,y){y===void 0&&(y=S.length);for(var _=y-this.blockSize,v=this.B,m=this.h,C=0;C<y;){if(m==0)for(;C<=_;)i(this,S,C),C+=this.blockSize;if(typeof S=="string"){for(;C<y;)if(v[m++]=S.charCodeAt(C++),m==this.blockSize){i(this,v),m=0;break}}else for(;C<y;)if(v[m++]=S[C++],m==this.blockSize){i(this,v),m=0;break}}this.h=m,this.o+=y},r.prototype.v=function(){var S=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);S[0]=128;for(var y=1;y<S.length-8;++y)S[y]=0;var _=8*this.o;for(y=S.length-8;y<S.length;++y)S[y]=_&255,_/=256;for(this.u(S),S=Array(16),y=_=0;4>y;++y)for(var v=0;32>v;v+=8)S[_++]=this.g[y]>>>v&255;return S};function s(S,y){var _=a;return Object.prototype.hasOwnProperty.call(_,S)?_[S]:_[S]=y(S)}function o(S,y){this.h=y;for(var _=[],v=!0,m=S.length-1;0<=m;m--){var C=S[m]|0;v&&C==y||(_[m]=C,v=!1)}this.g=_}var a={};function l(S){return-128<=S&&128>S?s(S,function(y){return new o([y|0],0>y?-1:0)}):new o([S|0],0>S?-1:0)}function c(S){if(isNaN(S)||!isFinite(S))return d;if(0>S)return b(c(-S));for(var y=[],_=1,v=0;S>=_;v++)y[v]=S/_|0,_*=4294967296;return new o(y,0)}function u(S,y){if(S.length==0)throw Error("number format error: empty string");if(y=y||10,2>y||36<y)throw Error("radix out of range: "+y);if(S.charAt(0)=="-")return b(u(S.substring(1),y));if(0<=S.indexOf("-"))throw Error('number format error: interior "-" character');for(var _=c(Math.pow(y,8)),v=d,m=0;m<S.length;m+=8){var C=Math.min(8,S.length-m),f=parseInt(S.substring(m,m+C),y);8>C?(C=c(Math.pow(y,C)),v=v.j(C).add(c(f))):(v=v.j(_),v=v.add(c(f)))}return v}var d=l(0),h=l(1),p=l(16777216);n=o.prototype,n.m=function(){if(w(this))return-b(this).m();for(var S=0,y=1,_=0;_<this.g.length;_++){var v=this.i(_);S+=(0<=v?v:4294967296+v)*y,y*=4294967296}return S},n.toString=function(S){if(S=S||10,2>S||36<S)throw Error("radix out of range: "+S);if(E(this))return"0";if(w(this))return"-"+b(this).toString(S);for(var y=c(Math.pow(S,6)),_=this,v="";;){var m=F(_,y).g;_=N(_,m.j(y));var C=((0<_.g.length?_.g[0]:_.h)>>>0).toString(S);if(_=m,E(_))return C+v;for(;6>C.length;)C="0"+C;v=C+v}},n.i=function(S){return 0>S?0:S<this.g.length?this.g[S]:this.h};function E(S){if(S.h!=0)return!1;for(var y=0;y<S.g.length;y++)if(S.g[y]!=0)return!1;return!0}function w(S){return S.h==-1}n.l=function(S){return S=N(this,S),w(S)?-1:E(S)?0:1};function b(S){for(var y=S.g.length,_=[],v=0;v<y;v++)_[v]=~S.g[v];return new o(_,~S.h).add(h)}n.abs=function(){return w(this)?b(this):this},n.add=function(S){for(var y=Math.max(this.g.length,S.g.length),_=[],v=0,m=0;m<=y;m++){var C=v+(this.i(m)&65535)+(S.i(m)&65535),f=(C>>>16)+(this.i(m)>>>16)+(S.i(m)>>>16);v=f>>>16,C&=65535,f&=65535,_[m]=f<<16|C}return new o(_,_[_.length-1]&-2147483648?-1:0)};function N(S,y){return S.add(b(y))}n.j=function(S){if(E(this)||E(S))return d;if(w(this))return w(S)?b(this).j(b(S)):b(b(this).j(S));if(w(S))return b(this.j(b(S)));if(0>this.l(p)&&0>S.l(p))return c(this.m()*S.m());for(var y=this.g.length+S.g.length,_=[],v=0;v<2*y;v++)_[v]=0;for(v=0;v<this.g.length;v++)for(var m=0;m<S.g.length;m++){var C=this.i(v)>>>16,f=this.i(v)&65535,g=S.i(m)>>>16,q=S.i(m)&65535;_[2*v+2*m]+=f*q,D(_,2*v+2*m),_[2*v+2*m+1]+=C*q,D(_,2*v+2*m+1),_[2*v+2*m+1]+=f*g,D(_,2*v+2*m+1),_[2*v+2*m+2]+=C*g,D(_,2*v+2*m+2)}for(v=0;v<y;v++)_[v]=_[2*v+1]<<16|_[2*v];for(v=y;v<2*y;v++)_[v]=0;return new o(_,0)};function D(S,y){for(;(S[y]&65535)!=S[y];)S[y+1]+=S[y]>>>16,S[y]&=65535,y++}function O(S,y){this.g=S,this.h=y}function F(S,y){if(E(y))throw Error("division by zero");if(E(S))return new O(d,d);if(w(S))return y=F(b(S),y),new O(b(y.g),b(y.h));if(w(y))return y=F(S,b(y)),new O(b(y.g),y.h);if(30<S.g.length){if(w(S)||w(y))throw Error("slowDivide_ only works with positive integers.");for(var _=h,v=y;0>=v.l(S);)_=G(_),v=G(v);var m=J(_,1),C=J(v,1);for(v=J(v,2),_=J(_,2);!E(v);){var f=C.add(v);0>=f.l(S)&&(m=m.add(_),C=f),v=J(v,1),_=J(_,1)}return y=N(S,m.j(y)),new O(m,y)}for(m=d;0<=S.l(y);){for(_=Math.max(1,Math.floor(S.m()/y.m())),v=Math.ceil(Math.log(_)/Math.LN2),v=48>=v?1:Math.pow(2,v-48),C=c(_),f=C.j(y);w(f)||0<f.l(S);)_-=v,C=c(_),f=C.j(y);E(C)&&(C=h),m=m.add(C),S=N(S,f)}return new O(m,S)}n.A=function(S){return F(this,S).h},n.and=function(S){for(var y=Math.max(this.g.length,S.g.length),_=[],v=0;v<y;v++)_[v]=this.i(v)&S.i(v);return new o(_,this.h&S.h)},n.or=function(S){for(var y=Math.max(this.g.length,S.g.length),_=[],v=0;v<y;v++)_[v]=this.i(v)|S.i(v);return new o(_,this.h|S.h)},n.xor=function(S){for(var y=Math.max(this.g.length,S.g.length),_=[],v=0;v<y;v++)_[v]=this.i(v)^S.i(v);return new o(_,this.h^S.h)};function G(S){for(var y=S.g.length+1,_=[],v=0;v<y;v++)_[v]=S.i(v)<<1|S.i(v-1)>>>31;return new o(_,S.h)}function J(S,y){var _=y>>5;y%=32;for(var v=S.g.length-_,m=[],C=0;C<v;C++)m[C]=0<y?S.i(C+_)>>>y|S.i(C+_+1)<<32-y:S.i(C+_);return new o(m,S.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,kT=wF.Md5=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=c,o.fromString=u,gs=wF.Integer=o}).apply(typeof CF<"u"?CF:typeof self<"u"?self:typeof window<"u"?window:{});var xo=uh(SF(),1),PL=uh(aw(),1);var TF="@firebase/firestore",bF="4.7.3";var ft=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};ft.UNAUTHENTICATED=new ft(null);ft.GOOGLE_CREDENTIALS=new ft("google-credentials-uid");ft.FIRST_PARTY=new ft("first-party-uid");ft.MOCK_USER=new ft("mock-user");var _8="10.14.0";var tc=_8;function v8(n){tc=n}function E8(n){return p8(n,{depth:100})}var Ts=new Ai("@firebase/firestore");function Rl(){return Ts.logLevel}function W0(n){Ts.setLogLevel(n)}function M(n,...e){if(Ts.logLevel<=bn.DEBUG){let t=e.map(j0);Ts.debug(`Firestore (${tc}): ${n}`,...t)}}function $e(n,...e){if(Ts.logLevel<=bn.ERROR){let t=e.map(j0);Ts.error(`Firestore (${tc}): ${n}`,...t)}}function ir(n,...e){if(Ts.logLevel<=bn.WARN){let t=e.map(j0);Ts.warn(`Firestore (${tc}): ${n}`,...t)}}function j0(n){if(typeof n=="string")return n;try{return E8(n)}catch{return n}}function z(n="Unexpected state"){let e=`FIRESTORE (${tc}) INTERNAL ASSERTION FAILED: `+n;throw $e(e),new Error(e)}function j(n,e){n||z()}function ML(n,e){n||z()}function U(n,e){return n}var R={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},k=class extends eR{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var dt=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var ag=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},GT=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(ft.UNAUTHENTICATED))}shutdown(){}},WT=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},jT=class{constructor(e){this.authProvider=e,this.currentUser=ft.UNAUTHENTICATED,this.tokenCounter=0,this.forceRefresh=!1,this.auth=null}start(e,t){j(this.tokenListener===void 0);let r=this.tokenCounter,i=l=>this.tokenCounter!==r?(r=this.tokenCounter,t(l)):Promise.resolve(),s=new dt;this.tokenListener=()=>{this.tokenCounter++,this.currentUser=this.getUser(),s.resolve(),s=new dt,e.enqueueRetryable(()=>i(this.currentUser))};let o=()=>{let l=s;e.enqueueRetryable(()=>T(this,null,function*(){yield l.promise,yield i(this.currentUser)}))},a=l=>{M("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.tokenListener&&(this.auth.addAuthTokenListener(this.tokenListener),o())};this.authProvider.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){let l=this.authProvider.getImmediate({optional:!0});l?a(l):(M("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new dt)}},0),o()}getToken(){let e=this.tokenCounter,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.tokenCounter!==e?(M("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(j(typeof r.accessToken=="string"),new ag(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.tokenListener&&this.auth.removeAuthTokenListener(this.tokenListener),this.tokenListener=void 0}getUser(){let e=this.auth&&this.auth.getUid();return j(e===null||typeof e=="string"),new ft(e)}},$T=class{constructor(e,t,r){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=r,this.type="FirstParty",this.user=ft.FIRST_PARTY,this._headers=new Map}getAuthToken(){return this.authTokenFactory?this.authTokenFactory():null}get headers(){this._headers.set("X-Goog-AuthUser",this.sessionIndex);let e=this.getAuthToken();return e&&this._headers.set("Authorization",e),this.iamToken&&this._headers.set("X-Goog-Iam-Authorization-Token",this.iamToken),this._headers}},HT=class{constructor(e,t,r){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=r}getToken(){return Promise.resolve(new $T(this.sessionIndex,this.iamToken,this.authTokenFactory))}start(e,t){e.enqueueRetryable(()=>t(ft.FIRST_PARTY))}shutdown(){}invalidateToken(){}},KT=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},QT=class{constructor(e){this.appCheckProvider=e,this.forceRefresh=!1,this.appCheck=null,this.latestAppCheckToken=null}start(e,t){j(this.tokenListener===void 0);let r=s=>{s.error!=null&&M("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.latestAppCheckToken;return this.latestAppCheckToken=s.token,M("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.tokenListener=s=>{e.enqueueRetryable(()=>r(s))};let i=s=>{M("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.tokenListener&&this.appCheck.addTokenListener(this.tokenListener)};this.appCheckProvider.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.appCheckProvider.getImmediate({optional:!0});s?i(s):M("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(j(typeof t.token=="string"),this.latestAppCheckToken=t.token,new KT(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.tokenListener&&this.appCheck.removeTokenListener(this.tokenListener),this.tokenListener=void 0}};function S8(n){if(!n)return new GT;switch(n.type){case"firstParty":return new HT(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new k(R.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}function C8(n){return y8(n)}var lg=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,r="",i=20;for(;r.length<i;){let s=C8(40);for(let o=0;o<s.length;++o)r.length<i&&s[o]<t&&(r+=e.charAt(s[o]%e.length))}return r}};function ne(n,e){return n<e?-1:n>e?1:0}function Po(n,e,t){return n.length!==e.length?!1:n.every((r,i)=>t(r,e[i]))}function FL(n){return n+"\0"}var IF=-62135596800,AF=1e6,He=class n{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new k(R.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new k(R.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<IF)throw new k(R.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new k(R.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-t*1e3)*AF);return new n(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return this.seconds*1e3+this.nanoseconds/AF}_compareTo(e){return this.seconds===e.seconds?ne(this.nanoseconds,e.nanoseconds):ne(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds-IF,t=String(e).padStart(12,"0"),r=String(this.nanoseconds).padStart(9,"0");return t+"."+r}};var Q=class n{constructor(e){this.timestamp=e}static fromTimestamp(e){return new n(e)}static min(){return new n(new He(0,0))}static max(){return new n(new He(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return this.timestamp.seconds*1e6+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var RF="__name__",cg=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&z(),r===void 0?r=e.length-t:r>e.length-t&&z(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let s=e.get(i),o=t.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}},pe=class n extends cg{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new k(R.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},w8=/^[_a-zA-Z][_a-zA-Z0-9]*$/,it=class n extends cg{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return w8.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===RF}static keyField(){return new n([RF])}static fromServerFormat(e){let t=[],r="",i=0,s=()=>{if(r.length===0)throw new k(R.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},o=!1;for(;i<e.length;){let a=e[i];if(a==="\\"){if(i+1===e.length)throw new k(R.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let l=e[i+1];if(!(l==="\\"||l==="."||l==="`"))throw new k(R.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,i+=2}else a==="`"?(o=!o,i++):a==="."&&!o?(s(),i++):(r+=a,i++)}if(s(),o)throw new k(R.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var V=class n{constructor(e){this.path=e}static fromPath(e){return new n(pe.fromString(e))}static fromName(e){return new n(pe.fromString(e).popFirst(5))}static empty(){return new n(pe.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&pe.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return pe.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2===0}static fromSegments(e){return new n(new pe(e.slice()))}};var Ll=-1,T8=0,YT=(()=>{class n{constructor(t,r,i,s){this.indexId=t,this.collectionGroup=r,this.fields=i,this.indexState=s}}return n.UNKNOWN_ID=-1,n})();function $0(n){return n.fields.find(e=>e.kind===2)}function Mo(n){return n.fields.filter(e=>e.kind!==2)}function b8(n){let e=Mo(n);return e.length===0?0:e[e.length-1].kind}function I8(n){return`id=${n.indexId}|cg=${n.collectionGroup}|f=${n.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")}`}var Pl=class{constructor(e,t){this.fieldPath=e,this.kind=t}};var bd=class n{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new n(T8,Un.min())}};function LL(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=Q.fromTimestamp(r===1e9?new He(t+1,0):new He(t,r));return new Un(i,V.empty(),e)}function BL(n){return new Un(n.readTime,n.key,Ll)}var Un=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(Q.min(),V.empty(),Ll)}static max(){return new n(Q.max(),V.empty(),Ll)}};function H0(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0||(t=V.comparator(n.documentKey,e.documentKey),t!==0)?t:ne(n.largestBatchId,e.largestBatchId)}var VL="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",ug=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function Ms(n){return T(this,null,function*(){if(n.code===R.FAILED_PRECONDITION&&n.message===VL)M("LocalStore","Unexpectedly lost primary lease");else throw n})}var I=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&z(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&t()},l=>r(l))}),o=!0,s===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let s=e.length,o=new Array(s),a=0;for(let l=0;l<s;l++){let c=l;t(e[c]).next(u=>{o[c]=u,++a,a===s&&r(o)},u=>i(u))}})}static doWhile(e,t){return new n((r,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):r()};s()})}};var _n="SimpleDb",A8=3,dg=class n{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.completionDeferred=new dt,this.transaction.oncomplete=()=>{this.completionDeferred.resolve()},this.transaction.onabort=()=>{t.error?this.completionDeferred.reject(new Oo(e,t.error)):this.completionDeferred.resolve()},this.transaction.onerror=r=>{let i=K0(r.target.error);this.completionDeferred.reject(new Oo(e,i))}}static open(e,t,r,i){try{return new n(t,e.transaction(i,r))}catch(s){throw new Oo(t,s)}}get completionPromise(){return this.completionDeferred.promise}abort(e){e&&this.completionDeferred.reject(e),this.aborted||(M(_n,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}maybeCommit(){let e=this.transaction;!this.aborted&&typeof e.commit=="function"&&e.commit()}store(e){let t=this.transaction.objectStore(e);return new JT(t)}},bs=class n{constructor(e,t,r){this.name=e,this.version=t,this.schemaConverter=r,n.getIOSVersion(wc())===12.2&&$e("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return M(_n,"Removing database:",e),bo(window.indexedDB.deleteDatabase(e)).toPromise()}static isAvailable(){if(!Th())return!1;if(n.isMockPersistence())return!0;let e=wc(),t=n.getIOSVersion(e),r=0<t&&t<10,i=UL(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static isMockPersistence(){var e;return typeof process<"u"&&((e=process.env)===null||e===void 0?void 0:e.USE_MOCK_PERSISTENCE)==="YES"}static getStore(e,t){return e.store(t)}static getIOSVersion(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}ensureDb(e){return T(this,null,function*(){return this.db||(M(_n,"Opening database:",this.name),this.db=yield new Promise((t,r)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let o=s.target.result;t(o)},i.onblocked=()=>{r(new Oo(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let o=s.target.error;o.name==="VersionError"?r(new k(R.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new k(R.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new Oo(e,o))},i.onupgradeneeded=s=>{M(_n,'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;this.schemaConverter.createOrUpgrade(o,i.transaction,s.oldVersion,this.version).next(()=>{M(_n,"Database upgrade to version "+this.version+" complete")})}})),this.versionchangelistener&&(this.db.onversionchange=t=>this.versionchangelistener(t)),this.db})}setVersionChangeListener(e){this.versionchangelistener=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,i){return T(this,null,function*(){let s=t==="readonly",o=0;for(;;){++o;try{this.db=yield this.ensureDb(e);let a=dg.open(this.db,e,s?"readonly":"readwrite",r),l=i(a).next(c=>(a.maybeCommit(),c)).catch(c=>(a.abort(c),I.reject(c))).toPromise();return l.catch(()=>{}),yield a.completionPromise,l}catch(a){let l=a,c=l.name!=="FirebaseError"&&o<A8;if(M(_n,"Transaction failed with error:",l.message,"Retrying:",c),this.close(),!c)return Promise.reject(l)}}})}close(){this.db&&this.db.close(),this.db=void 0}};function UL(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}var XT=class{constructor(e){this.dbCursor=e,this.shouldStop=!1,this.nextKey=null}get isDone(){return this.shouldStop}get skipToKey(){return this.nextKey}set cursor(e){this.dbCursor=e}done(){this.shouldStop=!0}skip(e){this.nextKey=e}delete(){return bo(this.dbCursor.delete())}},Oo=class extends k{constructor(e,t){super(R.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}};function Fs(n){return n.name==="IndexedDbTransactionError"}var JT=class{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(M(_n,"PUT",this.store.name,e,t),r=this.store.put(t,e)):(M(_n,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),bo(r)}add(e){M(_n,"ADD",this.store.name,e,e);let t=this.store.add(e);return bo(t)}get(e){let t=this.store.get(e);return bo(t).next(r=>(r===void 0&&(r=null),M(_n,"GET",this.store.name,e,r),r))}delete(e){M(_n,"DELETE",this.store.name,e);let t=this.store.delete(e);return bo(t)}count(){M(_n,"COUNT",this.store.name);let e=this.store.count();return bo(e)}loadAll(e,t){let r=this.options(e,t),i=r.index?this.store.index(r.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(r.range);return new I((o,a)=>{s.onerror=l=>{a(l.target.error)},s.onsuccess=l=>{o(l.target.result)}})}else{let s=this.cursor(r),o=[];return this.iterateCursor(s,(a,l)=>{o.push(l)}).next(()=>o)}}loadFirst(e,t){let r=this.store.getAll(e,t===null?void 0:t);return new I((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}deleteAll(e,t){M(_n,"DELETE ALL",this.store.name);let r=this.options(e,t);r.keysOnly=!1;let i=this.cursor(r);return this.iterateCursor(i,(s,o,a)=>a.delete())}iterate(e,t){let r;t?r=e:(r={},t=e);let i=this.cursor(r);return this.iterateCursor(i,t)}iterateSerial(e){let t=this.cursor({});return new I((r,i)=>{t.onerror=s=>{let o=K0(s.target.error);i(o)},t.onsuccess=s=>{let o=s.target.result;if(!o){r();return}e(o.primaryKey,o.value).next(a=>{a?o.continue():r()})}})}iterateCursor(e,t){let r=[];return new I((i,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{let a=o.target.result;if(!a){i();return}let l=new XT(a),c=t(a.primaryKey,a.value,l);if(c instanceof I){let u=c.catch(d=>(l.done(),I.reject(d)));r.push(u)}l.isDone?i():l.skipToKey===null?a.continue():a.continue(l.skipToKey)}}).next(()=>I.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let r=this.store.index(e.index);return e.keysOnly?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}else return this.store.openCursor(e.range,t)}};function bo(n){return new I((e,t)=>{n.onsuccess=r=>{let i=r.target.result;e(i)},n.onerror=r=>{let i=K0(r.target.error);t(i)}})}var DF=!1;function K0(n){let e=bs.getIOSVersion(wc());if(e>=12.2&&e<13){let t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){let r=new k("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return DF||(DF=!0,setTimeout(()=>{throw r},0)),r}}return n}var vd="IndexBackfiller",R8=15*1e3,D8=60*1e3,N8=50,ZT=class{constructor(e,t){this.asyncQueue=e,this.backfiller=t,this.task=null}start(){this.schedule(R8)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}schedule(e){M(vd,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,()=>T(this,null,function*(){this.task=null;try{let t=yield this.backfiller.backfill();M(vd,`Documents written: ${t}`)}catch(t){Fs(t)?M(vd,"Ignoring IndexedDB error during index backfill: ",t):yield Ms(t)}yield this.schedule(D8)}))}},eb=class{constructor(e,t){this.localStore=e,this.persistence=t}backfill(){return T(this,arguments,function*(e=N8){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.writeIndexEntries(t,e))})}writeIndexEntries(e,t){let r=new Set,i=t,s=!0;return I.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o===null||r.has(o))s=!1;else return M(vd,`Processing collection: ${o}`),this.writeEntriesForCollectionGroup(e,o,i).next(a=>{i-=a,r.add(o)})})).next(()=>t-i)}writeEntriesForCollectionGroup(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next(s=>{let o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.getNewOffset(i,s)).next(a=>(M(vd,`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}getNewOffset(e,t){let r=e;return t.changes.forEach((i,s)=>{let o=BL(s);H0(o,r)>0&&(r=o)}),new Un(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}};var vn=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.setPreviousValue(i),this.writeNewSequenceNumber=i=>r.writeSequenceNumber(i))}setPreviousValue(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(t),t}}n.INVALID=-1;return n})(),Ml="",tb="",qL="",zL="";function Yt(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=NF(e)),e=k8(n.get(t),e);return NF(e)}function k8(n,e){let t=e,r=n.length;for(let i=0;i<r;i++){let s=n.charAt(i);switch(s){case"\0":t+=Ml+qL;break;case Ml:t+=Ml+zL;break;default:t+=s}}return t}function NF(n){return n+Ml+tb}function qr(n){let e=n.length;if(j(e>=2),e===2)return j(n.charAt(0)===Ml&&n.charAt(1)===tb),pe.emptyPath();let t=e-2,r=[],i="";for(let s=0;s<e;){let o=n.indexOf(Ml,s);switch((o<0||o>t)&&z(),n.charAt(o+1)){case tb:let l=n.substring(s,o),c;i.length===0?c=l:(i+=l,c=i,i=""),r.push(c);break;case qL:i+=n.substring(s,o),i+="\0";break;case zL:i+=n.substring(s,o+1);break;default:z()}s=o+2}return new pe(r)}var Io="remoteDocuments";var Qd="owner",Sl="owner",Yd="mutationQueues",O8="userId",rr="mutations",GL="batchId",No="userMutationsIndex",WL=["userId","batchId"];function x8(n){return[n]}function ng(n,e){return[n,Yt(e)]}function jL(n,e,t){return[n,Yt(e),t]}var P8={},nc="documentMutations",ey="remoteDocumentsV14",M8=["prefixPath","collectionGroup","readTime","documentId"],rg="documentKeyIndex",F8=["prefixPath","collectionGroup","documentId"],$L="collectionGroupIndex",L8=["collectionGroup","readTime","prefixPath","documentId"],Xd="remoteDocumentGlobal",nb="remoteDocumentGlobalKey",rc="targets",B8="targetId",HL="queryTargetsIndex",V8=["canonicalId","targetId"],ic="targetDocuments",U8=["targetId","path"],Q0="documentTargetsIndex",q8=["path","targetId"],hg="targetGlobalKey",Ko="targetGlobal",Id="collectionParents",z8=["collectionId","parent"],Bl="clientMetadata",G8="clientId",ty="bundles",W8="bundleId",ny="namedQueries",j8="name",Y0="indexConfiguration",$8="indexId",rb="collectionGroupIndex",H8="collectionGroup",ry="indexState",K8=["indexId","uid"],KL="sequenceNumberIndex",Q8=["uid","sequenceNumber"],iy="indexEntries",Y8=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],QL="documentKeyIndex",X8=["indexId","uid","orderedDocumentKey"],sy="documentOverlays",J8=["userId","collectionPath","documentId"],ib="collectionPathOverlayIndex",Z8=["userId","collectionPath","largestBatchId"],YL="collectionGroupOverlayIndex",eQ=["userId","collectionGroup","largestBatchId"],X0="globals",tQ="name",nQ=[Yd,rr,nc,Io,rc,Qd,Ko,ic],rQ=nQ,iQ=[...rQ,Bl],sQ=[...iQ,Xd],oQ=[...sQ,Id],XL=[...oQ,ty,ny],aQ=[...XL,sy],JL=[Yd,rr,nc,ey,rc,Qd,Ko,ic,Bl,Xd,Id,ty,ny,sy],ZL=JL,J0=[...ZL,Y0,ry,iy],lQ=J0,cQ=[...J0,X0];function uQ(n){if(n===17)return cQ;if(n===16)return lQ;if(n===15)return J0;if(n===14)return ZL;if(n===13)return JL;if(n===12)return aQ;if(n===11)return XL;z()}var Ad=class extends ug{constructor(e,t){super(),this.simpleDbTransaction=e,this.currentSequenceNumber=t}};function _t(n,e){let t=U(n);return bs.getStore(t.simpleDbTransaction,e)}function kF(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Qo(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function e2(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var Fe=class n{constructor(e,t){this.comparator=e,this.root=t||Ed.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Ed.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Ed.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Ol(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Ol(this.root,e,this.comparator,!1)}getReverseIterator(){return new Ol(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Ol(this.root,e,this.comparator,!0)}},Ol=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)this.isReverse?e=e.left:e=e.right;else if(s===0){this.nodeStack.push(e);break}else this.nodeStack.push(e),this.isReverse?e=e.right:e=e.left}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},Ed=(()=>{class n{constructor(t,r,i,s,o){this.key=t,this.value=r,this.color=i??n.RED,this.left=s??n.EMPTY,this.right=o??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,r,i,s,o){return new n(t??this.key,r??this.value,i??this.color,s??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,r,i){let s=this,o=i(t,s.key);return o<0?s=s.copy(null,null,null,s.left.insert(t,r,i),null):o===0?s=s.copy(null,r,null,null,null):s=s.copy(null,null,null,null,s.right.insert(t,r,i)),s.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let t=this;return!t.left.isRed()&&!t.left.left.isRed()&&(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,r){let i,s=this;if(r(t,s.key)<0)!s.left.isEmpty()&&!s.left.isRed()&&!s.left.left.isRed()&&(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,r),null);else{if(s.left.isRed()&&(s=s.rotateRight()),!s.right.isEmpty()&&!s.right.isRed()&&!s.right.left.isRed()&&(s=s.moveRedRight()),r(t,s.key)===0){if(s.right.isEmpty())return n.EMPTY;i=s.right.min(),s=s.copy(i.key,i.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,r))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let t=this.left.copy(null,null,!this.left.color,null,null),r=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,r)}checkMaxDepth(){let t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw z();let t=this.left.check();if(t!==this.right.check())throw z();return t+(this.isRed()?0:1)}}return n.EMPTY=null,n.RED=!0,n.BLACK=!1,n})(),sb=class{constructor(){this.size=0}get key(){throw z()}get value(){throw z()}get color(){throw z()}get left(){throw z()}get right(){throw z()}copy(e,t,r,i,s){return this}insert(e,t,r){return new Ed(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};Ed.EMPTY=new sb;var De=class n{constructor(e){this.comparator=e,this.data=new Fe(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(t!==void 0?r=this.data.getIteratorFrom(t):r=this.data.getIterator();r.hasNext();){let i=r.getNext();if(!e(i.key))return}}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new fg(this.data.getIterator())}getIteratorFrom(e){return new fg(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},fg=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function dQ(n,e,t,r,i){let s=n.getIterator(),o=e.getIterator(),a=Cl(s),l=Cl(o);for(;a||l;){let c=!1,u=!1;if(a&&l){let d=t(a,l);d<0?u=!0:d>0&&(c=!0)}else a!=null?u=!0:c=!0;c?(r(l),l=Cl(o)):u?(i(a),a=Cl(s)):(a=Cl(s),l=Cl(o))}}function Cl(n){return n.hasNext()?n.getNext():void 0}var En=class n{constructor(e){this.fields=e,e.sort(it.comparator)}static empty(){return new n([])}unionWith(e){let t=new De(it.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Po(this.fields,e.fields,(t,r)=>t.isEqual(r))}};function hQ(n){return Buffer.from(n,"base64").toString("binary")}function fQ(n){return Buffer.from(n,"binary").toString("base64")}function t2(){return!0}var st=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=hQ(e);return new n(t)}static fromUint8Array(e){let t=pQ(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return fQ(this.binaryString)}toUint8Array(){return mQ(this.binaryString)}approximateByteSize(){return this.binaryString.length*2}compareTo(e){return ne(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};st.EMPTY_BYTE_STRING=new st("");function pQ(n){let e="";for(let t=0;t<n.length;++t)e+=String.fromCharCode(n[t]);return e}function mQ(n){let e=new Uint8Array(n.length);for(let t=0;t<n.length;t++)e[t]=n.charCodeAt(t);return e}var gQ=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function mi(n){if(j(!!n),typeof n=="string"){let e=0,t=gQ.exec(n);if(j(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}else{let e=Ge(n.seconds),t=Ge(n.nanos);return{seconds:e,nanos:t}}}function Ge(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Is(n){return typeof n=="string"?st.fromBase64String(n):st.fromUint8Array(n)}var n2="server_timestamp",r2="__type__",i2="__previous_value__",s2="__local_write_time__";function oy(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[r2])===null||t===void 0?void 0:t.stringValue)===n2}function yQ(n,e){let t={fields:{[r2]:{stringValue:n2},[s2]:{timestampValue:{seconds:n.seconds,nanos:n.nanoseconds}}}};return e&&oy(e)&&(e=Z0(e)),e&&(t.fields[i2]=e),{mapValue:t}}function Z0(n){let e=n.mapValue.fields[i2];return oy(e)?Z0(e):e}function Rd(n){let e=mi(n.mapValue.fields[s2].timestampValue);return new He(e.seconds,e.nanos)}var ob=class{constructor(e,t,r,i,s,o,a,l,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=c}},ab="(default)",As=class n{constructor(e,t){this.projectId=e,this.database=t||ab}static empty(){return new n("","")}get isDefaultDatabase(){return this.database===ab}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};function _Q(n,e){if(!Object.prototype.hasOwnProperty.apply(n.options,["projectId"]))throw new k(R.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new As(n.options.projectId,e)}var ws=-1;function Jd(n){return n==null}function Dd(n){return n===0&&1/n===-1/0}function o2(n){return typeof n=="number"&&Number.isInteger(n)&&!Dd(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}var eI="__type__",a2="__max__",Ss={mapValue:{fields:{__type__:{stringValue:a2}}}},tI="__vector__",Vl="value",ig={nullValue:"NULL_VALUE"};function Fo(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?oy(n)?4:c2(n)?9007199254740991:ay(n)?10:11:z()}function sr(n,e){if(n===e)return!0;let t=Fo(n),r=Fo(e);if(t!==r)return!1;switch(t){case 0:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Rd(n).isEqual(Rd(e));case 3:return vQ(n,e);case 5:return n.stringValue===e.stringValue;case 6:return SQ(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return EQ(n,e);case 2:return CQ(n,e);case 9:return Po(n.arrayValue.values||[],e.arrayValue.values||[],sr);case 10:case 11:return wQ(n,e);case 9007199254740991:return!0;default:return z()}}function vQ(n,e){if(typeof n.timestampValue=="string"&&typeof e.timestampValue=="string"&&n.timestampValue.length===e.timestampValue.length)return n.timestampValue===e.timestampValue;let t=mi(n.timestampValue),r=mi(e.timestampValue);return t.seconds===r.seconds&&t.nanos===r.nanos}function EQ(n,e){return Ge(n.geoPointValue.latitude)===Ge(e.geoPointValue.latitude)&&Ge(n.geoPointValue.longitude)===Ge(e.geoPointValue.longitude)}function SQ(n,e){return Is(n.bytesValue).isEqual(Is(e.bytesValue))}function CQ(n,e){if("integerValue"in n&&"integerValue"in e)return Ge(n.integerValue)===Ge(e.integerValue);if("doubleValue"in n&&"doubleValue"in e){let t=Ge(n.doubleValue),r=Ge(e.doubleValue);return t===r?Dd(t)===Dd(r):isNaN(t)&&isNaN(r)}return!1}function wQ(n,e){let t=n.mapValue.fields||{},r=e.mapValue.fields||{};if(kF(t)!==kF(r))return!1;for(let i in t)if(t.hasOwnProperty(i)&&(r[i]===void 0||!sr(t[i],r[i])))return!1;return!0}function Nd(n,e){return(n.values||[]).find(t=>sr(t,e))!==void 0}function Rs(n,e){if(n===e)return 0;let t=Fo(n),r=Fo(e);if(t!==r)return ne(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return ne(n.booleanValue,e.booleanValue);case 2:return TQ(n,e);case 3:return OF(n.timestampValue,e.timestampValue);case 4:return OF(Rd(n),Rd(e));case 5:return ne(n.stringValue,e.stringValue);case 6:return AQ(n.bytesValue,e.bytesValue);case 7:return bQ(n.referenceValue,e.referenceValue);case 8:return IQ(n.geoPointValue,e.geoPointValue);case 9:return l2(n.arrayValue,e.arrayValue);case 10:return RQ(n.mapValue,e.mapValue);case 11:return DQ(n.mapValue,e.mapValue);default:throw z()}}function TQ(n,e){let t=Ge(n.integerValue||n.doubleValue),r=Ge(e.integerValue||e.doubleValue);return t<r?-1:t>r?1:t===r?0:isNaN(t)?isNaN(r)?0:-1:1}function OF(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return ne(n,e);let t=mi(n),r=mi(e),i=ne(t.seconds,r.seconds);return i!==0?i:ne(t.nanos,r.nanos)}function bQ(n,e){let t=n.split("/"),r=e.split("/");for(let i=0;i<t.length&&i<r.length;i++){let s=ne(t[i],r[i]);if(s!==0)return s}return ne(t.length,r.length)}function IQ(n,e){let t=ne(Ge(n.latitude),Ge(e.latitude));return t!==0?t:ne(Ge(n.longitude),Ge(e.longitude))}function AQ(n,e){let t=Is(n),r=Is(e);return t.compareTo(r)}function l2(n,e){let t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){let s=Rs(t[i],r[i]);if(s)return s}return ne(t.length,r.length)}function RQ(n,e){var t,r,i,s;let o=n.fields||{},a=e.fields||{},l=(t=o[Vl])===null||t===void 0?void 0:t.arrayValue,c=(r=a[Vl])===null||r===void 0?void 0:r.arrayValue,u=ne(((i=l?.values)===null||i===void 0?void 0:i.length)||0,((s=c?.values)===null||s===void 0?void 0:s.length)||0);return u!==0?u:l2(l,c)}function DQ(n,e){if(n===Ss.mapValue&&e===Ss.mapValue)return 0;if(n===Ss.mapValue)return 1;if(e===Ss.mapValue)return-1;let t=n.fields||{},r=Object.keys(t),i=e.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let o=0;o<r.length&&o<s.length;++o){let a=ne(r[o],s[o]);if(a!==0)return a;let l=Rs(t[r[o]],i[s[o]]);if(l!==0)return l}return ne(r.length,s.length)}function Ul(n){return nI(n)}function nI(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?kQ(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?NQ(n.bytesValue):"referenceValue"in n?xQ(n.referenceValue):"geoPointValue"in n?OQ(n.geoPointValue):"arrayValue"in n?MQ(n.arrayValue):"mapValue"in n?PQ(n.mapValue):z()}function NQ(n){return Is(n).toBase64()}function kQ(n){let e=mi(n);return`time(${e.seconds},${e.nanos})`}function OQ(n){return`geo(${n.latitude},${n.longitude})`}function xQ(n){return V.fromName(n).toString()}function PQ(n){let e=Object.keys(n.fields||{}).sort(),t="{",r=!0;for(let i of e)r?r=!1:t+=",",t+=`${i}:${nI(n.fields[i])}`;return t+"}"}function MQ(n){let e="[",t=!0;for(let r of n.values||[])t?t=!1:e+=",",e+=nI(r);return e+"]"}function Lo(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function lb(n){return!!n&&"integerValue"in n}function FQ(n){return!!n&&"doubleValue"in n}function LQ(n){return lb(n)||FQ(n)}function kd(n){return!!n&&"arrayValue"in n}function xF(n){return!!n&&"nullValue"in n}function PF(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function sg(n){return!!n&&"mapValue"in n}function ay(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[eI])===null||t===void 0?void 0:t.stringValue)===tI}function Sd(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return Qo(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Sd(r)),e}else if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Sd(n.arrayValue.values[t]);return e}else return Object.assign({},n)}function c2(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===a2}var u2={mapValue:{fields:{[eI]:{stringValue:tI},[Vl]:{arrayValue:{}}}}};function BQ(n){return"nullValue"in n?ig:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Lo(As.empty(),V.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?ay(n)?u2:{mapValue:{}}:z()}function VQ(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Lo(As.empty(),V.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?u2:"mapValue"in n?ay(n)?{mapValue:{}}:Ss:z()}function MF(n,e){let t=Rs(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function FF(n,e){let t=Rs(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}var Lt=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!sg(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){let r=this.getFieldsMap(e.popLast());r[e.lastSegment()]=Sd(t)}setAll(e){let t=it.emptyPath(),r={},i=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){let l=this.getFieldsMap(t);this.applyChanges(l,r,i),r={},i=[],t=a.popLast()}o?r[a.lastSegment()]=Sd(o):i.push(a.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){let t=this.field(e.popLast());sg(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return sr(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];(!sg(i)||!i.mapValue.fields)&&(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){Qo(t,(i,s)=>e[i]=s);for(let i of r)delete e[i]}clone(){return new n(Sd(this.value))}};function d2(n){let e=[];return Qo(n.fields,(t,r)=>{let i=new it([t]);if(sg(r)){let o=d2(r.mapValue).fields;if(o.length===0)e.push(i);else for(let a of o)e.push(i.child(a))}else e.push(i)}),new En(e)}var ht=class n{constructor(e,t,r,i,s,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new n(e,0,Q.min(),Q.min(),Q.min(),Lt.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,Q.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,Q.min(),Q.min(),Lt.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,Q.min(),Q.min(),Lt.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(Q.min())&&(this.documentType===2||this.documentType===0)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Lt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Lt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Q.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};function UQ(n,e,t){let r=e.data.field(n),i=t.data.field(n);return r!==null&&i!==null?Rs(r,i):z()}var jr=class{constructor(e,t){this.position=e,this.inclusive=t}};function h2(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let s=e[i],o=n.position[i];if(s.field.isKeyField())r=V.comparator(V.fromName(o.referenceValue),t.key);else{let a=t.data.field(s.field);r=Rs(o,a)}if(s.dir==="desc"&&(r=r*-1),r!==0)break}return r}function qQ(n,e,t){let r=h2(n,e,t);return n.inclusive?r>=0:r>0}function zQ(n,e,t){let r=h2(n,e,t);return n.inclusive?r<=0:r<0}function LF(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++){let r=n.position[t],i=e.position[t];if(!sr(r,i))return!1}return!0}var Bo=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function GQ(n){return n.field.canonicalString()+n.dir}function WQ(n){return`${n.field.canonicalString()} (${n.dir})`}function jQ(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var pg=class{},de=class n extends pg{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new db(e,t,r):t==="array-contains"?new pb(e,r):t==="in"?new mg(e,r):t==="not-in"?new mb(e,r):t==="array-contains-any"?new gb(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new hb(e,r):new fb(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(Rs(t,this.value)):t!==null&&Fo(this.value)===Fo(t)&&this.matchesComparison(Rs(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return z()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},Ie=class n extends pg{constructor(e,t){super(),this.filters=e,this.op=t,this.memoizedFlattenedFilters=null}static create(e,t){return new n(e,t)}matches(e){return ql(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.memoizedFlattenedFilters!==null?this.memoizedFlattenedFilters:(this.memoizedFlattenedFilters=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[]),this.memoizedFlattenedFilters)}getFilters(){return Object.assign([],this.filters)}};function ql(n){return n.op==="and"}function cb(n){return n.op==="or"}function rI(n){return f2(n)&&ql(n)}function f2(n){for(let e of n.filters)if(e instanceof Ie)return!1;return!0}function ub(n){if(n instanceof de)return n.field.canonicalString()+n.op.toString()+Ul(n.value);if(rI(n))return n.filters.map(e=>ub(e)).join(",");{let e=n.filters.map(t=>ub(t)).join(",");return`${n.op}(${e})`}}function p2(n,e){if(n instanceof de)return $Q(n,e);if(n instanceof Ie)return HQ(n,e);z()}function $Q(n,e){return e instanceof de&&n.op===e.op&&n.field.isEqual(e.field)&&sr(n.value,e.value)}function HQ(n,e){return e instanceof Ie&&n.op===e.op&&n.filters.length===e.filters.length?n.filters.reduce((r,i,s)=>r&&p2(i,e.filters[s]),!0):!1}function m2(n,e){let t=n.filters.concat(e);return Ie.create(t,n.op)}function g2(n){return n instanceof de?QQ(n):n instanceof Ie?KQ(n):"Filter"}function KQ(n){return n.op.toString()+" {"+n.getFilters().map(g2).join(" ,")+"}"}function QQ(n){return`${n.field.canonicalString()} ${n.op} ${Ul(n.value)}`}var db=class extends de{constructor(e,t,r){super(e,t,r),this.key=V.fromName(r.referenceValue)}matches(e){let t=V.comparator(e.key,this.key);return this.matchesComparison(t)}},hb=class extends de{constructor(e,t){super(e,"in",t),this.keys=y2("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},fb=class extends de{constructor(e,t){super(e,"not-in",t),this.keys=y2("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function y2(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>V.fromName(r.referenceValue))}var pb=class extends de{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return kd(t)&&Nd(t.arrayValue,this.value)}},mg=class extends de{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&Nd(this.value.arrayValue,t)}},mb=class extends de{constructor(e,t){super(e,"not-in",t)}matches(e){if(Nd(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!Nd(this.value.arrayValue,t)}},gb=class extends de{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!kd(t)||!t.arrayValue.values?!1:t.arrayValue.values.some(r=>Nd(this.value.arrayValue,r))}};var yb=class{constructor(e,t=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.memoizedCanonicalId=null}};function _b(n,e=null,t=[],r=[],i=null,s=null,o=null){return new yb(n,e,t,r,i,s,o)}function Vo(n){let e=U(n);if(e.memoizedCanonicalId===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>ub(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>GQ(r)).join(","),Jd(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Ul(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Ul(r)).join(",")),e.memoizedCanonicalId=t}return e.memoizedCanonicalId}function YQ(n){let e=n.path.canonicalString();return n.collectionGroup!==null&&(e+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(e+=`, filters: [${n.filters.map(t=>g2(t)).join(", ")}]`),Jd(n.limit)||(e+=", limit: "+n.limit),n.orderBy.length>0&&(e+=`, orderBy: [${n.orderBy.map(t=>WQ(t)).join(", ")}]`),n.startAt&&(e+=", startAt: ",e+=n.startAt.inclusive?"b:":"a:",e+=n.startAt.position.map(t=>Ul(t)).join(",")),n.endAt&&(e+=", endAt: ",e+=n.endAt.inclusive?"a:":"b:",e+=n.endAt.position.map(t=>Ul(t)).join(",")),`Target(${e})`}function Zd(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!jQ(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!p2(n.filters[t],e.filters[t]))return!1;return n.collectionGroup!==e.collectionGroup||!n.path.isEqual(e.path)||!LF(n.startAt,e.startAt)?!1:LF(n.endAt,e.endAt)}function gg(n){return V.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function ly(n,e){return n.filters.filter(t=>t instanceof de&&t.field.isEqual(e))}function XQ(n,e){let t=$0(e);if(t===void 0)return null;for(let r of ly(n,t.fieldPath))switch(r.op){case"array-contains-any":return r.value.arrayValue.values||[];case"array-contains":return[r.value]}return null}function JQ(n,e){let t=new Map;for(let r of Mo(e))for(let i of ly(n,r.fieldPath))switch(i.op){case"==":case"in":t.set(r.fieldPath.canonicalString(),i.value);break;case"not-in":case"!=":return t.set(r.fieldPath.canonicalString(),i.value),Array.from(t.values())}return null}function ZQ(n,e){let t=[],r=!0;for(let i of Mo(e)){let s=i.kind===0?_2(n,i.fieldPath,n.startAt):v2(n,i.fieldPath,n.startAt);t.push(s.value),r&&(r=s.inclusive)}return new jr(t,r)}function e7(n,e){let t=[],r=!0;for(let i of Mo(e)){let s=i.kind===0?v2(n,i.fieldPath,n.endAt):_2(n,i.fieldPath,n.endAt);t.push(s.value),r&&(r=s.inclusive)}return new jr(t,r)}function _2(n,e,t){let r=ig,i=!0;for(let s of ly(n,e)){let o=ig,a=!0;switch(s.op){case"<":case"<=":o=BQ(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,a=!1;break;case"!=":case"not-in":o=ig;break}MF({value:r,inclusive:i},{value:o,inclusive:a})<0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let a=t.position[s];MF({value:r,inclusive:i},{value:a,inclusive:t.inclusive})<0&&(r=a,i=t.inclusive);break}}return{value:r,inclusive:i}}function v2(n,e,t){let r=Ss,i=!0;for(let s of ly(n,e)){let o=Ss,a=!0;switch(s.op){case">=":case">":o=VQ(s.value),a=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,a=!1;break;case"!=":case"not-in":o=Ss;break}FF({value:r,inclusive:i},{value:o,inclusive:a})>0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let a=t.position[s];FF({value:r,inclusive:i},{value:a,inclusive:t.inclusive})>0&&(r=a,i=t.inclusive);break}}return{value:r,inclusive:i}}function t7(n){let e=new De(it.comparator),t=!1;for(let r of n.filters)for(let i of r.getFlattenedFilters())i.field.isKeyField()||(i.op==="array-contains"||i.op==="array-contains-any"?t=!0:e=e.add(i.field));for(let r of n.orderBy)r.field.isKeyField()||(e=e.add(r.field));return e.size+(t?1:0)}function n7(n){return n.limit!==null}var or=class{constructor(e,t=null,r=[],i=[],s=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=l,this.memoizedNormalizedOrderBy=null,this.memoizedTarget=null,this.memoizedAggregateTarget=null,this.startAt,this.endAt}};function E2(n,e,t,r,i,s,o,a){return new or(n,e,t,r,i,s,o,a)}function sc(n){return new or(n)}function r7(n,e){return new or(e,null,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,n.startAt,n.endAt)}function BF(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function i7(n){let e=new De(it.comparator);return n.filters.forEach(t=>{t.getFlattenedFilters().forEach(i=>{i.isInequality()&&(e=e.add(i.field))})}),e}function s7(n){return new or(pe.emptyPath(),n)}function o7(n){return V.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function iI(n){return n.collectionGroup!==null}function zl(n){let e=U(n);if(e.memoizedNormalizedOrderBy===null){e.memoizedNormalizedOrderBy=[];let t=new Set;for(let s of e.explicitOrderBy)e.memoizedNormalizedOrderBy.push(s),t.add(s.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";i7(e).forEach(s=>{!t.has(s.canonicalString())&&!s.isKeyField()&&e.memoizedNormalizedOrderBy.push(new Bo(s,r))}),t.has(it.keyField().canonicalString())||e.memoizedNormalizedOrderBy.push(new Bo(it.keyField(),r))}return e.memoizedNormalizedOrderBy}function Xt(n){let e=U(n);return e.memoizedTarget||(e.memoizedTarget=a7(e,zl(n))),e.memoizedTarget}function a7(n,e){if(n.limitType==="F")return _b(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new Bo(i.field,s)});let t=n.endAt?new jr(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new jr(n.startAt.position,n.startAt.inclusive):null;return _b(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function sI(n,e){let t=n.filters.concat([e]);return new or(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function l7(n,e){let t=n.explicitOrderBy.concat([e]);return new or(n.path,n.collectionGroup,t,n.filters.slice(),n.limit,n.limitType,n.startAt,n.endAt)}function yg(n,e,t){return new or(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function c7(n,e){return new or(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,e,n.endAt)}function u7(n,e){return new or(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,n.startAt,e)}function eh(n,e){return Zd(Xt(n),Xt(e))&&n.limitType===e.limitType}function S2(n){return`${Vo(Xt(n))}|lt:${n.limitType}`}function Dl(n){return`Query(target=${YQ(Xt(n))}; limitType=${n.limitType})`}function th(n,e){return e.isFoundDocument()&&d7(n,e)&&h7(n,e)&&f7(n,e)&&p7(n,e)}function d7(n,e){let t=e.key.path;return n.collectionGroup!==null?e.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(t):V.isDocumentKey(n.path)?n.path.isEqual(t):n.path.isImmediateParentOf(t)}function h7(n,e){for(let t of zl(n))if(!t.field.isKeyField()&&e.data.field(t.field)===null)return!1;return!0}function f7(n,e){for(let t of n.filters)if(!t.matches(e))return!1;return!0}function p7(n,e){return!(n.startAt&&!zQ(n.startAt,zl(n),e)||n.endAt&&!qQ(n.endAt,zl(n),e))}function C2(n){return n.collectionGroup||(n.path.length%2===1?n.path.lastSegment():n.path.get(n.path.length-2))}function w2(n){return(e,t)=>{let r=!1;for(let i of zl(n)){let s=m7(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function m7(n,e,t){let r=n.field.isKeyField()?V.comparator(e.key,t.key):UQ(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return z()}}var $r=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0){this.inner[r]=[[e,t]],this.innerSize++;return}for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e)){i[s]=[e,t];return}i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Qo(this.inner,(t,r)=>{for(let[i,s]of r)e(i,s)})}isEmpty(){return e2(this.inner)}size(){return this.innerSize}};var g7=new Fe(V.comparator);function on(){return g7}var T2=new Fe(V.comparator);function yd(...n){let e=T2;for(let t of n)e=e.insert(t.key,t);return e}function y7(){return Od()}function b2(n){let e=T2;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function zr(){return Od()}function I2(){return Od()}function Od(){return new $r(n=>n.toString(),(n,e)=>n.isEqual(e))}var _7=new Fe(V.comparator);function v7(){return _7}var E7=new De(V.comparator);function ie(...n){let e=E7;for(let t of n)e=e.add(t);return e}var S7=new De(ne);function oI(){return S7}function aI(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Dd(e)?"-0":e}}function A2(n){return{integerValue:""+n}}function R2(n,e){return o2(e)?A2(e):aI(n,e)}var Gl=class{constructor(){this._=void 0}};function C7(n,e,t){return n instanceof Ds?yQ(t,e):n instanceof gi?N2(n,e):n instanceof yi?k2(n,e):b7(n,e)}function w7(n,e,t){return n instanceof gi?N2(n,e):n instanceof yi?k2(n,e):t}function D2(n,e){return n instanceof Ns?LQ(e)?e:{integerValue:0}:null}function T7(n,e){return n instanceof gi&&e instanceof gi||n instanceof yi&&e instanceof yi?Po(n.elements,e.elements,sr):n instanceof Ns&&e instanceof Ns?sr(n.operand,e.operand):n instanceof Ds&&e instanceof Ds}var Ds=class extends Gl{},gi=class extends Gl{constructor(e){super(),this.elements=e}};function N2(n,e){let t=O2(e);for(let r of n.elements)t.some(i=>sr(i,r))||t.push(r);return{arrayValue:{values:t}}}var yi=class extends Gl{constructor(e){super(),this.elements=e}};function k2(n,e){let t=O2(e);for(let r of n.elements)t=t.filter(i=>!sr(i,r));return{arrayValue:{values:t}}}var Ns=class extends Gl{constructor(e,t){super(),this.serializer=e,this.operand=t}};function b7(n,e){let t=D2(n,e),r=VF(t)+VF(n.operand);return lb(t)&&lb(n.operand)?A2(r):aI(n.serializer,r)}function VF(n){return Ge(n.integerValue||n.doubleValue)}function O2(n){return kd(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}var Uo=class{constructor(e,t){this.field=e,this.transform=t}};function I7(n,e){return n.field.isEqual(e.field)&&T7(n.transform,e.transform)}function A7(n,e){return n===void 0&&e===void 0?!0:n&&e?Po(n,e,(t,r)=>I7(t,r)):!1}var vb=class{constructor(e,t){this.version=e,this.transformResults=t}},Je=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function cy(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists!==void 0?n.exists===e.isFoundDocument():!0}var Wl=class{};function x2(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Os(n.key,Je.none()):new ks(n.key,n.data,Je.none());{let t=n.data,r=Lt.empty(),i=new De(it.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new ar(n.key,r,new En(i.toArray()),Je.none())}}function R7(n,e,t){n instanceof ks?N7(n,e,t):n instanceof ar?O7(n,e,t):P7(n,e,t)}function Cd(n,e,t,r){return n instanceof ks?k7(n,e,t,r):n instanceof ar?x7(n,e,t,r):M7(n,e,t)}function D7(n,e){let t=null;for(let r of n.fieldTransforms){let i=e.data.field(r.field),s=D2(r.transform,i||null);s!=null&&(t===null&&(t=Lt.empty()),t.set(r.field,s))}return t||null}function UF(n,e){return n.type!==e.type||!n.key.isEqual(e.key)||!n.precondition.isEqual(e.precondition)||!A7(n.fieldTransforms,e.fieldTransforms)?!1:n.type===0?n.value.isEqual(e.value):n.type===1?n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask):!0}var ks=class extends Wl{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}};function N7(n,e,t){let r=n.value.clone(),i=M2(n.fieldTransforms,e,t.transformResults);r.setAll(i),e.convertToFoundDocument(t.version,r).setHasCommittedMutations()}function k7(n,e,t,r){if(!cy(n.precondition,e))return t;let i=n.value.clone(),s=F2(n.fieldTransforms,r,e);return i.setAll(s),e.convertToFoundDocument(e.version,i).setHasLocalMutations(),null}var ar=class extends Wl{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function O7(n,e,t){if(!cy(n.precondition,e)){e.convertToUnknownDocument(t.version);return}let r=M2(n.fieldTransforms,e,t.transformResults),i=e.data;i.setAll(P2(n)),i.setAll(r),e.convertToFoundDocument(t.version,i).setHasCommittedMutations()}function x7(n,e,t,r){if(!cy(n.precondition,e))return t;let i=F2(n.fieldTransforms,r,e),s=e.data;return s.setAll(P2(n)),s.setAll(i),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),t===null?null:t.unionWith(n.fieldMask.fields).unionWith(n.fieldTransforms.map(o=>o.field))}function P2(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function M2(n,e,t){let r=new Map;j(n.length===t.length);for(let i=0;i<t.length;i++){let s=n[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,w7(o,a,t[i]))}return r}function F2(n,e,t){let r=new Map;for(let i of n){let s=i.transform,o=t.data.field(i.field);r.set(i.field,C7(s,o,e))}return r}var Os=class extends Wl{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}};function P7(n,e,t){e.convertToNoDocument(t.version).setHasCommittedMutations()}function M7(n,e,t){return cy(n.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):t}var xd=class extends Wl{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var Pd=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];if(s.key.isEqual(e.key)){let o=r[i];R7(s,e,o)}}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=Cd(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=Cd(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=I2();return this.mutations.forEach(i=>{let s=e.get(i.key),o=s.overlayedDocument,a=this.applyToLocalView(o,s.mutatedFields);a=t.has(i.key)?null:a;let l=x2(o,a);l!==null&&r.set(i.key,l),o.isValidDocument()||o.convertToNoDocument(Q.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),ie())}isEqual(e){return this.batchId===e.batchId&&Po(this.mutations,e.mutations,(t,r)=>UF(t,r))&&Po(this.baseMutations,e.baseMutations,(t,r)=>UF(t,r))}},Eb=class n{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){j(e.mutations.length===r.length);let i=v7(),s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new n(e,t,r,i)}};var Md=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var Sb=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var At=function(n){return n[n.OK=0]="OK",n[n.CANCELLED=1]="CANCELLED",n[n.UNKNOWN=2]="UNKNOWN",n[n.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",n[n.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",n[n.NOT_FOUND=5]="NOT_FOUND",n[n.ALREADY_EXISTS=6]="ALREADY_EXISTS",n[n.PERMISSION_DENIED=7]="PERMISSION_DENIED",n[n.UNAUTHENTICATED=16]="UNAUTHENTICATED",n[n.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",n[n.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",n[n.ABORTED=10]="ABORTED",n[n.OUT_OF_RANGE=11]="OUT_OF_RANGE",n[n.UNIMPLEMENTED=12]="UNIMPLEMENTED",n[n.INTERNAL=13]="INTERNAL",n[n.UNAVAILABLE=14]="UNAVAILABLE",n[n.DATA_LOSS=15]="DATA_LOSS",n}(At||{});function L2(n){switch(n){case R.OK:return z();case R.CANCELLED:case R.UNKNOWN:case R.DEADLINE_EXCEEDED:case R.RESOURCE_EXHAUSTED:case R.INTERNAL:case R.UNAVAILABLE:case R.UNAUTHENTICATED:return!1;case R.INVALID_ARGUMENT:case R.NOT_FOUND:case R.ALREADY_EXISTS:case R.PERMISSION_DENIED:case R.FAILED_PRECONDITION:case R.ABORTED:case R.OUT_OF_RANGE:case R.UNIMPLEMENTED:case R.DATA_LOSS:return!0;default:return z()}}function F7(n){return L2(n)&&n!==R.ABORTED}function og(n){if(n===void 0)return $e("GRPC error has no .code"),R.UNKNOWN;switch(n){case At.OK:return R.OK;case At.CANCELLED:return R.CANCELLED;case At.UNKNOWN:return R.UNKNOWN;case At.DEADLINE_EXCEEDED:return R.DEADLINE_EXCEEDED;case At.RESOURCE_EXHAUSTED:return R.RESOURCE_EXHAUSTED;case At.INTERNAL:return R.INTERNAL;case At.UNAVAILABLE:return R.UNAVAILABLE;case At.UNAUTHENTICATED:return R.UNAUTHENTICATED;case At.INVALID_ARGUMENT:return R.INVALID_ARGUMENT;case At.NOT_FOUND:return R.NOT_FOUND;case At.ALREADY_EXISTS:return R.ALREADY_EXISTS;case At.PERMISSION_DENIED:return R.PERMISSION_DENIED;case At.FAILED_PRECONDITION:return R.FAILED_PRECONDITION;case At.ABORTED:return R.ABORTED;case At.OUT_OF_RANGE:return R.OUT_OF_RANGE;case At.UNIMPLEMENTED:return R.UNIMPLEMENTED;case At.DATA_LOSS:return R.DATA_LOSS;default:return z()}}var Cb=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var OT=null;function B2(){return new m8}function L7(){return new g8("utf-8")}var B7=new gs([4294967295,4294967295],0);function qF(n){let e=B2().encode(n),t=new kT;return t.update(e),new Uint8Array(t.digest())}function zF(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0),o=new gs([t,r],0),a=new gs([i,s],0);return[o,a]}var wb=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new ko(`Invalid padding: ${t}`);if(r<0)throw new ko(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new ko(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new ko(`Invalid padding when bitmap length is 0: ${t}`);this.bitCount=e.length*8-t,this.bitCountInInteger=gs.fromNumber(this.bitCount)}getBitIndex(e,t,r){let i=e.add(t.multiply(gs.fromNumber(r)));return i.compare(B7)===1&&(i=new gs([i.getBits(0),i.getBits(1)],0)),i.modulo(this.bitCountInInteger).toNumber()}isBitSet(e){let t=this.bitmap[Math.floor(e/8)],r=e%8;return(t&1<<r)!==0}mightContain(e){if(this.bitCount===0)return!1;let t=qF(e),[r,i]=zF(t);for(let s=0;s<this.hashCount;s++){let o=this.getBitIndex(r,i,s);if(!this.isBitSet(o))return!1}return!0}static create(e,t,r){let i=e%8===0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new n(s,i,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.bitCount===0)return;let t=qF(e),[r,i]=zF(t);for(let s=0;s<this.hashCount;s++){let o=this.getBitIndex(r,i,s);this.setBit(o)}}setBit(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},ko=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var Fd=class n{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,Ld.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n(Q.min(),i,new Fe(ne),on(),ie())}},Ld=class n{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,ie(),ie(),ie())}};var Fl=class{constructor(e,t,r,i){this.updatedTargetIds=e,this.removedTargetIds=t,this.key=r,this.newDoc=i}},_g=class{constructor(e,t){this.targetId=e,this.existenceFilter=t}},vg=class{constructor(e,t,r=st.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},Eg=class{constructor(){this.pendingResponses=0,this.documentChanges=WF(),this._resumeToken=st.EMPTY_BYTE_STRING,this._current=!1,this._hasPendingChanges=!0}get current(){return this._current}get resumeToken(){return this._resumeToken}get isPending(){return this.pendingResponses!==0}get hasPendingChanges(){return this._hasPendingChanges}updateResumeToken(e){e.approximateByteSize()>0&&(this._hasPendingChanges=!0,this._resumeToken=e)}toTargetChange(){let e=ie(),t=ie(),r=ie();return this.documentChanges.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:z()}}),new Ld(this._resumeToken,this._current,e,t,r)}clearPendingChanges(){this._hasPendingChanges=!1,this.documentChanges=WF()}addDocumentChange(e,t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(e,t)}removeDocumentChange(e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(e)}recordPendingTargetRequest(){this.pendingResponses+=1}recordTargetResponse(){this.pendingResponses-=1,j(this.pendingResponses>=0)}markCurrent(){this._hasPendingChanges=!0,this._current=!0}},V7="WatchChangeAggregator",Tb=class{constructor(e){this.metadataProvider=e,this.targetStates=new Map,this.pendingDocumentUpdates=on(),this.pendingDocumentTargetMapping=GF(),this.pendingTargetResets=new Fe(ne)}handleDocumentChange(e){for(let t of e.updatedTargetIds)e.newDoc&&e.newDoc.isFoundDocument()?this.addDocumentToTarget(t,e.newDoc):this.removeDocumentFromTarget(t,e.key,e.newDoc);for(let t of e.removedTargetIds)this.removeDocumentFromTarget(t,e.key,e.newDoc)}handleTargetChange(e){this.forEachTarget(e,t=>{let r=this.ensureTargetState(t);switch(e.state){case 0:this.isActiveTarget(t)&&r.updateResumeToken(e.resumeToken);break;case 1:r.recordTargetResponse(),r.isPending||r.clearPendingChanges(),r.updateResumeToken(e.resumeToken);break;case 2:r.recordTargetResponse(),r.isPending||this.removeTarget(t);break;case 3:this.isActiveTarget(t)&&(r.markCurrent(),r.updateResumeToken(e.resumeToken));break;case 4:this.isActiveTarget(t)&&(this.resetTarget(t),r.updateResumeToken(e.resumeToken));break;default:z()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.targetStates.forEach((r,i)=>{this.isActiveTarget(i)&&t(i)})}handleExistenceFilter(e){let t=e.targetId,r=e.existenceFilter.count,i=this.targetDataForActiveTarget(t);if(i){let s=i.target;if(gg(s))if(r===0){let o=new V(s.path);this.removeDocumentFromTarget(t,o,ht.newNoDocument(o,Q.min()))}else j(r===1);else{let o=this.getCurrentDocumentCountForTarget(t);if(o!==r){let a=this.parseBloomFilter(e),l=a?this.applyBloomFilter(a,e,o):1;if(l!==0){this.resetTarget(t);let c=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.pendingTargetResets=this.pendingTargetResets.insert(t,c)}OT?.notifyOnExistenceFilterMismatch(U7(o,e.existenceFilter,this.metadataProvider.getDatabaseId(),a,l))}}}}parseBloomFilter(e){let t=e.existenceFilter.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t,o;try{o=Is(r).toUint8Array()}catch(l){if(l instanceof Cb)return ir("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}let a;try{a=new wb(o,i,s)}catch(l){return l instanceof ko?ir("BloomFilter error: ",l):ir("Applying bloom filter failed: ",l),null}return a.bitCount===0?null:a}applyBloomFilter(e,t,r){let i=t.existenceFilter.count,s=this.filterRemovedDocuments(e,t.targetId);return i===r-s?0:2}filterRemovedDocuments(e,t){let r=this.metadataProvider.getRemoteKeysForTarget(t),i=0;return r.forEach(s=>{let o=this.metadataProvider.getDatabaseId(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.removeDocumentFromTarget(t,s,null),i++)}),i}createRemoteEvent(e){let t=new Map;this.targetStates.forEach((s,o)=>{let a=this.targetDataForActiveTarget(o);if(a){if(s.current&&gg(a.target)){let l=new V(a.target.path);this.pendingDocumentUpdates.get(l)===null&&!this.targetContainsDocument(o,l)&&this.removeDocumentFromTarget(o,l,ht.newNoDocument(l,e))}s.hasPendingChanges&&(t.set(o,s.toTargetChange()),s.clearPendingChanges())}});let r=ie();this.pendingDocumentTargetMapping.forEach((s,o)=>{let a=!0;o.forEachWhile(l=>{let c=this.targetDataForActiveTarget(l);return c&&c.purpose!=="TargetPurposeLimboResolution"?(a=!1,!1):!0}),a&&(r=r.add(s))}),this.pendingDocumentUpdates.forEach((s,o)=>o.setReadTime(e));let i=new Fd(e,t,this.pendingTargetResets,this.pendingDocumentUpdates,r);return this.pendingDocumentUpdates=on(),this.pendingDocumentTargetMapping=GF(),this.pendingTargetResets=new Fe(ne),i}addDocumentToTarget(e,t){if(!this.isActiveTarget(e))return;let r=this.targetContainsDocument(e,t.key)?2:0;this.ensureTargetState(e).addDocumentChange(t.key,r),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t.key,t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t.key,this.ensureDocumentTargetMapping(t.key).add(e))}removeDocumentFromTarget(e,t,r){if(!this.isActiveTarget(e))return;let i=this.ensureTargetState(e);this.targetContainsDocument(e,t)?i.addDocumentChange(t,1):i.removeDocumentChange(t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,this.ensureDocumentTargetMapping(t).delete(e)),r&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t,r))}removeTarget(e){this.targetStates.delete(e)}getCurrentDocumentCountForTarget(e){let r=this.ensureTargetState(e).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(e).size+r.addedDocuments.size-r.removedDocuments.size}recordPendingTargetRequest(e){this.ensureTargetState(e).recordPendingTargetRequest()}ensureTargetState(e){let t=this.targetStates.get(e);return t||(t=new Eg,this.targetStates.set(e,t)),t}ensureDocumentTargetMapping(e){let t=this.pendingDocumentTargetMapping.get(e);return t||(t=new De(ne),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,t)),t}isActiveTarget(e){let t=this.targetDataForActiveTarget(e)!==null;return t||M(V7,"Detected inactive target",e),t}targetDataForActiveTarget(e){let t=this.targetStates.get(e);return t&&t.isPending?null:this.metadataProvider.getTargetDataForTarget(e)}resetTarget(e){this.targetStates.set(e,new Eg),this.metadataProvider.getRemoteKeysForTarget(e).forEach(r=>{this.removeDocumentFromTarget(e,r,null)})}targetContainsDocument(e,t){return this.metadataProvider.getRemoteKeysForTarget(e).has(t)}};function GF(){return new Fe(V.comparator)}function WF(){return new Fe(V.comparator)}function U7(n,e,t,r,i){var s,o,a,l,c,u;let d={localCacheCount:n,existenceFilterCount:e.count,databaseId:t.database,projectId:t.projectId},h=e.unchangedNames;return h&&(d.bloomFilter={applied:i===0,hashCount:(s=h?.hashCount)!==null&&s!==void 0?s:0,bitmapLength:(l=(a=(o=h?.bits)===null||o===void 0?void 0:o.bitmap)===null||a===void 0?void 0:a.length)!==null&&l!==void 0?l:0,padding:(u=(c=h?.bits)===null||c===void 0?void 0:c.padding)!==null&&u!==void 0?u:0,mightContain:p=>{var E;return(E=r?.mightContain(p))!==null&&E!==void 0?E:!1}}),d}var q7=(()=>{let n={};return n.asc="ASCENDING",n.desc="DESCENDING",n})(),z7=(()=>{let n={};return n["<"]="LESS_THAN",n["<="]="LESS_THAN_OR_EQUAL",n[">"]="GREATER_THAN",n[">="]="GREATER_THAN_OR_EQUAL",n["=="]="EQUAL",n["!="]="NOT_EQUAL",n["array-contains"]="ARRAY_CONTAINS",n.in="IN",n["not-in"]="NOT_IN",n["array-contains-any"]="ARRAY_CONTAINS_ANY",n})(),G7=(()=>{let n={};return n.and="AND",n.or="OR",n})();var bb=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function W7(n){let e=n.code===void 0?R.UNKNOWN:og(n.code);return new k(e,n.message||"")}function Ib(n,e){return n.useProto3Json||Jd(e)?e:{value:e}}function j7(n){let e;return typeof n=="object"?e=n.value:e=n,Jd(e)?null:e}function jl(n,e){if(n.useProto3Json){let r=new Date(e.seconds*1e3).toISOString().replace(/\.\d*/,"").replace("Z",""),i=("000000000"+e.nanoseconds).slice(-9);return`${r}.${i}Z`}else return{seconds:""+e.seconds,nanos:e.nanoseconds}}function $7(n){let e=mi(n);return new He(e.seconds,e.nanos)}function V2(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function H7(n,e){return n.useProto3Json?(j(e===void 0||typeof e=="string"),st.fromBase64String(e||"")):(j(e===void 0||e instanceof Buffer||e instanceof Uint8Array),st.fromUint8Array(e||new Uint8Array))}function K7(n,e){return jl(n,e.toTimestamp())}function rt(n){return j(!!n),Q.fromTimestamp($7(n))}function lI(n,e){return Ab(n,e).canonicalString()}function Ab(n,e){let t=Q7(n).child("documents");return e===void 0?t:t.child(e)}function U2(n){let e=pe.fromString(n);return j(Y2(e)),e}function Bd(n,e){return lI(n.databaseId,e.path)}function Gr(n,e){let t=U2(e);if(t.get(1)!==n.databaseId.projectId)throw new k(R.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new k(R.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new V(G2(t))}function q2(n,e){return lI(n.databaseId,e)}function z2(n){let e=U2(n);return e.length===4?pe.emptyPath():G2(e)}function Rb(n){return new pe(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Q7(n){return new pe(["projects",n.projectId,"databases",n.database])}function G2(n){return j(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function jF(n,e,t){return{name:Bd(n,e),fields:t.value.mapValue.fields}}function Y7(n,e){return{name:Bd(n,e.key),fields:e.data.value.mapValue.fields,updateTime:jl(n,e.version.toTimestamp()),createTime:jl(n,e.createTime.toTimestamp())}}function W2(n,e,t){let r=Gr(n,e.name),i=rt(e.updateTime),s=e.createTime?rt(e.createTime):Q.min(),o=new Lt({mapValue:{fields:e.fields}}),a=ht.newFoundDocument(r,i,s,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function X7(n,e){j(!!e.found),e.found.name,e.found.updateTime;let t=Gr(n,e.found.name),r=rt(e.found.updateTime),i=e.found.createTime?rt(e.found.createTime):Q.min(),s=new Lt({mapValue:{fields:e.found.fields}});return ht.newFoundDocument(t,r,i,s)}function J7(n,e){j(!!e.missing),j(!!e.readTime);let t=Gr(n,e.missing),r=rt(e.readTime);return ht.newNoDocument(t,r)}function Z7(n,e){return"found"in e?X7(n,e):"missing"in e?J7(n,e):z()}function eY(n,e){let t;if("targetChange"in e){e.targetChange;let r=tY(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=H7(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&W7(o);t=new vg(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=Gr(n,r.document.name),s=rt(r.document.updateTime),o=r.document.createTime?rt(r.document.createTime):Q.min(),a=new Lt({mapValue:{fields:r.document.fields}}),l=ht.newFoundDocument(i,s,o,a),c=r.targetIds||[],u=r.removedTargetIds||[];t=new Fl(c,u,l.key,l)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=Gr(n,r.document),s=r.readTime?rt(r.readTime):Q.min(),o=ht.newNoDocument(i,s),a=r.removedTargetIds||[];t=new Fl([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=Gr(n,r.document),s=r.removedTargetIds||[];t=new Fl([],s,i,null)}else if("filter"in e){e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,o=new Sb(i,s),a=r.targetId;t=new _g(a,o)}else return z();return t}function tY(n){return n==="NO_CHANGE"?0:n==="ADD"?1:n==="REMOVE"?2:n==="CURRENT"?3:n==="RESET"?4:z()}function nY(n){if(!("targetChange"in n))return Q.min();let e=n.targetChange;return e.targetIds&&e.targetIds.length||!e.readTime?Q.min():rt(e.readTime)}function Vd(n,e){let t;if(e instanceof ks)t={update:jF(n,e.key,e.value)};else if(e instanceof Os)t={delete:Bd(n,e.key)};else if(e instanceof ar)t={update:jF(n,e.key,e.data),updateMask:MY(e.fieldMask)};else if(e instanceof xd)t={verify:Bd(n,e.key)};else return z();return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>aY(n,r))),e.precondition.isNone||(t.currentDocument=rY(n,e.precondition)),t}function Db(n,e){let t=e.currentDocument?iY(e.currentDocument):Je.none(),r=e.updateTransforms?e.updateTransforms.map(i=>lY(n,i)):[];if(e.update){e.update.name;let i=Gr(n,e.update.name),s=new Lt({mapValue:{fields:e.update.fields}});if(e.updateMask){let o=FY(e.updateMask);return new ar(i,s,o,t,r)}else return new ks(i,s,t,r)}else if(e.delete){let i=Gr(n,e.delete);return new Os(i,t)}else if(e.verify){let i=Gr(n,e.verify);return new xd(i,t)}else return z()}function rY(n,e){return e.updateTime!==void 0?{updateTime:K7(n,e.updateTime)}:e.exists!==void 0?{exists:e.exists}:z()}function iY(n){return n.updateTime!==void 0?Je.updateTime(rt(n.updateTime)):n.exists!==void 0?Je.exists(n.exists):Je.none()}function sY(n,e){let t=n.updateTime?rt(n.updateTime):rt(e);return t.isEqual(Q.min())&&(t=rt(e)),new vb(t,n.transformResults||[])}function oY(n,e){return n&&n.length>0?(j(e!==void 0),n.map(t=>sY(t,e))):[]}function aY(n,e){let t=e.transform;if(t instanceof Ds)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(t instanceof gi)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:t.elements}};if(t instanceof yi)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:t.elements}};if(t instanceof Ns)return{fieldPath:e.field.canonicalString(),increment:t.operand};throw z()}function lY(n,e){let t=null;if("setToServerValue"in e)j(e.setToServerValue==="REQUEST_TIME"),t=new Ds;else if("appendMissingElements"in e){let i=e.appendMissingElements.values||[];t=new gi(i)}else if("removeAllFromArray"in e){let i=e.removeAllFromArray.values||[];t=new yi(i)}else"increment"in e?t=new Ns(n,e.increment):z();let r=it.fromServerFormat(e.fieldPath);return new Uo(r,t)}function j2(n,e){return{documents:[q2(n,e.path)]}}function cY(n){let e=n.documents.length;j(e===1);let t=n.documents[0];return Xt(sc(z2(t)))}function $2(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=q2(n,i);let s=pY(e.filters);s&&(t.structuredQuery.where=s);let o=gY(e.orderBy);o&&(t.structuredQuery.orderBy=o);let a=Ib(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=_Y(e.startAt)),e.endAt&&(t.structuredQuery.endAt=vY(e.endAt)),{queryTarget:t,parent:i}}function H2(n){let e=z2(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){j(r===1);let u=t.from[0];u.allDescendants?i=u.collectionId:e=e.child(u.collectionId)}let s=[];t.where&&(s=mY(t.where));let o=[];t.orderBy&&(o=yY(t.orderBy));let a=null;t.limit&&(a=j7(t.limit));let l=null;t.startAt&&(l=EY(t.startAt));let c=null;return t.endAt&&(c=SY(t.endAt)),E2(e,i,o,s,a,"F",l,c)}function uY(n){return Xt(H2(n))}function dY(n,e){let t=hY(e.purpose);return t==null?null:{"goog-listen-tags":t}}function hY(n){switch(n){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return z()}}function fY(n,e){let t,r=e.target;if(gg(r)?t={documents:j2(n,r)}:t={query:$2(n,r).queryTarget},t.targetId=e.targetId,e.resumeToken.approximateByteSize()>0){t.resumeToken=V2(n,e.resumeToken);let i=Ib(n,e.expectedCount);i!==null&&(t.expectedCount=i)}else if(e.snapshotVersion.compareTo(Q.min())>0){t.readTime=jl(n,e.snapshotVersion.toTimestamp());let i=Ib(n,e.expectedCount);i!==null&&(t.expectedCount=i)}return t}function pY(n){if(n.length!==0)return Q2(Ie.create(n,"and"))}function mY(n){let e=K2(n);return e instanceof Ie&&rI(e)?e.getFilters():[e]}function K2(n){return n.unaryFilter!==void 0?OY(n):n.fieldFilter!==void 0?xY(n):n.compositeFilter!==void 0?PY(n):z()}function gY(n){if(n.length!==0)return n.map(e=>RY(e))}function yY(n){return n.map(e=>DY(e))}function _Y(n){return{before:n.inclusive,values:n.position}}function vY(n){return{before:!n.inclusive,values:n.position}}function EY(n){let e=!!n.before,t=n.values||[];return new jr(t,e)}function SY(n){let e=!n.before,t=n.values||[];return new jr(t,e)}function CY(n){return q7[n]}function wY(n){switch(n){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}function TY(n){return z7[n]}function bY(n){return G7[n]}function IY(n){switch(n){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return z();default:return z()}}function AY(n){switch(n){case"AND":return"and";case"OR":return"or";default:return z()}}function Nl(n){return{fieldPath:n.canonicalString()}}function xl(n){return it.fromServerFormat(n.fieldPath)}function RY(n){return{field:Nl(n.field),direction:CY(n.dir)}}function DY(n){return new Bo(xl(n.field),wY(n.direction))}function Q2(n){return n instanceof de?kY(n):n instanceof Ie?NY(n):z()}function NY(n){let e=n.getFilters().map(t=>Q2(t));return e.length===1?e[0]:{compositeFilter:{op:bY(n.op),filters:e}}}function kY(n){if(n.op==="=="){if(PF(n.value))return{unaryFilter:{field:Nl(n.field),op:"IS_NAN"}};if(xF(n.value))return{unaryFilter:{field:Nl(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(PF(n.value))return{unaryFilter:{field:Nl(n.field),op:"IS_NOT_NAN"}};if(xF(n.value))return{unaryFilter:{field:Nl(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Nl(n.field),op:TY(n.op),value:n.value}}}function OY(n){switch(n.unaryFilter.op){case"IS_NAN":let e=xl(n.unaryFilter.field);return de.create(e,"==",{doubleValue:NaN});case"IS_NULL":let t=xl(n.unaryFilter.field);return de.create(t,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let r=xl(n.unaryFilter.field);return de.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=xl(n.unaryFilter.field);return de.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return z();default:return z()}}function xY(n){return de.create(xl(n.fieldFilter.field),IY(n.fieldFilter.op),n.fieldFilter.value)}function PY(n){return Ie.create(n.compositeFilter.filters.map(e=>K2(e)),AY(n.compositeFilter.op))}function MY(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function FY(n){let e=n.fieldPaths||[];return new En(e.map(t=>it.fromServerFormat(t)))}function Y2(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var $l=class n{constructor(e,t,r,i,s=Q.min(),o=Q.min(),a=st.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var Sg=class{constructor(e){this.remoteSerializer=e}};function LY(n,e){let t;if(e.document)t=W2(n.remoteSerializer,e.document,!!e.hasCommittedMutations);else if(e.noDocument){let r=V.fromSegments(e.noDocument.path),i=zo(e.noDocument.readTime);t=ht.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else if(e.unknownDocument){let r=V.fromSegments(e.unknownDocument.path),i=zo(e.unknownDocument.version);t=ht.newUnknownDocument(r,i)}else return z();return e.readTime&&t.setReadTime(BY(e.readTime)),t}function $F(n,e){let t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:uy(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=Y7(n.remoteSerializer,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:qo(e.version)};else if(e.isUnknownDocument())r.unknownDocument={path:t.path.toArray(),version:qo(e.version)};else return z();return r}function uy(n){let e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function BY(n){let e=new He(n[0],n[1]);return Q.fromTimestamp(e)}function qo(n){let e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function zo(n){let e=new He(n.seconds,n.nanoseconds);return Q.fromTimestamp(e)}function VY(n,e,t){let r=t.baseMutations.map(s=>Vd(n.remoteSerializer,s)),i=t.mutations.map(s=>Vd(n.remoteSerializer,s));return{userId:e,batchId:t.batchId,localWriteTimeMs:t.localWriteTime.toMillis(),baseMutations:r,mutations:i}}function Ao(n,e){let t=(e.baseMutations||[]).map(s=>Db(n.remoteSerializer,s));for(let s=0;s<e.mutations.length-1;++s){let o=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){let l=e.mutations[s+1];o.updateTransforms=l.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}let r=e.mutations.map(s=>Db(n.remoteSerializer,s)),i=He.fromMillis(e.localWriteTimeMs);return new Pd(e.batchId,i,t,r)}function _d(n){let e=zo(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?zo(n.lastLimboFreeSnapshotVersion):Q.min(),r;return UY(n.query)?r=cY(n.query):r=uY(n.query),new $l(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,st.fromBase64String(n.resumeToken))}function X2(n,e){let t=qo(e.snapshotVersion),r=qo(e.lastLimboFreeSnapshotVersion),i;gg(e.target)?i=j2(n.remoteSerializer,e.target):i=$2(n.remoteSerializer,e.target).queryTarget;let s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Vo(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function UY(n){return n.documents!==void 0}function qY(n){return{id:n.bundleId,createTime:zo(n.createTime),version:n.version}}function zY(n){return{bundleId:n.id,createTime:qo(rt(n.createTime)),version:n.version}}function GY(n){return{name:n.name,query:cI(n.bundledQuery),readTime:zo(n.readTime)}}function WY(n){return{name:n.name,readTime:qo(rt(n.readTime)),bundledQuery:n.bundledQuery}}function cI(n){let e=H2({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?yg(e,e.limit,"L"):e}function jY(n){return{name:n.name,query:cI(n.bundledQuery),readTime:rt(n.readTime)}}function $Y(n){return{id:n.id,version:n.version,createTime:rt(n.createTime)}}function xT(n,e){return new Md(e.largestBatchId,Db(n.remoteSerializer,e.overlayMutation))}function HY(n,e,t){let[r,i,s]=J2(e,t.mutation.key);return{userId:e,collectionPath:i,documentId:s,collectionGroup:t.mutation.key.getCollectionGroup(),largestBatchId:t.largestBatchId,overlayMutation:Vd(n.remoteSerializer,t.mutation)}}function J2(n,e){let t=e.path.lastSegment(),r=Yt(e.path.popLast());return[n,r,t]}function KY(n){return{indexId:n.indexId,collectionGroup:n.collectionGroup,fields:n.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])}}function QY(n,e){let t=e?new bd(e.sequenceNumber,new Un(zo(e.readTime),new V(qr(e.documentKey)),e.largestBatchId)):bd.empty(),r=n.fields.map(([i,s])=>new Pl(it.fromServerFormat(i),s));return new YT(n.indexId,n.collectionGroup,r,t)}function HF(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:qo(r.readTime),documentKey:Yt(r.documentKey.path),largestBatchId:r.largestBatchId}}var Nb=class{getBundleMetadata(e,t){return KF(e).get(t).next(r=>{if(r)return qY(r)})}saveBundleMetadata(e,t){return KF(e).put(zY(t))}getNamedQuery(e,t){return QF(e).get(t).next(r=>{if(r)return GY(r)})}saveNamedQuery(e,t){return QF(e).put(WY(t))}};function KF(n){return _t(n,ty)}function QF(n){return _t(n,ny)}var Cg=class n{constructor(e,t){this.serializer=e,this.userId=t}static forUser(e,t){let r=t.uid||"";return new n(e,r)}getOverlay(e,t){return fd(e).get(J2(this.userId,t)).next(r=>r?xT(this.serializer,r):null)}getOverlays(e,t){let r=zr();return I.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){let i=[];return r.forEach((s,o)=>{let a=new Md(t,o);i.push(this.saveOverlay(e,a))}),I.waitFor(i)}removeOverlaysForBatchId(e,t,r){let i=new Set;t.forEach(o=>i.add(Yt(o.getCollectionPath())));let s=[];return i.forEach(o=>{let a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);s.push(fd(e).deleteAll(ib,a))}),I.waitFor(s)}getOverlaysForCollection(e,t,r){let i=zr(),s=Yt(t),o=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return fd(e).loadAll(ib,o).next(a=>{for(let l of a){let c=xT(this.serializer,l);i.set(c.getKey(),c)}return i})}getOverlaysForCollectionGroup(e,t,r,i){let s=zr(),o,a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return fd(e).iterate({index:YL,range:a},(l,c,u)=>{let d=xT(this.serializer,c);s.size()<i||d.largestBatchId===o?(s.set(d.getKey(),d),o=d.largestBatchId):u.done()}).next(()=>s)}saveOverlay(e,t){return fd(e).put(HY(this.serializer,this.userId,t))}};function fd(n){return _t(n,sy)}var kb=class{globalsStore(e){return _t(e,X0)}getSessionToken(e){return this.globalsStore(e).get("sessionToken").next(r=>{let i=r?.value;return i?st.fromUint8Array(i):st.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.globalsStore(e).put({name:"sessionToken",value:t.toUint8Array()})}};var YY=5,XY=10,JY=13,PT=15,ZY=20,eX=25,tX=30,nX=37,rX=45,iX=50,sX=53,oX=55,aX=60,lX=2,pi=class{constructor(){}writeIndexValue(e,t){this.writeIndexValueAux(e,t),t.writeInfinity()}writeIndexValueAux(e,t){if("nullValue"in e)this.writeValueTypeLabel(t,YY);else if("booleanValue"in e)this.writeValueTypeLabel(t,XY),t.writeNumber(e.booleanValue?1:0);else if("integerValue"in e)this.writeValueTypeLabel(t,PT),t.writeNumber(Ge(e.integerValue));else if("doubleValue"in e){let r=Ge(e.doubleValue);isNaN(r)?this.writeValueTypeLabel(t,JY):(this.writeValueTypeLabel(t,PT),Dd(r)?t.writeNumber(0):t.writeNumber(r))}else if("timestampValue"in e){let r=e.timestampValue;this.writeValueTypeLabel(t,ZY),typeof r=="string"&&(r=mi(r)),t.writeString(`${r.seconds||""}`),t.writeNumber(r.nanos||0)}else if("stringValue"in e)this.writeIndexString(e.stringValue,t),this.writeTruncationMarker(t);else if("bytesValue"in e)this.writeValueTypeLabel(t,tX),t.writeBytes(Is(e.bytesValue)),this.writeTruncationMarker(t);else if("referenceValue"in e)this.writeIndexEntityRef(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.writeValueTypeLabel(t,rX),t.writeNumber(r.latitude||0),t.writeNumber(r.longitude||0)}else"mapValue"in e?c2(e)?this.writeValueTypeLabel(t,Number.MAX_SAFE_INTEGER):ay(e)?this.writeIndexVector(e.mapValue,t):(this.writeIndexMap(e.mapValue,t),this.writeTruncationMarker(t)):"arrayValue"in e?(this.writeIndexArray(e.arrayValue,t),this.writeTruncationMarker(t)):z()}writeIndexString(e,t){this.writeValueTypeLabel(t,eX),this.writeUnlabeledIndexString(e,t)}writeUnlabeledIndexString(e,t){t.writeString(e)}writeIndexMap(e,t){let r=e.fields||{};this.writeValueTypeLabel(t,oX);for(let i of Object.keys(r))this.writeIndexString(i,t),this.writeIndexValueAux(r[i],t)}writeIndexVector(e,t){var r,i;let s=e.fields||{};this.writeValueTypeLabel(t,sX);let o=Vl,a=((i=(r=s[o].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.length)||0;this.writeValueTypeLabel(t,PT),t.writeNumber(Ge(a)),this.writeIndexString(o,t),this.writeIndexValueAux(s[o],t)}writeIndexArray(e,t){let r=e.values||[];this.writeValueTypeLabel(t,iX);for(let i of r)this.writeIndexValueAux(i,t)}writeIndexEntityRef(e,t){this.writeValueTypeLabel(t,nX),V.fromName(e).path.forEach(i=>{this.writeValueTypeLabel(t,aX),this.writeUnlabeledIndexString(i,t)})}writeValueTypeLabel(e,t){e.writeNumber(t)}writeTruncationMarker(e){e.writeNumber(lX)}};pi.INSTANCE=new pi;var YF="\uD800",XF="\uDBFF",wl=0,JF=255,ZF=1,Tl=255,eL=255,tL=0,cX=64,uX=8,dX=1024;function hX(n){let e=new DataView(new ArrayBuffer(8));return e.setFloat64(0,n,!1),new Uint8Array(e.buffer)}function fX(n){if(n===0)return 8;let e=0;return n>>4||(e+=4,n=n<<4),n>>6||(e+=2,n=n<<2),n>>7||(e+=1),e}function pX(n){let e=0;for(let t=0;t<8;++t){let r=fX(n[t]&255);if(e+=r,r!==8)break}return e}function nL(n){let e=cX-pX(n);return Math.ceil(e/uX)}var Ob=class{constructor(){this.buffer=new Uint8Array(dX),this.position=0}writeBytesAscending(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.writeByteAscending(r.value),r=t.next();this.writeSeparatorAscending()}writeBytesDescending(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.writeByteDescending(r.value),r=t.next();this.writeSeparatorDescending()}writeUtf8Ascending(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.writeByteAscending(r);else if(r<2048)this.writeByteAscending(960|r>>>6),this.writeByteAscending(128|63&r);else if(t<YF||XF<t)this.writeByteAscending(480|r>>>12),this.writeByteAscending(128|63&r>>>6),this.writeByteAscending(128|63&r);else{let i=t.codePointAt(0);this.writeByteAscending(240|i>>>18),this.writeByteAscending(128|63&i>>>12),this.writeByteAscending(128|63&i>>>6),this.writeByteAscending(128|63&i)}}this.writeSeparatorAscending()}writeUtf8Descending(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.writeByteDescending(r);else if(r<2048)this.writeByteDescending(960|r>>>6),this.writeByteDescending(128|63&r);else if(t<YF||XF<t)this.writeByteDescending(480|r>>>12),this.writeByteDescending(128|63&r>>>6),this.writeByteDescending(128|63&r);else{let i=t.codePointAt(0);this.writeByteDescending(240|i>>>18),this.writeByteDescending(128|63&i>>>12),this.writeByteDescending(128|63&i>>>6),this.writeByteDescending(128|63&i)}}this.writeSeparatorDescending()}writeNumberAscending(e){let t=this.toOrderedBits(e),r=nL(t);this.ensureAvailable(1+r),this.buffer[this.position++]=r&255;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=t[i]&255}writeNumberDescending(e){let t=this.toOrderedBits(e),r=nL(t);this.ensureAvailable(1+r),this.buffer[this.position++]=~(r&255);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(t[i]&255)}writeInfinityAscending(){this.writeEscapedByteAscending(Tl),this.writeEscapedByteAscending(eL)}writeInfinityDescending(){this.writeEscapedByteDescending(Tl),this.writeEscapedByteDescending(eL)}reset(){this.position=0}seed(e){this.ensureAvailable(e.length),this.buffer.set(e,this.position),this.position+=e.length}encodedBytes(){return this.buffer.slice(0,this.position)}toOrderedBits(e){let t=hX(e),r=(t[0]&128)!==0;t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}writeByteAscending(e){let t=e&255;t===wl?(this.writeEscapedByteAscending(wl),this.writeEscapedByteAscending(JF)):t===Tl?(this.writeEscapedByteAscending(Tl),this.writeEscapedByteAscending(tL)):this.writeEscapedByteAscending(t)}writeByteDescending(e){let t=e&255;t===wl?(this.writeEscapedByteDescending(wl),this.writeEscapedByteDescending(JF)):t===Tl?(this.writeEscapedByteDescending(Tl),this.writeEscapedByteDescending(tL)):this.writeEscapedByteDescending(e)}writeSeparatorAscending(){this.writeEscapedByteAscending(wl),this.writeEscapedByteAscending(ZF)}writeSeparatorDescending(){this.writeEscapedByteDescending(wl),this.writeEscapedByteDescending(ZF)}writeEscapedByteAscending(e){this.ensureAvailable(1),this.buffer[this.position++]=e}writeEscapedByteDescending(e){this.ensureAvailable(1),this.buffer[this.position++]=~e}ensureAvailable(e){let t=e+this.position;if(t<=this.buffer.length)return;let r=this.buffer.length*2;r<t&&(r=t);let i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}},xb=class{constructor(e){this.orderedCode=e}writeBytes(e){this.orderedCode.writeBytesAscending(e)}writeString(e){this.orderedCode.writeUtf8Ascending(e)}writeNumber(e){this.orderedCode.writeNumberAscending(e)}writeInfinity(){this.orderedCode.writeInfinityAscending()}},Pb=class{constructor(e){this.orderedCode=e}writeBytes(e){this.orderedCode.writeBytesDescending(e)}writeString(e){this.orderedCode.writeUtf8Descending(e)}writeNumber(e){this.orderedCode.writeNumberDescending(e)}writeInfinity(){this.orderedCode.writeInfinityDescending()}},Ro=class{constructor(){this.orderedCode=new Ob,this.ascending=new xb(this.orderedCode),this.descending=new Pb(this.orderedCode)}seed(e){this.orderedCode.seed(e)}forKind(e){return e===0?this.ascending:this.descending}encodedBytes(){return this.orderedCode.encodedBytes()}reset(){this.orderedCode.reset()}};var Do=class n{constructor(e,t,r,i){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=i}successor(){let e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new n(this.indexId,this.documentKey,this.arrayValue,r)}};function ys(n,e){let t=n.indexId-e.indexId;return t!==0||(t=rL(n.arrayValue,e.arrayValue),t!==0)||(t=rL(n.directionalValue,e.directionalValue),t!==0)?t:V.comparator(n.documentKey,e.documentKey)}function rL(n,e){for(let t=0;t<n.length&&t<e.length;++t){let r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}var wg=class{constructor(e){this.inequalityFilters=new De((t,r)=>it.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.orderBys=e.orderBy,this.equalityFilters=[];for(let t of e.filters){let r=t;r.isInequality()?this.inequalityFilters=this.inequalityFilters.add(r):this.equalityFilters.push(r)}}get hasMultipleInequality(){return this.inequalityFilters.size>1}servedByIndex(e){if(j(e.collectionGroup===this.collectionId),this.hasMultipleInequality)return!1;let t=$0(e);if(t!==void 0&&!this.hasMatchingEqualityFilter(t))return!1;let r=Mo(e),i=new Set,s=0,o=0;for(;s<r.length&&this.hasMatchingEqualityFilter(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(this.inequalityFilters.size>0){let a=this.inequalityFilters.getIterator().getNext();if(!i.has(a.field.canonicalString())){let l=r[s];if(!this.matchesFilter(a,l)||!this.matchesOrderBy(this.orderBys[o++],l))return!1}++s}for(;s<r.length;++s){let a=r[s];if(o>=this.orderBys.length||!this.matchesOrderBy(this.orderBys[o++],a))return!1}return!0}buildTargetIndex(){if(this.hasMultipleInequality)return null;let e=new De(it.comparator),t=[];for(let r of this.equalityFilters){if(r.field.isKeyField())continue;if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new Pl(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new Pl(r.field,0))}}for(let r of this.orderBys)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new Pl(r.field,r.dir==="asc"?0:1)));return new YT(YT.UNKNOWN_ID,this.collectionId,t,bd.empty())}hasMatchingEqualityFilter(e){for(let t of this.equalityFilters)if(this.matchesFilter(t,e))return!0;return!1}matchesFilter(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;let r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}matchesOrderBy(e,t){return e.field.isEqual(t.fieldPath)?t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc":!1}};function Z2(n){var e,t;if(j(n instanceof de||n instanceof Ie),n instanceof de)if(n instanceof mg){let i=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(s=>de.create(n.field,"==",s)))||[];return Ie.create(i,"or")}else return n;let r=n.filters.map(i=>Z2(i));return Ie.create(r,n.op)}function mX(n){if(n.getFilters().length===0)return[];let e=Mb(Z2(n));return j(eB(e)),uI(e)||dI(e)?[e]:e.getFilters()}function uI(n){return n instanceof de}function dI(n){return n instanceof Ie&&rI(n)}function eB(n){return uI(n)||dI(n)||gX(n)}function gX(n){if(n instanceof Ie&&cb(n)){for(let e of n.getFilters())if(!uI(e)&&!dI(e))return!1;return!0}return!1}function Mb(n){if(j(n instanceof de||n instanceof Ie),n instanceof de)return n;if(n.filters.length===1)return Mb(n.filters[0]);let e=n.filters.map(r=>Mb(r)),t=Ie.create(e,n.op);return t=Tg(t),eB(t)?t:(j(t instanceof Ie),j(ql(t)),j(t.filters.length>1),t.filters.reduce((r,i)=>hI(r,i)))}function hI(n,e){j(n instanceof de||n instanceof Ie),j(e instanceof de||e instanceof Ie);let t;return n instanceof de?e instanceof de?t=yX(n,e):t=iL(n,e):e instanceof de?t=iL(e,n):t=_X(n,e),Tg(t)}function yX(n,e){return Ie.create([n,e],"and")}function _X(n,e){if(j(n.filters.length>0&&e.filters.length>0),ql(n)&&ql(e))return m2(n,e.getFilters());let t=cb(n)?n:e,r=cb(n)?e:n,i=t.filters.map(s=>hI(s,r));return Ie.create(i,"or")}function iL(n,e){if(ql(e))return m2(e,n.getFilters());{let t=e.filters.map(r=>hI(n,r));return Ie.create(t,"or")}}function Tg(n){if(j(n instanceof de||n instanceof Ie),n instanceof de)return n;let e=n.getFilters();if(e.length===1)return Tg(e[0]);if(f2(n))return n;let t=e.map(i=>Tg(i)),r=[];return t.forEach(i=>{i instanceof de?r.push(i):i instanceof Ie&&(i.op===n.op?r.push(...i.filters):r.push(i))}),r.length===1?r[0]:Ie.create(r,n.op)}var Fb=class{constructor(){this.collectionParentIndex=new Ud}addToCollectionParentIndex(e,t){return this.collectionParentIndex.add(t),I.resolve()}getCollectionParents(e,t){return I.resolve(this.collectionParentIndex.getEntries(t))}addFieldIndex(e,t){return I.resolve()}deleteFieldIndex(e,t){return I.resolve()}deleteAllFieldIndexes(e){return I.resolve()}createTargetIndexes(e,t){return I.resolve()}getDocumentsMatchingTarget(e,t){return I.resolve(null)}getIndexType(e,t){return I.resolve(0)}getFieldIndexes(e,t){return I.resolve([])}getNextCollectionGroupToUpdate(e){return I.resolve(null)}getMinOffset(e,t){return I.resolve(Un.min())}getMinOffsetFromCollectionGroup(e,t){return I.resolve(Un.min())}updateCollectionGroup(e,t,r){return I.resolve()}updateIndexEntries(e,t){return I.resolve()}},Ud=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new De(pe.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new De(pe.comparator)).toArray()}};var sL="IndexedDbIndexManager",Jm=new Uint8Array(0),Lb=class{constructor(e,t){this.databaseId=t,this.collectionParentsCache=new Ud,this.targetToDnfSubTargets=new $r(r=>Vo(r),(r,i)=>Zd(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.collectionParentsCache.has(t)){let r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.collectionParentsCache.add(t)});let s={collectionId:r,parent:Yt(i)};return oL(e).put(s)}return I.resolve()}getCollectionParents(e,t){let r=[],i=IDBKeyRange.bound([t,""],[FL(t),""],!1,!0);return oL(e).loadAll(i).next(s=>{for(let o of s){if(o.collectionId!==t)break;r.push(qr(o.parent))}return r})}addFieldIndex(e,t){let r=pd(e),i=KY(t);delete i.indexId;let s=r.add(i);if(t.indexState){let o=Il(e);return s.next(a=>{o.put(HF(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}else return s.next()}deleteFieldIndex(e,t){let r=pd(e),i=Il(e),s=bl(e);return r.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=pd(e),r=bl(e),i=Il(e);return t.deleteAll().next(()=>r.deleteAll()).next(()=>i.deleteAll())}createTargetIndexes(e,t){return I.forEach(this.getSubTargets(t),r=>this.getIndexType(e,r).next(i=>{if(i===0||i===1){let o=new wg(r).buildTargetIndex();if(o!=null)return this.addFieldIndex(e,o)}}))}getDocumentsMatchingTarget(e,t){let r=bl(e),i=!0,s=new Map;return I.forEach(this.getSubTargets(t),o=>this.getFieldIndex(e,o).next(a=>{i&&(i=!!a),s.set(o,a)})).next(()=>{if(i){let o=ie(),a=[];return I.forEach(s,(l,c)=>{M(sL,`Using index ${I8(l)} to execute ${Vo(t)}`);let u=XQ(c,l),d=JQ(c,l),h=ZQ(c,l),p=e7(c,l),E=this.encodeBound(l,c,h),w=this.encodeBound(l,c,p),b=this.encodeValues(l,c,d),N=this.generateIndexRanges(l.indexId,u,E,h.inclusive,w,p.inclusive,b);return I.forEach(N,D=>r.loadFirst(D,t.limit).next(O=>{O.forEach(F=>{let G=V.fromSegments(F.documentKey);o.has(G)||(o=o.add(G),a.push(G))})}))}).next(()=>a)}else return I.resolve(null)})}getSubTargets(e){let t=this.targetToDnfSubTargets.get(e);return t||(e.filters.length===0?t=[e]:t=mX(Ie.create(e.filters,"and")).map(i=>_b(e.path,e.collectionGroup,e.orderBy,i.getFilters(),e.limit,e.startAt,e.endAt)),this.targetToDnfSubTargets.set(e,t),t)}generateIndexRanges(e,t,r,i,s,o,a){let l=(t!=null?t.length:1)*Math.max(r.length,s.length),c=l/(t!=null?t.length:1),u=[];for(let d=0;d<l;++d){let h=t?this.encodeSingleElement(t[d/c]):Jm,p=this.generateLowerBound(e,h,r[d%c],i),E=this.generateUpperBound(e,h,s[d%c],o),w=a.map(b=>this.generateLowerBound(e,h,b,!0));u.push(...this.createRange(p,E,w))}return u}generateLowerBound(e,t,r,i){let s=new Do(e,V.empty(),t,r);return i?s:s.successor()}generateUpperBound(e,t,r,i){let s=new Do(e,V.empty(),t,r);return i?s.successor():s}getFieldIndex(e,t){let r=new wg(t),i=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let o=null;for(let a of s)r.servedByIndex(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2,i=this.getSubTargets(t);return I.forEach(i,s=>this.getFieldIndex(e,s).next(o=>{o?r!==0&&o.fields.length<t7(s)&&(r=1):r=0})).next(()=>n7(t)&&i.length>1&&r===2?1:r)}encodeDirectionalElements(e,t){let r=new Ro;for(let i of Mo(e)){let s=t.data.field(i.fieldPath);if(s==null)return null;let o=r.forKind(i.kind);pi.INSTANCE.writeIndexValue(s,o)}return r.encodedBytes()}encodeSingleElement(e){let t=new Ro;return pi.INSTANCE.writeIndexValue(e,t.forKind(0)),t.encodedBytes()}encodeDirectionalKey(e,t){let r=new Ro;return pi.INSTANCE.writeIndexValue(Lo(this.databaseId,t),r.forKind(b8(e))),r.encodedBytes()}encodeValues(e,t,r){if(r===null)return[];let i=[];i.push(new Ro);let s=0;for(let o of Mo(e)){let a=r[s++];for(let l of i)if(this.isInFilter(t,o.fieldPath)&&kd(a))i=this.expandIndexValues(i,o,a);else{let c=l.forKind(o.kind);pi.INSTANCE.writeIndexValue(a,c)}}return this.getEncodedBytes(i)}encodeBound(e,t,r){return this.encodeValues(e,t,r.position)}getEncodedBytes(e){let t=[];for(let r=0;r<e.length;++r)t[r]=e[r].encodedBytes();return t}expandIndexValues(e,t,r){let i=[...e],s=[];for(let o of r.arrayValue.values||[])for(let a of i){let l=new Ro;l.seed(a.encodedBytes()),pi.INSTANCE.writeIndexValue(o,l.forKind(t.kind)),s.push(l)}return s}isInFilter(e,t){return!!e.filters.find(r=>r instanceof de&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){let r=pd(e),i=Il(e);return(t?r.loadAll(rb,IDBKeyRange.bound(t,t)):r.loadAll()).next(s=>{let o=[];return I.forEach(s,a=>i.get([a.indexId,this.uid]).next(l=>{o.push(QY(a,l))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,i)=>{let s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:ne(r.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){let i=pd(e),s=Il(e);return this.getNextSequenceNumber(e).next(o=>i.loadAll(rb,IDBKeyRange.bound(t,t)).next(a=>I.forEach(a,l=>s.put(HF(l.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){let r=new Map;return I.forEach(t,(i,s)=>{let o=r.get(i.collectionGroup);return(o?I.resolve(o):this.getFieldIndexes(e,i.collectionGroup)).next(l=>(r.set(i.collectionGroup,l),I.forEach(l,c=>this.getExistingIndexEntries(e,i,c).next(u=>{let d=this.computeIndexEntries(s,c);return u.isEqual(d)?I.resolve():this.updateEntries(e,s,c,u,d)}))))})}addIndexEntry(e,t,r,i){return bl(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.encodeDirectionalKey(r,t.key),documentKey:t.key.path.toArray()})}deleteIndexEntry(e,t,r,i){return bl(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.encodeDirectionalKey(r,t.key),t.key.path.toArray()])}getExistingIndexEntries(e,t,r){let i=bl(e),s=new De(ys);return i.iterate({index:QL,range:IDBKeyRange.only([r.indexId,this.uid,this.encodeDirectionalKey(r,t)])},(o,a)=>{s=s.add(new Do(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>s)}computeIndexEntries(e,t){let r=new De(ys),i=this.encodeDirectionalElements(t,e);if(i==null)return r;let s=$0(t);if(s!=null){let o=e.data.field(s.fieldPath);if(kd(o))for(let a of o.arrayValue.values||[])r=r.add(new Do(t.indexId,e.key,this.encodeSingleElement(a),i))}else r=r.add(new Do(t.indexId,e.key,Jm,i));return r}updateEntries(e,t,r,i,s){M(sL,"Updating index entries for document '%s'",t.key);let o=[];return dQ(i,s,ys,a=>{o.push(this.addIndexEntry(e,t,r,a))},a=>{o.push(this.deleteIndexEntry(e,t,r,a))}),I.waitFor(o)}getNextSequenceNumber(e){let t=1;return Il(e).iterate({index:KL,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(i,s,o)=>{o.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>ys(o,a)).filter((o,a,l)=>!a||ys(o,l[a-1])!==0);let i=[];i.push(e);for(let o of r){let a=ys(o,e),l=ys(o,t);if(a===0)i[0]=e.successor();else if(a>0&&l<0)i.push(o),i.push(o.successor());else if(l>0)break}i.push(t);let s=[];for(let o=0;o<i.length;o+=2){if(this.isRangeMatchable(i[o],i[o+1]))return[];let a=[i[o].indexId,this.uid,i[o].arrayValue,i[o].directionalValue,Jm,[]],l=[i[o+1].indexId,this.uid,i[o+1].arrayValue,i[o+1].directionalValue,Jm,[]];s.push(IDBKeyRange.bound(a,l))}return s}isRangeMatchable(e,t){return ys(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(aL)}getMinOffset(e,t){return I.mapArray(this.getSubTargets(t),r=>this.getFieldIndex(e,r).next(i=>i||z())).next(aL)}};function oL(n){return _t(n,Id)}function bl(n){return _t(n,iy)}function pd(n){return _t(n,Y0)}function Il(n){return _t(n,ry)}function aL(n){j(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){let i=n[r].indexState.offset;H0(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new Un(e.readTime,e.documentKey,t)}function tB(n,e,t){let r=n.store(rr),i=n.store(nc),s=[],o=IDBKeyRange.only(t.batchId),a=0,l=r.iterate({range:o},(u,d,h)=>(a++,h.delete()));s.push(l.next(()=>{j(a===1)}));let c=[];for(let u of t.mutations){let d=jL(e,u.key.path,t.batchId);s.push(i.delete(d)),c.push(u.key)}return I.waitFor(s).next(()=>c)}function bg(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else if(n.noDocument)e=n.noDocument;else throw z();return JSON.stringify(e).length}var Ig=class n{constructor(e,t,r,i){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=i,this.documentKeysByBatchId={}}static forUser(e,t,r,i){j(e.uid!=="");let s=e.isAuthenticated()?e.uid:"";return new n(s,t,r,i)}checkEmpty(e){let t=!0,r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return _s(e).iterate({index:No,range:r},(i,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,i){let s=kl(e),o=_s(e);return o.add({}).next(a=>{j(typeof a=="number");let l=new Pd(a,t,r,i),c=VY(this.serializer,this.userId,l),u=[],d=new De((h,p)=>ne(h.canonicalString(),p.canonicalString()));for(let h of i){let p=jL(this.userId,h.key.path,a);d=d.add(h.key.path.popLast()),u.push(o.put(c)),u.push(s.put(p,P8))}return d.forEach(h=>{u.push(this.indexManager.addToCollectionParentIndex(e,h))}),e.addOnCommittedListener(()=>{this.documentKeysByBatchId[a]=l.keys()}),I.waitFor(u).next(()=>l)})}lookupMutationBatch(e,t){return _s(e).get(t).next(r=>r?(j(r.userId===this.userId),Ao(this.serializer,r)):null)}lookupMutationKeys(e,t){return this.documentKeysByBatchId[t]?I.resolve(this.documentKeysByBatchId[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){let i=r.keys();return this.documentKeysByBatchId[t]=i,i}else return null})}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]),s=null;return _s(e).iterate({index:No,range:i},(o,a,l)=>{a.userId===this.userId&&(j(a.batchId>=r),s=Ao(this.serializer,a)),l.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=ws;return _s(e).iterate({index:No,range:t,reverse:!0},(i,s,o)=>{r=s.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,ws],[this.userId,Number.POSITIVE_INFINITY]);return _s(e).loadAll(No,t).next(r=>r.map(i=>Ao(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){let r=ng(this.userId,t.path),i=IDBKeyRange.lowerBound(r),s=[];return kl(e).iterate({range:i},(o,a,l)=>{let[c,u,d]=o,h=qr(u);if(c!==this.userId||!t.path.isEqual(h)){l.done();return}return _s(e).get(d).next(p=>{if(!p)throw z();j(p.userId===this.userId),s.push(Ao(this.serializer,p))})}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new De(ne),i=[];return t.forEach(s=>{let o=ng(this.userId,s.path),a=IDBKeyRange.lowerBound(o),l=kl(e).iterate({range:a},(c,u,d)=>{let[h,p,E]=c,w=qr(p);if(h!==this.userId||!s.path.isEqual(w)){d.done();return}r=r.add(E)});i.push(l)}),I.waitFor(i).next(()=>this.lookupMutationBatches(e,r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=ng(this.userId,r),o=IDBKeyRange.lowerBound(s),a=new De(ne);return kl(e).iterate({range:o},(l,c,u)=>{let[d,h,p]=l,E=qr(h);if(d!==this.userId||!r.isPrefixOf(E)){u.done();return}E.length===i&&(a=a.add(p))}).next(()=>this.lookupMutationBatches(e,a))}lookupMutationBatches(e,t){let r=[],i=[];return t.forEach(s=>{i.push(_s(e).get(s).next(o=>{if(o===null)throw z();j(o.userId===this.userId),r.push(Ao(this.serializer,o))}))}),I.waitFor(i).next(()=>r)}removeMutationBatch(e,t){return tB(e.simpleDbTransaction,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.removeCachedMutationKeys(t.batchId)}),I.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}removeCachedMutationKeys(e){delete this.documentKeysByBatchId[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return I.resolve();let r=IDBKeyRange.lowerBound(x8(this.userId)),i=[];return kl(e).iterate({range:r},(s,o,a)=>{if(s[0]!==this.userId){a.done();return}else{let c=qr(s[1]);i.push(c)}}).next(()=>{j(i.length===0)})})}containsKey(e,t){return nB(e,this.userId,t)}getMutationQueueMetadata(e){return rB(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:ws,lastStreamToken:""})}};function nB(n,e,t){let r=ng(e,t.path),i=r[1],s=IDBKeyRange.lowerBound(r),o=!1;return kl(n).iterate({range:s,keysOnly:!0},(a,l,c)=>{let[u,d,h]=a;u===e&&d===i&&(o=!0),c.done()}).next(()=>o)}function vX(n,e){let t=!1;return rB(n).iterateSerial(r=>nB(n,r,e).next(i=>(i&&(t=!0),I.resolve(!i)))).next(()=>t)}function _s(n){return _t(n,rr)}function kl(n){return _t(n,nc)}function rB(n){return _t(n,Yd)}var MT=2,Hl=class n{constructor(e){this.lastId=e}next(){return this.lastId+=MT,this.lastId}static forTargetCache(){return new n(2-MT)}static forSyncEngine(){return new n(1-MT)}};var Bb=class{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.retrieveMetadata(e).next(t=>{let r=new Hl(t.highestTargetId);return t.highestTargetId=r.next(),this.saveMetadata(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.retrieveMetadata(e).next(t=>Q.fromTimestamp(new He(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.retrieveMetadata(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.retrieveMetadata(e).next(i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.saveMetadata(e,i)))}addTargetData(e,t){return this.saveTargetData(e,t).next(()=>this.retrieveMetadata(e).next(r=>(r.targetCount+=1,this.updateMetadataFromTargetData(t,r),this.saveMetadata(e,r))))}updateTargetData(e,t){return this.saveTargetData(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Al(e).delete(t.targetId)).next(()=>this.retrieveMetadata(e)).next(r=>(j(r.targetCount>0),r.targetCount-=1,this.saveMetadata(e,r)))}removeTargets(e,t,r){let i=0,s=[];return Al(e).iterate((o,a)=>{let l=_d(a);l.sequenceNumber<=t&&r.get(l.targetId)===null&&(i++,s.push(this.removeTargetData(e,l)))}).next(()=>I.waitFor(s)).next(()=>i)}forEachTarget(e,t){return Al(e).iterate((r,i)=>{let s=_d(i);t(s)})}retrieveMetadata(e){return lL(e).get(hg).next(t=>(j(t!==null),t))}saveMetadata(e,t){return lL(e).put(hg,t)}saveTargetData(e,t){return Al(e).put(X2(this.serializer,t))}updateMetadataFromTargetData(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.retrieveMetadata(e).next(t=>t.targetCount)}getTargetData(e,t){let r=Vo(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),s=null;return Al(e).iterate({range:i,index:HL},(o,a,l)=>{let c=_d(a);Zd(t,c.target)&&(s=c,l.done())}).next(()=>s)}addMatchingKeys(e,t,r){let i=[],s=Es(e);return t.forEach(o=>{let a=Yt(o.path);i.push(s.put({targetId:r,path:a})),i.push(this.referenceDelegate.addReference(e,r,o))}),I.waitFor(i)}removeMatchingKeys(e,t,r){let i=Es(e);return I.forEach(t,s=>{let o=Yt(s.path);return I.waitFor([i.delete([r,o]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,t){let r=Es(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){let r=IDBKeyRange.bound([t],[t+1],!1,!0),i=Es(e),s=ie();return i.iterate({range:r,keysOnly:!0},(o,a,l)=>{let c=qr(o[1]),u=new V(c);s=s.add(u)}).next(()=>s)}containsKey(e,t){let r=Yt(t.path),i=IDBKeyRange.bound([r],[FL(r)],!1,!0),s=0;return Es(e).iterate({index:Q0,keysOnly:!0,range:i},([o,a],l,c)=>{o!==0&&(s++,c.done())}).next(()=>s>0)}getTargetDataForTarget(e,t){return Al(e).get(t).next(r=>r?_d(r):null)}};function Al(n){return _t(n,rc)}function lL(n){return _t(n,Ko)}function Es(n){return _t(n,ic)}var cL={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},nh=-1,iB=40*1024*1024,Vn=class n{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};Vn.DEFAULT_COLLECTION_PERCENTILE=10;Vn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3;Vn.DEFAULT=new Vn(iB,Vn.DEFAULT_COLLECTION_PERCENTILE,Vn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT);Vn.DISABLED=new Vn(nh,0,0);var uL="LruGarbageCollector",dL=1*1024*1024,EX=1*60*1e3,SX=5*60*1e3;function hL([n,e],[t,r]){let i=ne(n,t);return i===0?ne(e,r):i}var Vb=class{constructor(e){this.maxElements=e,this.buffer=new De(hL),this.previousIndex=0}nextIndex(){return++this.previousIndex}addElement(e){let t=[e,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(t);else{let r=this.buffer.last();hL(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}},Ub=class{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.gcTask=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==nh&&this.scheduleGC(EX)}stop(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)}get started(){return this.gcTask!==null}scheduleGC(e){M(uL,`Garbage collection scheduled in ${e}ms`),this.gcTask=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>T(this,null,function*(){this.gcTask=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){Fs(t)?M(uL,"Ignoring IndexedDB error during garbage collection: ",t):yield Ms(t)}yield this.scheduleGC(SX)}))}},qb=class{constructor(e,t){this.delegate=e,this.params=t}calculateTargetCount(e,t){return this.delegate.getSequenceNumberCount(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return I.resolve(vn.INVALID);let r=new Vb(t);return this.delegate.forEachTarget(e,i=>r.addElement(i.sequenceNumber)).next(()=>this.delegate.forEachOrphanedDocumentSequenceNumber(e,i=>r.addElement(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.delegate.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.delegate.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===nh?(M("LruGarbageCollector","Garbage collection skipped; disabled"),I.resolve(cL)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(M("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),cL):this.runGarbageCollection(e,t))}getCacheSize(e){return this.delegate.getCacheSize(e)}runGarbageCollection(e,t){let r,i,s,o,a,l,c,u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(d=>(d>this.params.maximumSequenceNumbersToCollect?(M("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${d}`),i=this.params.maximumSequenceNumbersToCollect):i=d,o=Date.now(),this.nthSequenceNumber(e,i))).next(d=>(r=d,a=Date.now(),this.removeTargets(e,r,t))).next(d=>(s=d,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(d=>{if(c=Date.now(),Rl()<=bn.DEBUG){let h=`LRU Garbage Collection
	Counted targets in ${o-u}ms
	Determined least recently used ${i} in ${a-o}ms
	Removed ${s} targets in ${l-a}ms
	Removed ${d} documents in ${c-l}ms
Total Duration: ${c-u}ms`;M("LruGarbageCollector",h)}return I.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:d})})}};function CX(n,e){return new qb(n,e)}var zb=class{constructor(e,t){this.db=e,this.garbageCollector=CX(this,t)}getSequenceNumberCount(e){let t=this.orphanedDocumentCount(e);return this.db.getTargetCache().getTargetCount(e).next(i=>t.next(s=>i+s))}orphanedDocumentCount(e){let t=0;return this.forEachOrphanedDocumentSequenceNumber(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}forEachOrphanedDocumentSequenceNumber(e,t){return this.forEachOrphanedDocument(e,(r,i)=>t(i))}addReference(e,t,r){return Zm(e,r)}removeReference(e,t,r){return Zm(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Zm(e,t)}isPinned(e,t){return vX(e,t)}removeOrphanedDocuments(e,t){let i=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[],o=0;return this.forEachOrphanedDocument(e,(l,c)=>{if(c<=t){let u=this.isPinned(e,l).next(d=>{if(!d)return o++,i.getEntry(e,l).next(()=>(i.removeEntry(l,Q.min()),Es(e).delete(wX(l))))});s.push(u)}}).next(()=>I.waitFor(s)).next(()=>i.apply(e)).next(()=>o)}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Zm(e,t)}forEachOrphanedDocument(e,t){let r=Es(e),i=vn.INVALID,s;return r.iterate({index:Q0},([o,a],{path:l,sequenceNumber:c})=>{o===0?(i!==vn.INVALID&&t(new V(qr(s)),i),i=c,s=l):i=vn.INVALID}).next(()=>{i!==vn.INVALID&&t(new V(qr(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}};function wX(n){return[0,Yt(n.path)]}function TX(n,e){return{targetId:0,path:Yt(n.path),sequenceNumber:e}}function Zm(n,e){return Es(n).put(TX(e,n.currentSequenceNumber))}var Ag=class{constructor(){this.changes=new $r(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ht.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?I.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var Gb=class{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return To(e).put(r)}removeEntry(e,t,r){return To(e).delete(bX(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.setMetadata(e,r)))}getEntry(e,t){let r=ht.newInvalidDocument(t);return To(e).iterate({index:rg,range:IDBKeyRange.only(md(t))},(i,s)=>{r=this.maybeDecodeDocument(t,s)}).next(()=>r)}getSizedEntry(e,t){let r={size:0,document:ht.newInvalidDocument(t)};return To(e).iterate({index:rg,range:IDBKeyRange.only(md(t))},(i,s)=>{r={document:this.maybeDecodeDocument(t,s),size:bg(s)}}).next(()=>r)}getEntries(e,t){let r=on();return this.forEachDbEntry(e,t,(i,s)=>{let o=this.maybeDecodeDocument(i,s);r=r.insert(i,o)}).next(()=>r)}getSizedEntries(e,t){let r=on(),i=new Fe(V.comparator);return this.forEachDbEntry(e,t,(s,o)=>{let a=this.maybeDecodeDocument(s,o);r=r.insert(s,a),i=i.insert(s,bg(o))}).next(()=>({documents:r,sizeMap:i}))}forEachDbEntry(e,t,r){if(t.isEmpty())return I.resolve();let i=new De(mL);t.forEach(l=>i=i.add(l));let s=IDBKeyRange.bound(md(i.first()),md(i.last())),o=i.getIterator(),a=o.getNext();return To(e).iterate({index:rg,range:s},(l,c,u)=>{let d=V.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&mL(a,d)<0;)r(a,null),a=o.getNext();a&&a.isEqual(d)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?u.skip(md(a)):u.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,i,s){let o=t.path,a=[o.popLast().toArray(),o.lastSegment(),uy(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],l=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return To(e).loadAll(IDBKeyRange.bound(a,l,!0)).next(c=>{s?.incrementDocumentReadCount(c.length);let u=on();for(let d of c){let h=this.maybeDecodeDocument(V.fromSegments(d.prefixPath.concat(d.collectionGroup,d.documentId)),d);h.isFoundDocument()&&(th(t,h)||i.has(h.key))&&(u=u.insert(h.key,h))}return u})}getAllFromCollectionGroup(e,t,r,i){let s=on(),o=pL(t,r),a=pL(t,Un.max());return To(e).iterate({index:$L,range:IDBKeyRange.bound(o,a,!0)},(l,c,u)=>{let d=this.maybeDecodeDocument(V.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);s=s.insert(d.key,d),s.size===i&&u.done()}).next(()=>s)}newChangeBuffer(e){return new Wb(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return fL(e).get(nb).next(t=>(j(!!t),t))}setMetadata(e,t){return fL(e).put(nb,t)}maybeDecodeDocument(e,t){if(t){let r=LY(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(Q.min())))return r}return ht.newInvalidDocument(e)}};function sB(n){return new Gb(n)}var Wb=class extends Ag{constructor(e,t){super(),this.documentCache=e,this.trackRemovals=t,this.documentStates=new $r(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){let t=[],r=0,i=new De((s,o)=>ne(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{let a=this.documentStates.get(s);if(t.push(this.documentCache.removeEntry(e,s,a.readTime)),o.isValidDocument()){let l=$F(this.documentCache.serializer,o);i=i.add(s.path.popLast());let c=bg(l);r+=c-a.size,t.push(this.documentCache.addEntry(e,s,l))}else if(r-=a.size,this.trackRemovals){let l=$F(this.documentCache.serializer,o.convertToNoDocument(Q.min()));t.push(this.documentCache.addEntry(e,s,l))}}),i.forEach(s=>{t.push(this.documentCache.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.documentCache.updateMetadata(e,r)),I.waitFor(t)}getFromCache(e,t){return this.documentCache.getSizedEntry(e,t).next(r=>(this.documentStates.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.documentCache.getSizedEntries(e,t).next(({documents:r,sizeMap:i})=>(i.forEach((s,o)=>{this.documentStates.set(s,{size:o,readTime:r.get(s).readTime})}),r))}};function fL(n){return _t(n,Xd)}function To(n){return _t(n,ey)}function md(n){let e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function bX(n,e){let t=n.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],uy(e),t[t.length-1]]}function pL(n,e){let t=e.documentKey.path.toArray();return[n,uy(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function mL(n,e){let t=n.path.toArray(),r=e.path.toArray(),i=0;for(let s=0;s<t.length-2&&s<r.length-2;++s)if(i=ne(t[s],r[s]),i)return i;return i=ne(t.length,r.length),i||(i=ne(t[t.length-2],r[r.length-2]),i)?i:ne(t[t.length-1],r[r.length-1])}var IX=17;var jb=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var Rg=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&Cd(r.mutation,i,En.empty(),He.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,ie()).next(()=>r))}getLocalViewOfDocuments(e,t,r=ie()){let i=zr();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let o=yd();return s.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){let r=zr();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,ie()))}populateOverlays(e,t,r){let i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,i){let s=on(),o=Od(),a=y7();return t.forEach((l,c)=>{let u=r.get(c.key);i.has(c.key)&&(u===void 0||u.mutation instanceof ar)?s=s.insert(c.key,c):u!==void 0?(o.set(c.key,u.mutation.getFieldMask()),Cd(u.mutation,c,u.mutation.getFieldMask(),He.now())):o.set(c.key,En.empty())}),this.recalculateAndSaveOverlays(e,s).next(l=>(l.forEach((c,u)=>o.set(c,u)),t.forEach((c,u)=>{var d;return a.set(c,new jb(u,(d=o.get(c))!==null&&d!==void 0?d:null))}),a))}recalculateAndSaveOverlays(e,t){let r=Od(),i=new Fe((o,a)=>o-a),s=ie();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(let a of o)a.keys().forEach(l=>{let c=t.get(l);if(c===null)return;let u=r.get(l)||En.empty();u=a.applyToLocalView(c,u),r.set(l,u);let d=(i.get(a.batchId)||ie()).add(l);i=i.insert(a.batchId,d)})}).next(()=>{let o=[],a=i.getReverseIterator();for(;a.hasNext();){let l=a.getNext(),c=l.key,u=l.value,d=I2();u.forEach(h=>{if(!s.has(h)){let p=x2(t.get(h),r.get(h));p!==null&&d.set(h,p),s=s.add(h)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,d))}return I.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return o7(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):iI(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{let o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):I.resolve(zr()),a=Ll,l=s;return o.next(c=>I.forEach(c,(u,d)=>(a<d.largestBatchId&&(a=d.largestBatchId),s.get(u)?I.resolve():this.remoteDocumentCache.getEntry(e,u).next(h=>{l=l.insert(u,h)}))).next(()=>this.populateOverlays(e,c,s)).next(()=>this.computeViews(e,l,c,ie())).next(u=>({batchId:a,changes:b2(u)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new V(t)).next(r=>{let i=yd();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let s=t.collectionGroup,o=yd();return this.indexManager.getCollectionParents(e,s).next(a=>I.forEach(a,l=>{let c=r7(t,l.child(s));return this.getDocumentsMatchingCollectionQuery(e,c,r,i).next(u=>{u.forEach((d,h)=>{o=o.insert(d,h)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(o=>{s.forEach((l,c)=>{let u=c.getKey();o.get(u)===null&&(o=o.insert(u,ht.newInvalidDocument(u)))});let a=yd();return o.forEach((l,c)=>{let u=s.get(l);u!==void 0&&Cd(u.mutation,c,En.empty(),He.now()),th(t,c)&&(a=a.insert(l,c))}),a})}};var $b=class{constructor(e){this.serializer=e,this.bundles=new Map,this.namedQueries=new Map}getBundleMetadata(e,t){return I.resolve(this.bundles.get(t))}saveBundleMetadata(e,t){return this.bundles.set(t.id,$Y(t)),I.resolve()}getNamedQuery(e,t){return I.resolve(this.namedQueries.get(t))}saveNamedQuery(e,t){return this.namedQueries.set(t.name,jY(t)),I.resolve()}};var Hb=class{constructor(){this.overlays=new Fe(V.comparator),this.overlayByBatchId=new Map}getOverlay(e,t){return I.resolve(this.overlays.get(t))}getOverlays(e,t){let r=zr();return I.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.saveOverlay(e,t,s)}),I.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.overlayByBatchId.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.overlayByBatchId.delete(r)),I.resolve()}getOverlaysForCollection(e,t,r){let i=zr(),s=t.length+1,o=new V(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let c=a.getNext().value,u=c.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===s&&c.largestBatchId>r&&i.set(c.getKey(),c)}return I.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new Fe((c,u)=>c-u),o=this.overlays.getIterator();for(;o.hasNext();){let u=o.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>r){let h=s.get(u.largestBatchId);h===null&&(h=zr(),s=s.insert(u.largestBatchId,h)),h.set(u.getKey(),u)}}let a=zr(),l=s.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((d,h)=>a.set(d,h)),!(a.size()>=i)););return I.resolve(a)}saveOverlay(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let o=this.overlayByBatchId.get(i.largestBatchId).delete(r.key);this.overlayByBatchId.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Md(t,r));let s=this.overlayByBatchId.get(t);s===void 0&&(s=ie(),this.overlayByBatchId.set(t,s)),this.overlayByBatchId.set(t,s.add(r.key))}};var Kb=class{constructor(){this.sessionToken=st.EMPTY_BYTE_STRING}getSessionToken(e){return I.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,I.resolve()}};var qd=class{constructor(){this.refsByKey=new De(ut.compareByKey),this.refsByTarget=new De(ut.compareByTargetId)}isEmpty(){return this.refsByKey.isEmpty()}addReference(e,t){let r=new ut(e,t);this.refsByKey=this.refsByKey.add(r),this.refsByTarget=this.refsByTarget.add(r)}addReferences(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.removeRef(new ut(e,t))}removeReferences(e,t){e.forEach(r=>this.removeReference(r,t))}removeReferencesForId(e){let t=new V(new pe([])),r=new ut(t,e),i=new ut(t,e+1),s=[];return this.refsByTarget.forEachInRange([r,i],o=>{this.removeRef(o),s.push(o.key)}),s}removeAllReferences(){this.refsByKey.forEach(e=>this.removeRef(e))}removeRef(e){this.refsByKey=this.refsByKey.delete(e),this.refsByTarget=this.refsByTarget.delete(e)}referencesForId(e){let t=new V(new pe([])),r=new ut(t,e),i=new ut(t,e+1),s=ie();return this.refsByTarget.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){let t=new ut(e,0),r=this.refsByKey.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},ut=class{constructor(e,t){this.key=e,this.targetOrBatchId=t}static compareByKey(e,t){return V.comparator(e.key,t.key)||ne(e.targetOrBatchId,t.targetOrBatchId)}static compareByTargetId(e,t){return ne(e.targetOrBatchId,t.targetOrBatchId)||V.comparator(e.key,t.key)}};var Qb=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.nextBatchId=1,this.batchesByDocumentKey=new De(ut.compareByKey)}checkEmpty(e){return I.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let s=this.nextBatchId;this.nextBatchId++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new Pd(s,t,r,i);this.mutationQueue.push(o);for(let a of i)this.batchesByDocumentKey=this.batchesByDocumentKey.add(new ut(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return I.resolve(o)}lookupMutationBatch(e,t){return I.resolve(this.findMutationBatch(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.indexOfBatchId(r),s=i<0?0:i;return I.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return I.resolve(this.mutationQueue.length===0?ws:this.nextBatchId-1)}getAllMutationBatches(e){return I.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new ut(t,0),i=new ut(t,Number.POSITIVE_INFINITY),s=[];return this.batchesByDocumentKey.forEachInRange([r,i],o=>{let a=this.findMutationBatch(o.targetOrBatchId);s.push(a)}),I.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new De(ne);return t.forEach(i=>{let s=new ut(i,0),o=new ut(i,Number.POSITIVE_INFINITY);this.batchesByDocumentKey.forEachInRange([s,o],a=>{r=r.add(a.targetOrBatchId)})}),I.resolve(this.findMutationBatches(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=r;V.isDocumentKey(s)||(s=s.child(""));let o=new ut(new V(s),0),a=new De(ne);return this.batchesByDocumentKey.forEachWhile(l=>{let c=l.key.path;return r.isPrefixOf(c)?(c.length===i&&(a=a.add(l.targetOrBatchId)),!0):!1},o),I.resolve(this.findMutationBatches(a))}findMutationBatches(e){let t=[];return e.forEach(r=>{let i=this.findMutationBatch(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){let r=this.indexOfExistingBatchId(t.batchId,"removed");j(r===0),this.mutationQueue.shift();let i=this.batchesByDocumentKey;return I.forEach(t.mutations,s=>{let o=new ut(s.key,t.batchId);return i=i.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.batchesByDocumentKey=i})}removeCachedMutationKeys(e){}containsKey(e,t){let r=new ut(t,0),i=this.batchesByDocumentKey.firstAfterOrEqual(r);return I.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,I.resolve()}indexOfExistingBatchId(e,t){return this.indexOfBatchId(e)}indexOfBatchId(e){if(this.mutationQueue.length===0)return 0;let t=this.mutationQueue[0].batchId;return e-t}findMutationBatch(e){let t=this.indexOfBatchId(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};function AX(){return new Fe(V.comparator)}var Yb=class{constructor(e){this.sizer=e,this.docs=AX(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.sizer(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return I.resolve(r?r.document.mutableCopy():ht.newInvalidDocument(t))}getEntries(e,t){let r=on();return t.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():ht.newInvalidDocument(i))}),I.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=on(),o=t.path,a=new V(o.child("")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){let{key:c,value:{document:u}}=l.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||H0(BL(u),r)<=0||!i.has(u.key)&&!th(t,u)||(s=s.insert(u.key,u.mutableCopy()))}return I.resolve(s)}getAllFromCollectionGroup(e,t,r,i){z()}forEachDocumentKey(e,t){return I.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new Xb(this)}getSize(e){return I.resolve(this.size)}};function RX(n){return new Yb(n)}var Xb=class extends Ag{constructor(e){super(),this.documentCache=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.documentCache.addEntry(e,i)):this.documentCache.removeEntry(r)}),I.waitFor(t)}getFromCache(e,t){return this.documentCache.getEntry(e,t)}getAllFromCache(e,t){return this.documentCache.getEntries(e,t)}};var Jb=class{constructor(e){this.persistence=e,this.targets=new $r(t=>Vo(t),Zd),this.lastRemoteSnapshotVersion=Q.min(),this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new qd,this.targetCount=0,this.targetIdGenerator=Hl.forTargetCache()}forEachTarget(e,t){return this.targets.forEach((r,i)=>t(i)),I.resolve()}getLastRemoteSnapshotVersion(e){return I.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return I.resolve(this.highestSequenceNumber)}allocateTargetId(e){return this.highestTargetId=this.targetIdGenerator.next(),I.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.highestSequenceNumber&&(this.highestSequenceNumber=t),I.resolve()}saveTargetData(e){this.targets.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.targetIdGenerator=new Hl(t),this.highestTargetId=t),e.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=e.sequenceNumber)}addTargetData(e,t){return this.saveTargetData(t),this.targetCount+=1,I.resolve()}updateTargetData(e,t){return this.saveTargetData(t),I.resolve()}removeTargetData(e,t){return this.targets.delete(t.target),this.references.removeReferencesForId(t.targetId),this.targetCount-=1,I.resolve()}removeTargets(e,t,r){let i=0,s=[];return this.targets.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.targets.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),I.waitFor(s).next(()=>i)}getTargetCount(e){return I.resolve(this.targetCount)}getTargetData(e,t){let r=this.targets.get(t)||null;return I.resolve(r)}addMatchingKeys(e,t,r){return this.references.addReferences(t,r),I.resolve()}removeMatchingKeys(e,t,r){this.references.removeReferences(t,r);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),I.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.references.removeReferencesForId(t),I.resolve()}getMatchingKeysForTargetId(e,t){let r=this.references.referencesForId(t);return I.resolve(r)}containsKey(e,t){return I.resolve(this.references.containsKey(t))}};var DX="MemoryPersistence",Dg=class{constructor(e,t){this.mutationQueues={},this.overlays={},this.listenSequence=new vn(0),this._started=!1,this._started=!0,this.globalsCache=new Kb,this.referenceDelegate=e(this),this.targetCache=new Jb(this);let r=i=>this.referenceDelegate.documentSize(i);this.indexManager=new Fb,this.remoteDocumentCache=RX(r),this.serializer=new Sg(t),this.bundleCache=new $b(this.serializer)}start(){return Promise.resolve()}shutdown(){return this._started=!1,Promise.resolve()}get started(){return this._started}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Hb,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.mutationQueues[e.toKey()];return r||(r=new Qb(t,this.referenceDelegate),this.mutationQueues[e.toKey()]=r),r}getGlobalsCache(){return this.globalsCache}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.bundleCache}runTransaction(e,t,r){M(DX,"Starting transaction:",e);let i=new Zb(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),r(i).next(s=>this.referenceDelegate.onTransactionCommitted(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}mutationQueuesContainKey(e,t){return I.or(Object.values(this.mutationQueues).map(r=>()=>r.containsKey(e,t)))}},Zb=class extends ug{constructor(e){super(),this.currentSequenceNumber=e}},Ng=class n{constructor(e){this.persistence=e,this.localViewReferences=new qd,this._orphanedDocuments=null}static factory(e){return new n(e)}get orphanedDocuments(){if(this._orphanedDocuments)return this._orphanedDocuments;throw z()}addReference(e,t,r){return this.localViewReferences.addReference(r,t),this.orphanedDocuments.delete(r.toString()),I.resolve()}removeReference(e,t,r){return this.localViewReferences.removeReference(r,t),this.orphanedDocuments.add(r.toString()),I.resolve()}markPotentiallyOrphaned(e,t){return this.orphanedDocuments.add(t.toString()),I.resolve()}removeTarget(e,t){this.localViewReferences.removeReferencesForId(t.targetId).forEach(s=>this.orphanedDocuments.add(s.toString()));let i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(o=>this.orphanedDocuments.add(o.toString()))}).next(()=>i.removeTargetData(e,t))}onTransactionStarted(){this._orphanedDocuments=new Set}onTransactionCommitted(e){let r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return I.forEach(this.orphanedDocuments,i=>{let s=V.fromPath(i);return this.isReferenced(e,s).next(o=>{o||r.removeEntry(s,Q.min())})}).next(()=>(this._orphanedDocuments=null,r.apply(e)))}updateLimboDocument(e,t){return this.isReferenced(e,t).next(r=>{r?this.orphanedDocuments.delete(t.toString()):this.orphanedDocuments.add(t.toString())})}documentSize(e){return 0}isReferenced(e,t){return I.or([()=>I.resolve(this.localViewReferences.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.mutationQueuesContainKey(e,t)])}};var e0=class{constructor(e){this.serializer=e}createOrUpgrade(e,t,r,i){let s=new dg("createOrUpgrade",t);r<1&&i>=1&&(kX(e),OX(e),gL(e),PX(e));let o=I.resolve();return r<3&&i>=3&&(r!==0&&(LX(e),gL(e)),o=o.next(()=>VX(s))),r<4&&i>=4&&(r!==0&&(o=o.next(()=>xX(e,s))),o=o.next(()=>{UX(e)})),r<5&&i>=5&&(o=o.next(()=>this.removeAcknowledgedMutations(s))),r<6&&i>=6&&(o=o.next(()=>(FX(e),this.addDocumentGlobal(s)))),r<7&&i>=7&&(o=o.next(()=>this.ensureSequenceNumbers(s))),r<8&&i>=8&&(o=o.next(()=>this.createCollectionParentIndex(e,s))),r<9&&i>=9&&(o=o.next(()=>{BX(e)})),r<10&&i>=10&&(o=o.next(()=>this.rewriteCanonicalIds(s))),r<11&&i>=11&&(o=o.next(()=>{qX(e),zX(e)})),r<12&&i>=12&&(o=o.next(()=>{WX(e)})),r<13&&i>=13&&(o=o.next(()=>MX(e)).next(()=>this.rewriteRemoteDocumentCache(e,s)).next(()=>e.deleteObjectStore(Io))),r<14&&i>=14&&(o=o.next(()=>this.runOverlayMigration(e,s))),r<15&&i>=15&&(o=o.next(()=>GX(e))),r<16&&i>=16&&(o=o.next(()=>{t.objectStore(ry).clear()}).next(()=>{t.objectStore(iy).clear()})),r<17&&i>=17&&(o=o.next(()=>{jX(e)})),o}addDocumentGlobal(e){let t=0;return e.store(Io).iterate((r,i)=>{t+=bg(i)}).next(()=>{let r={byteSize:t};return e.store(Xd).put(nb,r)})}removeAcknowledgedMutations(e){let t=e.store(Yd),r=e.store(rr);return t.loadAll().next(i=>I.forEach(i,s=>{let o=IDBKeyRange.bound([s.userId,ws],[s.userId,s.lastAcknowledgedBatchId]);return r.loadAll(No,o).next(a=>I.forEach(a,l=>{j(l.userId===s.userId);let c=Ao(this.serializer,l);return tB(e,s.userId,c).next(()=>{})}))}))}ensureSequenceNumbers(e){let t=e.store(ic),r=e.store(Io);return e.store(Ko).get(hg).next(s=>{let o=l=>t.put({targetId:0,path:Yt(l),sequenceNumber:s.highestListenSequenceNumber}),a=[];return r.iterate((l,c)=>{let u=new pe(l),d=NX(u);a.push(t.get(d).next(h=>h?I.resolve():o(u)))}).next(()=>I.waitFor(a))})}createCollectionParentIndex(e,t){e.createObjectStore(Id,{keyPath:z8});let r=t.store(Id),i=new Ud,s=o=>{if(i.add(o)){let a=o.lastSegment(),l=o.popLast();return r.put({collectionId:a,parent:Yt(l)})}};return t.store(Io).iterate({keysOnly:!0},(o,a)=>{let l=new pe(o);return s(l.popLast())}).next(()=>t.store(nc).iterate({keysOnly:!0},([o,a,l],c)=>{let u=qr(a);return s(u.popLast())}))}rewriteCanonicalIds(e){let t=e.store(rc);return t.iterate((r,i)=>{let s=_d(i),o=X2(this.serializer,s);return t.put(o)})}rewriteRemoteDocumentCache(e,t){let r=t.store(Io),i=[];return r.iterate((s,o)=>{let a=t.store(ey),l=$X(o).path.toArray(),c={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};i.push(a.put(c))}).next(()=>I.waitFor(i))}runOverlayMigration(e,t){let r=t.store(rr),i=sB(this.serializer),s=new Dg(Ng.factory,this.serializer.remoteSerializer);return r.loadAll().next(o=>{let a=new Map;return o.forEach(l=>{var c;let u=(c=a.get(l.userId))!==null&&c!==void 0?c:ie();Ao(this.serializer,l).keys().forEach(h=>u=u.add(h)),a.set(l.userId,u)}),I.forEach(a,(l,c)=>{let u=new ft(c),d=Cg.forUser(this.serializer,u),h=s.getIndexManager(u),p=Ig.forUser(u,this.serializer,h,s.referenceDelegate);return new Rg(i,p,d,h).recalculateAndSaveOverlaysForDocumentKeys(new Ad(t,vn.INVALID),l).next()})})}};function NX(n){return[0,Yt(n)]}function kX(n){n.createObjectStore(Qd)}function OX(n){n.createObjectStore(Yd,{keyPath:O8}),n.createObjectStore(rr,{keyPath:GL,autoIncrement:!0}).createIndex(No,WL,{unique:!0}),n.createObjectStore(nc)}function xX(n,e){return e.store(rr).loadAll().next(r=>{n.deleteObjectStore(rr),n.createObjectStore(rr,{keyPath:GL,autoIncrement:!0}).createIndex(No,WL,{unique:!0});let s=e.store(rr),o=r.map(a=>s.put(a));return I.waitFor(o)})}function PX(n){n.createObjectStore(Io)}function MX(n){let e=n.createObjectStore(ey,{keyPath:M8});e.createIndex(rg,F8),e.createIndex($L,L8)}function FX(n){n.createObjectStore(Xd)}function gL(n){n.createObjectStore(ic,{keyPath:U8}).createIndex(Q0,q8,{unique:!0}),n.createObjectStore(rc,{keyPath:B8}).createIndex(HL,V8,{unique:!0}),n.createObjectStore(Ko)}function LX(n){n.deleteObjectStore(ic),n.deleteObjectStore(rc),n.deleteObjectStore(Ko)}function BX(n){n.objectStoreNames.contains("remoteDocumentChanges")&&n.deleteObjectStore("remoteDocumentChanges")}function VX(n){let e=n.store(Ko),t={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:Q.min().toTimestamp(),targetCount:0};return e.put(hg,t)}function UX(n){n.createObjectStore(Bl,{keyPath:G8})}function qX(n){n.createObjectStore(ty,{keyPath:W8})}function zX(n){n.createObjectStore(ny,{keyPath:j8})}function GX(n){n.createObjectStore(Y0,{keyPath:$8,autoIncrement:!0}).createIndex(rb,H8,{unique:!1}),n.createObjectStore(ry,{keyPath:K8}).createIndex(KL,Q8,{unique:!1}),n.createObjectStore(iy,{keyPath:Y8}).createIndex(QL,X8,{unique:!1})}function WX(n){let e=n.createObjectStore(sy,{keyPath:J8});e.createIndex(ib,Z8,{unique:!1}),e.createIndex(YL,eQ,{unique:!1})}function jX(n){n.createObjectStore(X0,{keyPath:tQ})}function $X(n){return n.document?new V(pe.fromString(n.document.name).popFirst(5)):n.noDocument?V.fromSegments(n.noDocument.path):n.unknownDocument?V.fromSegments(n.unknownDocument.path):z()}var vs="IndexedDbPersistence",FT=30*60*1e3,LT=5e3,HX=4e3,BT="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",KX="This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.",QX="firestore_zombie",oB="main",t0=class n{constructor(e,t,r,i,s,o,a,l,c,u,d=IX){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.queue=s,this.window=o,this.document=a,this.sequenceNumberSyncer=c,this.forceOwningTab=u,this.schemaVersion=d,this.listenSequence=null,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.windowUnloadHandler=null,this.inForeground=!1,this.documentVisibilityHandler=null,this.clientMetadataRefresher=null,this.lastGarbageCollectionTime=Number.NEGATIVE_INFINITY,this.primaryStateListener=h=>Promise.resolve(),!n.isAvailable())throw new k(R.UNIMPLEMENTED,KX);this.referenceDelegate=new zb(this,i),this.dbName=t+oB,this.serializer=new Sg(l),this.simpleDb=new bs(this.dbName,this.schemaVersion,new e0(this.serializer)),this.globalsCache=new kb,this.targetCache=new Bb(this.referenceDelegate,this.serializer),this.remoteDocumentCache=sB(this.serializer),this.bundleCache=new Nb,this.window&&this.window.localStorage?this.webStorage=this.window.localStorage:(this.webStorage=null,u===!1&&$e(vs,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.updateClientMetadataAndTryBecomePrimary().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new k(R.FAILED_PRECONDITION,BT);return this.attachVisibilityHandler(),this.attachWindowUnloadHook(),this.scheduleClientMetadataAndPrimaryLeaseRefreshes(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.targetCache.getHighestSequenceNumber(e))}).then(e=>{this.listenSequence=new vn(e,this.sequenceNumberSyncer)}).then(()=>{this._started=!0}).catch(e=>(this.simpleDb&&this.simpleDb.close(),Promise.reject(e)))}setPrimaryStateListener(e){return this.primaryStateListener=t=>T(this,null,function*(){if(this.started)return e(t)}),e(this.isPrimary)}setDatabaseDeletedListener(e){this.simpleDb.setVersionChangeListener(t=>T(this,null,function*(){t.newVersion===null&&(yield e())}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.queue.enqueueAndForget(()=>T(this,null,function*(){this.started&&(yield this.updateClientMetadataAndTryBecomePrimary())})))}updateClientMetadataAndTryBecomePrimary(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>eg(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.verifyPrimaryLease(e).next(r=>{r||(this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)))})}).next(()=>this.canActAsPrimary(e)).next(r=>this.isPrimary&&!r?this.releasePrimaryLeaseIfHeld(e).next(()=>!1):r?this.acquireOrExtendPrimaryLease(e).next(()=>!0):!1)).catch(e=>{if(Fs(e))return M(vs,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return M(vs,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.queue.enqueueRetryable(()=>this.primaryStateListener(e)),this.isPrimary=e})}verifyPrimaryLease(e){return gd(e).get(Sl).next(r=>I.resolve(this.isLocalClient(r)))}removeClientMetadata(e){return eg(e).delete(this.clientId)}maybeGarbageCollectMultiClientState(){return T(this,null,function*(){if(this.isPrimary&&!this.isWithinAge(this.lastGarbageCollectionTime,FT)){this.lastGarbageCollectionTime=Date.now();let e=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{let r=_t(t,Bl);return r.loadAll().next(i=>{let s=this.filterActiveClients(i,FT),o=i.filter(a=>s.indexOf(a)===-1);return I.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.webStorage)for(let t of e)this.webStorage.removeItem(this.zombiedClientLocalStorageKey(t.clientId))}})}scheduleClientMetadataAndPrimaryLeaseRefreshes(){this.clientMetadataRefresher=this.queue.enqueueAfterDelay("client_metadata_refresh",HX,()=>this.updateClientMetadataAndTryBecomePrimary().then(()=>this.maybeGarbageCollectMultiClientState()).then(()=>this.scheduleClientMetadataAndPrimaryLeaseRefreshes()))}isLocalClient(e){return e?e.ownerId===this.clientId:!1}canActAsPrimary(e){return this.forceOwningTab?I.resolve(!0):gd(e).get(Sl).next(r=>{if(r!==null&&this.isWithinAge(r.leaseTimestampMs,LT)&&!this.isClientZombied(r.ownerId)){if(this.isLocalClient(r)&&this.networkEnabled)return!0;if(!this.isLocalClient(r)){if(!r.allowTabSynchronization)throw new k(R.FAILED_PRECONDITION,BT);return!1}}return this.networkEnabled&&this.inForeground?!0:eg(e).loadAll().next(s=>this.filterActiveClients(s,LT).find(a=>{if(this.clientId!==a.clientId){let l=!this.networkEnabled&&a.networkEnabled,c=!this.inForeground&&a.inForeground,u=this.networkEnabled===a.networkEnabled;if(l||c&&u)return!0}return!1})===void 0)}).next(r=>(this.isPrimary!==r&&M(vs,`Client ${r?"is":"is not"} eligible for a primary lease.`),r))}shutdown(){return T(this,null,function*(){this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&(this.clientMetadataRefresher.cancel(),this.clientMetadataRefresher=null),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),yield this.simpleDb.runTransaction("shutdown","readwrite",[Qd,Bl],e=>{let t=new Ad(e,vn.INVALID);return this.releasePrimaryLeaseIfHeld(t).next(()=>this.removeClientMetadata(t))}),this.simpleDb.close(),this.removeClientZombiedEntry()})}filterActiveClients(e,t){return e.filter(r=>this.isWithinAge(r.updateTimeMs,t)&&!this.isClientZombied(r.clientId))}getActiveClients(){return this.runTransaction("getActiveClients","readonly",e=>eg(e).loadAll().next(t=>this.filterActiveClients(t,FT).map(r=>r.clientId)))}get started(){return this._started}getGlobalsCache(){return this.globalsCache}getMutationQueue(e,t){return Ig.forUser(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Lb(e,this.serializer.remoteSerializer.databaseId)}getDocumentOverlayCache(e){return Cg.forUser(this.serializer,e)}getBundleCache(){return this.bundleCache}runTransaction(e,t,r){M(vs,"Starting transaction:",e);let i=t==="readonly"?"readonly":"readwrite",s=uQ(this.schemaVersion),o;return this.simpleDb.runTransaction(e,i,s,a=>(o=new Ad(a,this.listenSequence?this.listenSequence.next():vn.INVALID),t==="readwrite-primary"?this.verifyPrimaryLease(o).next(l=>l?!0:this.canActAsPrimary(o)).next(l=>{if(!l)throw $e(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)),new k(R.FAILED_PRECONDITION,VL);return r(o)}).next(l=>this.acquireOrExtendPrimaryLease(o).next(()=>l)):this.verifyAllowTabSynchronization(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}verifyAllowTabSynchronization(e){return gd(e).get(Sl).next(r=>{if(r!==null&&this.isWithinAge(r.leaseTimestampMs,LT)&&!this.isClientZombied(r.ownerId)&&!this.isLocalClient(r)&&!this.forceOwningTab&&(!this.allowTabSynchronization||!r.allowTabSynchronization))throw new k(R.FAILED_PRECONDITION,BT)})}acquireOrExtendPrimaryLease(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return gd(e).put(Sl,t)}static isAvailable(){return bs.isAvailable()}releasePrimaryLeaseIfHeld(e){let t=gd(e);return t.get(Sl).next(r=>this.isLocalClient(r)?(M(vs,"Releasing primary lease."),t.delete(Sl)):I.resolve())}isWithinAge(e,t){let r=Date.now(),i=r-t,s=r;return e<i?!1:e>s?($e(`Detected an update time that is in the future: ${e} > ${s}`),!1):!0}attachVisibilityHandler(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.documentVisibilityHandler=()=>{this.queue.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.updateClientMetadataAndTryBecomePrimary()))},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground=this.document.visibilityState==="visible")}detachVisibilityHandler(){this.documentVisibilityHandler&&(this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)}attachWindowUnloadHook(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.windowUnloadHandler=()=>{this.markClientZombied();let t=/(?:Version|Mobile)\/1[456]/;Ky()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.queue.enterRestrictedMode(!0),this.queue.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.windowUnloadHandler))}detachWindowUnloadHook(){this.windowUnloadHandler&&(this.window.removeEventListener("pagehide",this.windowUnloadHandler),this.windowUnloadHandler=null)}isClientZombied(e){var t;try{let r=((t=this.webStorage)===null||t===void 0?void 0:t.getItem(this.zombiedClientLocalStorageKey(e)))!==null;return M(vs,`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return $e(vs,"Failed to get zombied client id.",r),!1}}markClientZombied(){if(this.webStorage)try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(e){$e("Failed to set zombie client id.",e)}}removeClientZombiedEntry(){if(this.webStorage)try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch{}}zombiedClientLocalStorageKey(e){return`${QX}_${this.persistenceKey}_${e}`}};function gd(n){return _t(n,Qd)}function eg(n){return _t(n,Bl)}function fI(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}function YX(n){return T(this,null,function*(){if(!bs.isAvailable())return Promise.resolve();let e=n+oB;yield bs.delete(e)})}function XX(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;++t)if(n[t]!==e[t])return!1;return!0}var pI="LocalStore",JX=5*60*1e6,zd=class{constructor(e,t,r,i){this.persistence=e,this.queryEngine=t,this.serializer=i,this.targetDataByTarget=new Fe(ne),this.targetIdByTarget=new $r(s=>Vo(s),Zd),this.collectionGroupReadTime=new Map,this.remoteDocuments=e.getRemoteDocumentCache(),this.targetCache=e.getTargetCache(),this.bundleCache=e.getBundleCache(),this.initializeUserComponents(r)}initializeUserComponents(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Rg(this.remoteDocuments,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.remoteDocuments.setIndexManager(this.indexManager),this.queryEngine.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.targetDataByTarget))}};function aB(n,e,t,r){return new zd(n,e,t,r)}function lB(n,e){return T(this,null,function*(){let t=U(n);return yield t.persistence.runTransaction("Handle user change","readonly",i=>{let s;return t.mutationQueue.getAllMutationBatches(i).next(o=>(s=o,t.initializeUserComponents(e),t.mutationQueue.getAllMutationBatches(i))).next(o=>{let a=[],l=[],c=ie();for(let u of s){a.push(u.batchId);for(let d of u.mutations)c=c.add(d.key)}for(let u of o){l.push(u.batchId);for(let d of u.mutations)c=c.add(d.key)}return t.localDocuments.getDocuments(i,c).next(u=>({affectedDocuments:u,removedBatchIds:a,addedBatchIds:l}))})})})}function ZX(n,e){let t=U(n),r=He.now(),i=e.reduce((a,l)=>a.add(l.key),ie()),s,o;return t.persistence.runTransaction("Locally write mutations","readwrite",a=>{let l=on(),c=ie();return t.remoteDocuments.getEntries(a,i).next(u=>{l=u,l.forEach((d,h)=>{h.isValidDocument()||(c=c.add(d))})}).next(()=>t.localDocuments.getOverlayedDocuments(a,l)).next(u=>{s=u;let d=[];for(let h of e){let p=D7(h,s.get(h.key).overlayedDocument);p!=null&&d.push(new ar(h.key,p,d2(p.value.mapValue),Je.exists(!0)))}return t.mutationQueue.addMutationBatch(a,r,d,e)}).next(u=>{o=u;let d=u.applyToLocalDocumentSet(s,c);return t.documentOverlayCache.saveOverlays(a,u.batchId,d)})}).then(()=>({batchId:o.batchId,changes:b2(s)}))}function eJ(n,e){let t=U(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),s=t.remoteDocuments.newChangeBuffer({trackRemovals:!0});return uJ(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,tJ(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function tJ(n){let e=ie();for(let t=0;t<n.mutationResults.length;++t)n.mutationResults[t].transformResults.length>0&&(e=e.add(n.batch.mutations[t].key));return e}function nJ(n,e){let t=U(n);return t.persistence.runTransaction("Reject batch","readwrite-primary",r=>{let i;return t.mutationQueue.lookupMutationBatch(r,e).next(s=>(j(s!==null),i=s.keys(),t.mutationQueue.removeMutationBatch(r,s))).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,i)).next(()=>t.localDocuments.getDocuments(r,i))})}function rJ(n){let e=U(n);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",t=>e.mutationQueue.getHighestUnacknowledgedBatchId(t))}function cB(n){let e=U(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.targetCache.getLastRemoteSnapshotVersion(t))}function iJ(n,e){let t=U(n),r=e.snapshotVersion,i=t.targetDataByTarget;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=t.remoteDocuments.newChangeBuffer({trackRemovals:!0});i=t.targetDataByTarget;let a=[];e.targetChanges.forEach((u,d)=>{let h=i.get(d);if(!h)return;a.push(t.targetCache.removeMatchingKeys(s,u.removedDocuments,d).next(()=>t.targetCache.addMatchingKeys(s,u.addedDocuments,d)));let p=h.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(d)!==null?p=p.withResumeToken(st.EMPTY_BYTE_STRING,Q.min()).withLastLimboFreeSnapshotVersion(Q.min()):u.resumeToken.approximateByteSize()>0&&(p=p.withResumeToken(u.resumeToken,r)),i=i.insert(d,p),sJ(h,p,u)&&a.push(t.targetCache.updateTargetData(s,p))});let l=on(),c=ie();if(e.documentUpdates.forEach(u=>{e.resolvedLimboDocuments.has(u)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,u))}),a.push(uB(s,o,e.documentUpdates).next(u=>{l=u.changedDocuments,c=u.existenceChangedKeys})),!r.isEqual(Q.min())){let u=t.targetCache.getLastRemoteSnapshotVersion(s).next(d=>t.targetCache.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(u)}return I.waitFor(a).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,l,c)).next(()=>l)}).then(s=>(t.targetDataByTarget=i,s))}function uB(n,e,t){let r=ie(),i=ie();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let o=on();return t.forEach((a,l)=>{let c=s.get(a);l.isFoundDocument()!==c.isFoundDocument()&&(i=i.add(a)),l.isNoDocument()&&l.version.isEqual(Q.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!c.isValidDocument()||l.version.compareTo(c.version)>0||l.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):M(pI,"Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",l.version)}),{changedDocuments:o,existenceChangedKeys:i}})}function sJ(n,e,t){return n.resumeToken.approximateByteSize()===0||e.snapshotVersion.toMicroseconds()-n.snapshotVersion.toMicroseconds()>=JX?!0:t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size>0}function oJ(n,e){return T(this,null,function*(){let t=U(n);try{yield t.persistence.runTransaction("notifyLocalViewChanges","readwrite",r=>I.forEach(e,i=>I.forEach(i.addedKeys,s=>t.persistence.referenceDelegate.addReference(r,i.targetId,s)).next(()=>I.forEach(i.removedKeys,s=>t.persistence.referenceDelegate.removeReference(r,i.targetId,s)))))}catch(r){if(Fs(r))M(pI,"Failed to update sequence numbers: "+r);else throw r}for(let r of e){let i=r.targetId;if(!r.fromCache){let s=t.targetDataByTarget.get(i),o=s.snapshotVersion,a=s.withLastLimboFreeSnapshotVersion(o);t.targetDataByTarget=t.targetDataByTarget.insert(i,a)}}})}function aJ(n,e){let t=U(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=ws),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function lJ(n,e){let t=U(n);return t.persistence.runTransaction("read document","readonly",r=>t.localDocuments.getDocument(r,e))}function Kl(n,e){let t=U(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.targetCache.getTargetData(r,e).next(s=>s?(i=s,I.resolve(i)):t.targetCache.allocateTargetId(r).next(o=>(i=new $l(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.targetCache.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.targetDataByTarget.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.targetDataByTarget=t.targetDataByTarget.insert(r.targetId,r),t.targetIdByTarget.set(e,r.targetId)),r})}function cJ(n,e,t){let r=U(n),i=r.targetIdByTarget.get(t);return i!==void 0?I.resolve(r.targetDataByTarget.get(i)):r.targetCache.getTargetData(e,t)}function Ql(n,e,t){return T(this,null,function*(){let r=U(n),i=r.targetDataByTarget.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(Fs(o))M(pI,`Failed to update sequence numbers for target ${e}: ${o}`);else throw o}r.targetDataByTarget=r.targetDataByTarget.remove(e),r.targetIdByTarget.delete(i.target)})}function dy(n,e,t){let r=U(n),i=Q.min(),s=ie();return r.persistence.runTransaction("Execute query","readwrite",o=>cJ(r,o,Xt(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.targetCache.getMatchingKeysForTargetId(o,a.targetId).next(l=>{s=l})}).next(()=>r.queryEngine.getDocumentsMatchingQuery(o,e,t?i:Q.min(),t?s:ie())).next(a=>(fB(r,C2(e),a),{documents:a,remoteKeys:s})))}function uJ(n,e,t,r){let i=t.batch,s=i.keys(),o=I.resolve();return s.forEach(a=>{o=o.next(()=>r.getEntry(e,a)).next(l=>{let c=t.docVersions.get(a);j(c!==null),l.version.compareTo(c)<0&&(i.applyToRemoteDocument(l,t),l.isValidDocument()&&(l.setReadTime(t.commitVersion),r.addEntry(l)))})}),o.next(()=>n.mutationQueue.removeMutationBatch(e,i))}function dJ(n,e){let t=U(n),r=U(t.mutationQueue);return t.persistence.runTransaction("Lookup mutation documents","readonly",i=>r.lookupMutationKeys(i,e).next(s=>s?t.localDocuments.getDocuments(i,s):I.resolve(null)))}function hJ(n,e){U(U(n,zd).mutationQueue).removeCachedMutationKeys(e)}function fJ(n){return U(U(n,zd).persistence).getActiveClients()}function dB(n,e){let t=U(n),r=U(t.targetCache),i=t.targetDataByTarget.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>r.getTargetDataForTarget(s,e).next(o=>o?o.target:null))}function hB(n,e){let t=U(n),r=t.collectionGroupReadTime.get(e)||Q.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.remoteDocuments.getAllFromCollectionGroup(i,e,LL(r,Ll),Number.MAX_SAFE_INTEGER)).then(i=>(fB(t,e,i),i))}function fB(n,e,t){let r=n.collectionGroupReadTime.get(e)||Q.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.collectionGroupReadTime.set(e,r)}function pJ(n){return Xt(sc(pe.fromString(`__bundle__/docs/${n}`)))}function mJ(n,e,t,r){return T(this,null,function*(){let i=U(n),s=ie(),o=on();for(let c of t){let u=e.toDocumentKey(c.metadata.name);c.document&&(s=s.add(u));let d=e.toMutableDocument(c);d.setReadTime(e.toSnapshotVersion(c.metadata.readTime)),o=o.insert(u,d)}let a=i.remoteDocuments.newChangeBuffer({trackRemovals:!0}),l=yield Kl(i,pJ(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",c=>uB(c,a,o).next(u=>(a.apply(c),u)).next(u=>i.targetCache.removeMatchingKeysForTargetId(c,l.targetId).next(()=>i.targetCache.addMatchingKeys(c,s,l.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(c,u.changedDocuments,u.existenceChangedKeys)).next(()=>u.changedDocuments)))})}function gJ(n,e){let t=U(n),r=rt(e.createTime);return t.persistence.runTransaction("hasNewerBundle","readonly",i=>t.bundleCache.getBundleMetadata(i,e.id)).then(i=>!!i&&i.createTime.compareTo(r)>=0)}function yJ(n,e){let t=U(n);return t.persistence.runTransaction("Save bundle","readwrite",r=>t.bundleCache.saveBundleMetadata(r,e))}function _J(n,e){let t=U(n);return t.persistence.runTransaction("Get named query","readonly",r=>t.bundleCache.getNamedQuery(r,e))}function vJ(r,i){return T(this,arguments,function*(n,e,t=ie()){let s=yield Kl(n,Xt(cI(e.bundledQuery))),o=U(n);return o.persistence.runTransaction("Save named query","readwrite",a=>{let l=rt(e.readTime);if(s.snapshotVersion.compareTo(l)>=0)return o.bundleCache.saveNamedQuery(a,e);let c=s.withResumeToken(st.EMPTY_BYTE_STRING,l);return o.targetDataByTarget=o.targetDataByTarget.insert(c.targetId,c),o.targetCache.updateTargetData(a,c).next(()=>o.targetCache.removeMatchingKeysForTargetId(a,s.targetId)).next(()=>o.targetCache.addMatchingKeys(a,t,s.targetId)).next(()=>o.bundleCache.saveNamedQuery(a,e))})})}var n0=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var EJ=100;function SJ(){return Ky()?8:UL(wc())>0?6:4}var kg=class{constructor(){this.initialized=!1,this.indexAutoCreationEnabled=!1,this.indexAutoCreationMinCollectionSize=EJ,this.relativeIndexReadCostPerDocument=SJ()}initialize(e,t){this.localDocumentsView=e,this.indexManager=t,this.initialized=!0}getDocumentsMatchingQuery(e,t,r,i){let s={result:null};return this.performQueryUsingIndex(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.performQueryUsingRemoteKeys(e,t,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new n0;return this.executeFullCollectionScan(e,t,o).next(a=>{if(s.result=a,this.indexAutoCreationEnabled)return this.createCacheIndexes(e,t,o,a.size)})}).next(()=>s.result)}createCacheIndexes(e,t,r,i){return r.documentReadCount<this.indexAutoCreationMinCollectionSize?(Rl()<=bn.DEBUG&&M("QueryEngine","SDK will not create cache indexes for query:",Dl(t),"since it only creates cache indexes for collection contains","more than or equal to",this.indexAutoCreationMinCollectionSize,"documents"),I.resolve()):(Rl()<=bn.DEBUG&&M("QueryEngine","Query:",Dl(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.relativeIndexReadCostPerDocument*i?(Rl()<=bn.DEBUG&&M("QueryEngine","The SDK decides to create cache indexes for query:",Dl(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Xt(t))):I.resolve())}performQueryUsingIndex(e,t){if(BF(t))return I.resolve(null);let r=Xt(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=yg(t,null,"F"),r=Xt(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{let o=ie(...s);return this.localDocumentsView.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{let c=this.applyQuery(t,a);return this.needsRefill(t,c,o,l.readTime)?this.performQueryUsingIndex(e,yg(t,null,"F")):this.appendRemainingResults(e,c,t,l)}))})))}performQueryUsingRemoteKeys(e,t,r,i){return BF(t)||i.isEqual(Q.min())?I.resolve(null):this.localDocumentsView.getDocuments(e,r).next(s=>{let o=this.applyQuery(t,s);return this.needsRefill(t,o,r,i)?I.resolve(null):(Rl()<=bn.DEBUG&&M("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Dl(t)),this.appendRemainingResults(e,o,t,LL(i,Ll)).next(a=>a))})}applyQuery(e,t){let r=new De(w2(e));return t.forEach((i,s)=>{th(e,s)&&(r=r.add(s))}),r}needsRefill(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return s?s.hasPendingWrites||s.version.compareTo(i)>0:!1}executeFullCollectionScan(e,t,r){return Rl()<=bn.DEBUG&&M("QueryEngine","Using full collection scan to execute query:",Dl(t)),this.localDocumentsView.getDocumentsMatchingQuery(e,t,Un.min(),r)}appendRemainingResults(e,t,r,i){return this.localDocumentsView.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}};var pB="firestore_clients";function yL(n,e){return`${pB}_${n}_${e}`}var mB="firestore_mutations";function _L(n,e,t){let r=`${mB}_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}var gB="firestore_targets";function VT(n,e){return`${gB}_${n}_${e}`}var CJ="firestore_online_state";function wJ(n){return`${CJ}_${n}`}var TJ="firestore_bundle_loaded_v2";function bJ(n){return`${TJ}_${n}`}var IJ="firestore_sequence_number";function AJ(n){return`${IJ}_${n}`}var Ur="SharedClientState",Og=class n{constructor(e,t,r,i){this.user=e,this.batchId=t,this.state=r,this.error=i}static fromWebStorageEntry(e,t,r){let i=JSON.parse(r),s=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object"),o;return s&&i.error&&(s=typeof i.error.message=="string"&&typeof i.error.code=="string",s&&(o=new k(i.error.code,i.error.message))),s?new n(e,t,i.state,o):($e(Ur,`Failed to parse mutation state for ID '${t}': ${r}`),null)}toWebStorageJSON(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},wd=class n{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static fromWebStorageEntry(e,t){let r=JSON.parse(t),i=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object"),s;return i&&r.error&&(i=typeof r.error.message=="string"&&typeof r.error.code=="string",i&&(s=new k(r.error.code,r.error.message))),i?new n(e,r.state,s):($e(Ur,`Failed to parse target state for ID '${e}': ${t}`),null)}toWebStorageJSON(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},xg=class n{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static fromWebStorageEntry(e,t){let r=JSON.parse(t),i=typeof r=="object"&&r.activeTargetIds instanceof Array,s=oI();for(let o=0;i&&o<r.activeTargetIds.length;++o)i=o2(r.activeTargetIds[o]),s=s.add(r.activeTargetIds[o]);return i?new n(e,s):($e(Ur,`Failed to parse client data for instance '${e}': ${t}`),null)}},r0=class n{constructor(e,t){this.clientId=e,this.onlineState=t}static fromWebStorageEntry(e){let t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new n(t.clientId,t.onlineState):($e(Ur,`Failed to parse online state: ${e}`),null)}},Gd=class{constructor(){this.activeTargetIds=oI()}addQueryTarget(e){this.activeTargetIds=this.activeTargetIds.add(e)}removeQueryTarget(e){this.activeTargetIds=this.activeTargetIds.delete(e)}toWebStorageJSON(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},Td=class{constructor(e,t,r,i,s){this.window=e,this.queue=t,this.persistenceKey=r,this.localClientId=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.storageListener=this.handleWebStorageEvent.bind(this),this.activeClients=new Fe(ne),this.started=!1,this.earlyEvents=[];let o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.localClientStorageKey=yL(this.persistenceKey,this.localClientId),this.sequenceNumberKey=AJ(this.persistenceKey),this.activeClients=this.activeClients.insert(this.localClientId,new Gd),this.clientStateKeyRe=new RegExp(`^${pB}_${o}_([^_]*)$`),this.mutationBatchKeyRe=new RegExp(`^${mB}_${o}_(\\d+)(?:_(.*))?$`),this.queryTargetKeyRe=new RegExp(`^${gB}_${o}_(\\d+)$`),this.onlineStateKey=wJ(this.persistenceKey),this.bundleLoadedKey=bJ(this.persistenceKey),this.window.addEventListener("storage",this.storageListener)}static isAvailable(e){return!!(e&&e.localStorage)}start(){return T(this,null,function*(){let e=yield this.syncEngine.getActiveClients();for(let r of e){if(r===this.localClientId)continue;let i=this.getItem(yL(this.persistenceKey,r));if(i){let s=xg.fromWebStorageEntry(r,i);s&&(this.activeClients=this.activeClients.insert(s.clientId,s))}}this.persistClientState();let t=this.storage.getItem(this.onlineStateKey);if(t){let r=this.fromWebStorageOnlineState(t);r&&this.handleOnlineStateEvent(r)}for(let r of this.earlyEvents)this.handleWebStorageEvent(r);this.earlyEvents=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(e){this.setItem(this.sequenceNumberKey,JSON.stringify(e))}getAllActiveQueryTargets(){return this.extractActiveQueryTargets(this.activeClients)}isActiveQueryTarget(e){let t=!1;return this.activeClients.forEach((r,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.persistMutationState(e,"pending")}updateMutationState(e,t,r){this.persistMutationState(e,t,r),this.removeMutationState(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){let i=this.storage.getItem(VT(this.persistenceKey,e));if(i){let s=wd.fromWebStorageEntry(e,i);s&&(r=s.state)}}return t&&this.localClientState.addQueryTarget(e),this.persistClientState(),r}removeLocalQueryTarget(e){this.localClientState.removeQueryTarget(e),this.persistClientState()}isLocalQueryTarget(e){return this.localClientState.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(VT(this.persistenceKey,e))}updateQueryState(e,t,r){this.persistQueryTargetState(e,t,r)}handleUserChange(e,t,r){t.forEach(i=>{this.removeMutationState(i)}),this.currentUser=e,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.persistOnlineState(e)}notifyBundleLoaded(e){this.persistBundleLoadedState(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return M(Ur,"READ",e,t),t}setItem(e,t){M(Ur,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){M(Ur,"REMOVE",e),this.storage.removeItem(e)}handleWebStorageEvent(e){let t=e;if(t.storageArea===this.storage){if(M(Ur,"EVENT",t.key,t.newValue),t.key===this.localClientStorageKey){$e("Received WebStorage notification for local change. Another client might have garbage-collected our state");return}this.queue.enqueueRetryable(()=>T(this,null,function*(){if(!this.started){this.earlyEvents.push(t);return}if(t.key!==null){if(this.clientStateKeyRe.test(t.key))if(t.newValue!=null){let r=this.fromWebStorageClientState(t.key,t.newValue);if(r)return this.handleClientStateEvent(r.clientId,r)}else{let r=this.fromWebStorageClientStateKey(t.key);return this.handleClientStateEvent(r,null)}else if(this.mutationBatchKeyRe.test(t.key)){if(t.newValue!==null){let r=this.fromWebStorageMutationMetadata(t.key,t.newValue);if(r)return this.handleMutationBatchEvent(r)}}else if(this.queryTargetKeyRe.test(t.key)){if(t.newValue!==null){let r=this.fromWebStorageQueryTargetMetadata(t.key,t.newValue);if(r)return this.handleQueryTargetEvent(r)}}else if(t.key===this.onlineStateKey){if(t.newValue!==null){let r=this.fromWebStorageOnlineState(t.newValue);if(r)return this.handleOnlineStateEvent(r)}}else if(t.key===this.sequenceNumberKey){let r=RJ(t.newValue);r!==vn.INVALID&&this.sequenceNumberHandler(r)}else if(t.key===this.bundleLoadedKey){let r=this.fromWebStoreBundleLoadedState(t.newValue);yield Promise.all(r.map(i=>this.syncEngine.synchronizeWithChangedDocuments(i)))}}}))}}get localClientState(){return this.activeClients.get(this.localClientId)}persistClientState(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())}persistMutationState(e,t,r){let i=new Og(this.currentUser,e,t,r),s=_L(this.persistenceKey,this.currentUser,e);this.setItem(s,i.toWebStorageJSON())}removeMutationState(e){let t=_L(this.persistenceKey,this.currentUser,e);this.removeItem(t)}persistOnlineState(e){let t={clientId:this.localClientId,onlineState:e};this.storage.setItem(this.onlineStateKey,JSON.stringify(t))}persistQueryTargetState(e,t,r){let i=VT(this.persistenceKey,e),s=new wd(e,t,r);this.setItem(i,s.toWebStorageJSON())}persistBundleLoadedState(e){let t=JSON.stringify(Array.from(e));this.setItem(this.bundleLoadedKey,t)}fromWebStorageClientStateKey(e){let t=this.clientStateKeyRe.exec(e);return t?t[1]:null}fromWebStorageClientState(e,t){let r=this.fromWebStorageClientStateKey(e);return xg.fromWebStorageEntry(r,t)}fromWebStorageMutationMetadata(e,t){let r=this.mutationBatchKeyRe.exec(e),i=Number(r[1]),s=r[2]!==void 0?r[2]:null;return Og.fromWebStorageEntry(new ft(s),i,t)}fromWebStorageQueryTargetMetadata(e,t){let r=this.queryTargetKeyRe.exec(e),i=Number(r[1]);return wd.fromWebStorageEntry(i,t)}fromWebStorageOnlineState(e){return r0.fromWebStorageEntry(e)}fromWebStoreBundleLoadedState(e){return JSON.parse(e)}handleMutationBatchEvent(e){return T(this,null,function*(){if(e.user.uid!==this.currentUser.uid){M(Ur,`Ignoring mutation for non-active user ${e.user.uid}`);return}return this.syncEngine.applyBatchState(e.batchId,e.state,e.error)})}handleQueryTargetEvent(e){return this.syncEngine.applyTargetState(e.targetId,e.state,e.error)}handleClientStateEvent(e,t){let r=t?this.activeClients.insert(e,t):this.activeClients.remove(e),i=this.extractActiveQueryTargets(this.activeClients),s=this.extractActiveQueryTargets(r),o=[],a=[];return s.forEach(l=>{i.has(l)||o.push(l)}),i.forEach(l=>{s.has(l)||a.push(l)}),this.syncEngine.applyActiveTargetsChange(o,a).then(()=>{this.activeClients=r})}handleOnlineStateEvent(e){this.activeClients.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}extractActiveQueryTargets(e){let t=oI();return e.forEach((r,i)=>{t=t.unionWith(i.activeTargetIds)}),t}};function RJ(n){let e=vn.INVALID;if(n!=null)try{let t=JSON.parse(n);j(typeof t=="number"),e=t}catch(t){$e(Ur,"Failed to read sequence number from WebStorage",t)}return e}var Pg=class{constructor(){this.localState=new Gd,this.queryState={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.localState.addQueryTarget(e),this.queryState[e]||"not-current"}updateQueryState(e,t,r){this.queryState[e]=t}removeLocalQueryTarget(e){this.localState.removeQueryTarget(e)}isLocalQueryTarget(e){return this.localState.activeTargetIds.has(e)}clearQueryState(e){delete this.queryState[e]}getAllActiveQueryTargets(){return this.localState.activeTargetIds}isActiveQueryTarget(e){return this.localState.activeTargetIds.has(e)}start(){return this.localState=new Gd,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var i0=class{addCallback(e){}shutdown(){}};var s0=class{constructor(e){this.sendFn=e.sendFn,this.closeFn=e.closeFn}onConnected(e){this.wrappedOnConnected=e}onOpen(e){this.wrappedOnOpen=e}onClose(e){this.wrappedOnClose=e}onMessage(e){this.wrappedOnMessage=e}close(){this.closeFn()}send(e){this.sendFn(e)}callOnConnected(){this.wrappedOnConnected()}callOnOpen(){this.wrappedOnOpen()}callOnClose(e){this.wrappedOnClose(e)}callOnMessage(e){this.wrappedOnMessage(e)}};var tg=null;function DJ(){return 268435456+Math.round(2147483648*Math.random())}function UT(){return tg===null?tg=DJ():tg++,"0x"+tg.toString(16)}function NJ(n){return new Promise((e,t)=>{n((r,i)=>{r?t(r):e(i)})})}var kJ="1.9.1",Qt="GrpcConnection",OJ=`gl-node/${process.versions.node} fire/${tc} grpc/${kJ}`;function qT(n,e,t,r){j(e===null||e.type==="OAuth");let i=new xo.Metadata;return e&&e.headers.forEach((s,o)=>i.set(o,s)),t&&t.headers.forEach((s,o)=>i.set(o,s)),r&&i.set("X-Firebase-GMPID",r),i.set("X-Goog-Api-Client",OJ),i.set("Google-Cloud-Resource-Prefix",n),i.set("x-goog-request-params",n),i}var o0=class{constructor(e,t){this.databaseInfo=t,this.cachedStub=null,this.firestore=e.google.firestore.v1,this.databasePath=`projects/${t.databaseId.projectId}/databases/${t.databaseId.database}`}get shouldResourcePathBeIncludedInRequest(){return!0}ensureActiveStub(){if(!this.cachedStub){M(Qt,"Creating Firestore stub.");let e=this.databaseInfo.ssl?xo.credentials.createSsl():xo.credentials.createInsecure();this.cachedStub=new this.firestore.Firestore(this.databaseInfo.host,e)}return this.cachedStub}invokeRPC(e,t,r,i,s){let o=UT(),a=this.ensureActiveStub(),l=qT(this.databasePath,i,s,this.databaseInfo.appId),c=Object.assign({database:this.databasePath},r);return NJ(u=>(M(Qt,`RPC '${e}' ${o} invoked with request:`,r),a[e](c,l,(d,h)=>{d?(M(Qt,`RPC '${e}' ${o} failed with error:`,d),u(new k(og(d.code),d.message))):(M(Qt,`RPC '${e}' ${o} completed with response:`,h),u(void 0,h))})))}invokeStreamingRPC(e,t,r,i,s,o){let a=UT(),l=[],c=new dt;M(Qt,`RPC '${e}' ${a} invoked (streaming) with request:`,r);let u=this.ensureActiveStub(),d=qT(this.databasePath,i,s,this.databaseInfo.appId),h=Object.assign(Object.assign({},r),{database:this.databasePath}),p=u[e](h,d),E=!1;return p.on("data",w=>{M(Qt,`RPC ${e} ${a} received result:`,w),l.push(w),o!==void 0&&l.length===o&&(E=!0,c.resolve(l))}),p.on("end",()=>{M(Qt,`RPC '${e}' ${a} completed.`),E||(E=!0,c.resolve(l))}),p.on("error",w=>{M(Qt,`RPC '${e}' ${a} failed with error:`,w);let b=og(w.code);c.reject(new k(b,w.message))}),c.promise}openStream(e,t,r){let i=UT(),s=this.ensureActiveStub(),o=qT(this.databasePath,t,r,this.databaseInfo.appId),a=s[e](o),l=!1,c=h=>{l||(l=!0,u.callOnClose(h),a.end())},u=new s0({sendFn:h=>{if(l)M(Qt,`RPC '${e}' stream ${i} not sending because gRPC stream is closed:`,h);else{M(Qt,`RPC '${e}' stream ${i} sending:`,h);try{a.write(h)}catch(p){throw $e("Failure sending:",h),$e("Error:",p),p}}},closeFn:()=>{M(Qt,`RPC '${e}' stream ${i} closed locally via close().`),c()}}),d=!1;return a.on("data",h=>{l||(M(Qt,`RPC '${e}' stream ${i} received:`,h),d||(u.callOnConnected(),d=!0),u.callOnMessage(h))}),a.on("end",()=>{M(Qt,`RPC '${e}' stream ${i} ended.`),c()}),a.on("error",h=>{if(!l){ir(Qt,`RPC '${e}' stream ${i} error. Code:`,h.code,"Message:",h.message);let p=og(h.code);c(new k(p,h.message))}}),M(Qt,`Opening RPC '${e}' stream ${i} to ${this.databaseInfo.host}`),setTimeout(()=>{u.callOnOpen()},0),u}terminate(){this.cachedStub&&(this.cachedStub.close(),this.cachedStub=void 0)}},yB={google:{nested:{protobuf:{options:{csharp_namespace:"Google.Protobuf.WellKnownTypes",go_package:"github.com/golang/protobuf/ptypes/wrappers",java_package:"com.google.protobuf",java_outer_classname:"WrappersProto",java_multiple_files:!0,objc_class_prefix:"GPB",cc_enable_arenas:!0,optimize_for:"SPEED"},nested:{Timestamp:{fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}},FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}},Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},Empty:{fields:{}},DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}},Any:{fields:{typeUrl:{type:"string",id:1},value:{type:"bytes",id:2}}}}},firestore:{nested:{v1:{options:{csharp_namespace:"Google.Cloud.Firestore.V1",go_package:"google.golang.org/genproto/googleapis/firestore/v1;firestore",java_multiple_files:!0,java_outer_classname:"WriteProto",java_package:"com.google.firestore.v1",objc_class_prefix:"GCFS",php_namespace:"Google\\Cloud\\Firestore\\V1",ruby_package:"Google::Cloud::Firestore::V1"},nested:{AggregationResult:{fields:{aggregateFields:{keyType:"string",type:"Value",id:2}}},BitSequence:{fields:{bitmap:{type:"bytes",id:1},padding:{type:"int32",id:2}}},BloomFilter:{fields:{bits:{type:"BitSequence",id:1},hashCount:{type:"int32",id:2}}},DocumentMask:{fields:{fieldPaths:{rule:"repeated",type:"string",id:1}}},Precondition:{oneofs:{conditionType:{oneof:["exists","updateTime"]}},fields:{exists:{type:"bool",id:1},updateTime:{type:"google.protobuf.Timestamp",id:2}}},TransactionOptions:{oneofs:{mode:{oneof:["readOnly","readWrite"]}},fields:{readOnly:{type:"ReadOnly",id:2},readWrite:{type:"ReadWrite",id:3}},nested:{ReadWrite:{fields:{retryTransaction:{type:"bytes",id:1}}},ReadOnly:{oneofs:{consistencySelector:{oneof:["readTime"]}},fields:{readTime:{type:"google.protobuf.Timestamp",id:2}}}}},Document:{fields:{name:{type:"string",id:1},fields:{keyType:"string",type:"Value",id:2},createTime:{type:"google.protobuf.Timestamp",id:3},updateTime:{type:"google.protobuf.Timestamp",id:4}}},Value:{oneofs:{valueType:{oneof:["nullValue","booleanValue","integerValue","doubleValue","timestampValue","stringValue","bytesValue","referenceValue","geoPointValue","arrayValue","mapValue"]}},fields:{nullValue:{type:"google.protobuf.NullValue",id:11},booleanValue:{type:"bool",id:1},integerValue:{type:"int64",id:2},doubleValue:{type:"double",id:3},timestampValue:{type:"google.protobuf.Timestamp",id:10},stringValue:{type:"string",id:17},bytesValue:{type:"bytes",id:18},referenceValue:{type:"string",id:5},geoPointValue:{type:"google.type.LatLng",id:8},arrayValue:{type:"ArrayValue",id:9},mapValue:{type:"MapValue",id:6}}},ArrayValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},MapValue:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Firestore:{options:{"(google.api.default_host)":"firestore.googleapis.com","(google.api.oauth_scopes)":"https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/datastore"},methods:{GetDocument:{requestType:"GetDocumentRequest",responseType:"Document",options:{"(google.api.http).get":"/v1/{name=projects/*/databases/*/documents/*/**}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{name=projects/*/databases/*/documents/*/**}"}}]},ListDocuments:{requestType:"ListDocumentsRequest",responseType:"ListDocumentsResponse",options:{"(google.api.http).get":"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"}}]},UpdateDocument:{requestType:"UpdateDocumentRequest",responseType:"Document",options:{"(google.api.http).patch":"/v1/{document.name=projects/*/databases/*/documents/*/**}","(google.api.http).body":"document","(google.api.method_signature)":"document,update_mask"},parsedOptions:[{"(google.api.http)":{patch:"/v1/{document.name=projects/*/databases/*/documents/*/**}",body:"document"}},{"(google.api.method_signature)":"document,update_mask"}]},DeleteDocument:{requestType:"DeleteDocumentRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).delete":"/v1/{name=projects/*/databases/*/documents/*/**}","(google.api.method_signature)":"name"},parsedOptions:[{"(google.api.http)":{delete:"/v1/{name=projects/*/databases/*/documents/*/**}"}},{"(google.api.method_signature)":"name"}]},BatchGetDocuments:{requestType:"BatchGetDocumentsRequest",responseType:"BatchGetDocumentsResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchGet","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchGet",body:"*"}}]},BeginTransaction:{requestType:"BeginTransactionRequest",responseType:"BeginTransactionResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:beginTransaction","(google.api.http).body":"*","(google.api.method_signature)":"database"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:beginTransaction",body:"*"}},{"(google.api.method_signature)":"database"}]},Commit:{requestType:"CommitRequest",responseType:"CommitResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:commit","(google.api.http).body":"*","(google.api.method_signature)":"database,writes"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:commit",body:"*"}},{"(google.api.method_signature)":"database,writes"}]},Rollback:{requestType:"RollbackRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:rollback","(google.api.http).body":"*","(google.api.method_signature)":"database,transaction"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:rollback",body:"*"}},{"(google.api.method_signature)":"database,transaction"}]},RunQuery:{requestType:"RunQueryRequest",responseType:"RunQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery",body:"*"}}}]},RunAggregationQuery:{requestType:"RunAggregationQueryRequest",responseType:"RunAggregationQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery",body:"*"}}}]},PartitionQuery:{requestType:"PartitionQueryRequest",responseType:"PartitionQueryResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:partitionQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:partitionQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery",body:"*"}}}]},Write:{requestType:"WriteRequest",requestStream:!0,responseType:"WriteResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:write","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:write",body:"*"}}]},Listen:{requestType:"ListenRequest",requestStream:!0,responseType:"ListenResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:listen","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:listen",body:"*"}}]},ListCollectionIds:{requestType:"ListCollectionIdsRequest",responseType:"ListCollectionIdsResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds","(google.api.http).additional_bindings.body":"*","(google.api.method_signature)":"parent"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds",body:"*"}}},{"(google.api.method_signature)":"parent"}]},BatchWrite:{requestType:"BatchWriteRequest",responseType:"BatchWriteResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchWrite","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchWrite",body:"*"}}]},CreateDocument:{requestType:"CreateDocumentRequest",responseType:"Document",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}","(google.api.http).body":"document"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}",body:"document"}}]}}},GetDocumentRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:5}}},ListDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:3},pageToken:{type:"string",id:4},orderBy:{type:"string",id:6},mask:{type:"DocumentMask",id:7},transaction:{type:"bytes",id:8},readTime:{type:"google.protobuf.Timestamp",id:10},showMissing:{type:"bool",id:12}}},ListDocumentsResponse:{fields:{documents:{rule:"repeated",type:"Document",id:1},nextPageToken:{type:"string",id:2}}},CreateDocumentRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},documentId:{type:"string",id:3},document:{type:"Document",id:4,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:5}}},UpdateDocumentRequest:{fields:{document:{type:"Document",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},updateMask:{type:"DocumentMask",id:2},mask:{type:"DocumentMask",id:3},currentDocument:{type:"Precondition",id:4}}},DeleteDocumentRequest:{fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},currentDocument:{type:"Precondition",id:2}}},BatchGetDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},documents:{rule:"repeated",type:"string",id:2},mask:{type:"DocumentMask",id:3},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:7}}},BatchGetDocumentsResponse:{oneofs:{result:{oneof:["found","missing"]}},fields:{found:{type:"Document",id:1},missing:{type:"string",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:4}}},BeginTransactionRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},options:{type:"TransactionOptions",id:2}}},BeginTransactionResponse:{fields:{transaction:{type:"bytes",id:1}}},CommitRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},transaction:{type:"bytes",id:3}}},CommitResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},commitTime:{type:"google.protobuf.Timestamp",id:2}}},RollbackRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},transaction:{type:"bytes",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}}}},RunQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},transaction:{type:"bytes",id:5},newTransaction:{type:"TransactionOptions",id:6},readTime:{type:"google.protobuf.Timestamp",id:7}}},RunQueryResponse:{fields:{transaction:{type:"bytes",id:2},document:{type:"Document",id:1},readTime:{type:"google.protobuf.Timestamp",id:3},skippedResults:{type:"int32",id:4}}},RunAggregationQueryRequest:{oneofs:{queryType:{oneof:["structuredAggregationQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredAggregationQuery:{type:"StructuredAggregationQuery",id:2},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:6}}},RunAggregationQueryResponse:{fields:{result:{type:"AggregationResult",id:1},transaction:{type:"bytes",id:2},readTime:{type:"google.protobuf.Timestamp",id:3}}},PartitionQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},partitionCount:{type:"int64",id:3},pageToken:{type:"string",id:4},pageSize:{type:"int32",id:5}}},PartitionQueryResponse:{fields:{partitions:{rule:"repeated",type:"Cursor",id:1},nextPageToken:{type:"string",id:2}}},WriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},streamId:{type:"string",id:2},writes:{rule:"repeated",type:"Write",id:3},streamToken:{type:"bytes",id:4},labels:{keyType:"string",type:"string",id:5}}},WriteResponse:{fields:{streamId:{type:"string",id:1},streamToken:{type:"bytes",id:2},writeResults:{rule:"repeated",type:"WriteResult",id:3},commitTime:{type:"google.protobuf.Timestamp",id:4}}},ListenRequest:{oneofs:{targetChange:{oneof:["addTarget","removeTarget"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},addTarget:{type:"Target",id:2},removeTarget:{type:"int32",id:3},labels:{keyType:"string",type:"string",id:4}}},ListenResponse:{oneofs:{responseType:{oneof:["targetChange","documentChange","documentDelete","documentRemove","filter"]}},fields:{targetChange:{type:"TargetChange",id:2},documentChange:{type:"DocumentChange",id:3},documentDelete:{type:"DocumentDelete",id:4},documentRemove:{type:"DocumentRemove",id:6},filter:{type:"ExistenceFilter",id:5}}},Target:{oneofs:{targetType:{oneof:["query","documents"]},resumeType:{oneof:["resumeToken","readTime"]}},fields:{query:{type:"QueryTarget",id:2},documents:{type:"DocumentsTarget",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:11},targetId:{type:"int32",id:5},once:{type:"bool",id:6},expectedCount:{type:"google.protobuf.Int32Value",id:12}},nested:{DocumentsTarget:{fields:{documents:{rule:"repeated",type:"string",id:2}}},QueryTarget:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1},structuredQuery:{type:"StructuredQuery",id:2}}}}},TargetChange:{fields:{targetChangeType:{type:"TargetChangeType",id:1},targetIds:{rule:"repeated",type:"int32",id:2},cause:{type:"google.rpc.Status",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:6}},nested:{TargetChangeType:{values:{NO_CHANGE:0,ADD:1,REMOVE:2,CURRENT:3,RESET:4}}}},ListCollectionIdsRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:2},pageToken:{type:"string",id:3}}},ListCollectionIdsResponse:{fields:{collectionIds:{rule:"repeated",type:"string",id:1},nextPageToken:{type:"string",id:2}}},BatchWriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},labels:{keyType:"string",type:"string",id:3}}},BatchWriteResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},status:{rule:"repeated",type:"google.rpc.Status",id:2}}},StructuredQuery:{fields:{select:{type:"Projection",id:1},from:{rule:"repeated",type:"CollectionSelector",id:2},where:{type:"Filter",id:3},orderBy:{rule:"repeated",type:"Order",id:4},startAt:{type:"Cursor",id:7},endAt:{type:"Cursor",id:8},offset:{type:"int32",id:6},limit:{type:"google.protobuf.Int32Value",id:5}},nested:{CollectionSelector:{fields:{collectionId:{type:"string",id:2},allDescendants:{type:"bool",id:3}}},Filter:{oneofs:{filterType:{oneof:["compositeFilter","fieldFilter","unaryFilter"]}},fields:{compositeFilter:{type:"CompositeFilter",id:1},fieldFilter:{type:"FieldFilter",id:2},unaryFilter:{type:"UnaryFilter",id:3}}},CompositeFilter:{fields:{op:{type:"Operator",id:1},filters:{rule:"repeated",type:"Filter",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,AND:1,OR:2}}}},FieldFilter:{fields:{field:{type:"FieldReference",id:1},op:{type:"Operator",id:2},value:{type:"Value",id:3}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,LESS_THAN:1,LESS_THAN_OR_EQUAL:2,GREATER_THAN:3,GREATER_THAN_OR_EQUAL:4,EQUAL:5,NOT_EQUAL:6,ARRAY_CONTAINS:7,IN:8,ARRAY_CONTAINS_ANY:9,NOT_IN:10}}}},UnaryFilter:{oneofs:{operandType:{oneof:["field"]}},fields:{op:{type:"Operator",id:1},field:{type:"FieldReference",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,IS_NAN:2,IS_NULL:3,IS_NOT_NAN:4,IS_NOT_NULL:5}}}},Order:{fields:{field:{type:"FieldReference",id:1},direction:{type:"Direction",id:2}}},FieldReference:{fields:{fieldPath:{type:"string",id:2}}},Projection:{fields:{fields:{rule:"repeated",type:"FieldReference",id:2}}},Direction:{values:{DIRECTION_UNSPECIFIED:0,ASCENDING:1,DESCENDING:2}}}},StructuredAggregationQuery:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{structuredQuery:{type:"StructuredQuery",id:1},aggregations:{rule:"repeated",type:"Aggregation",id:3}},nested:{Aggregation:{oneofs:{operator:{oneof:["count","sum","avg"]}},fields:{count:{type:"Count",id:1},sum:{type:"Sum",id:2},avg:{type:"Avg",id:3},alias:{type:"string",id:7}},nested:{Count:{fields:{upTo:{type:"google.protobuf.Int64Value",id:1}}},Sum:{fields:{field:{type:"FieldReference",id:1}}},Avg:{fields:{field:{type:"FieldReference",id:1}}}}}}},Cursor:{fields:{values:{rule:"repeated",type:"Value",id:1},before:{type:"bool",id:2}}},Write:{oneofs:{operation:{oneof:["update","delete","verify","transform"]}},fields:{update:{type:"Document",id:1},delete:{type:"string",id:2},verify:{type:"string",id:5},transform:{type:"DocumentTransform",id:6},updateMask:{type:"DocumentMask",id:3},updateTransforms:{rule:"repeated",type:"DocumentTransform.FieldTransform",id:7},currentDocument:{type:"Precondition",id:4}}},DocumentTransform:{fields:{document:{type:"string",id:1},fieldTransforms:{rule:"repeated",type:"FieldTransform",id:2}},nested:{FieldTransform:{oneofs:{transformType:{oneof:["setToServerValue","increment","maximum","minimum","appendMissingElements","removeAllFromArray"]}},fields:{fieldPath:{type:"string",id:1},setToServerValue:{type:"ServerValue",id:2},increment:{type:"Value",id:3},maximum:{type:"Value",id:4},minimum:{type:"Value",id:5},appendMissingElements:{type:"ArrayValue",id:6},removeAllFromArray:{type:"ArrayValue",id:7}},nested:{ServerValue:{values:{SERVER_VALUE_UNSPECIFIED:0,REQUEST_TIME:1}}}}}},WriteResult:{fields:{updateTime:{type:"google.protobuf.Timestamp",id:1},transformResults:{rule:"repeated",type:"Value",id:2}}},DocumentChange:{fields:{document:{type:"Document",id:1},targetIds:{rule:"repeated",type:"int32",id:5},removedTargetIds:{rule:"repeated",type:"int32",id:6}}},DocumentDelete:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:6},readTime:{type:"google.protobuf.Timestamp",id:4}}},DocumentRemove:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:2},readTime:{type:"google.protobuf.Timestamp",id:4}}},ExistenceFilter:{fields:{targetId:{type:"int32",id:1},count:{type:"int32",id:2},unchangedNames:{type:"BloomFilter",id:3}}}}}}},api:{options:{go_package:"google.golang.org/genproto/googleapis/api/annotations;annotations",java_multiple_files:!0,java_outer_classname:"HttpProto",java_package:"com.google.api",objc_class_prefix:"GAPI",cc_enable_arenas:!0},nested:{http:{type:"HttpRule",id:72295728,extend:"google.protobuf.MethodOptions"},Http:{fields:{rules:{rule:"repeated",type:"HttpRule",id:1}}},HttpRule:{oneofs:{pattern:{oneof:["get","put","post","delete","patch","custom"]}},fields:{get:{type:"string",id:2},put:{type:"string",id:3},post:{type:"string",id:4},delete:{type:"string",id:5},patch:{type:"string",id:6},custom:{type:"CustomHttpPattern",id:8},selector:{type:"string",id:1},body:{type:"string",id:7},additionalBindings:{rule:"repeated",type:"HttpRule",id:11}}},CustomHttpPattern:{fields:{kind:{type:"string",id:1},path:{type:"string",id:2}}},methodSignature:{rule:"repeated",type:"string",id:1051,extend:"google.protobuf.MethodOptions"},defaultHost:{type:"string",id:1049,extend:"google.protobuf.ServiceOptions"},oauthScopes:{type:"string",id:1050,extend:"google.protobuf.ServiceOptions"},fieldBehavior:{rule:"repeated",type:"google.api.FieldBehavior",id:1052,extend:"google.protobuf.FieldOptions"},FieldBehavior:{values:{FIELD_BEHAVIOR_UNSPECIFIED:0,OPTIONAL:1,REQUIRED:2,OUTPUT_ONLY:3,INPUT_ONLY:4,IMMUTABLE:5,UNORDERED_LIST:6,NON_EMPTY_DEFAULT:7}}}},type:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/type/latlng;latlng",java_multiple_files:!0,java_outer_classname:"LatLngProto",java_package:"com.google.type",objc_class_prefix:"GTP"},nested:{LatLng:{fields:{latitude:{type:"double",id:1},longitude:{type:"double",id:2}}}}},rpc:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/rpc/status;status",java_multiple_files:!0,java_outer_classname:"StatusProto",java_package:"com.google.rpc",objc_class_prefix:"RPC"},nested:{Status:{fields:{code:{type:"int32",id:1},message:{type:"string",id:2},details:{rule:"repeated",type:"google.protobuf.Any",id:3}}}}}}}},xJ={nested:yB},PJ=Object.freeze({__proto__:null,nested:yB,default:xJ});var MJ={longs:String,enums:String,defaults:!0,oneofs:!1};function FJ(){let n=PL.fromJSON(PJ,MJ);return xo.loadPackageDefinition(n)}function LJ(n){let e=FJ();return new o0(e,n)}function BJ(){return new i0}function _B(){return process.env.USE_MOCK_PERSISTENCE==="YES"?window:null}function VJ(){return null}function rh(n){return new bb(n,!1)}var UJ="ExponentialBackoff",qJ=1e3,zJ=1.5,GJ=60*1e3,Wd=class{constructor(e,t,r=qJ,i=zJ,s=GJ){this.queue=e,this.timerId=t,this.initialDelayMs=r,this.backoffFactor=i,this.maxDelayMs=s,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}reset(){this.currentBaseMs=0}resetToMax(){this.currentBaseMs=this.maxDelayMs}backoffAndRun(e){this.cancel();let t=Math.floor(this.currentBaseMs+this.jitterDelayMs()),r=Math.max(0,Date.now()-this.lastAttemptTime),i=Math.max(0,t-r);i>0&&M(UJ,`Backing off for ${i} ms (base delay: ${this.currentBaseMs} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,i,()=>(this.lastAttemptTime=Date.now(),e())),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)}skipBackoff(){this.timerPromise!==null&&(this.timerPromise.skipDelay(),this.timerPromise=null)}cancel(){this.timerPromise!==null&&(this.timerPromise.cancel(),this.timerPromise=null)}jitterDelayMs(){return(Math.random()-.5)*this.currentBaseMs}};var vL="PersistentStream",WJ=60*1e3,jJ=10*1e3,Mg=class{constructor(e,t,r,i,s,o,a,l){this.queue=e,this.idleTimerId=r,this.healthTimerId=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.closeCount=0,this.idleTimer=null,this.healthCheck=null,this.stream=null,this.responseCount=0,this.backoff=new Wd(e,t)}isStarted(){return this.state===1||this.state===5||this.isOpen()}isOpen(){return this.state===2||this.state===3}start(){if(this.responseCount=0,this.state===4){this.performBackoff();return}this.auth()}stop(){return T(this,null,function*(){this.isStarted()&&(yield this.close(0))})}inhibitBackoff(){this.state=0,this.backoff.reset()}markIdle(){this.isOpen()&&this.idleTimer===null&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,WJ,()=>this.handleIdleCloseTimer()))}sendRequest(e){this.cancelIdleCheck(),this.stream.send(e)}handleIdleCloseTimer(){return T(this,null,function*(){if(this.isOpen())return this.close(0)})}cancelIdleCheck(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)}cancelHealthCheck(){this.healthCheck&&(this.healthCheck.cancel(),this.healthCheck=null)}close(e,t){return T(this,null,function*(){this.cancelIdleCheck(),this.cancelHealthCheck(),this.backoff.cancel(),this.closeCount++,e!==4?this.backoff.reset():t&&t.code===R.RESOURCE_EXHAUSTED?($e(t.toString()),$e("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):t&&t.code===R.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.onClose(t)})}tearDown(){}auth(){this.state=1;let e=this.getCloseGuardedDispatcher(this.closeCount),t=this.closeCount;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.closeCount===t&&this.startStream(r,i)},r=>{e(()=>{let i=new k(R.UNKNOWN,"Fetching auth token failed: "+r.message);return this.handleStreamClose(i)})})}startStream(e,t){let r=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(e,t),this.stream.onConnected(()=>{r(()=>this.listener.onConnected())}),this.stream.onOpen(()=>{r(()=>(this.state=2,this.healthCheck=this.queue.enqueueAfterDelay(this.healthTimerId,jJ,()=>(this.isOpen()&&(this.state=3),Promise.resolve())),this.listener.onOpen()))}),this.stream.onClose(i=>{r(()=>this.handleStreamClose(i))}),this.stream.onMessage(i=>{r(()=>++this.responseCount===1?this.onFirst(i):this.onNext(i))})}performBackoff(){this.state=5,this.backoff.backoffAndRun(()=>T(this,null,function*(){this.state=0,this.start()}))}handleStreamClose(e){return M(vL,`close with error: ${e}`),this.stream=null,this.close(4,e)}getCloseGuardedDispatcher(e){return t=>{this.queue.enqueueAndForget(()=>this.closeCount===e?t():(M(vL,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},a0=class extends Mg{constructor(e,t,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}startRpc(e,t){return this.connection.openStream("Listen",e,t)}onFirst(e){return this.onNext(e)}onNext(e){this.backoff.reset();let t=eY(this.serializer,e),r=nY(e);return this.listener.onWatchChange(t,r)}watch(e){let t={};t.database=Rb(this.serializer),t.addTarget=fY(this.serializer,e);let r=dY(this.serializer,e);r&&(t.labels=r),this.sendRequest(t)}unwatch(e){let t={};t.database=Rb(this.serializer),t.removeTarget=e,this.sendRequest(t)}},l0=class extends Mg{constructor(e,t,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}get handshakeComplete(){return this.responseCount>0}start(){this.lastStreamToken=void 0,super.start()}tearDown(){this.handshakeComplete&&this.writeMutations([])}startRpc(e,t){return this.connection.openStream("Write",e,t)}onFirst(e){return j(!!e.streamToken),this.lastStreamToken=e.streamToken,j(!e.writeResults||e.writeResults.length===0),this.listener.onHandshakeComplete()}onNext(e){j(!!e.streamToken),this.lastStreamToken=e.streamToken,this.backoff.reset();let t=oY(e.writeResults,e.commitTime),r=rt(e.commitTime);return this.listener.onMutationResult(r,t)}writeHandshake(){let e={};e.database=Rb(this.serializer),this.sendRequest(e)}writeMutations(e){let t={streamToken:this.lastStreamToken,writes:e.map(r=>Vd(this.serializer,r))};this.sendRequest(t)}};var c0=class{},u0=class extends c0{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.terminated=!1}verifyInitialized(){if(this.terminated)throw new k(R.FAILED_PRECONDITION,"The client has already been terminated.")}invokeRPC(e,t,r,i){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.invokeRPC(e,Ab(t,r),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===R.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new k(R.UNKNOWN,s.toString())})}invokeStreamingRPC(e,t,r,i,s){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.invokeStreamingRPC(e,Ab(t,r),i,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===R.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new k(R.UNKNOWN,o.toString())})}terminate(){this.terminated=!0,this.connection.terminate()}};function $J(n,e,t,r){return new u0(n,e,t,r)}function HJ(n,e){return T(this,null,function*(){let t=U(n),r={writes:e.map(i=>Vd(t.serializer,i))};yield t.invokeRPC("Commit",t.serializer.databaseId,pe.emptyPath(),r)})}function KJ(n,e){return T(this,null,function*(){let t=U(n),r={documents:e.map(a=>Bd(t.serializer,a))},i=yield t.invokeStreamingRPC("BatchGetDocuments",t.serializer.databaseId,pe.emptyPath(),r,e.length),s=new Map;i.forEach(a=>{let l=Z7(t.serializer,a);s.set(l.key.toString(),l)});let o=[];return e.forEach(a=>{let l=s.get(a.toString());j(!!l),o.push(l)}),o})}function QJ(n,e,t){let r=U(n);return r.verifyInitialized(),new l0(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,t)}function YJ(n,e,t){let r=U(n);return r.verifyInitialized(),new a0(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,t)}var XJ="OnlineStateTracker",EL=1,SL=10*1e3,d0=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}handleWatchStreamStart(){this.watchStreamFailures===0&&(this.setAndBroadcast("Unknown"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay("online_state_timeout",SL,()=>(this.onlineStateTimer=null,this.logClientOfflineWarningIfNecessary(`Backend didn't respond within ${SL/1e3} seconds.`),this.setAndBroadcast("Offline"),Promise.resolve())))}handleWatchStreamFailure(e){this.state==="Online"?this.setAndBroadcast("Unknown"):(this.watchStreamFailures++,this.watchStreamFailures>=EL&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary(`Connection failed ${EL} times. Most recent error: ${e.toString()}`),this.setAndBroadcast("Offline")))}set(e){this.clearOnlineStateTimer(),this.watchStreamFailures=0,e==="Online"&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(e)}setAndBroadcast(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}logClientOfflineWarningIfNecessary(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.shouldWarnClientIsOffline?($e(t),this.shouldWarnClientIsOffline=!1):M(XJ,t)}clearOnlineStateTimer(){this.onlineStateTimer!==null&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)}};var Go="RemoteStore",JJ=10,h0=class{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.writePipeline=[],this.listenTargets=new Map,this.offlineCauses=new Set,this.onNetworkStatusChange=[],this.connectivityMonitor=s,this.connectivityMonitor.addCallback(o=>{r.enqueueAndForget(()=>T(this,null,function*(){Ls(this)&&(M(Go,"Restarting streams for network reachability change."),yield gZ(this))}))}),this.onlineStateTracker=new d0(r,i)}};function ZJ(n,e,t,r,i){return new h0(n,e,t,r,i)}function eZ(n){let e=U(n);return e.offlineCauses.delete(0),ih(e)}function ih(n){return T(this,null,function*(){if(Ls(n))for(let e of n.onNetworkStatusChange)yield e(!0)})}function tZ(n){return T(this,null,function*(){let e=U(n);e.offlineCauses.add(0),yield oc(e),e.onlineStateTracker.set("Offline")})}function oc(n){return T(this,null,function*(){for(let e of n.onNetworkStatusChange)yield e(!1)})}function nZ(n){return T(this,null,function*(){let e=U(n);M(Go,"RemoteStore shutting down."),e.offlineCauses.add(5),yield oc(e),e.connectivityMonitor.shutdown(),e.onlineStateTracker.set("Unknown")})}function hy(n,e){let t=U(n);t.listenTargets.has(e.targetId)||(t.listenTargets.set(e.targetId,e),yI(t)?gI(t):cc(t).isOpen()&&mI(t,e))}function ac(n,e){let t=U(n),r=cc(t);t.listenTargets.delete(e),r.isOpen()&&vB(t,e),t.listenTargets.size===0&&(r.isOpen()?r.markIdle():Ls(t)&&t.onlineStateTracker.set("Unknown"))}function mI(n,e){if(n.watchChangeAggregator.recordPendingTargetRequest(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Q.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}cc(n).watch(e)}function vB(n,e){n.watchChangeAggregator.recordPendingTargetRequest(e),cc(n).unwatch(e)}function gI(n){n.watchChangeAggregator=new Tb({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),getTargetDataForTarget:e=>n.listenTargets.get(e)||null,getDatabaseId:()=>n.datastore.serializer.databaseId}),cc(n).start(),n.onlineStateTracker.handleWatchStreamStart()}function yI(n){return Ls(n)&&!cc(n).isStarted()&&n.listenTargets.size>0}function Ls(n){return U(n).offlineCauses.size===0}function EB(n){n.watchChangeAggregator=void 0}function rZ(n){return T(this,null,function*(){n.onlineStateTracker.set("Online")})}function iZ(n){return T(this,null,function*(){n.listenTargets.forEach((e,t)=>{mI(n,e)})})}function sZ(n,e){return T(this,null,function*(){EB(n),yI(n)?(n.onlineStateTracker.handleWatchStreamFailure(e),gI(n)):n.onlineStateTracker.set("Unknown")})}function oZ(n,e,t){return T(this,null,function*(){if(n.onlineStateTracker.set("Online"),e instanceof vg&&e.state===2&&e.cause){try{yield lZ(n,e)}catch(r){M(Go,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield Fg(n,r)}return}if(e instanceof Fl?n.watchChangeAggregator.handleDocumentChange(e):e instanceof _g?n.watchChangeAggregator.handleExistenceFilter(e):n.watchChangeAggregator.handleTargetChange(e),!t.isEqual(Q.min()))try{let r=yield cB(n.localStore);t.compareTo(r)>=0&&(yield aZ(n,t))}catch(r){M(Go,"Failed to raise snapshot:",r),yield Fg(n,r)}})}function Fg(n,e,t){return T(this,null,function*(){if(Fs(e))n.offlineCauses.add(1),yield oc(n),n.onlineStateTracker.set("Offline"),t||(t=()=>cB(n.localStore)),n.asyncQueue.enqueueRetryable(()=>T(this,null,function*(){M(Go,"Retrying IndexedDB access"),yield t(),n.offlineCauses.delete(1),yield ih(n)}));else throw e})}function SB(n,e){return e().catch(t=>Fg(n,t,e))}function aZ(n,e){let t=n.watchChangeAggregator.createRemoteEvent(e);return t.targetChanges.forEach((r,i)=>{if(r.resumeToken.approximateByteSize()>0){let s=n.listenTargets.get(i);s&&n.listenTargets.set(i,s.withResumeToken(r.resumeToken,e))}}),t.targetMismatches.forEach((r,i)=>{let s=n.listenTargets.get(r);if(!s)return;n.listenTargets.set(r,s.withResumeToken(st.EMPTY_BYTE_STRING,s.snapshotVersion)),vB(n,r);let o=new $l(s.target,r,i,s.sequenceNumber);mI(n,o)}),n.remoteSyncer.applyRemoteEvent(t)}function lZ(n,e){return T(this,null,function*(){let t=e.cause;for(let r of e.targetIds)n.listenTargets.has(r)&&(yield n.remoteSyncer.rejectListen(r,t),n.listenTargets.delete(r),n.watchChangeAggregator.removeTarget(r))})}function lc(n){return T(this,null,function*(){let e=U(n),t=Bs(e),r=e.writePipeline.length>0?e.writePipeline[e.writePipeline.length-1].batchId:ws;for(;cZ(e);)try{let i=yield aJ(e.localStore,r);if(i===null){e.writePipeline.length===0&&t.markIdle();break}else r=i.batchId,uZ(e,i)}catch(i){yield Fg(e,i)}CB(e)&&wB(e)})}function cZ(n){return Ls(n)&&n.writePipeline.length<JJ}function uZ(n,e){n.writePipeline.push(e);let t=Bs(n);t.isOpen()&&t.handshakeComplete&&t.writeMutations(e.mutations)}function CB(n){return Ls(n)&&!Bs(n).isStarted()&&n.writePipeline.length>0}function wB(n){Bs(n).start()}function dZ(n){return T(this,null,function*(){Bs(n).writeHandshake()})}function hZ(n){return T(this,null,function*(){let e=Bs(n);for(let t of n.writePipeline)e.writeMutations(t.mutations)})}function fZ(n,e,t){return T(this,null,function*(){let r=n.writePipeline.shift(),i=Eb.from(r,e,t);yield SB(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield lc(n)})}function pZ(n,e){return T(this,null,function*(){e&&Bs(n).handshakeComplete&&(yield mZ(n,e)),CB(n)&&wB(n)})}function mZ(n,e){return T(this,null,function*(){if(F7(e.code)){let t=n.writePipeline.shift();Bs(n).inhibitBackoff(),yield SB(n,()=>n.remoteSyncer.rejectFailedWrite(t.batchId,e)),yield lc(n)}})}function gZ(n){return T(this,null,function*(){let e=U(n);e.offlineCauses.add(4),yield oc(e),e.onlineStateTracker.set("Unknown"),e.offlineCauses.delete(4),yield ih(e)})}function CL(n,e){return T(this,null,function*(){let t=U(n);t.asyncQueue.verifyOperationInProgress(),M(Go,"RemoteStore received new credentials");let r=Ls(t);t.offlineCauses.add(3),yield oc(t),r&&t.onlineStateTracker.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.offlineCauses.delete(3),yield ih(t)})}function f0(n,e){return T(this,null,function*(){let t=U(n);e?(t.offlineCauses.delete(2),yield ih(t)):e||(t.offlineCauses.add(2),yield oc(t),t.onlineStateTracker.set("Unknown"))})}function cc(n){return n.watchStream||(n.watchStream=YJ(n.datastore,n.asyncQueue,{onConnected:rZ.bind(null,n),onOpen:iZ.bind(null,n),onClose:sZ.bind(null,n),onWatchChange:oZ.bind(null,n)}),n.onNetworkStatusChange.push(e=>T(this,null,function*(){e?(n.watchStream.inhibitBackoff(),yI(n)?gI(n):n.onlineStateTracker.set("Unknown")):(yield n.watchStream.stop(),EB(n))}))),n.watchStream}function Bs(n){return n.writeStream||(n.writeStream=QJ(n.datastore,n.asyncQueue,{onConnected:()=>Promise.resolve(),onOpen:dZ.bind(null,n),onClose:pZ.bind(null,n),onHandshakeComplete:hZ.bind(null,n),onMutationResult:fZ.bind(null,n)}),n.onNetworkStatusChange.push(e=>T(this,null,function*(){e?(n.writeStream.inhibitBackoff(),yield lc(n)):(yield n.writeStream.stop(),n.writePipeline.length>0&&(M(Go,`Stopping write stream with ${n.writePipeline.length} pending writes`),n.writePipeline=[]))}))),n.writeStream}var yZ="AsyncQueue",p0=class n{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new dt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){let o=Date.now()+r,a=new n(e,t,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new k(R.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function uc(n,e){if($e(yZ,`${e}: ${n}`),Fs(n))return new k(R.UNAVAILABLE,`${e}: ${n}`);throw n}var Lg=class n{constructor(e){e?this.comparator=(t,r)=>e(t,r)||V.comparator(t.key,r.key):this.comparator=(t,r)=>V.comparator(t.key,r.key),this.keyedMap=yd(),this.sortedSet=new Fe(this.comparator)}static emptySet(e){return new n(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};var Bg=class{constructor(){this.changeMap=new Fe(V.comparator)}track(e){let t=e.doc.key,r=this.changeMap.get(t);if(!r){this.changeMap=this.changeMap.insert(t,e);return}e.type!==0&&r.type===3?this.changeMap=this.changeMap.insert(t,e):e.type===3&&r.type!==1?this.changeMap=this.changeMap.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.changeMap=this.changeMap.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.changeMap=this.changeMap.remove(t):e.type===1&&r.type===2?this.changeMap=this.changeMap.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):z()}getChanges(){let e=[];return this.changeMap.inorderTraversal((t,r)=>{e.push(r)}),e}},Yl=class n{constructor(e,t,r,i,s,o,a,l,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,i,s){let o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new n(e,t,Lg.emptySet(t),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(this.fromCache!==e.fromCache||this.hasCachedResults!==e.hasCachedResults||this.syncStateChanged!==e.syncStateChanged||!this.mutatedKeys.isEqual(e.mutatedKeys)||!eh(this.query,e.query)||!this.docs.isEqual(e.docs)||!this.oldDocs.isEqual(e.oldDocs))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};var m0=class{constructor(){this.viewSnap=void 0,this.listeners=[]}hasRemoteListeners(){return this.listeners.some(e=>e.listensToRemoteStore())}};function _Z(){return new g0}var g0=class{constructor(){this.queries=TB(),this.onlineState="Unknown",this.snapshotsInSyncListeners=new Set}terminate(){TZ(this,new k(R.ABORTED,"Firestore shutting down"))}};function TB(){return new $r(n=>S2(n),eh)}function _I(n,e){return T(this,null,function*(){let t=U(n),r=3,i=e.query,s=t.queries.get(i);s?!s.hasRemoteListeners()&&e.listensToRemoteStore()&&(r=2):(s=new m0,r=e.listensToRemoteStore()?0:1);try{switch(r){case 0:s.viewSnap=yield t.onListen(i,!0);break;case 1:s.viewSnap=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i);break;default:break}}catch(o){let a=uc(o,`Initialization of query '${Dl(e.query)}' failed`);e.onError(a);return}t.queries.set(i,s),s.listeners.push(e),e.applyOnlineStateChange(t.onlineState),s.viewSnap&&e.onViewSnapshot(s.viewSnap)&&EI(t)})}function vI(n,e){return T(this,null,function*(){let t=U(n),r=e.query,i=3,s=t.queries.get(r);if(s){let o=s.listeners.indexOf(e);o>=0&&(s.listeners.splice(o,1),s.listeners.length===0?i=e.listensToRemoteStore()?0:1:!s.hasRemoteListeners()&&e.listensToRemoteStore()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}})}function vZ(n,e){let t=U(n),r=!1;for(let i of e){let s=i.query,o=t.queries.get(s);if(o){for(let a of o.listeners)a.onViewSnapshot(i)&&(r=!0);o.viewSnap=i}}r&&EI(t)}function EZ(n,e,t){let r=U(n),i=r.queries.get(e);if(i)for(let s of i.listeners)s.onError(t);r.queries.delete(e)}function SZ(n,e){let t=U(n);t.onlineState=e;let r=!1;t.queries.forEach((i,s)=>{for(let o of s.listeners)o.applyOnlineStateChange(e)&&(r=!0)}),r&&EI(t)}function CZ(n,e){U(n).snapshotsInSyncListeners.add(e),e.next()}function wZ(n,e){U(n).snapshotsInSyncListeners.delete(e)}function TZ(n,e){let t=U(n),r=t.queries;t.queries=TB(),r.forEach((i,s)=>{for(let o of s.listeners)o.onError(e)})}function EI(n){n.snapshotsInSyncListeners.forEach(e=>{e.next()})}var bB=function(n){return n.Default="default",n.Cache="cache",n}(bB||{}),jd=class{constructor(e,t,r){this.query=e,this.queryObserver=t,this.raisedInitialEvent=!1,this.snap=null,this.onlineState="Unknown",this.options=r||{}}onViewSnapshot(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new Yl(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.raisedInitialEvent?this.shouldRaiseEvent(e)&&(this.queryObserver.next(e),t=!0):this.shouldRaiseInitialEvent(e,this.onlineState)&&(this.raiseInitialEvent(e),t=!0),this.snap=e,t}onError(e){this.queryObserver.error(e)}applyOnlineStateChange(e){this.onlineState=e;let t=!1;return this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,e)&&(this.raiseInitialEvent(this.snap),t=!0),t}shouldRaiseInitialEvent(e,t){if(!e.fromCache||!this.listensToRemoteStore())return!0;let r=t!=="Offline";return this.options.waitForSyncWhenOnline&&r?!1:!e.docs.isEmpty()||e.hasCachedResults||t==="Offline"}shouldRaiseEvent(e){if(e.docChanges.length>0)return!0;let t=this.snap&&this.snap.hasPendingWrites!==e.hasPendingWrites;return e.syncStateChanged||t?this.options.includeMetadataChanges===!0:!1}raiseInitialEvent(e){e=Yl.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.raisedInitialEvent=!0,this.queryObserver.next(e)}listensToRemoteStore(){return this.options.source!==bB.Cache}};var y0=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.addedKeys=r,this.removedKeys=i}static fromSnapshot(e,t){let r=ie(),i=ie();for(let s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key);break}return new n(e,t.fromCache,r,i)}};var Vg=class{constructor(e){this.serializer=e}toDocumentKey(e){return Gr(this.serializer,e)}toMutableDocument(e){return e.metadata.exists?W2(this.serializer,e.document,!1):ht.newNoDocument(this.toDocumentKey(e.metadata.name),this.toSnapshotVersion(e.metadata.readTime))}toSnapshotVersion(e){return rt(e)}},_0=class{constructor(e,t,r){this.bundleMetadata=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=IB(e)}addSizedElement(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.payload.namedQuery)this.queries.push(e.payload.namedQuery);else if(e.payload.documentMetadata){this.documents.push({metadata:e.payload.documentMetadata}),e.payload.documentMetadata.exists||++t;let r=pe.fromString(e.payload.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.payload.document&&(this.documents[this.documents.length-1].document=e.payload.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}getQueryDocumentMapping(e){let t=new Map,r=new Vg(this.serializer);for(let i of e)if(i.metadata.queries){let s=r.toDocumentKey(i.metadata.name);for(let o of i.metadata.queries){let a=(t.get(o)||ie()).add(s);t.set(o,a)}}return t}complete(){return T(this,null,function*(){let e=yield mJ(this.localStore,new Vg(this.serializer),this.documents,this.bundleMetadata.id),t=this.getQueryDocumentMapping(this.documents);for(let r of this.queries)yield vJ(this.localStore,r,t.get(r.name));return this.progress.taskState="Success",{progress:this.progress,changedCollectionGroups:this.collectionGroups,changedDocs:e}})}};function IB(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}function bZ(n){return{taskState:"Success",documentsLoaded:n.totalDocuments,bytesLoaded:n.totalBytes,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}var Ug=class{constructor(e){this.key=e}},qg=class{constructor(e){this.key=e}},zg=class{constructor(e,t){this.query=e,this._syncedDocuments=t,this.syncState=null,this.hasCachedResults=!1,this.current=!1,this.limboDocuments=ie(),this.mutatedKeys=ie(),this.docComparator=w2(e),this.documentSet=new Lg(this.docComparator)}get syncedDocuments(){return this._syncedDocuments}computeDocChanges(e,t){let r=t?t.changeSet:new Bg,i=t?t.documentSet:this.documentSet,s=t?t.mutatedKeys:this.mutatedKeys,o=i,a=!1,l=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,c=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((u,d)=>{let h=i.get(u),p=th(this.query,d)?d:null,E=h?this.mutatedKeys.has(h.key):!1,w=p?p.hasLocalMutations||this.mutatedKeys.has(p.key)&&p.hasCommittedMutations:!1,b=!1;h&&p?h.data.isEqual(p.data)?E!==w&&(r.track({type:3,doc:p}),b=!0):this.shouldWaitForSyncedDocument(h,p)||(r.track({type:2,doc:p}),b=!0,(l&&this.docComparator(p,l)>0||c&&this.docComparator(p,c)<0)&&(a=!0)):!h&&p?(r.track({type:0,doc:p}),b=!0):h&&!p&&(r.track({type:1,doc:h}),b=!0,(l||c)&&(a=!0)),b&&(p?(o=o.add(p),w?s=s.add(u):s=s.delete(u)):(o=o.delete(u),s=s.delete(u)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let u=this.query.limitType==="F"?o.last():o.first();o=o.delete(u.key),s=s.delete(u.key),r.track({type:1,doc:u})}return{documentSet:o,changeSet:r,needsRefill:a,mutatedKeys:s}}shouldWaitForSyncedDocument(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let s=this.documentSet;this.documentSet=e.documentSet,this.mutatedKeys=e.mutatedKeys;let o=e.changeSet.getChanges();o.sort((d,h)=>IZ(d.type,h.type)||this.docComparator(d.doc,h.doc)),this.applyTargetChange(r),i=i??!1;let a=t&&!i?this.updateLimboDocuments():[],c=this.limboDocuments.size===0&&this.current&&!i?1:0,u=c!==this.syncState;return this.syncState=c,o.length===0&&!u?{limboChanges:a}:{snapshot:new Yl(this.query,e.documentSet,s,o,e.mutatedKeys,c===0,u,!1,r?r.resumeToken.approximateByteSize()>0:!1),limboChanges:a}}applyOnlineStateChange(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new Bg,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}}shouldBeInLimbo(e){return!(this._syncedDocuments.has(e)||!this.documentSet.has(e)||this.documentSet.get(e).hasLocalMutations)}applyTargetChange(e){e&&(e.addedDocuments.forEach(t=>this._syncedDocuments=this._syncedDocuments.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this._syncedDocuments=this._syncedDocuments.delete(t)),this.current=e.current)}updateLimboDocuments(){if(!this.current)return[];let e=this.limboDocuments;this.limboDocuments=ie(),this.documentSet.forEach(r=>{this.shouldBeInLimbo(r.key)&&(this.limboDocuments=this.limboDocuments.add(r.key))});let t=[];return e.forEach(r=>{this.limboDocuments.has(r)||t.push(new qg(r))}),this.limboDocuments.forEach(r=>{e.has(r)||t.push(new Ug(r))}),t}synchronizeWithPersistedState(e){this._syncedDocuments=e.remoteKeys,this.limboDocuments=ie();let t=this.computeDocChanges(e.documents);return this.applyChanges(t,!0)}computeInitialSnapshot(){return Yl.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,this.syncState===0,this.hasCachedResults)}};function IZ(n,e){let t=r=>{switch(r){case 0:return 1;case 2:return 2;case 3:return 2;case 1:return 0;default:return z()}};return t(n)-t(e)}var Vs="SyncEngine",v0=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},E0=class{constructor(e){this.key=e,this.receivedDocument=!1}},S0=class{constructor(e,t,r,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.syncEngineListener={},this.queryViewsByQuery=new $r(a=>S2(a),eh),this.queriesByTarget=new Map,this.enqueuedLimboResolutions=new Set,this.activeLimboTargetsByKey=new Fe(V.comparator),this.activeLimboResolutionsByTarget=new Map,this.limboDocumentRefs=new qd,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=Hl.forSyncEngine(),this.onlineState="Unknown",this._isPrimaryClient=void 0}get isPrimaryClient(){return this._isPrimaryClient===!0}};function AZ(n,e,t,r,i,s,o){let a=new S0(n,e,t,r,i,s);return o&&(a._isPrimaryClient=!0),a}function RZ(n,e,t=!0){return T(this,null,function*(){let r=fy(n),i,s=r.queryViewsByQuery.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.computeInitialSnapshot()):i=yield AB(r,e,t,!0),i})}function DZ(n,e){return T(this,null,function*(){let t=fy(n);yield AB(t,e,!0,!1)})}function AB(n,e,t,r){return T(this,null,function*(){let i=yield Kl(n.localStore,Xt(e)),s=i.targetId,o=n.sharedClientState.addLocalQueryTarget(s,t),a;return r&&(a=yield SI(n,e,s,o==="current",i.resumeToken)),n.isPrimaryClient&&t&&hy(n.remoteStore,i),a})}function SI(n,e,t,r,i){return T(this,null,function*(){n.applyDocChanges=(d,h,p)=>UZ(n,d,h,p);let s=yield dy(n.localStore,e,!0),o=new zg(e,s.remoteKeys),a=o.computeDocChanges(s.documents),l=Ld.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),c=o.applyChanges(a,n.isPrimaryClient,l);TI(n,t,c.limboChanges);let u=new v0(e,t,o);return n.queryViewsByQuery.set(e,u),n.queriesByTarget.has(t)?n.queriesByTarget.get(t).push(e):n.queriesByTarget.set(t,[e]),c.snapshot})}function NZ(n,e,t){return T(this,null,function*(){let r=U(n),i=r.queryViewsByQuery.get(e),s=r.queriesByTarget.get(i.targetId);if(s.length>1){r.queriesByTarget.set(i.targetId,s.filter(o=>!eh(o,e))),r.queryViewsByQuery.delete(e);return}r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield Ql(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&ac(r.remoteStore,i.targetId),Xl(r,i.targetId)}).catch(Ms))):(Xl(r,i.targetId),yield Ql(r.localStore,i.targetId,!0))})}function kZ(n,e){return T(this,null,function*(){let t=U(n),r=t.queryViewsByQuery.get(e),i=t.queriesByTarget.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),ac(t.remoteStore,r.targetId))})}function OZ(n,e,t){return T(this,null,function*(){let r=II(n);try{let i=yield ZX(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),BZ(r,i.batchId,t),yield Si(r,i.changes),yield lc(r.remoteStore)}catch(i){let s=uc(i,"Failed to persist write");t.reject(s)}})}function RB(n,e){return T(this,null,function*(){let t=U(n);try{let r=yield iJ(t.localStore,e);e.targetChanges.forEach((i,s)=>{let o=t.activeLimboResolutionsByTarget.get(s);o&&(j(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.receivedDocument=!0:i.modifiedDocuments.size>0?j(o.receivedDocument):i.removedDocuments.size>0&&(j(o.receivedDocument),o.receivedDocument=!1))}),yield Si(t,r,e)}catch(r){yield Ms(r)}})}function wL(n,e,t){let r=U(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.queryViewsByQuery.forEach((s,o)=>{let a=o.view.applyOnlineStateChange(e);a.snapshot&&i.push(a.snapshot)}),SZ(r.eventManager,e),i.length&&r.syncEngineListener.onWatchChange(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function xZ(n,e,t){return T(this,null,function*(){let r=U(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.activeLimboResolutionsByTarget.get(e),s=i&&i.key;if(s){let o=new Fe(V.comparator);o=o.insert(s,ht.newNoDocument(s,Q.min()));let a=ie().add(s),l=new Fd(Q.min(),new Map,new Fe(ne),o,a);yield RB(r,l),r.activeLimboTargetsByKey=r.activeLimboTargetsByKey.remove(s),r.activeLimboResolutionsByTarget.delete(e),bI(r)}else yield Ql(r.localStore,e,!1).then(()=>Xl(r,e,t)).catch(Ms)})}function PZ(n,e){return T(this,null,function*(){let t=U(n),r=e.batch.batchId;try{let i=yield eJ(t.localStore,e);wI(t,r,null),CI(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield Si(t,i)}catch(i){yield Ms(i)}})}function MZ(n,e,t){return T(this,null,function*(){let r=U(n);try{let i=yield nJ(r.localStore,e);wI(r,e,t),CI(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield Si(r,i)}catch(i){yield Ms(i)}})}function FZ(n,e){return T(this,null,function*(){let t=U(n);Ls(t.remoteStore)||M(Vs,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let r=yield rJ(t.localStore);if(r===ws){e.resolve();return}let i=t.pendingWritesCallbacks.get(r)||[];i.push(e),t.pendingWritesCallbacks.set(r,i)}catch(r){let i=uc(r,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}})}function CI(n,e){(n.pendingWritesCallbacks.get(e)||[]).forEach(t=>{t.resolve()}),n.pendingWritesCallbacks.delete(e)}function LZ(n,e){n.pendingWritesCallbacks.forEach(t=>{t.forEach(r=>{r.reject(new k(R.CANCELLED,e))})}),n.pendingWritesCallbacks.clear()}function BZ(n,e,t){let r=n.mutationUserCallbacks[n.currentUser.toKey()];r||(r=new Fe(ne)),r=r.insert(e,t),n.mutationUserCallbacks[n.currentUser.toKey()]=r}function wI(n,e,t){let r=U(n),i=r.mutationUserCallbacks[r.currentUser.toKey()];if(i){let s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.mutationUserCallbacks[r.currentUser.toKey()]=i}}function Xl(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.queriesByTarget.get(e))n.queryViewsByQuery.delete(r),t&&n.syncEngineListener.onWatchError(r,t);n.queriesByTarget.delete(e),n.isPrimaryClient&&n.limboDocumentRefs.removeReferencesForId(e).forEach(i=>{n.limboDocumentRefs.containsKey(i)||DB(n,i)})}function DB(n,e){n.enqueuedLimboResolutions.delete(e.path.canonicalString());let t=n.activeLimboTargetsByKey.get(e);t!==null&&(ac(n.remoteStore,t),n.activeLimboTargetsByKey=n.activeLimboTargetsByKey.remove(e),n.activeLimboResolutionsByTarget.delete(t),bI(n))}function TI(n,e,t){for(let r of t)r instanceof Ug?(n.limboDocumentRefs.addReference(r.key,e),VZ(n,r)):r instanceof qg?(M(Vs,"Document no longer in limbo: "+r.key),n.limboDocumentRefs.removeReference(r.key,e),n.limboDocumentRefs.containsKey(r.key)||DB(n,r.key)):z()}function VZ(n,e){let t=e.key,r=t.path.canonicalString();!n.activeLimboTargetsByKey.get(t)&&!n.enqueuedLimboResolutions.has(r)&&(M(Vs,"New document in limbo: "+t),n.enqueuedLimboResolutions.add(r),bI(n))}function bI(n){for(;n.enqueuedLimboResolutions.size>0&&n.activeLimboTargetsByKey.size<n.maxConcurrentLimboResolutions;){let e=n.enqueuedLimboResolutions.values().next().value;n.enqueuedLimboResolutions.delete(e);let t=new V(pe.fromString(e)),r=n.limboTargetIdGenerator.next();n.activeLimboResolutionsByTarget.set(r,new E0(t)),n.activeLimboTargetsByKey=n.activeLimboTargetsByKey.insert(t,r),hy(n.remoteStore,new $l(Xt(sc(t.path)),r,"TargetPurposeLimboResolution",vn.INVALID))}}function Si(n,e,t){return T(this,null,function*(){let r=U(n),i=[],s=[],o=[];r.queryViewsByQuery.isEmpty()||(r.queryViewsByQuery.forEach((a,l)=>{o.push(r.applyDocChanges(l,e,t).then(c=>{var u;if((c||t)&&r.isPrimaryClient){let d=c?!c.fromCache:(u=t?.targetChanges.get(l.targetId))===null||u===void 0?void 0:u.current;r.sharedClientState.updateQueryState(l.targetId,d?"current":"not-current")}if(c){i.push(c);let d=y0.fromSnapshot(l.targetId,c);s.push(d)}}))}),yield Promise.all(o),r.syncEngineListener.onWatchChange(i),yield oJ(r.localStore,s))})}function UZ(n,e,t,r){return T(this,null,function*(){let i=e.view.computeDocChanges(t);i.needsRefill&&(i=yield dy(n.localStore,e.query,!1).then(({documents:l})=>e.view.computeDocChanges(l,i)));let s=r&&r.targetChanges.get(e.targetId),o=r&&r.targetMismatches.get(e.targetId)!=null,a=e.view.applyChanges(i,n.isPrimaryClient,s,o);return TI(n,e.targetId,a.limboChanges),a.snapshot})}function qZ(n,e){return T(this,null,function*(){let t=U(n);if(!t.currentUser.isEqual(e)){M(Vs,"User change. New user:",e.toKey());let i=yield lB(t.localStore,e);t.currentUser=e,LZ(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,i.removedBatchIds,i.addedBatchIds),yield Si(t,i.affectedDocuments)}})}function zZ(n,e){let t=U(n),r=t.activeLimboResolutionsByTarget.get(e);if(r&&r.receivedDocument)return ie().add(r.key);{let i=ie(),s=t.queriesByTarget.get(e);if(!s)return i;for(let o of s){let a=t.queryViewsByQuery.get(o);i=i.unionWith(a.view.syncedDocuments)}return i}}function GZ(n,e){return T(this,null,function*(){let t=U(n),r=yield dy(t.localStore,e.query,!0),i=e.view.synchronizeWithPersistedState(r);return t.isPrimaryClient&&TI(t,e.targetId,i.limboChanges),i})}function WZ(n,e){return T(this,null,function*(){let t=U(n);return hB(t.localStore,e).then(r=>Si(t,r))})}function jZ(n,e,t,r){return T(this,null,function*(){let i=U(n),s=yield dJ(i.localStore,e);if(s===null){M(Vs,"Cannot apply mutation batch with id: "+e);return}t==="pending"?yield lc(i.remoteStore):t==="acknowledged"||t==="rejected"?(wI(i,e,r||null),CI(i,e),hJ(i.localStore,e)):z(),yield Si(i,s)})}function $Z(n,e){return T(this,null,function*(){let t=U(n);if(fy(t),II(t),e===!0&&t._isPrimaryClient!==!0){let r=t.sharedClientState.getAllActiveQueryTargets(),i=yield TL(t,r.toArray());t._isPrimaryClient=!0,yield f0(t.remoteStore,!0);for(let s of i)hy(t.remoteStore,s)}else if(e===!1&&t._isPrimaryClient!==!1){let r=[],i=Promise.resolve();t.queriesByTarget.forEach((s,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):i=i.then(()=>(Xl(t,o),Ql(t.localStore,o,!0))),ac(t.remoteStore,o)}),yield i,yield TL(t,r),HZ(t),t._isPrimaryClient=!1,yield f0(t.remoteStore,!1)}})}function HZ(n){let e=U(n);e.activeLimboResolutionsByTarget.forEach((t,r)=>{ac(e.remoteStore,r)}),e.limboDocumentRefs.removeAllReferences(),e.activeLimboResolutionsByTarget=new Map,e.activeLimboTargetsByKey=new Fe(V.comparator)}function TL(n,e,t){return T(this,null,function*(){let r=U(n),i=[],s=[];for(let o of e){let a,l=r.queriesByTarget.get(o);if(l&&l.length!==0){a=yield Kl(r.localStore,Xt(l[0]));for(let c of l){let u=r.queryViewsByQuery.get(c),d=yield GZ(r,u);d.snapshot&&s.push(d.snapshot)}}else{let c=yield dB(r.localStore,o);a=yield Kl(r.localStore,c),yield SI(r,NB(c),o,!1,a.resumeToken)}i.push(a)}return r.syncEngineListener.onWatchChange(s),i})}function NB(n){return E2(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function KZ(n){let e=U(n);return fJ(e.localStore)}function QZ(n,e,t,r){return T(this,null,function*(){let i=U(n);if(i._isPrimaryClient){M(Vs,"Ignoring unexpected query state notification.");return}let s=i.queriesByTarget.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{let o=yield hB(i.localStore,C2(s[0])),a=Fd.createSynthesizedRemoteEventForCurrentChange(e,t==="current",st.EMPTY_BYTE_STRING);yield Si(i,o,a);break}case"rejected":{yield Ql(i.localStore,e,!0),Xl(i,e,r);break}default:z()}})}function YZ(n,e,t){return T(this,null,function*(){let r=fy(n);if(r._isPrimaryClient){for(let i of e){if(r.queriesByTarget.has(i)&&r.sharedClientState.isActiveQueryTarget(i)){M(Vs,"Adding an already active target "+i);continue}let o=yield dB(r.localStore,i),a=yield Kl(r.localStore,o);yield SI(r,NB(o),a.targetId,!1,a.resumeToken),hy(r.remoteStore,a)}for(let i of t)r.queriesByTarget.has(i)&&(yield Ql(r.localStore,i,!1).then(()=>{ac(r.remoteStore,i),Xl(r,i)}).catch(Ms))}})}function fy(n){let e=U(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=RB.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=zZ.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=xZ.bind(null,e),e.syncEngineListener.onWatchChange=vZ.bind(null,e.eventManager),e.syncEngineListener.onWatchError=EZ.bind(null,e.eventManager),e}function II(n){let e=U(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=PZ.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=MZ.bind(null,e),e}function XZ(n,e,t){let r=U(n);JZ(r,e,t).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}function JZ(n,e,t){return T(this,null,function*(){try{let r=yield e.getMetadata();if(yield gJ(n.localStore,r))return yield e.close(),t._completeWith(bZ(r)),Promise.resolve(new Set);t._updateProgress(IB(r));let s=new _0(r,n.localStore,e.serializer),o=yield e.nextElement();for(;o;){let l=yield s.addSizedElement(o);l&&t._updateProgress(l),o=yield e.nextElement()}let a=yield s.complete();return yield Si(n,a.changedDocs,void 0),yield yJ(n.localStore,r),t._completeWith(a.progress),Promise.resolve(a.changedCollectionGroups)}catch(r){return ir(Vs,`Loading bundle failed with ${r}`),t._failWith(r),Promise.resolve(new Set)}})}var C0=(()=>{class n{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){return T(this,null,function*(){this.serializer=rh(t.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(t),this.persistence=this.createPersistence(t),yield this.persistence.start(),this.localStore=this.createLocalStore(t),this.gcScheduler=this.createGarbageCollectionScheduler(t,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(t,this.localStore)})}createGarbageCollectionScheduler(t,r){return null}createIndexBackfillerScheduler(t,r){return null}createLocalStore(t){return aB(this.persistence,new kg,t.initialUser,this.serializer)}createPersistence(t){return new Dg(Ng.factory,this.serializer)}createSharedClientState(t){return new Pg}terminate(){return T(this,null,function*(){var t,r;(t=this.gcScheduler)===null||t===void 0||t.stop(),(r=this.indexBackfillerScheduler)===null||r===void 0||r.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return n.provider={build:()=>new n},n})();var Gg=class n extends C0{constructor(e,t,r){super(),this.onlineComponentProvider=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}initialize(e){return T(this,null,function*(){yield Py(n.prototype,this,"initialize").call(this,e),yield this.onlineComponentProvider.initialize(this,e),yield II(this.onlineComponentProvider.syncEngine),yield lc(this.onlineComponentProvider.remoteStore),yield this.persistence.setPrimaryStateListener(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}createLocalStore(e){return aB(this.persistence,new kg,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){let r=this.persistence.referenceDelegate.garbageCollector;return new Ub(r,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){let r=new eb(t,this.persistence);return new ZT(e.asyncQueue,r)}createPersistence(e){let t=fI(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?Vn.withCacheSize(this.cacheSizeBytes):Vn.DEFAULT;return new t0(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,_B(),VJ(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new Pg}},w0=class n extends Gg{constructor(e,t){super(e,t,!1),this.onlineComponentProvider=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){return T(this,null,function*(){yield Py(n.prototype,this,"initialize").call(this,e);let t=this.onlineComponentProvider.syncEngine;this.sharedClientState instanceof Td&&(this.sharedClientState.syncEngine={applyBatchState:jZ.bind(null,t),applyTargetState:QZ.bind(null,t),applyActiveTargetsChange:YZ.bind(null,t),getActiveClients:KZ.bind(null,t),synchronizeWithChangedDocuments:WZ.bind(null,t)},yield this.sharedClientState.start()),yield this.persistence.setPrimaryStateListener(r=>T(this,null,function*(){yield $Z(this.onlineComponentProvider.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())}))})}createSharedClientState(e){let t=_B();if(!Td.isAvailable(t))throw new k(R.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let r=fI(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Td(t,e.asyncQueue,r,e.clientId,e.initialUser)}},AI=(()=>{class n{initialize(t,r){return T(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>wL(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=qZ.bind(null,this.syncEngine),yield f0(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return _Z()}createDatastore(t){let r=rh(t.databaseInfo.databaseId),i=LJ(t.databaseInfo);return $J(t.authCredentials,t.appCheckCredentials,i,r)}createRemoteStore(t){return ZJ(this.localStore,this.datastore,t.asyncQueue,r=>wL(this.syncEngine,r,0),BJ())}createSyncEngine(t,r){return AZ(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,r)}terminate(){return T(this,null,function*(){var t,r;yield nZ(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(r=this.eventManager)===null||r===void 0||r.terminate()})}}n.provider={build:()=>new n};return n})(),ZZ=10240;function eee(n,e=ZZ){let t=0;return{read(){return T(this,null,function*(){if(t<n.byteLength){let s={value:n.slice(t,t+e),done:!1};return t+=e,s}return{done:!0}})},cancel(){return T(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}function RI(n,e,t){if(!t)throw new k(R.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function DI(n,e,t,r){if(e===!0&&r===!0)throw new k(R.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function bL(n){if(!V.isDocumentKey(n))throw new k(R.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function IL(n){if(V.isDocumentKey(n))throw new k(R.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function tee(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function sh(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=nee(n);return e?`a custom ${e} object`:"an object"}}else return typeof n=="function"?"a function":z()}function nee(n){return n.constructor?n.constructor.name:null}function _e(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new k(R.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=sh(n);throw new k(R.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function kB(n,e){if(e<=0)throw new k(R.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}function ree(n,e){if(!(n instanceof Uint8Array))throw new k(R.INVALID_ARGUMENT,`NodePlatform.toByteStreamReader expects source to be Uint8Array, got ${sh(n)}`);return eee(n,e)}var Jl=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.scheduleEvent(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.scheduleEvent(this.observer.error,e):$e("Uncaught Error in snapshot listener:",e.toString()))}mute(){this.muted=!0}scheduleEvent(e,t){setTimeout(()=>{this.muted||e(t)},0)}};var T0=class{constructor(e,t){this.payload=e,this.byteLength=t}isBundleMetadata(){return"metadata"in this.payload}};var b0=class{constructor(e,t){this.reader=e,this.serializer=t,this.metadata=new dt,this.buffer=new Uint8Array,this.textDecoder=L7(),this.nextElementImpl().then(r=>{r&&r.isBundleMetadata()?this.metadata.resolve(r.payload.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r?.payload)}`))},r=>this.metadata.reject(r))}close(){return this.reader.cancel()}getMetadata(){return T(this,null,function*(){return this.metadata.promise})}nextElement(){return T(this,null,function*(){return yield this.getMetadata(),this.nextElementImpl()})}nextElementImpl(){return T(this,null,function*(){let e=yield this.readLength();if(e===null)return null;let t=this.textDecoder.decode(e),r=Number(t);isNaN(r)&&this.raiseError(`length string (${t}) is not valid number`);let i=yield this.readJsonString(r);return new T0(JSON.parse(i),e.length+r)})}indexOfOpenBracket(){return this.buffer.findIndex(e=>e===123)}readLength(){return T(this,null,function*(){for(;this.indexOfOpenBracket()<0&&!(yield this.pullMoreDataToBuffer()););if(this.buffer.length===0)return null;let e=this.indexOfOpenBracket();e<0&&this.raiseError("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t})}readJsonString(e){return T(this,null,function*(){for(;this.buffer.length<e;)(yield this.pullMoreDataToBuffer())&&this.raiseError("Reached the end of bundle when more is expected.");let t=this.textDecoder.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t})}raiseError(e){throw this.reader.cancel(),new Error(`Invalid bundle format: ${e}`)}pullMoreDataToBuffer(){return T(this,null,function*(){let e=yield this.reader.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done})}};function iee(n,e){return new b0(n,e)}var I0=class{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){return T(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new k(R.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=yield KJ(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t})}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new Os(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){return T(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{let i=V.fromPath(r);this.mutations.push(new xd(i,this.precondition(i)))}),yield HJ(this.datastore,this.mutations),this.committed=!0})}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else if(e.isNoDocument())t=Q.min();else throw z();let r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new k(R.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(Q.min())?Je.exists(!1):Je.updateTime(t):Je.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(Q.min()))throw new k(R.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Je.updateTime(t)}else return Je.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}};var A0=class{constructor(e,t,r,i,s){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=i,this.deferred=s,this.attemptsRemaining=r.maxAttempts,this.backoff=new Wd(this.asyncQueue,"transaction_retry")}run(){this.attemptsRemaining-=1,this.runWithBackOff()}runWithBackOff(){this.backoff.backoffAndRun(()=>T(this,null,function*(){let e=new I0(this.datastore),t=this.tryRunUpdateFunction(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(i=>{this.handleTransactionError(i)}))}).catch(r=>{this.handleTransactionError(r)})}))}tryRunUpdateFunction(e){try{let t=this.updateFunction(e);return Jd(t)||!t.catch||!t.then?(this.deferred.reject(Error("Transaction callback must return a Promise")),null):t}catch(t){return this.deferred.reject(t),null}}handleTransactionError(e){this.attemptsRemaining>0&&this.isRetryableTransactionError(e)?(this.attemptsRemaining-=1,this.asyncQueue.enqueueAndForget(()=>(this.runWithBackOff(),Promise.resolve()))):this.deferred.reject(e)}isRetryableTransactionError(e){if(e.name==="FirebaseError"){let t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!L2(t)}return!1}};var xs="FirestoreClient",see=100,oee=11,aee=20,lee=22,R0=class{constructor(e,t,r,i,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=ft.UNAUTHENTICATED,this.clientId=lg.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(r,o=>T(this,null,function*(){M(xs,"Received user=",o.uid),yield this.authCredentialListener(o),this.user=o})),this.appCheckCredentials.start(r,o=>(M(xs,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:see}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new dt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>T(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=uc(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function zT(n,e){return T(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),M(xs,"Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(i=>T(this,null,function*(){r.isEqual(i)||(yield lB(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function AL(n,e){return T(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield NI(n);M(xs,"Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>CL(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>CL(e.remoteStore,i)),n._onlineComponents=e})}function cee(n){return n.name==="FirebaseError"?n.code===R.FAILED_PRECONDITION||n.code===R.UNIMPLEMENTED:typeof DOMException<"u"&&n instanceof DOMException?n.code===lee||n.code===aee||n.code===oee:!0}function NI(n){return T(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){M(xs,"Using user provided OfflineComponentProvider");try{yield zT(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!cee(t))throw t;ir("Error using user provided cache. Falling back to memory cache: "+t),yield zT(n,new C0)}}else M(xs,"Using default OfflineComponentProvider"),yield zT(n,new C0);return n._offlineComponents})}function py(n){return T(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(M(xs,"Using user provided OnlineComponentProvider"),yield AL(n,n._uninitializedComponentsProvider._online)):(M(xs,"Using default OnlineComponentProvider"),yield AL(n,new AI))),n._onlineComponents})}function OB(n){return NI(n).then(e=>e.persistence)}function kI(n){return NI(n).then(e=>e.localStore)}function xB(n){return py(n).then(e=>e.remoteStore)}function OI(n){return py(n).then(e=>e.syncEngine)}function uee(n){return py(n).then(e=>e.datastore)}function Zl(n){return T(this,null,function*(){let e=yield py(n),t=e.eventManager;return t.onListen=RZ.bind(null,e.syncEngine),t.onUnlisten=NZ.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=DZ.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=kZ.bind(null,e.syncEngine),t})}function dee(n){return n.asyncQueue.enqueue(()=>T(this,null,function*(){let e=yield OB(n),t=yield xB(n);return e.setNetworkEnabled(!0),eZ(t)}))}function hee(n){return n.asyncQueue.enqueue(()=>T(this,null,function*(){let e=yield OB(n),t=yield xB(n);return e.setNetworkEnabled(!1),tZ(t)}))}function fee(n){let e=new dt;return n.asyncQueue.enqueueAndForget(()=>T(this,null,function*(){let t=yield OI(n);return FZ(t,e)})),e.promise}function pee(n,e,t,r){let i=new Jl(r),s=new jd(e,i,t);return n.asyncQueue.enqueueAndForget(()=>T(this,null,function*(){let o=yield Zl(n);return _I(o,s)})),()=>{i.mute(),n.asyncQueue.enqueueAndForget(()=>T(this,null,function*(){let o=yield Zl(n);return vI(o,s)}))}}function mee(n,e){let t=new dt;return n.asyncQueue.enqueueAndForget(()=>T(this,null,function*(){let r=yield kI(n);return Eee(r,e,t)})),t.promise}function PB(n,e,t={}){let r=new dt;return n.asyncQueue.enqueueAndForget(()=>T(this,null,function*(){let i=yield Zl(n);return See(i,n.asyncQueue,e,t,r)})),r.promise}function gee(n,e){let t=new dt;return n.asyncQueue.enqueueAndForget(()=>T(this,null,function*(){let r=yield kI(n);return Cee(r,e,t)})),t.promise}function MB(n,e,t={}){let r=new dt;return n.asyncQueue.enqueueAndForget(()=>T(this,null,function*(){let i=yield Zl(n);return wee(i,n.asyncQueue,e,t,r)})),r.promise}function yee(n,e){let t=new dt;return n.asyncQueue.enqueueAndForget(()=>T(this,null,function*(){let r=yield OI(n);return OZ(r,e,t)})),t.promise}function _ee(n,e){let t=new Jl(e);return n.asyncQueue.enqueueAndForget(()=>T(this,null,function*(){let r=yield Zl(n);return CZ(r,t)})),()=>{t.mute(),n.asyncQueue.enqueueAndForget(()=>T(this,null,function*(){let r=yield Zl(n);return wZ(r,t)}))}}function vee(n,e,t){let r=new dt;return n.asyncQueue.enqueueAndForget(()=>T(this,null,function*(){let i=yield uee(n);new A0(n.asyncQueue,i,t,e,r).run()})),r.promise}function Eee(n,e,t){return T(this,null,function*(){try{let r=yield lJ(n,e);r.isFoundDocument()?t.resolve(r):r.isNoDocument()?t.resolve(null):t.reject(new k(R.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(r){let i=uc(r,`Failed to get document '${e} from cache`);t.reject(i)}})}function See(n,e,t,r,i){let s=new Jl({next:a=>{s.mute(),e.enqueueAndForget(()=>vI(n,o));let l=a.docs.has(t);!l&&a.fromCache?i.reject(new k(R.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&a.fromCache&&r&&r.source==="server"?i.reject(new k(R.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(a)},error:a=>i.reject(a)}),o=new jd(sc(t.path),s,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return _I(n,o)}function Cee(n,e,t){return T(this,null,function*(){try{let r=yield dy(n,e,!0),i=new zg(e,r.remoteKeys),s=i.computeDocChanges(r.documents),o=i.applyChanges(s,!1);t.resolve(o.snapshot)}catch(r){let i=uc(r,`Failed to execute query '${e} against cache`);t.reject(i)}})}function wee(n,e,t,r,i){let s=new Jl({next:a=>{s.mute(),e.enqueueAndForget(()=>vI(n,o)),a.fromCache&&r.source==="server"?i.reject(new k(R.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(a)},error:a=>i.reject(a)}),o=new jd(t,s,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return _I(n,o)}function Tee(n,e,t,r){let i=Iee(t,rh(e));n.asyncQueue.enqueueAndForget(()=>T(this,null,function*(){XZ(yield OI(n),i,r)}))}function bee(n,e){return n.asyncQueue.enqueue(()=>T(this,null,function*(){return _J(yield kI(n),e)}))}function Iee(n,e){let t;return typeof n=="string"?t=B2().encode(n):t=n,iee(ree(t),e)}function Aee(n,e){return n.timeoutSeconds===e.timeoutSeconds}function FB(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var Ree="ComponentProvider",RL=new Map;function Dee(n){let e=RL.get(n);e&&(M(Ree,"Removing Datastore"),RL.delete(n),e.terminate())}function Nee(n,e,t,r){return new ob(n,e,t,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,FB(r.experimentalLongPollingOptions),r.useFetchStreams)}var LB="firestore.googleapis.com",DL=!0,NL=5,kL=30,kee=!0,Wg=class{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new k(R.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=LB,this.ssl=DL}else this.host=e.host,this.ssl=(t=e.ssl)!==null&&t!==void 0?t:DL;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=iB;else{if(e.cacheSizeBytes!==nh&&e.cacheSizeBytes<dL)throw new k(R.INVALID_ARGUMENT,`cacheSizeBytes must be at least ${dL}`);this.cacheSizeBytes=e.cacheSizeBytes}DI("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=kee:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=FB((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),Oee(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&Aee(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}};function Oee(n){if(n.timeoutSeconds!==void 0){if(isNaN(n.timeoutSeconds))throw new k(R.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (must not be NaN)`);if(n.timeoutSeconds<NL)throw new k(R.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (minimum allowed value is ${NL})`);if(n.timeoutSeconds>kL)throw new k(R.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (maximum allowed value is ${kL})`)}}var Wo=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Wg({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new k(R.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new k(R.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Wg(e),e.credentials!==void 0&&(this._authCredentials=S8(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return T(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return Dee(this),Promise.resolve()}};function my(n,e,t,r={}){var i;n=_e(n,Wo);let s=n._getSettings(),o=`${e}:${t}`;if(s.host!==LB&&s.host!==o&&ir("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let a,l;if(typeof r.mockUserToken=="string")a=r.mockUserToken,l=ft.MOCK_USER;else{a=wh(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);let c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new k(R.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new ft(c)}n._authCredentials=new WT(new ag(a,l))}}var Dt=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},Pe=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Wr(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}},Wr=class n extends Dt{constructor(e,t,r){super(e,t,sc(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new Pe(this.firestore,null,new V(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function gy(n,e,...t){if(n=ue(n),RI("collection","path",e),n instanceof Wo){let r=pe.fromString(e,...t);return IL(r),new Wr(n,null,r)}else{if(!(n instanceof Pe)&&!(n instanceof Wr))throw new k(R.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(pe.fromString(e,...t));return IL(r),new Wr(n.firestore,null,r)}}function xI(n,e){if(n=_e(n,Wo),RI("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new k(R.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Dt(n,null,s7(e))}function dc(n,e,...t){if(n=ue(n),arguments.length===1&&(e=lg.newId()),RI("doc","path",e),n instanceof Wo){let r=pe.fromString(e,...t);return bL(r),new Pe(n,null,new V(r))}else{if(!(n instanceof Pe)&&!(n instanceof Wr))throw new k(R.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(pe.fromString(e,...t));return bL(r),new Pe(n.firestore,n instanceof Wr?n.converter:null,new V(r))}}function yy(n,e){return n=ue(n),e=ue(e),(n instanceof Pe||n instanceof Wr)&&(e instanceof Pe||e instanceof Wr)?n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter:!1}function _y(n,e){return n=ue(n),e=ue(e),n instanceof Dt&&e instanceof Dt?n.firestore===e.firestore&&eh(n._query,e._query)&&n.converter===e.converter:!1}var xee="AsyncQueue",jg=class{constructor(e=Promise.resolve()){this.retryableOps=[],this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.skipNonRestrictedTasks=!1,this.timerIdsToSkip=[],this.backoff=new Wd(this,"async_queue_retry"),this.visibilityHandler=()=>{this.backoff.skipBackoff()},this.tail=e}get isShuttingDown(){return this._isShuttingDown}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.verifyNotFailed(),this.enqueueInternal(e)}enterRestrictedMode(e){this._isShuttingDown||(this._isShuttingDown=!0,this.skipNonRestrictedTasks=e||!1)}enqueue(e){if(this.verifyNotFailed(),this._isShuttingDown)return new Promise(()=>{});let t=new dt;return this.enqueueInternal(()=>this._isShuttingDown&&this.skipNonRestrictedTasks?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.retryableOps.push(e),this.retryNextOp()))}retryNextOp(){return T(this,null,function*(){if(this.retryableOps.length!==0){try{yield this.retryableOps[0](),this.retryableOps.shift(),this.backoff.reset()}catch(e){if(Fs(e))M(xee,"Operation failed with retryable error: "+e);else throw e}this.retryableOps.length>0&&this.backoff.backoffAndRun(()=>this.retryNextOp())}})}enqueueInternal(e){let t=this.tail.then(()=>(this.operationInProgress=!0,e().catch(r=>{this.failure=r,this.operationInProgress=!1;let i=Pee(r);throw $e("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.operationInProgress=!1,r))));return this.tail=t,t}enqueueAfterDelay(e,t,r){this.verifyNotFailed(),this.timerIdsToSkip.indexOf(e)>-1&&(t=0);let i=p0.createAndSchedule(this,e,t,r,s=>this.removeDelayedOperation(s));return this.delayedOperations.push(i),i}verifyNotFailed(){this.failure&&z()}verifyOperationInProgress(){}drain(){return T(this,null,function*(){let e;do e=this.tail,yield e;while(e!==this.tail)})}containsDelayedOperation(e){for(let t of this.delayedOperations)if(t.timerId===e)return!0;return!1}runAllDelayedOperationsUntil(e){return this.drain().then(()=>{this.delayedOperations.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this.delayedOperations)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.drain()})}skipDelaysForTimerId(e){this.timerIdsToSkip.push(e)}removeDelayedOperation(e){let t=this.delayedOperations.indexOf(e);this.delayedOperations.splice(t,1)}};function Pee(n){let e=n.message||"";return n.stack&&(n.stack.includes(n.message)?e=n.stack:e=n.message+`
`+n.stack),e}var D0=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new dt,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}};var BB=nh,Ke=class extends Wo{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new jg,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return T(this,null,function*(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new jg(e),this._firestoreClient=void 0,yield e}})}};function VB(n,e){let t=typeof n=="object"?n:Ws(),r=typeof n=="string"?n:e||ab,i=Ic(t,"firestore").getImmediate({identifier:r});if(!i._initialized){let s=Ch("firestore");s&&my(i,...s)}return i}function Nt(n){if(n._terminated)throw new k(R.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||UB(n),n._firestoreClient}function UB(n){var e,t,r;let i=n._freezeSettings(),s=Nee(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._componentsProvider||!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),n._firestoreClient=new R0(n._authCredentials,n._appCheckCredentials,n._queue,s,n._componentsProvider&&Mee(n._componentsProvider))}function Mee(n){let e=n?._online.build();return{_offline:n?._offline.build(e),_online:e}}function PI(n,e){ir("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=n._freezeSettings();return qB(n,AI.provider,{build:r=>new Gg(r,t.cacheSizeBytes,e?.forceOwnership)}),Promise.resolve()}function MI(n){return T(this,null,function*(){ir("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let e=n._freezeSettings();qB(n,AI.provider,{build:t=>new w0(t,e.cacheSizeBytes)})})}function qB(n,e,t){if(n=_e(n,Ke),n._firestoreClient||n._terminated)throw new k(R.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new k(R.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},UB(n)}function FI(n){if(n._initialized&&!n._terminated)throw new k(R.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let e=new dt;return n._queue.enqueueAndForgetEvenWhileRestricted(()=>T(this,null,function*(){try{yield YX(fI(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function LI(n){n=_e(n,Ke);let e=Nt(n);return fee(e)}function BI(n){n=_e(n,Ke);let e=Nt(n);return dee(e)}function VI(n){n=_e(n,Ke);let e=Nt(n);return hee(e)}function UI(n,e){n=_e(n,Ke);let t=Nt(n),r=new D0;return Tee(t,n._databaseId,e,r),r}function qI(n,e){n=_e(n,Ke);let t=Nt(n);return bee(t,e).then(r=>r?new Dt(n,null,r.query):null)}function Fee(n,e=!0){v8(Rh),Gs(new ln("firestore",(t,{instanceIdentifier:r,options:i})=>{let s=t.getProvider("app").getImmediate(),o=new Ke(new jT(t.getProvider("auth-internal")),new QT(t.getProvider("app-check-internal")),_Q(s,r),s);return i=Object.assign({useFetchStreams:e},i),o._setSettings(i),o},"PUBLIC").setMultipleInstances(!0)),et(TF,bF,n),et(TF,bF,"esm2017")}var Hr=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(st.fromBase64String(e))}catch(t){throw new k(R.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(st.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var lr=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new k(R.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new it(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var _i=class{constructor(e){this._methodName=e}};var jo=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new k(R.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new k(R.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return ne(this._lat,e._lat)||ne(this._long,e._long)}};var $d=class{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return XX(this._values,e._values)}};var Lee=/^__.*__$/,N0=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new ar(e,this.data,this.fieldMask,t,this.fieldTransforms):new ks(e,this.data,t,this.fieldTransforms)}},$g=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new ar(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function zB(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw z()}}var Hg=class n{constructor(e,t,r,i,s,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.validatePath(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.contextWith({path:r,arrayElement:!1});return i.validatePathSegment(e),i}childContextForFieldPath(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.contextWith({path:r,arrayElement:!1});return i.validatePath(),i}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return Kg(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(e.length===0)throw this.createError("Document fields must not be empty");if(zB(this.dataSource)&&Lee.test(e))throw this.createError('Document fields cannot begin and end with "__"')}},k0=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||rh(e)}createContext(e,t,r,i=!1){return new Hg({dataSource:e,methodName:t,targetDoc:r,path:it.emptyPath(),arrayElement:!1,hasConverter:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function Yo(n){let e=n._freezeSettings(),t=rh(n._databaseId);return new k0(n._databaseId,!!e.ignoreUndefinedProperties,t)}function vy(n,e,t,r,i,s={}){let o=n.createContext(s.merge||s.mergeFields?2:0,e,t,i);WI("Data must be an object, but it was:",o,r);let a=jB(r,o),l,c;if(s.merge)l=new En(o.fieldMask),c=o.fieldTransforms;else if(s.mergeFields){let u=[];for(let d of s.mergeFields){let h=F0(e,d,t);if(!o.contains(h))throw new k(R.INVALID_ARGUMENT,`Field '${h}' is specified in your field mask but missing from your input data.`);HB(u,h)||u.push(h)}l=new En(u),c=o.fieldTransforms.filter(d=>l.covers(d.field))}else l=null,c=o.fieldTransforms;return new N0(new Lt(a),l,c)}var Hd=class n extends _i{_toFieldTransform(e){if(e.dataSource===2)e.fieldMask.push(e.path);else throw e.dataSource===1?e.createError(`${this._methodName}() can only appear at the top level of your update data`):e.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return null}isEqual(e){return e instanceof n}};function GB(n,e,t){return new Hg({dataSource:3,targetDoc:e.settings.targetDoc,methodName:n._methodName,arrayElement:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}var O0=class n extends _i{_toFieldTransform(e){return new Uo(e.path,new Ds)}isEqual(e){return e instanceof n}},x0=class n extends _i{constructor(e,t){super(e),this._elements=t}_toFieldTransform(e){let t=GB(this,e,!0),r=this._elements.map(s=>Xo(s,t)),i=new gi(r);return new Uo(e.path,i)}isEqual(e){return e instanceof n&&Qy(this._elements,e._elements)}},P0=class n extends _i{constructor(e,t){super(e),this._elements=t}_toFieldTransform(e){let t=GB(this,e,!0),r=this._elements.map(s=>Xo(s,t)),i=new yi(r);return new Uo(e.path,i)}isEqual(e){return e instanceof n&&Qy(this._elements,e._elements)}},M0=class n extends _i{constructor(e,t){super(e),this._operand=t}_toFieldTransform(e){let t=new Ns(e.serializer,R2(e.serializer,this._operand));return new Uo(e.path,t)}isEqual(e){return e instanceof n&&this._operand===e._operand}};function zI(n,e,t,r){let i=n.createContext(1,e,t);WI("Data must be an object, but it was:",i,r);let s=[],o=Lt.empty();Qo(r,(l,c)=>{let u=jI(e,l,t);c=ue(c);let d=i.childContextForFieldPath(u);if(c instanceof Hd)s.push(u);else{let h=Xo(c,d);h!=null&&(s.push(u),o.set(u,h))}});let a=new En(s);return new $g(o,a,i.fieldTransforms)}function GI(n,e,t,r,i,s){let o=n.createContext(1,e,t),a=[F0(e,r,t)],l=[i];if(s.length%2!==0)throw new k(R.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let h=0;h<s.length;h+=2)a.push(F0(e,s[h])),l.push(s[h+1]);let c=[],u=Lt.empty();for(let h=a.length-1;h>=0;--h)if(!HB(c,a[h])){let p=a[h],E=l[h];E=ue(E);let w=o.childContextForFieldPath(p);if(E instanceof Hd)c.push(p);else{let b=Xo(E,w);b!=null&&(c.push(p),u.set(p,b))}}let d=new En(c);return new $g(u,d,o.fieldTransforms)}function WB(n,e,t,r=!1){let i=n.createContext(r?4:3,e);return Xo(t,i)}function Xo(n,e){if(n=ue(n),$B(n))return WI("Unsupported field value:",e,n),jB(n,e);if(n instanceof _i)return Vee(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.arrayElement&&e.dataSource!==4)throw e.createError("Nested arrays are not supported");return Bee(n,e)}else return Uee(n,e)}function jB(n,e){let t={};return e2(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Qo(n,(r,i)=>{let s=Xo(i,e.childContextForField(r));s!=null&&(t[r]=s)}),{mapValue:{fields:t}}}function Bee(n,e){let t=[],r=0;for(let i of n){let s=Xo(i,e.childContextForArray(r));s==null&&(s={nullValue:"NULL_VALUE"}),t.push(s),r++}return{arrayValue:{values:t}}}function Vee(n,e){if(!zB(e.dataSource))throw e.createError(`${n._methodName}() can only be used with update() and set()`);if(!e.path)throw e.createError(`${n._methodName}() is not currently supported inside arrays`);let t=n._toFieldTransform(e);t&&e.fieldTransforms.push(t)}function Uee(n,e){if(n=ue(n),n===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return R2(e.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){let t=He.fromDate(n);return{timestampValue:jl(e.serializer,t)}}else if(n instanceof He){let t=new He(n.seconds,Math.floor(n.nanoseconds/1e3)*1e3);return{timestampValue:jl(e.serializer,t)}}else{if(n instanceof jo)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof Hr)return{bytesValue:V2(e.serializer,n._byteString)};if(n instanceof Pe){let t=e.databaseId,r=n.firestore._databaseId;if(!r.isEqual(t))throw e.createError(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${t.projectId}/${t.database}`);return{referenceValue:lI(n.firestore._databaseId||e.databaseId,n._key.path)}}else{if(n instanceof $d)return qee(n,e);throw e.createError(`Unsupported field value: ${sh(n)}`)}}}function qee(n,e){return{mapValue:{fields:{[eI]:{stringValue:tI},[Vl]:{arrayValue:{values:n.toArray().map(r=>{if(typeof r!="number")throw e.createError("VectorValues must only contain numeric values.");return aI(e.serializer,r)})}}}}}}function $B(n){return typeof n=="object"&&n!==null&&!(n instanceof Array)&&!(n instanceof Date)&&!(n instanceof He)&&!(n instanceof jo)&&!(n instanceof Hr)&&!(n instanceof Pe)&&!(n instanceof _i)&&!(n instanceof $d)}function WI(n,e,t){if(!$B(t)||!tee(t)){let r=sh(t);throw r==="an object"?e.createError(n+" a custom object"):e.createError(n+" "+r)}}function F0(n,e,t){if(e=ue(e),e instanceof lr)return e._internalPath;if(typeof e=="string")return jI(n,e);throw Kg("Field path arguments must be of type string or ",n,!1,void 0,t)}var zee=new RegExp("[~\\*/\\[\\]]");function jI(n,e,t){if(e.search(zee)>=0)throw Kg(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new lr(...e.split("."))._internalPath}catch{throw Kg(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Kg(n,e,t,r,i){let s=r&&!r.isEmpty(),o=i!==void 0,a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(s||o)&&(l+=" (found",s&&(l+=` in field ${r}`),o&&(l+=` in document ${i}`),l+=")"),new k(R.INVALID_ARGUMENT,a+n+l)}function HB(n,e){return n.some(t=>t.isEqual(e))}var $o=class{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Pe(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document)if(this._converter){let e=new L0(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}else return this._userDataWriter.convertValue(this._document.data.value);else return}get(e){if(this._document){let t=this._document.data.field(Ey("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},L0=class extends $o{data(){return super.data()}};function Ey(n,e){return typeof e=="string"?jI(n,e):e instanceof lr?e._internalPath:e._delegate._internalPath}function KB(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new k(R.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Kd=class{},Ho=class extends Kd{};function Kr(n,e,...t){let r=[];e instanceof Kd&&r.push(e),r=r.concat(t),Yee(r);for(let i of r)n=i._apply(n);return n}var Qg=class n extends Ho{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=this._parse(e);return YB(e._query,t),new Dt(e.firestore,e.converter,sI(e._query,t))}_parse(e){let t=Yo(e.firestore);return Gee(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function $I(n,e,t){let r=e,i=Ey("where",n);return Qg._create(i,r,t)}var B0=class n extends Kd{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new n(e,t)}_parse(e){let t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:Ie.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(Kee(e._query,t),new Dt(e.firestore,e.converter,sI(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var V0=class n extends Ho{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new n(e,t)}_apply(e){let t=Wee(e._query,this._field,this._direction);return new Dt(e.firestore,e.converter,l7(e._query,t))}};function HI(n,e="asc"){let t=e,r=Ey("orderBy",n);return V0._create(r,t)}var Yg=class n extends Ho{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){return new Dt(e.firestore,e.converter,yg(e._query,this._limit,this._limitType))}};function KI(n){return kB("limit",n),Yg._create("limit",n,"F")}function QI(n){return kB("limitToLast",n),Yg._create("limitToLast",n,"L")}var Xg=class n extends Ho{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=QB(e,this.type,this._docOrFields,this._inclusive);return new Dt(e.firestore,e.converter,c7(e._query,t))}};function YI(...n){return Xg._create("startAt",n,!0)}function XI(...n){return Xg._create("startAfter",n,!1)}var Jg=class n extends Ho{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=QB(e,this.type,this._docOrFields,this._inclusive);return new Dt(e.firestore,e.converter,u7(e._query,t))}};function JI(...n){return Jg._create("endBefore",n,!1)}function ZI(...n){return Jg._create("endAt",n,!0)}function QB(n,e,t,r){if(t[0]=ue(t[0]),t[0]instanceof $o)return jee(n._query,n.firestore._databaseId,e,t[0]._document,r);{let i=Yo(n.firestore);return $ee(n._query,n.firestore._databaseId,i,e,t,r)}}function Gee(n,e,t,r,i,s,o){let a;if(i.isKeyField()){if(s==="array-contains"||s==="array-contains-any")throw new k(R.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if(s==="in"||s==="not-in"){xL(o,s);let c=[];for(let u of o)c.push(OL(r,n,u));a={arrayValue:{values:c}}}else a=OL(r,n,o)}else(s==="in"||s==="not-in"||s==="array-contains-any")&&xL(o,s),a=WB(t,e,o,s==="in"||s==="not-in");return de.create(i,s,a)}function Wee(n,e,t){if(n.startAt!==null)throw new k(R.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(n.endAt!==null)throw new k(R.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Bo(e,t)}function jee(n,e,t,r,i){if(!r)throw new k(R.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${t}().`);let s=[];for(let o of zl(n))if(o.field.isKeyField())s.push(Lo(e,r.key));else{let a=r.data.field(o.field);if(oy(a))throw new k(R.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+o.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(a!==null)s.push(a);else{let l=o.field.canonicalString();throw new k(R.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${l}' (used as the orderBy) does not exist.`)}}return new jr(s,i)}function $ee(n,e,t,r,i,s){let o=n.explicitOrderBy;if(i.length>o.length)throw new k(R.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let a=[];for(let l=0;l<i.length;l++){let c=i[l];if(o[l].field.isKeyField()){if(typeof c!="string")throw new k(R.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof c}`);if(!iI(n)&&c.indexOf("/")!==-1)throw new k(R.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${c}' contains a slash.`);let d=n.path.child(pe.fromString(c));if(!V.isDocumentKey(d))throw new k(R.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${d}' is not because it contains an odd number of segments.`);let h=new V(d);a.push(Lo(e,h))}else{let d=WB(t,r,c);a.push(d)}}return new jr(a,s)}function OL(n,e,t){if(t=ue(t),typeof t=="string"){if(t==="")throw new k(R.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!iI(e)&&t.indexOf("/")!==-1)throw new k(R.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let r=e.path.child(pe.fromString(t));if(!V.isDocumentKey(r))throw new k(R.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Lo(n,new V(r))}else{if(t instanceof Pe)return Lo(n,t._key);throw new k(R.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${sh(t)}.`)}}function xL(n,e){if(!Array.isArray(n)||n.length===0)throw new k(R.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Hee(n){switch(n){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}function YB(n,e){let t=Qee(n.filters,Hee(e.op));if(t!==null)throw t===e.op?new k(R.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new k(R.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function Kee(n,e){let t=n,r=e.getFlattenedFilters();for(let i of r)YB(t,i),t=sI(t,i)}function Qee(n,e){for(let t of n)for(let r of t.getFlattenedFilters())if(e.indexOf(r.op)>=0)return r.op;return null}function Yee(n){let e=n.filter(r=>r instanceof B0).length,t=n.filter(r=>r instanceof Qg).length;if(e>1||e>0&&t>0)throw new k(R.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}var ec=class{convertValue(e,t="none"){switch(Fo(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ge(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Is(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw z()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return Qo(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertVectorValue(e){var t,r,i;let s=(i=(r=(t=e.fields)===null||t===void 0?void 0:t[Vl].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.map(o=>Ge(o.doubleValue));return new $d(s)}convertGeoPoint(e){return new jo(Ge(e.latitude),Ge(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=Z0(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Rd(e));default:return null}}convertTimestamp(e){let t=mi(e);return new He(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=pe.fromString(e);j(Y2(r));let i=new As(r.get(1),r.get(3)),s=new V(r.popFirst(5));return i.isEqual(t)||$e(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function Sy(n,e,t){let r;return n?t&&(t.merge||t.mergeFields)?r=n.toFirestore(e,t):r=n.toFirestore(e):r=e,r}var U0=class extends ec{constructor(e){super(),this.firestore=e}convertBytes(e){return new Hr(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new Pe(this.firestore,null,t)}};function q0(n){return Xee(n,["next","error","complete"])}function Xee(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}var vi=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},qn=class extends $o{constructor(e,t,r,i,s,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document)if(this._converter){let t=new Ps(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}else return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps);else return}get(e,t={}){if(this._document){let r=this._document.data.field(Ey("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}},Ps=class extends qn{data(e={}){return super.data(e)}},cr=class{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new vi(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Ps(this._firestore,this._userDataWriter,r.key,r,new vi(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new k(R.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return(!this._cachedChanges||this._cachedChangesIncludeMetadataChanges!==t)&&(this._cachedChanges=Jee(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function Jee(n,e){if(n._snapshot.oldDocs.isEmpty()){let t=0;return n._snapshot.docChanges.map(r=>{let i=new Ps(n._firestore,n._userDataWriter,r.doc.key,r.doc,new vi(n._snapshot.mutatedKeys.has(r.doc.key),n._snapshot.fromCache),n.query.converter);return r.doc,{type:"added",doc:i,oldIndex:-1,newIndex:t++}})}else{let t=n._snapshot.oldDocs;return n._snapshot.docChanges.filter(r=>e||r.type!==3).map(r=>{let i=new Ps(n._firestore,n._userDataWriter,r.doc.key,r.doc,new vi(n._snapshot.mutatedKeys.has(r.doc.key),n._snapshot.fromCache),n.query.converter),s=-1,o=-1;return r.type!==0&&(s=t.indexOf(r.doc.key),t=t.delete(r.doc.key)),r.type!==1&&(t=t.add(r.doc),o=t.indexOf(r.doc.key)),{type:Zee(r.type),doc:i,oldIndex:s,newIndex:o}})}}function Zee(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return z()}}function Cy(n,e){return n instanceof qn&&e instanceof qn?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof cr&&e instanceof cr?n._firestore===e._firestore&&_y(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot):!1}function eA(n){n=_e(n,Pe);let e=_e(n.firestore,Ke),t=Nt(e);return PB(t,n._key).then(r=>cA(e,n,r))}var Ei=class extends ec{constructor(e){super(),this.firestore=e}convertBytes(e){return new Hr(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new Pe(this.firestore,null,t)}};function tA(n){n=_e(n,Pe);let e=_e(n.firestore,Ke),t=Nt(e),r=new Ei(e);return mee(t,n._key).then(i=>new qn(e,r,n._key,i,new vi(i!==null&&i.hasLocalMutations,!0),n.converter))}function nA(n){n=_e(n,Pe);let e=_e(n.firestore,Ke),t=Nt(e);return PB(t,n._key,{source:"server"}).then(r=>cA(e,n,r))}function rA(n){n=_e(n,Dt);let e=_e(n.firestore,Ke),t=Nt(e),r=new Ei(e);return KB(n._query),MB(t,n._query).then(i=>new cr(e,r,n,i))}function iA(n){n=_e(n,Dt);let e=_e(n.firestore,Ke),t=Nt(e),r=new Ei(e);return gee(t,n._query).then(i=>new cr(e,r,n,i))}function sA(n){n=_e(n,Dt);let e=_e(n.firestore,Ke),t=Nt(e),r=new Ei(e);return MB(t,n._query,{source:"server"}).then(i=>new cr(e,r,n,i))}function wy(n,e,t){n=_e(n,Pe);let r=_e(n.firestore,Ke),i=Sy(n.converter,e,t),s=Yo(r),a=vy(s,"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,Je.none());return hc(r,[a])}function Ty(n,e,t,...r){n=_e(n,Pe);let i=_e(n.firestore,Ke),s=Yo(i);e=ue(e);let o;typeof e=="string"||e instanceof lr?o=GI(s,"updateDoc",n._key,e,t,r):o=zI(s,"updateDoc",n._key,e);let a=o.toMutation(n._key,Je.exists(!0));return hc(i,[a])}function oA(n){let e=_e(n.firestore,Ke),t=[new Os(n._key,Je.none())];return hc(e,t)}function aA(n,e){let t=_e(n.firestore,Ke),r=dc(n),i=Sy(n.converter,e),s=Yo(n.firestore),a=vy(s,"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,Je.exists(!1));return hc(t,[a]).then(()=>r)}function by(n,...e){var t,r,i;n=ue(n);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]=="object"&&!q0(e[o])&&(s=e[o],o++);let a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(q0(e[o])){let h=e[o];e[o]=(t=h.next)===null||t===void 0?void 0:t.bind(h),e[o+1]=(r=h.error)===null||r===void 0?void 0:r.bind(h),e[o+2]=(i=h.complete)===null||i===void 0?void 0:i.bind(h)}let l,c,u;if(n instanceof Pe)c=_e(n.firestore,Ke),u=sc(n._key.path),l={next:h=>{e[o]&&e[o](cA(c,n,h))},error:e[o+1],complete:e[o+2]};else{let h=_e(n,Dt);c=_e(h.firestore,Ke),u=h._query;let p=new Ei(c);l={next:E=>{e[o]&&e[o](new cr(c,p,h,E))},error:e[o+1],complete:e[o+2]},KB(n._query)}let d=Nt(c);return pee(d,u,a,l)}function lA(n,e){n=_e(n,Ke);let t=Nt(n),r=q0(e)?e:{next:e};return _ee(t,r)}function hc(n,e){let t=Nt(n);return yee(t,e)}function cA(n,e,t){let r=t.docs.get(e._key),i=new Ei(n);return new qn(n,i,e._key,r,new vi(t.hasPendingWrites,t.fromCache),e.converter)}var ete={maxAttempts:5};function tte(n){if(n.maxAttempts<1)throw new k(R.INVALID_ARGUMENT,"Max attempts must be at least 1")}var Zg=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Yo(e)}set(e,t,r){this._verifyNotCommitted();let i=Cs(e,this._firestore),s=Sy(i.converter,t,r),o=vy(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,r);return this._mutations.push(o.toMutation(i._key,Je.none())),this}update(e,t,r,...i){this._verifyNotCommitted();let s=Cs(e,this._firestore);t=ue(t);let o;return typeof t=="string"||t instanceof lr?o=GI(this._dataReader,"WriteBatch.update",s._key,t,r,i):o=zI(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,Je.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=Cs(e,this._firestore);return this._mutations=this._mutations.concat(new Os(t._key,Je.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new k(R.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function Cs(n,e){if(n=ue(n),n.firestore!==e)throw new k(R.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}var z0=class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=Yo(e)}get(e){let t=Cs(e,this._firestore),r=new U0(this._firestore);return this._transaction.lookup([t._key]).then(i=>{if(!i||i.length!==1)return z();let s=i[0];if(s.isFoundDocument())return new $o(this._firestore,r,s.key,s,t.converter);if(s.isNoDocument())return new $o(this._firestore,r,t._key,null,t.converter);throw z()})}set(e,t,r){let i=Cs(e,this._firestore),s=Sy(i.converter,t,r),o=vy(this._dataReader,"Transaction.set",i._key,s,i.converter!==null,r);return this._transaction.set(i._key,o),this}update(e,t,r,...i){let s=Cs(e,this._firestore);t=ue(t);let o;return typeof t=="string"||t instanceof lr?o=GI(this._dataReader,"Transaction.update",s._key,t,r,i):o=zI(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,o),this}delete(e){let t=Cs(e,this._firestore);return this._transaction.delete(t._key),this}};var G0=class extends z0{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=Cs(e,this._firestore),r=new Ei(this._firestore);return super.get(e).then(i=>new qn(this._firestore,r,t._key,i._document,new vi(!1,!1),t.converter))}};function uA(n,e,t){n=_e(n,Ke);let r=Object.assign(Object.assign({},ete),t);tte(r);let i=Nt(n);return vee(i,s=>e(new G0(n,s)),r)}function dA(){return new Hd("deleteField")}function hA(){return new O0("serverTimestamp")}function fA(...n){return new x0("arrayUnion",n)}function pA(...n){return new P0("arrayRemove",n)}function mA(n){return new M0("increment",n)}Fee("node");var oh=class{constructor(e){return e}},XB="firestore",gA=class{constructor(){return $s(XB)}};var yA=new ge("angularfire2.firestore-instances");function nte(n,e){let t=ca(XB,n,e);return t&&new oh(t)}function rte(n){return(e,t)=>{let r=e.runOutsideAngular(()=>n(t));return new oh(r)}}var ite={provide:gA,deps:[[new pt,yA]]},ste={provide:oh,useFactory:nte,deps:[[new pt,yA],jn]};function JB(n,...e){return et("angularfire",St.full,"fst"),Ti([ste,ite,{provide:yA,useFactory:rte(n),multi:!0,deps:[vt,Jr,en,ei,[new pt,fo],[new pt,qt],...e]}])}var ZB=Ri(VB,!0);var ah=class{constructor(e){return e}},eV="database",_A=class{constructor(){return $s(eV)}};var vA=new ge("angularfire2.database-instances");function ote(n,e){let t=ca(eV,n,e);return t&&new ah(t)}function ate(n){return(e,t)=>{let r=e.runOutsideAngular(()=>n(t));return new ah(r)}}var lte={provide:_A,deps:[[new pt,vA]]},cte={provide:ah,useFactory:ote,deps:[[new pt,vA],jn]};function tV(n,...e){return et("angularfire",St.full,"rtdb"),Ti([cte,lte,{provide:vA,useFactory:ate(n),multi:!0,deps:[vt,Jr,en,ei,[new pt,fo],[new pt,qt],...e]}])}var nV=Ri(Yk,!0);var ute="@firebase/firestore-compat",dte="0.3.38";function bA(n,e){if(e===void 0)return{merge:!1};if(e.mergeFields!==void 0&&e.merge!==void 0)throw new k("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function rV(){if(typeof Uint8Array>"u")throw new k("unimplemented","Uint8Arrays are not available in this environment.")}function iV(){if(!t2())throw new k("unimplemented","Blobs are unavailable in Firestore in this environment.")}var Iy=class n{constructor(e){this._delegate=e}static fromBase64String(e){return iV(),new n(Hr.fromBase64String(e))}static fromUint8Array(e){return rV(),new n(Hr.fromUint8Array(e))}toBase64(){return iV(),this._delegate.toBase64()}toUint8Array(){return rV(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}};function EA(n){return hte(n,["next","error","complete"])}function hte(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}var SA=class{enableIndexedDbPersistence(e,t){return PI(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return MI(e._delegate)}clearIndexedDbPersistence(e){return FI(e._delegate)}},Ay=class{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof As||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){let t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&ir("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},t),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,r={}){my(this._delegate,e,t,r)}enableNetwork(){return BI(this._delegate)}disableNetwork(){return VI(this._delegate)}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,DI("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return LI(this._delegate)}onSnapshotsInSync(e){return lA(this._delegate,e)}get app(){if(!this._appCompat)throw new k("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new mc(this,gy(this._delegate,e))}catch(t){throw Jt(t,"collection()","Firestore.collection()")}}doc(e){try{return new Qr(this,dc(this._delegate,e))}catch(t){throw Jt(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new ta(this,xI(this._delegate,e))}catch(t){throw Jt(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return uA(this._delegate,t=>e(new Ry(this,t)))}batch(){return Nt(this._delegate),new Dy(new Zg(this._delegate,e=>hc(this._delegate,e)))}loadBundle(e){return UI(this._delegate,e)}namedQuery(e){return qI(this._delegate,e).then(t=>t?new ta(this,t):null)}},fc=class extends ec{constructor(e){super(),this.firestore=e}convertBytes(e){return new Iy(new Hr(e))}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return Qr.forKey(t,this.firestore,null)}};function fte(n){W0(n)}var Ry=class{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new fc(e)}get(e){let t=Jo(e);return this._delegate.get(t).then(r=>new Zo(this._firestore,new qn(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,t.converter)))}set(e,t,r){let i=Jo(e);return r?(bA("Transaction.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){let s=Jo(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){let t=Jo(e);return this._delegate.delete(t),this}},Dy=class{constructor(e){this._delegate=e}set(e,t,r){let i=Jo(e);return r?(bA("WriteBatch.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){let s=Jo(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){let t=Jo(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}},pc=class n{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){let r=new Ps(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new ea(this._firestore,r),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){let r=n.INSTANCES,i=r.get(e);i||(i=new WeakMap,r.set(e,i));let s=i.get(t);return s||(s=new n(e,new fc(e),t),i.set(t,s)),s}};pc.INSTANCES=new WeakMap;var Qr=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new fc(e)}static forPath(e,t,r){if(e.length%2!==0)throw new k("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new n(t,new Pe(t._delegate,r,new V(e)))}static forKey(e,t,r){return new n(t,new Pe(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new mc(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new mc(this.firestore,gy(this._delegate,e))}catch(t){throw Jt(t,"collection()","DocumentReference.collection()")}}isEqual(e){return e=ue(e),e instanceof Pe?yy(this._delegate,e):!1}set(e,t){t=bA("DocumentReference.set",t);try{return t?wy(this._delegate,e,t):wy(this._delegate,e)}catch(r){throw Jt(r,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return arguments.length===1?Ty(this._delegate,e):Ty(this._delegate,e,t,...r)}catch(i){throw Jt(i,"updateDoc()","DocumentReference.update()")}}delete(){return oA(this._delegate)}onSnapshot(...e){let t=sV(e),r=oV(e,i=>new Zo(this.firestore,new qn(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return by(this._delegate,t,r)}get(e){let t;return e?.source==="cache"?t=tA(this._delegate):e?.source==="server"?t=nA(this._delegate):t=eA(this._delegate),t.then(r=>new Zo(this.firestore,new qn(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(pc.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function Jt(n,e,t){return n.message=n.message.replace(e,t),n}function sV(n){for(let e of n)if(typeof e=="object"&&!EA(e))return e;return{}}function oV(n,e){var t,r;let i;return EA(n[0])?i=n[0]:EA(n[1])?i=n[1]:typeof n[0]=="function"?i={next:n[0],error:n[1],complete:n[2]}:i={next:n[1],error:n[2],complete:n[3]},{next:s=>{i.next&&i.next(e(s))},error:(t=i.error)===null||t===void 0?void 0:t.bind(i),complete:(r=i.complete)===null||r===void 0?void 0:r.bind(i)}}var Zo=class{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new Qr(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return Cy(this._delegate,e._delegate)}},ea=class extends Zo{data(e){let t=this._delegate.data(e);return this._delegate._converter||ML(t!==void 0,"Document in a QueryDocumentSnapshot should exist"),t}},ta=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new fc(e)}where(e,t,r){try{return new n(this.firestore,Kr(this._delegate,$I(e,t,r)))}catch(i){throw Jt(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new n(this.firestore,Kr(this._delegate,HI(e,t)))}catch(r){throw Jt(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new n(this.firestore,Kr(this._delegate,KI(e)))}catch(t){throw Jt(t,"limit()","Query.limit()")}}limitToLast(e){try{return new n(this.firestore,Kr(this._delegate,QI(e)))}catch(t){throw Jt(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new n(this.firestore,Kr(this._delegate,YI(...e)))}catch(t){throw Jt(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new n(this.firestore,Kr(this._delegate,XI(...e)))}catch(t){throw Jt(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new n(this.firestore,Kr(this._delegate,JI(...e)))}catch(t){throw Jt(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new n(this.firestore,Kr(this._delegate,ZI(...e)))}catch(t){throw Jt(t,"endAt()","Query.endAt()")}}isEqual(e){return _y(this._delegate,e._delegate)}get(e){let t;return e?.source==="cache"?t=iA(this._delegate):e?.source==="server"?t=sA(this._delegate):t=rA(this._delegate),t.then(r=>new lh(this.firestore,new cr(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...e){let t=sV(e),r=oV(e,i=>new lh(this.firestore,new cr(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return by(this._delegate,t,r)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(pc.getInstance(this.firestore,e)):this._delegate.withConverter(null))}},CA=class{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new ea(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}},lh=class{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new ta(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new ea(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new CA(this._firestore,t))}forEach(e,t){this._delegate.forEach(r=>{e.call(t,new ea(this._firestore,r))})}isEqual(e){return Cy(this._delegate,e._delegate)}},mc=class n extends ta{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){let e=this._delegate.parent;return e?new Qr(this.firestore,e):null}doc(e){try{return e===void 0?new Qr(this.firestore,dc(this._delegate)):new Qr(this.firestore,dc(this._delegate,e))}catch(t){throw Jt(t,"doc()","CollectionReference.doc()")}}add(e){return aA(this._delegate,e).then(t=>new Qr(this.firestore,t))}isEqual(e){return yy(this._delegate,e._delegate)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(pc.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function Jo(n){return _e(n,Pe)}var wA=class n{constructor(...e){this._delegate=new lr(...e)}static documentId(){return new n(it.keyField().canonicalString())}isEqual(e){return e=ue(e),e instanceof lr?this._delegate._internalPath.isEqual(e._internalPath):!1}};var TA=class n{constructor(e){this._delegate=e}static serverTimestamp(){let e=hA();return e._methodName="FieldValue.serverTimestamp",new n(e)}static delete(){let e=dA();return e._methodName="FieldValue.delete",new n(e)}static arrayUnion(...e){let t=fA(...e);return t._methodName="FieldValue.arrayUnion",new n(t)}static arrayRemove(...e){let t=pA(...e);return t._methodName="FieldValue.arrayRemove",new n(t)}static increment(e){let t=mA(e);return t._methodName="FieldValue.increment",new n(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}};var pte={Firestore:Ay,GeoPoint:jo,Timestamp:He,Blob:Iy,Transaction:Ry,WriteBatch:Dy,DocumentReference:Qr,DocumentSnapshot:Zo,Query:ta,QueryDocumentSnapshot:ea,QuerySnapshot:lh,CollectionReference:mc,FieldPath:wA,FieldValue:TA,setLogLevel:fte,CACHE_SIZE_UNLIMITED:BB};function mte(n,e){n.INTERNAL.registerComponent(new ln("firestore-compat",t=>{let r=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(r,i)},"PUBLIC").setServiceProps(Object.assign({},pte)))}function gte(n){mte(n,(e,t)=>new Ay(e,t,new SA)),n.registerVersion(ute,dte,"node")}gte(gt);function yte(n,e=ra){return new ur(t=>{let r;return e!=null?e.schedule(()=>{r=n.onSnapshot({includeMetadataChanges:!0},t)}):r=n.onSnapshot({includeMetadataChanges:!0},t),()=>{r?.()}})}function aV(n,e){return yte(n,e)}function _te(n,e){return aV(n,e).pipe(fh(void 0),hh(),Be(t=>{let[r,i]=t;return i.exists?r?.exists?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))}function RA(n,e){return aV(n,e).pipe(Be(t=>({payload:t,type:"query"})))}var Ny=class{ref;afs;constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){let r=this.ref.collection(e),{ref:i,query:s}=hV(r,t);return new Oy(i,s,this.afs)}snapshotChanges(){return _te(this.ref,this.afs.schedulers.outsideAngular).pipe(Ye)}valueChanges(e={}){return this.snapshotChanges().pipe(Be(({payload:t})=>e.idField?Sn(Ut({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return dr(this.ref.get(e)).pipe(Ye)}};function ky(n,e){return RA(n,e).pipe(fh(void 0),hh(),Be(t=>{let[r,i]=t,s=i.payload.docChanges(),o=s.map(a=>({type:a.type,payload:a}));return r&&JSON.stringify(r.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((a,l)=>{let c=s.find(d=>d.doc.ref.isEqual(a.ref)),u=r?.payload.docs.find(d=>d.ref.isEqual(a.ref));c&&JSON.stringify(c.doc.metadata)===JSON.stringify(a.metadata)||!c&&u&&JSON.stringify(u.metadata)===JSON.stringify(a.metadata)||o.push({type:"modified",payload:{oldIndex:l,newIndex:l,type:"modified",doc:a}})}),o}))}function lV(n,e,t){return ky(n,t).pipe(qs((r,i)=>vte(r,i.map(s=>s.payload),e),[]),dh(),Be(r=>r.map(i=>({type:i.type,payload:i}))))}function vte(n,e,t){return e.forEach(r=>{t.indexOf(r.type)>-1&&(n=Ete(n,r))}),n}function IA(n,e,t,...r){let i=n.slice();return i.splice(e,t,...r),i}function Ete(n,e){switch(e.type){case"added":if(!(n[e.newIndex]&&n[e.newIndex].doc.ref.isEqual(e.doc.ref)))return IA(n,e.newIndex,0,e);break;case"modified":if(n[e.oldIndex]==null||n[e.oldIndex].doc.ref.isEqual(e.doc.ref))if(e.oldIndex!==e.newIndex){let t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}else return IA(n,e.newIndex,1,e);break;case"removed":if(n[e.oldIndex]&&n[e.oldIndex].doc.ref.isEqual(e.doc.ref))return IA(n,e.oldIndex,1);break}return n}function cV(n){return(!n||n.length===0)&&(n=["added","removed","modified"]),n}var Oy=class{ref;query;afs;constructor(e,t,r){this.ref=e,this.query=t,this.afs=r}stateChanges(e){let t=ky(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe(Be(r=>r.filter(i=>e.indexOf(i.type)>-1)))),t.pipe(fh(void 0),hh(),yc(([r,i])=>i.length>0||!r),Be(([,r])=>r),Ye)}auditTrail(e){return this.stateChanges(e).pipe(qs((t,r)=>[...t,...r],[]))}snapshotChanges(e){let t=cV(e);return lV(this.query,t,this.afs.schedulers.outsideAngular).pipe(Ye)}valueChanges(e={}){return RA(this.query,this.afs.schedulers.outsideAngular).pipe(Be(t=>t.payload.docs.map(r=>e.idField?Sn(Ut({},r.data()),{[e.idField]:r.id}):r.data())),Ye)}get(e){return dr(this.query.get(e)).pipe(Ye)}add(e){return this.ref.add(e)}doc(e){return new Ny(this.ref.doc(e),this.afs)}},AA=class{query;afs;constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return!e||e.length===0?ky(this.query,this.afs.schedulers.outsideAngular).pipe(Ye):ky(this.query,this.afs.schedulers.outsideAngular).pipe(Be(t=>t.filter(r=>e.indexOf(r.type)>-1)),yc(t=>t.length>0),Ye)}auditTrail(e){return this.stateChanges(e).pipe(qs((t,r)=>[...t,...r],[]))}snapshotChanges(e){let t=cV(e);return lV(this.query,t,this.afs.schedulers.outsideAngular).pipe(Ye)}valueChanges(e={}){return RA(this.query,this.afs.schedulers.outsideAngular).pipe(Be(r=>r.payload.docs.map(i=>e.idField?Ut({[e.idField]:i.id},i.data()):i.data())),Ye)}get(e){return dr(this.query.get(e)).pipe(Ye)}},uV=new ge("angularfire2.enableFirestorePersistence"),dV=new ge("angularfire2.firestore.persistenceSettings"),Ste=new ge("angularfire2.firestore.settings"),Cte=new ge("angularfire2.firestore.use-emulator");function hV(n,e=t=>t){return{query:e(n),ref:n}}var wte=(()=>{class n{schedulers;firestore;persistenceEnabled$;constructor(t,r,i,s,o,a,l,c,u,d,h,p,E,w,b,N,D){this.schedulers=l;let O=Hs(t,a,r),F=u;d&&Pc(O,a,h,E,w,b,p,N),[this.firestore,this.persistenceEnabled$]=ua(`${O.name}.firestore`,"AngularFirestore",O.name,()=>{let G=a.runOutsideAngular(()=>O.firestore());if(s&&G.settings(s),F&&G.useEmulator(...F),i&&!_h(o)){let J=()=>{try{return dr(G.enablePersistence(c||void 0).then(()=>!0,()=>!1))}catch(S){return typeof console<"u"&&console.warn(S),hr(!1)}};return[G,a.runOutsideAngular(J)]}else return[G,hr(!1)]},[s,F,i])}collection(t,r){let i;typeof t=="string"?i=this.firestore.collection(t):i=t;let{ref:s,query:o}=hV(i,r),a=this.schedulers.ngZone.run(()=>s);return new Oy(a,o,this)}collectionGroup(t,r){let i=r||(o=>o),s=this.firestore.collectionGroup(t);return new AA(i(s),this)}doc(t){let r;typeof t=="string"?r=this.firestore.doc(t):r=t;let i=this.schedulers.ngZone.run(()=>r);return new Ny(i,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(r){return new(r||n)(Z(Ni),Z(ki,8),Z(uV,8),Z(Ste,8),Z(pr),Z(vt),Z(en),Z(dV,8),Z(Cte,8),Z(Mc,8),Z(Rc,8),Z(Dc,8),Z(Nc,8),Z(kc,8),Z(Oc,8),Z(xc,8),Z(qt,8))};static \u0275prov=Cn({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),fV=(()=>{class n{constructor(){gt.registerVersion("angularfire",St.full,"fst-compat")}static enablePersistence(t){return{ngModule:n,providers:[{provide:uV,useValue:!0},{provide:dV,useValue:t}]}}static \u0275fac=function(r){return new(r||n)};static \u0275mod=Gn({type:n});static \u0275inj=zn({providers:[wte]})}return n})();var pV={apiKey:"AIzaSyB80VTr7cPxvt1N8cX5DXRaO1z_VWinuJo",authDomain:"employee-management-c1a06.firebaseapp.com",databaseURL:"https://employee-management-c1a06-default-rtdb.firebaseio.com",projectId:"employee-management-c1a06",storageBucket:"employee-management-c1a06.firebasestorage.app",messagingSenderId:"481676635426",appId:"1:481676635426:web:3c371ff5fdd31fbabf497b",measurementId:"G-LWLWMSWGE9"};var mV={providers:[YA($O),LA([IR.initializeApp(pV),AR,lO,fV]),HA(),dR(()=>hR({projectId:"employee-management-c1a06",appId:"1:481676635426:web:3c371ff5fdd31fbabf497b",databaseURL:"https://employee-management-c1a06-default-rtdb.firebaseio.com",storageBucket:"employee-management-c1a06.firebasestorage.app",apiKey:"AIzaSyB80VTr7cPxvt1N8cX5DXRaO1z_VWinuJo",authDomain:"employee-management-c1a06.firebaseapp.com",messagingSenderId:"481676635426",measurementId:"G-LWLWMSWGE9"})),KO(()=>QO()),JB(()=>ZB()),tV(()=>nV())]};var Tte={providers:[KA()]},gV=jA(mV,Tte);var bte=()=>$A(lR,gV),_ce=bte;export{_r as a,_ce as b};
